{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to MkDocs For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Welcome to MkDocs"},{"location":"#welcome-to-mkdocs","text":"For full documentation visit mkdocs.org .","title":"Welcome to MkDocs"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit.","title":"Commands"},{"location":"#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"Financial%20engineering/Derivatives%20cheatsheet/","text":"Derivatives cheatsheet WE USE 360 DAYS not 365 Chapter 5. Forward and forward valuation SPI200 trade in whole points Debt futures trade in half points [!warning] Net gain from shorting Inflow from selling - outflow from closing position (buy) - dividend (must pay out) Outflow from buying + Dividend (receive) - inflow from closing position (sell) ![[Pasted image 20240206174607.png]] == The left column = forward price, the right column = value of the contract == You need K to find value of contract, but not for future price ![[Pasted image 20240114041907.png]] [!warning] ==[If foreign involved]== Calculate forward rate given xc rate & interest rates Forward rate = exchange rate . e ^ [(rfr local - rfr foreign)*time] [!warning] ==[Basic maths]== Continuous compounding find FV Future amount = Principal . e^(pa interest rate * time in years) [!warning] ==[Given table]== Estimating interest rate differentials from table Look at one country & its 2 'Prior settlement price' at 2 different times. * e.g. Australia September vs December: 1.0075 -> 1.0000 * % change = 1/1.0075 = 0.744% LOWER => Short term futures prices are DECREASING at a rate of 0.744% / 3 months = 0.744 / 3 * 12 = 2.976% per year. => This is also the amount by which short term Aus interest rates > short term US interest rates ![[Pasted image 20240202003335.png]] [!warning] Forward price of investment commodity Without income & storage costs: F = S . e^(rT) With storage costs U (U = PV of all storage costs): F = (S + U) . e^(rT) If U = proportional to price of commodity -> treated as negative yield: F = S.e^[(r+u)T] * u = storage cost per annum = proportion of spot price net of any yield earnt [!warning] Convenience & carry cost Investment asset | cost of carry c only ![[Pasted image 20240202195730.png]] Consumption asset | cost of carry c - convenience yield y ![[Pasted image 20240202195746.png]] Chapter 10. Options valuation Variable European Call European Put American Call American Put Current stock price + - + - Strike price - + - + Time to expiration ? ? + + Volatility + + + + Risk-free rate + - + - Dividends - + - + [!warning] Upper bounds Call: C \u2264 S(0) | c \u2264 S(0) * If X true -> arbitrage: buy the stock, sell the call option Put: P \u2264 K | p \u2264 Ke^(-rT) * If X true -> arbitrage: writing/sell the option, invest proceeds of the sale at rfr [!warning] Lower bound Call option: ![[Pasted image 20240204164909.png]] Put option: ![[Pasted image 20240204212630.png]] [!warning] Put call parity for stock WITHOUT DIVIDENDs ![[Pasted image 20240205185528.png]] WITH DIVIDENDs ![[Pasted image 20240205185412.png]] Arbitrage opportunity: 1. Find value of portfolio 1 (put call parity RHS): call & bond 2. Find value of portfolio 2 (LHS): put & share 3. Whatever is underpriced -> buy underpriced portfolio, sell overpriced portfolio * NOTE: portfolio 1 -> BUY/SELL THE CALL ONLY, ignore the bond. example: put call parity arbitrage [[Derivatives notes#^1e885b]] Chapter 12. Options - Binomial tree pricing [!NOTE]- 2 step binomial ![[Presentation_LamDongQuy_22119146_Week10.pdf]] [!warning] Valuation of options - 1 step SHORT WAY * f = value of option * d = transformation of current stock price if it goes down * u = transformation of current stock price if it goes up ![[Pasted image 20240304012806.png]] ![[Pasted image 20240304012856.png]] LONG WAY 1. Up value \u0394 - option = Down value \u0394 Solve for \u0394 Solve for value of portfolio (any of the two sides) 2. (\u0394 . current share price - f).e^(rt) = 38.4 Solve for f = 2.23 [!warning] Valuation of options - 2 step ![[Pasted image 20240304175612.png]] ![[Pasted image 20240329002523.png]] ![[Pasted image 20240304165312.png]] Chapter 13. Black-Scholes-Merton option pricing Probability Distribution of stock price (ln ST) ~ (expected value, variance) ![[Pasted image 20240305021349.png]] Prob dist of the cont compounded RATE OF RETURN \u03c3\u221a\u0394t Black pricing ![[Pasted image 20240306141705.png]] Prob of exercise call = N(d2) Prob of exercise put = 1 - N(d2) If there's dividend S0 = S0 - Dividend.e^(-r.time to discount the dividend only) e.g. s0 = 50, strike = 50, r = 0.1, option is 3 months If dividend is 1.5, expected in 2 months: S0 = 50 - 1.5.e^(-10% x 2/12) = 48.52 (NOT 3/12) Normdist ![[Pasted image 20240306170427.png]] ![[Pasted image 20240306170438.png]] ![[Pasted image 20240318173155.png]] Chapter 4. Interest rates Converting between different compounded rates ![[Pasted image 20240329004353.png]] Finding forward rate at T2 given zero rates at T1 and T2 ![[Pasted image 20240329014141.png]] Valuating an FRA ![[Pasted image 20240329014441.png]] Finding par yield ![[Pasted image 20240329071130.png]] d = PV of 1$ received at maturity m = # of coupon payments / year c = par yield par = principal A = all the discounting factor, aka pretend pmt d is invisible Chapter 3. Hedging & basis risk [!warning] Short / long hedge guide If what we're NEEDING TO SELL is gonna go down -> wanna lock in the higher selling rate -> SELL futures If what we're NEEDING TO BUY is gonna go down -> we wanna lock in the cheaper rate -> BUY futures ![[Pasted image 20240329114346.png]] ![[Pasted image 20240329114356.png]]","title":"Derivatives cheatsheet"},{"location":"Financial%20engineering/Derivatives%20cheatsheet/#derivatives-cheatsheet","text":"WE USE 360 DAYS not 365","title":"Derivatives cheatsheet"},{"location":"Financial%20engineering/Derivatives%20cheatsheet/#chapter-5-forward-and-forward-valuation","text":"SPI200 trade in whole points Debt futures trade in half points [!warning] Net gain from shorting Inflow from selling - outflow from closing position (buy) - dividend (must pay out) Outflow from buying + Dividend (receive) - inflow from closing position (sell) ![[Pasted image 20240206174607.png]] == The left column = forward price, the right column = value of the contract == You need K to find value of contract, but not for future price ![[Pasted image 20240114041907.png]] [!warning] ==[If foreign involved]== Calculate forward rate given xc rate & interest rates Forward rate = exchange rate . e ^ [(rfr local - rfr foreign)*time] [!warning] ==[Basic maths]== Continuous compounding find FV Future amount = Principal . e^(pa interest rate * time in years) [!warning] ==[Given table]== Estimating interest rate differentials from table Look at one country & its 2 'Prior settlement price' at 2 different times. * e.g. Australia September vs December: 1.0075 -> 1.0000 * % change = 1/1.0075 = 0.744% LOWER => Short term futures prices are DECREASING at a rate of 0.744% / 3 months = 0.744 / 3 * 12 = 2.976% per year. => This is also the amount by which short term Aus interest rates > short term US interest rates ![[Pasted image 20240202003335.png]] [!warning] Forward price of investment commodity Without income & storage costs: F = S . e^(rT) With storage costs U (U = PV of all storage costs): F = (S + U) . e^(rT) If U = proportional to price of commodity -> treated as negative yield: F = S.e^[(r+u)T] * u = storage cost per annum = proportion of spot price net of any yield earnt [!warning] Convenience & carry cost Investment asset | cost of carry c only ![[Pasted image 20240202195730.png]] Consumption asset | cost of carry c - convenience yield y ![[Pasted image 20240202195746.png]]","title":"Chapter 5. Forward and forward valuation"},{"location":"Financial%20engineering/Derivatives%20cheatsheet/#chapter-10-options-valuation","text":"Variable European Call European Put American Call American Put Current stock price + - + - Strike price - + - + Time to expiration ? ? + + Volatility + + + + Risk-free rate + - + - Dividends - + - + [!warning] Upper bounds Call: C \u2264 S(0) | c \u2264 S(0) * If X true -> arbitrage: buy the stock, sell the call option Put: P \u2264 K | p \u2264 Ke^(-rT) * If X true -> arbitrage: writing/sell the option, invest proceeds of the sale at rfr [!warning] Lower bound Call option: ![[Pasted image 20240204164909.png]] Put option: ![[Pasted image 20240204212630.png]] [!warning] Put call parity for stock WITHOUT DIVIDENDs ![[Pasted image 20240205185528.png]] WITH DIVIDENDs ![[Pasted image 20240205185412.png]] Arbitrage opportunity: 1. Find value of portfolio 1 (put call parity RHS): call & bond 2. Find value of portfolio 2 (LHS): put & share 3. Whatever is underpriced -> buy underpriced portfolio, sell overpriced portfolio * NOTE: portfolio 1 -> BUY/SELL THE CALL ONLY, ignore the bond. example: put call parity arbitrage [[Derivatives notes#^1e885b]]","title":"Chapter 10. Options valuation"},{"location":"Financial%20engineering/Derivatives%20cheatsheet/#chapter-12-options-binomial-tree-pricing","text":"[!NOTE]- 2 step binomial ![[Presentation_LamDongQuy_22119146_Week10.pdf]] [!warning] Valuation of options - 1 step SHORT WAY * f = value of option * d = transformation of current stock price if it goes down * u = transformation of current stock price if it goes up ![[Pasted image 20240304012806.png]] ![[Pasted image 20240304012856.png]] LONG WAY 1. Up value \u0394 - option = Down value \u0394 Solve for \u0394 Solve for value of portfolio (any of the two sides) 2. (\u0394 . current share price - f).e^(rt) = 38.4 Solve for f = 2.23 [!warning] Valuation of options - 2 step ![[Pasted image 20240304175612.png]] ![[Pasted image 20240329002523.png]] ![[Pasted image 20240304165312.png]]","title":"Chapter 12. Options - Binomial tree pricing"},{"location":"Financial%20engineering/Derivatives%20cheatsheet/#chapter-13-black-scholes-merton-option-pricing","text":"Probability Distribution of stock price (ln ST) ~ (expected value, variance) ![[Pasted image 20240305021349.png]] Prob dist of the cont compounded RATE OF RETURN \u03c3\u221a\u0394t Black pricing ![[Pasted image 20240306141705.png]] Prob of exercise call = N(d2) Prob of exercise put = 1 - N(d2) If there's dividend S0 = S0 - Dividend.e^(-r.time to discount the dividend only) e.g. s0 = 50, strike = 50, r = 0.1, option is 3 months If dividend is 1.5, expected in 2 months: S0 = 50 - 1.5.e^(-10% x 2/12) = 48.52 (NOT 3/12) Normdist ![[Pasted image 20240306170427.png]] ![[Pasted image 20240306170438.png]] ![[Pasted image 20240318173155.png]]","title":"Chapter 13. Black-Scholes-Merton option pricing"},{"location":"Financial%20engineering/Derivatives%20cheatsheet/#chapter-4-interest-rates","text":"Converting between different compounded rates ![[Pasted image 20240329004353.png]] Finding forward rate at T2 given zero rates at T1 and T2 ![[Pasted image 20240329014141.png]] Valuating an FRA ![[Pasted image 20240329014441.png]] Finding par yield ![[Pasted image 20240329071130.png]] d = PV of 1$ received at maturity m = # of coupon payments / year c = par yield par = principal A = all the discounting factor, aka pretend pmt d is invisible","title":"Chapter 4. Interest rates"},{"location":"Financial%20engineering/Derivatives%20cheatsheet/#chapter-3-hedging-basis-risk","text":"[!warning] Short / long hedge guide If what we're NEEDING TO SELL is gonna go down -> wanna lock in the higher selling rate -> SELL futures If what we're NEEDING TO BUY is gonna go down -> we wanna lock in the cheaper rate -> BUY futures ![[Pasted image 20240329114346.png]] ![[Pasted image 20240329114356.png]]","title":"Chapter 3. Hedging &amp; basis risk"},{"location":"Financial%20engineering/Derivatives%20exercises/","text":"[[Derivatives]] Maths = blue, Orange = hard, Purple = theory, Orange = need some non-excel work, should revise [X] = excel ready Title Derivatives notes Date Created Saturday, 13th January 2024, 00:10:18 Last Modified Friday, 10th January 2025, 00:59:38 Area - school Class western sydney Tags - finance - derivatives Chapter 1. Basics [!NOTE]- What is the difference between (a) entering into a long futures contract when the futures price is \\$50 and (b) taking a long position in a call option with a strike price of \\$50? a) BUY future - buy the foreign not at the current market price now but at 50$; obligated to buy the asset for $50 and does not have a choice b) BUY call - buy the ability to buy at predetermined price; has the option to buy the asset for $50 but does not have to exercise the option [!NOTE]- An investor enters into a short forward contract to sell 100,000 British pounds for U.S. dollars at an exchange rate of 1.4000 U.S. dollars per pound. How much does the investor gain or lose if the exchange rate at the end of the contract is (a) 1.3900 and (b) 1.4200? Short forward = sell pounds for US not at current price but at 1 pound = 1.4 US * Gain 1.4 US * Lose 1 pound a) Later 1 pound = only worth 1.39 US -> 1.39 - 1.40 = -0.1 US . 100,000 The investor is obligated to sell pounds for 1.4000 when they are worth 1.3900. b) Pound appreciates -> Gain 0.2 US . 100,000 [!NOTE]- Suppose that you write a put contract with a strike price of $40 and an expiration date in three months. The current stock price is $41 and one put option contract is on 100 shares. What have you committed yourself to? How much could you gain or lose? a) Write = sell Put = ability to sell => You're saying if you buy my put -> if you exercise and sell your stock -> I must definitely buy it at exactly 40 bucks => If stock goes up higher -> you'll profit so the buyer won't exercise -> you only gain the premium => If stock goes down < 40 -> they will profit if they sell for you at 40 -> you lose whatever the spot is - 40, times 100 [!NOTE]- You would like to speculate on a rise in the price of a certain stock. The current stock price is $29 and a three-month call (buy) with a strike price of $30 costs $2.90. You have $5,800 to invest. Identify two alternative strategies. Briefly outline the advantages and disadvantages of each. You think it's gonna go up -> better BUY it now a) buy 5800/29 = 200 shares now b) buy 2000 options = option to BUY at 30 dollars * Profit if value share goes up > 30 dollars * Not exercise -> lose premium 2.9 . 2000 = 5800 If the share price does well, the second strategy will give rise to greater gains. However, if the share price does badly, the second strategy yields greater losses. [!NOTE]- Suppose you own 5,000 shares that are worth $25 each. How can put options be used to provide you with insurance against a decline in the value of your holding over the next four months? Buy the ability to sell your stocks at set prices if it were to decrease -> BUY a CALL option with a strike price of $25 and an expiration date in four months. If at the end of four months the stock price proves to be less than $25, you can exercise the options and sell the shares for $25 each. [!warning]- An exchange-traded stock option provides no funds for the company. It is a security sold by one investor to another. The company is not involved. By contrast, a stock when it is first issued is sold by the company to investors and does provide funds for the company. [!example]- Explain why a futures contract can be used for either speculation or hedging. If an investor has an EXPOSURE to the price of an asset, he or she can hedge with futures contracts. * If the investor will gain when the price decreases and lose when the price increases, a long futures position will hedge the risk. * If the investor will lose when the price decreases and gain when the price increases, a short futures position will hedge the risk. * Thus either a long or a short futures position can be entered into for hedging purposes. If the investor has NO EXPOSURE to the price of the underlying asset, entering into a futures contract is speculation. If the investor takes a long position, he or she gains when the asset\u2019s price increases and loses when it decreases. If the investor takes a short position, he or she loses when the asset\u2019s price increases and gains when it decreases. [!warning]- A cattle farmer expects to have 120,000 pounds of live cattle to sell in three months. The live-cattle futures contract on the Chicago Mercantile Exchange is for the delivery of 40,000 pounds of cattle. How can the farmer use the contract for hedging? From the farmer\u2019s viewpoint, what are the pros and cons of hedging? The farmer can SHORT (sell) 3 contracts that have 3 months to maturity. * If the price of cattle falls -> sell at high predetermined price -> futures contract profit but will offset the loss on the sale of the cattle. * If the price of cattle rises, the gain on the sale of the cattle will be offset by the loss on the futures contract. * Using futures contracts to hedge has the advantage that it can at no cost reduce risk to almost zero. * Its disadvantage is that the farmer no longer gains from favorable movements in cattle prices. [!NOTE]- It is May and a trader writes a September call option with a strike price of $20. The stock price is $18 and the option price is $2. Describe the investor\u2019s cash flows if the option is held until September and the stock price is $25 at this time. Write = sell Call = ability to BUY Write a call = sell ability to buy - at time x if exercise -> writer MUST sell to holder no matter what * writer profits if value goes down, sell at agreed > more than spot * At 25 dollars, writer must sell for 18 despite spot = 25 -> lose 7 dollars, gain 2 premium = lose 5 Essentially, at time 0 the writer earns 2 dollars . The, in the future at 25, has to buy the currency at spot of 25 then sell to holder of option for 20 -> lose 5 => inflow of $2 in May and an outflow of $5 in September [!example]- The CME Group offers a futures contract on long-term Treasury bonds. Characterise the investors likely to use this contract. Most investors will use the contract because they want to do one of the following: a) Hedge an exposure to long-term interest rates. b) Speculate on the future direction of long-term interest rates. c) Arbitrage between the spot and futures markets for Treasury bonds. [!example]- An airline executive has argued: \u201cThere is no point in our using oil futures. There is just as much chance that the price of oil in the future will be less than the futures price as there is that it will be greater than this price.\u201d Discuss the executive\u2019s viewpoint. * It may well be true that there is just as much chance that the price of oil in the future will be above the futures price as that it will be below the futures price. This means that the use of a futures contract for speculation would be like betting on whether a coin comes up heads or tails. * But it might make sense for the airline to use futures for hedging rather than speculation . The futures contract then has the effect of reducing risks . It can be argued that an airline should not expose its shareholders to risks associated with the future price of oil when there are contracts available to hedge the risks. [!notes]- A trader enters into a short forward contract on 100 million yen. The forward exchange rate is $0.0080 per yen. How much does the trader gain or lose if the exchange rate at the end of the contract is (a) $0.0074 per yen; (b) $0.0091 per yen? Short forward = sell 100 million yen at 1 yen = 0.0080 US no matter what Profit if the selling at 1 yen = 0.0080 US is higher than spot rate cos then they can immediately buy back / deliver US at lower amounts a) Gain 0.0006 * 100,000,000 b) Lose 0.0011 * 100,000,000 [!note]- A trader enters into a short cotton futures contract when the futures price is 50 cents per pound. The contract is for the delivery of 50,000 pounds. How much does the trader gain or lose if the cotton price at the end of the contract is (a) 48.20 cents per pound; (b) 51.30 cents per pound? Short contract = The agreed-upon price at which the trader has committed to sell the cotton is 50 cents per pound, and for the delivery of 50,000 pounds of cotton. -> No matter what, I would like to sell at this price (aka they think it's gonna go down so they better sell it at this price that is still high) a) It did go down -> profit 50 - 48.20 * 50,000 b) Lose [!NOTE]- A company knows that it is due to receive a certain amount of a foreign currency in four months. What type of option contract is appropriate for hedging? -> Receive foreign - wanna sell it at set price -> PUT buy -> long position in a 4-month put option -> provide insurance against the exchange rate falling below the strike price. It ensures that the foreign currency can be sold for at least the strike price -> If the foreign currency depreciates, the company can exercise the put option and sell the currency at the higher strike price [!NOTE]- A United States company expects to have to pay 1 million Canadian dollars in six months. Explain how the exchange rate risk can be hedged using (a) a forward contract; (b) an option. Pay foreign -> wanna make sure 1 US is worth as much Cad in 6 months. Bad news if 1 US is worth a lesser amount of Cad -> wanna being able to sell US for Cad at predetermined rate -> long future contract - buy 1 million Canadian dollars in six months. This would have the effect of locking in an exchange rate equal to the current forward exchange rate. -> buy / long position in a call - if worst comes to worst -> has the option to buy Cad at set prices - giving it the right (but not the obligation) to purchase 1 million Canadian dollar at a certain exchange rate in six months. This would provide insurance against a strong Canadian dollar in six months while still allowing the company to benefit from a weak Canadian dollar at that time. [!example]- Buying a stock and a put option on the stock is considered a form of insurance. Explain. * In this strategy, the put option acts as a form of protection against potential downside risk. If the stock price falls, the put option provides the right to sell the stock at a predetermined price (the strike price), limiting the potential losses for the trader. * The cost of the put option premium is the price paid for this insurance. * It is a common strategy known as a protective put or a married put . [!NOTE] Hard questions 1. An call option will always be exercised at maturity if the underlying asset price> strike price while a put option will always be exercised at maturity if the strike price > underlying asset price. 2. An American option can be exercised at any time during its life, up to and including the expiration date. This flexibility is a key feature of American options, distinguishing them from European options, which can only be exercised at the expiration date. 3. If principal size = size of market, then the over-the-counter market is ten times as big as the exchange-traded market. 4. When a trader sells put options , they are taking on the obligation to BUY . 5. A short forward contract on an asset + a long position in a call option on the asset with a strike price = forward price is the same as a long position a put option [!warning]- A trader has a portfolio worth $5 million that mirrors the performance of a stock index. The stock index is currently 1,250. Futures contract trade on the index with one contract being on 250 times the index. To remove market risk from the portfolio the trader should: 1. Number of contracts: 1. Each futures contract is on 250 times the index value 2. Given that the stock index is currently at 1,250 3. Value of one futures contract = 250 * 1,250 = $312,500 2. Number of contracts needed = Portfolio value / Value of one futures contract 1. = 5,000,000 / 312,500 = 16 contracts 3. Direction: To remove market risk from the portfolio, the trader should take an opposite position in the futures market to the existing position in the stock index. Since the trader has a portfolio worth $5 million that mirrors the performance of the stock index, they should take a short / sell position in the futures market => sell 16 contracts 1. Taking a short position in futures contracts provides a form of insurance against a decline in the value of the portfolio. If the stock index falls, the gain from the short futures position can help offset the loss in the portfolio, thus reducing overall market risk. 2. To hedge the existing long position in the portfolio, the trader should take a short position [!warning]- A one-year call option on a stock with a strike price of $30 costs $3; a one-year put option on the stock with a strike price of $30 costs $4. Suppose that a trader buys two call option and one put option. The breakeven stock price below which the trader makes a profit is: 'BELOW' which the trader makes a profit -> lower than this = even better, we need to find the ceiling -> the put option = the one that would make this trader money (cos price falls -> sell higher than spot). * Amount they already lost: 3 + 3 + 4 = 10 * Sell at: 30 * To make a profit, price must be 30 - 10 = 20 [!warning]- A one-year call option on a stock with a strike price of $30 costs $3; a one-year put option on the stock with a strike price of $30 costs $4. Suppose that a trader buys two call options and one put option. The breakeven stock price above which the trader makes a profit is Opposite from above -> profit from call options. * Amount lost = 10 * Buy at 30 PER OPTION * There are 2 options => price for each option must compensate for that 10 dollars amount -> 10 / 2 = 5 * Thus price must be 30 + 5 = 35 Chapter 2. Futures markets [!NOTE]- Hard questions 1. Futures contracts nearly always last longer than forward contracts. This is incorrect. 2. Commodities Futures Trading Commission (CFTC) takes primary responsibility for regulating futures market. 3. In many cases, the open interest for a near-month futures contract (e.g., June 2012) is often higher than that for a more distant-month futures contract bc traders and investors may show greater interest and activity in contracts with nearer expiration dates. 4. Clearing house = in both OTC and markets 5. Which are cash settled A. All futures contracts B. All option contracts C. Futures on commodities D. Futures on stock indices (* this one *) [!example]- What's a haircut? A haircut represents the % reduction in the value of an asset when used as collateral. A 20% haircut means the market value of the bond is reduced by 20%, making it worth $80 when used to satisfy a collateral request. [!example]- Number of agreements in bilateral clearing? In bilateral clearing, each pair of dealers forms an agreement. Since there are four dealers (let's label them A, B, C, and D), the possible pairs are AB, AC, AD, BC, BD, and CD. Therefore, there are six agreements in total. [!NOTE]- [x] Suppose that you enter into a short futures contract to sell July silver for $27.20 per ounce. The size of the contract is 5,000 ounces. The initial margin is $4,000, and the maintenance margin is $3,000. What change in the futures price will lead to a margin call? What happens if you do not meet the margin call? Margin call when (initial margin - maintenance margin) $1,000 has been lost from the margin account. Lose money = when price goes up to: * 1000 = 5000 * amount lost per contract -> amount lost per contract = 0.2 dollars => Occur when: price goes up by 0.2 dollars / to 27.40 per ounce If the margin call is not met aka. when you receive a margin call and do not meet it by depositing additional funds into your margin account, the broker will step in to close out your position. [!warning]- [x] Suppose that in September 2013 a company takes a long position in a contract on May 2014 crude oil futures. It closes out its position in March 2014. The futures price (per barrel) is $88.30 when it enters into the contract, $90.50 when it closes out the position, and $89.10 at the end of December 2013. One contract is for the delivery of 1,000 barrels. What is the company\u2019s profit? When is it realized? How is it taxed if it is (a) a hedger and (b) a speculator? Assume that the company has a December 31 year end. Long = buy at set $ = profit if it goes up (it did to 90.50) -> Total profit = 90.50 - 88.30 times 1000 =2200 dollars Of this 2.2k, amount realised on a day-by-day basis btwn Sep 2013 - Dec 2013 is: -> 89.10 - 88.3 * 1000 = 800 dollars Amount realised btwn Jan 2014 - Mar 2014: -> 90.5 - 89.10 * 1000 = 1400 dollars Hedger : taxed on 2200 dollars (everything) in 2014. Speculator : taxed on 800 dollars in 2013, 1400 in 2014 (in separate years) [!warning]- [x] A trader buys two July futures contracts on orange juice. Each contract is for the delivery of 15,000 pounds. The current futures price is 160 cents per pound, the initial margin is $6,000 per contract, and the maintenance margin is $4,500 per contract . What price change would lead to a margin call? Under what circumstances could $2,000 be withdrawn from the margin account? ( HARD BECAUSE PER CONTRACT - THERE ARE 2 ) 1. Margin call when: loss = 1500 PER CONTRACT 2. Price change required: 1500 = amount lost/pound * 15000 -> amount lost/price change = 0.1 dollars = 10 cents 3. Direction of price change: buy at set price -> lose if price goes down cos then they bought 4 2 high => price drops to 150 cents/pound -> trigger margin call Again must think in terms of 1 contract: Gain of 1000/contract = 15000 * amount gained/pound -> amount = 1/15 or 0.06666 dollars -> price goes up to 166.6666 / pound You CANNOT join the 2 together into 2k profit since a threshold is set for each individual contract [!NOTE]- At the end of one day a clearing house member is long 100 contracts, and the settlement price is $50,000 per contract. The original margin is $2,000 per contract. On the following day the member becomes responsible for clearing an additional 20 long contracts, entered into at a price of $51,000 per contract. The settlement price at the end of this day is $50,200. How much does the member have to add to its margin account with the exchange clearing house? Day 1: * Buy 100 contracts * Price = 50k / contract * Margin = 2k / contract Day 2 20 more contracts 51k / contract For the new contract, additional margin needed to provide: -> 20 * 2000 = 40000 dollars Amount gained (buy -> good if higher price): -> 50200 - 50000 times 100 = 20000 gained on Day 1 contracts Amount lost: -> 50200 - 51000 times 20 = 16000 dollars lost on Day 2 contracts Amount must add to margin account: -> 40k (margin for the new 20) - 4k (gained) = 36000 dollars [!NOTE]- On July 1, 2013, a Japanese company enters into a forward contract to buy $1 million with yen on January 1, 2014. On September 1, 2013, it enters into a forward contract to sell $1 million on January 1, 2014. Describe the profit or loss the company will make in dollars as a function of the forward exchange rates on July 1, 2013, and September 1, 2013. July 2013: will buy 1 mil US for x yen/US (current forward XC rate) Sep 2013: will sell 1 mil US for y yen/US (current forward XC rate) On Jan 2014: For the July 2013 contract: + 1 mil US, - x yen For the Sep 2013 contract: - 1 mil US, + y yen Total payoff : (- x + y) yen [!warning]- The forward price of the Swiss franc for delivery in 45 days is quoted as 1.1000. The futures price for a contract that will be delivered in 45 days is 0.9000. Explain these two quotes. Which is more favorable for an investor wanting to sell Swiss francs? 1.1 = will get francs at 1.1 francs / 1 US -> 1 francs = 0.909090909 US 0.9 = will get fracs at 0.9 US / 1 francs => First rate > Second rate => The Swiss franc is therefore more valuable in the forward market (1st one) than in the futures market. => The forward market is therefore more attractive for an investor wanting to SELL Swiss francs. [!example]- Suppose you call your broker and issue instructions to sell one July hogs contract. Describe what happens. Hog futures are traded on the Chicago Mercantile Exchange. 1. The broker will request some initial margin. 2. The order will be relayed by telephone to your broker\u2019s trading desk on the floor of the exchange (or to the trading desk of another broker). 3. It will be sent by messenger to a commission broker who will execute the trade according to your instructions. 4. Confirmation of the trade eventually reaches you. 5. If there are adverse movements in the futures price your broker may contact you to request additional margin. [!example]- \"Speculation in futures markets is pure gambling. It is not in the public interest to allow speculators to trade on a futures exchange.\" Discuss this viewpoint. Speculators are important market participants because they add liquidity to the market. However, contracts must be useful for hedging as well as speculation . This is because regulators generally only approve contracts when they are likely to be of interest to hedgers as well as speculators . [!example]- What do you think would happen if an exchange started trading a contract in which the quality of the underlying asset was incompletely specified? The contract would not be a success. * Parties with short positions would hold their contracts until delivery and then deliver the cheapest form of the asset -> This might well be viewed by the party with the long position as garbage! * Once news of the quality problem became widely known no one would be prepared to buy the contract. * This shows that futures contracts are feasible only when there are rigorous standards within an industry for defining the quality of the asset. * Many futures contracts have in practice failed because of the problem of defining quality. [!example]- \u201cWhen a futures contract is traded on the floor of the exchange, it may be the case that the open interest increases by one, stays the same, or decreases by one.\u201d Explain this statement. * If both sides of the transaction are entering into a new contract, the open interest increases by one. * If both sides of the transaction are closing out existing positions, the open interest decreases by one. * If one party is entering into a new contract while the other party is closing out an existing position, the open interest stays the same. [!NOTE]- [x] Suppose that on October 24, 2010, you take a short position in an April 2011 live-cattle futures contract. You close out your position on January 21, 2011. The futures price (per pound) is 91.20 cents when you enter into the contract, 88.30 cents when you close out your position, and 88.80 cents at the end of December 2010. One contract is for the delivery of 40,000 pounds of cattle. What is your total profit? How is it taxed if you are (a) a hedger and (b) a speculator? Assume that you have a December 31 year end. Short = sell at set $ = think it's gonna go down Oct 2010: take short position in Apr 2011 contract - 0. 9120 Dec 2010: 0.8880 Jan 2011: close out position - 0.8830 Apr 2011: future contract matures Total profit (enter -> close) -> 0.9120 - 0.8830 times 40000 = 1160 dollars gained Realised on day-by-day basis in 2010: -> 0.9120 - 0.8880 times 40000 = 960 dollars gained As a speculator: taxed on 960 in 2010 then on 200 in 2011 As a hedger: taxed on 1160 in 2011 [!example]- Explain the difference between bilateral and central clearing for OTC derivatives. Aspect Bilateral Clearing Central Clearing Nature Direct negotiation between counterparties Centralised clearinghouse acts as an intermediary Counterparty Risk High, as it relies on the creditworthiness of each party Reduced, as the clearinghouse becomes the counterparty to both sides Documentation ISDA Master Agreement Standardised contracts and terms may be used Margining Negotiated directly between counterparties Clearinghouses impose margin requirements Flexibility Greater flexibility in contract terms and negotiations Standardisation may limit flexibility [!example]- Why flexibility decreases f/f prices? The party with the short position chooses between the alternatives. The alternatives therefore make the futures contract more attractive to the party with the short position. The lower the futures price the less attractive it is to the party with the short position. The benefit of the alternatives available to the party with the short position is therefore compensated for by the futures price being lower than it would otherwise be. SELL FUTURE CONTRACT = TAKING SHORT POSITION = THINK IT'S GONNA GO DOWN [!example]- Explain how CCPs work. What are the advantages to the financial system of requiring all standardised derivatives transactions to be cleared through CCPs? A CCP, or Central Counterparty, acts as a middleman when trading standardised derivatives. * After a trade, the CCP steps in as the central counterparty for both the buyer and seller through a process called novation. * The CCP manages risk by using standardised contracts and collecting margin from participants. * If a participant defaults, the CCP has procedures to handle it, using the defaulting party's margin and resources to cover losses. Advantages * Significantly reduces counterparty risk by becoming the counterparty for all trades. * Promotes transparency through the use of standardised contracts with clear terms. * Streamlining of settlement processes by netting offsetting positions, leading to increased operational efficiency. Chapter 5. Valuation of futures and forwards [!note]- [x] An investor shorts 100 shares when the share price is $50 and closes out the position six months later when the share price is $43. The shares pay a dividend of $3 per share during the six months. Net gain/loss? When an investor \"shorts\" shares, it means they are selling shares they don't own with the expectation that the share price will fall. 1. The investor borrows 100 shares from a broker and sells them in the market at the current share price of $50. * The investor receives $5,000 (100 shares * $50/share) from the sale 2. Position open for 6 months: * The investor keeps the proceeds from the short sale and waits for the share price to decrease. 3. Closing out * After six months, the share price has fallen to $43. * To close out the short position, the investor buys back 100 shares at the current lower price of $43/share. * The cost of buying back the shares is $4300 (100 shares * $43/share). Net so far: 5000 gain from selling - 4300 loss from buying back = 700 gain But they must pay dividends during open -> lose 3 * 100 = 300 Thus, profit = 700 - 300 - 400 [!example]- The spot price of an asset is positively correlated with the market. Which of the following would you expect to be true? => The forward price is less than the expected future spot price * A positive correlation between the spot price of an asset and the market implies that when the market is expected to rise in the future, the spot price of the asset is also expected to rise. * In such a scenario, the forward price is typically < expected future spot price. * This is because the forward price incorporates the expected future spot price plus the cost of carry or the opportunity cost of tying up capital. * The difference between the forward price and the expected future spot price reflects this cost of carry . [!example]- f/f quoting conventions Futures price of a foreign currency -> number of U.S. dollars per unit of the foreign currency. Forward price of a foreign currency -> Some forward prices are always quoted as the number of U.S. dollars per unit of the foreign currency and some are always quoted the other way round. [!example]- Reasons why a short position in a stock is closed out? * Investor decisions * broker is no longer able to borrow shares from other clients * investor does not maintain margins required on his/her margin account * NOT lender of the shares issues instructions to close out the position [!WARNING]- What should a trader do when the one-year forward price of an asset is too low? Assume 0 income generating. -> Sell/short the asset -> Invest the proceeds of the short sale at the risk-free rate -> enter into a long forward contract to buy the asset in one year Forward contracts are LESS liquid than futures contracts [!example] Keynes and Hicks? If hedgers hold long positions and speculators holds short positions, the futures price will tend to be higher than expected future spot prices (or vice versa - see notes) [!example]- Contango The futures price is above the expected future spot price -> In other words, the futures price is trading at a premium to the expected future spot price. This condition is often associated with the normal upward-sloping shape of the futures curve. Potential causes: * Cost of carry : Contango can result from the cost of carry, which includes expenses such as storage costs, insurance, and financing charges. These costs are reflected in the futures price. * Supply and demand dynamics : If there is excess supply or low demand for the commodity in the near term, the futures prices for future delivery may be higher than the expected spot price.* [!NOTE]- [x] The spot price of an investment asset is $30 and the risk-free rate for all maturities is 10% with continuous compounding. The asset provides an income of $2 at the end of the first year and at the end of the second year. What is the three-year forward price? 35.84 [!NOTE]- [x] The spot price of an investment asset that provides no income is $30 and the risk-free rate for all maturities (with continuous compounding) is 10%. What is the three-year forward price? 40.50 [!example]- Explain what happens when an investor shorts a certain share. * The investor\u2019s broker borrows the shares from another client\u2019s account and sells them in the usual way. * To close out the position, the investor must purchase the shares. * The broker then replaces them in the account of the client from whom they were borrowed. * The party with the short position must remit to the broker dividends and other income paid on the shares. * The broker transfers these funds to the account of the client from whom the shares were borrowed. * Occasionally the broker runs out of places from which to borrow the shares. * The investor is then short squeezed and has to close out the position immediately. [!example]- What is the difference between the forward price and the value of a forward contract? The forward price of an asset today is the price at which you would agree to buy or sell the asset at a future time. The value of a forward contract is zero 0 you first enter into it. * As time passes the underlying asset price changes and the value of the contract maybecome positive or negative. [!NOTE]- [x] Suppose that you enter into a six-month forward contract on a non-dividend-paying stock when the stock price is $30 and the risk-free interest rate (with continuous compounding) is 12% per annum. What is the forward price? ![[Pasted image 20240202203106.png]] [!NOTE]- [x] A stock index currently stands at 350. The risk-free interest rate is 8% per annum (with continuous compounding) and the dividend yield on the index is 4% per annum. What should the futures price for a four-month contract be? ![[Pasted image 20240202203141.png]] [!example]- Explain carefully why the futures price of gold can be calculated from its spot price and other observable variables whereas the futures price of copper cannot. Gold is an investment asset . * If the futures price is too high, investors will find it profitable to increase their holdings of gold and short futures contracts. * If the futures price is too low, they will find it profitable to decrease their holdings of gold and go long in the futures market. Copper is a consumption asset . * If the futures price is too high, a strategy of buy copper and short futures works. * However, because investors do not in general hold the asset, the strategy of sell copper and buy futures is not available to them. There is therefore an upper bound, but no lower bound, to the futures price . [!example]- Which of the following is true for a consumption commodity? For consumption commodity, there is an upper limit to the futures price but no lower limit , except that the futures price cannot be negative. [!example]- Explain carefully the meaning of the terms convenience yield and cost of carry. What is the relationship between futures price, spot price, convenience yield, and cost of carry? Convenience yield measures the extent to which there are benefits obtained from ownership of the physical asset that are not obtained by owners of long futures contracts. The cost of carry is the interest cost plus storage cost less the income earned. The futures price, F0,and spot price, S0, are related by ![[Pasted image 20240202203439.png]] [!example]- Explain why a foreign currency can be treated as an asset providing a known yield. A foreign currency provides a known interest rate , but the interest is received in the foreign currency . The value in the domestic currency of the income provided by the foreign currency is therefore known as a % of the value of the foreign currency . => The income has the properties of a known yield. [!example]- Is the futures price of a stock index greater than or less than the expected future value of the index? The futures price of a stock index is always < expected future value of the index . * Index has positive systematic risk. * Argument 2: let u be the expected return required by investors on the index so that ![[Pasted image 20240202203740.png]] Since (u > r) and ![[Pasted image 20240202203813.png]] It follows that ![[Pasted image 20240202203832.png]] [!danger]+ [x] A one-year long forward contract on a non-dividend-paying stock is entered into when the stock price is $40 and the risk-free rate of interest is 10% per annum with continuous compounding. (a) What are the forward price and the initial value of the forward contract? (b) Six months later, the price of the stock is $45 and the risk-free interest rate is still 10%. What are the forward price and the value of the forward contract? S = 40, r = 10%, no income a) F and Initial value - Initial value of forward contract = 0 - Forward price F = 40 . e ^(10% . 1) = $ 44.21 ==Left 1st row== b) S(6) = 45, r = 10% - Delivery price K = forward price above = 44.21 - S is now 45 - Forward price F = 45 . e ^(10% . 0.5) = 47.31 ==Left 1st row== - Value of f contract = 45 - 44.21 . e ^(-10% . 0.5) = 2.95 ==Right 1st row== INITIAL VALUE OF CONTRACT = 0! AFTER SOME TIME, THE FORWARD PRICE CALCULATED AT THE BEGINNING BECOMES K - THE DELIVERY PRICE. [!NOTE]- [x] r = 0.07, dividend = 3.2% pa, current value of index = 150, T = 6 month. Futures price = ? CURRENT VALUE OF INDEX = S F = 150 . e ^ (0.07 - 0.032)0.5 = 152.88 ==left 3rd row== [!warning]- [x] r = 0.09, dividend varies throughout the yr: 2, 5, 8, 11 -> 0.05 pa; other 8 months -> 0.02 pa. Value of index on July 31 = 1300 (S); futures price of contract deliverable on Dec 31? a) Find avg yield August (0.05) -> Sep -> Oct -> Nov (0.05) -> Dec (0.05 x 2 + 0.02 x 3) / 5 = 0.032 b) Futures price F = 1300 . e^(0.09 - 0.032).5/12 = 1331.80 ==left 3rd row== [!NOTE]- r = 0.1, dividend = 0.04, index = 400, futures price 4 months = 405. Arbitrage opportunity? S.e^(0.1 - 0.04).4/12 = 408.08 ==left 3rd row== The above is the THEORETICAL FUTURES PRICE. But actual F price = 405 -> F < Sert (index futures price is too low relative to index) Arbitrage strategy Time 0: 1. short/sell underlying the index (receive the current spot price of the index (+S - higher) 2. take a long position (buy) in futures contracts lock in the futures price (-F - lower) Time 1: Deliver -> since F < Sert, you can use the stocks obtained from the short position to cover the futures contract, making a profit. ![[Pasted image 20240114041907.png]] [!NOTE]- [x] Estimate the difference between short-term interest rates in Japan and the United States on August 4, 2009 from the information (the table is in the US so we don't need US, just Japan) 1. Look at settlement prices: Japan 1.0502 in Sep -> 1.0512 in Dec -> 0.09522 % increased over 3 months => indicates that short-term futures prices are increasing at a rate of about 0.09522% per 3 months => Short term interest in Japan > US by (0.09522% / 3*12) = 0.38% per year Short term interest rate differentials If settlement price of country A INCREASED over time -> short term futures prices are INCREASING over time -> Country A interest rates IS LOWER THAN country B (US - home country) ![[Pasted image 20240127003145.png]] [!warning]- [x] 2 months = T, interest rates Switz = 0.02, interest rates US = 0.05, spot price of Switz franc = $0.8, futures contract price, deliverable in 2 months = $0.81. Arbitrage opportunity? 1. Theoretical futures price Se... = 0.8 . e^(0.05 - 0.02).2/12 = 0.8040 Compare with actual futures price of 0.81 -> actual is too high (F > S) Arbitrage opportunity: Sell at F aka short/sell Swiss francs futures (lock in profit at F - higher) Buy Swiss francs at spot S (lower) At delivery, must deliver Swiss francs - you are getting a profit of F (higher) [!warning]- [x] Current price of silver S = 15 per ounce, storage cost = 0.24 / ounce pa payable quarterly in advance, interest rates = 10% pa, find futures price, T = 9 months 1. Find U (storage cost) 0.24 pa, payable quarterly -> 0.06 per quarter Payable in advance quarterly -> * pay 1 now * 1 in 3 months * 1 in 6 months if delivery in 9 months We have to discount each to the present. * 0.06 (present) * 0.06 discount by 3 months - continuous compounding so / by (e^rt = e^10%.3/12) * 0.06 discount by 6 months - continuous compounding so / by (e^rt = e^10%.6/12) PV of storage costs U = 0.06 + 0.06 . e^-(10% . 3/12) + 0.06 . e^-(10% . 6/12) = 0.176 2. Find F F = (S + U) . e^(rT) = (15 + 0.176) . e^(10% . 9/12) = 16.36 [!example]- When a known future cash outflow in a foreign currency is hedged by a company using a forward contract, there is no foreign exchange risk. When it is hedged using futures contracts, the daily settlement process does leave the company exposed to some risk. Explain the nature of this risk. In particular, consider whether the company is better off using a futures contract or a forward contract when: (a) The value of the foreign currency falls rapidly during the life of the contract. (b) The value of the foreign currency rises rapidly during the life of the contract. (c) The value of the foreign currency first rises and then falls back to its initial value. (d) The value of the foreign currency first falls and then rises back to its initial value. Assume that the forward price equals the futures price. a) In total the gain or loss under a futures contract is equal to the gain or loss under the corresponding forward contract. However the timing of the cash flows is different . * When the time value of money is taken into account a futures contract may prove to be > valuable or < valuable than a forward contract. * Ofc company does not know in advance which will work out better. * The long forward contract provides a perfect hedge . * The long futures contract provides a slightly imperfect hedge . b) all effects = slightly * (a) forward > - company will lose on hedge. If forward -> the loss will be realised at the end. If future -> loss will realise day by day. * (b) futures > - company will gain. If forward -> gain realised at the end. If future -> gain realised day by day. On PV basis, latter = preferable. * (c) futures > - positive CF early, negative CF later * (d) forward > cos if futures, negative CF early, later CF positive [!warning] Futures = formal, realise day by day; forwards = realise at the end [!example]- The forward exchange rate = unbiased predictor of the future exchange rate when ??? The exchange rate has no systematic risk . To have no systematic risk the exchange rate must be uncorrelated with the return on the market. [!example]- What is meant by (a) an investment asset and (b) a consumption asset. Why is the distinction between investment and consumption assets important in the determination of forward and futures prices? An investment asset is an asset held for investment by a significant number of people or companies. * The forward/futures price can be determined from the spot price for an investment asset. A consumption asset is an asset that is nearly always held to be consumed (either directly or in some sort of manufacturing process). * All that can be determined is an upper bound for the forward/futures price. [!example] What is the cost of carry for (a) a non-dividend-paying stock, (b) a stock index, (c) a commodity with storage costs, and (d) a foreign currency? a) the rfr b) the excess of the rfr over the dividend yield c) the rfr plus the storage cost d) the excess of the domestic risk-free rate over the foreign rfr [!example]- (1) Explain carefully what is meant by the expected price of a commodity on a particular future date. (2) Suppose that the futures price of crude oil declines with the maturity of the contract at the rate of 2% per year. Assume that speculators tend to be short crude oil futures and hedgers tended to be long crude oil futures. What does the Keynes and Hicks argument imply about the expected future price of oil? (1) The expected future price refers to the anticipated price of a commodity on a specific future date (2) Keynes and Hicks argue that speculators on average make money from commodity futures trading and hedgers on average lose money from commodity futures trading . * If speculators tend to have short positions in crude oil futures, the Keynes and Hicks argument implies that futures prices overstate expected future spot prices. * If crude oil futures prices decline at 2% per year the Keynes and Hicks argument therefore implies an even faster decline for the expected price of crude oil if speculators are short. Chapter 9. Option [!example] A corporate treasurer is designing a hedging program involving foreign currency options. What are the pros and cons of using (a) the NASDAQ OMX and (b) the over-the-counter market for trading? The NASDAQ OMX offers options with standard strike prices and times to maturity. Options in the over-the-counter market have the advantage that they can be tailored to meet the precise needs of the treasurer. Their disadvantage is that they expose the treasurer to some credit risk. Exchanges organize their trading so that there is virtually no credit risk. [!example] Explain why the market maker\u2019s bid-offer spread represents a real cost to options investors. A \u201cfair\u201d price for the option can reasonably be assumed to be half way between the bid and the offer price quoted by a market maker. An investor typically buys at the market maker\u2019s offer and sells at the market maker\u2019s bid. Each time he or she does this there is a hidden cost equal to half the bid-offer spread. [!example] \u201cIf a company does not do better than its competitors but the stock market goes up, executives do very well from their stock options. This makes no sense\u201d Discuss this viewpoint. Can you think of alternatives to the usual executive stock option plan that take the viewpoint into account. Executive stock option plans account for a high percentage of the total remuneration received by executives. When the market is rising fast (as it was for much of the 1990s) many corporate executives do very well out of their stock option plans \u2014 even when their company does worse than its competitors. Large institutional investors have argued that executive stock options should be structured so that the payoff depends how the company has performed relative to an appropriate industry index. In a regular executive stock option the strike price is the stock price at the time the option is issued. In the type of relative performance stock option favored by institutional investors, the strike price at time t is S I I \uf02f where 0 S is the company\u2019s stock price at the time the option is issued, 0 I is the value of an equity index for the industry in which the company operates at the time the option is issued, and t I is the value of the index at time t . If the company\u2019s performance equals the performance of the industry, the options are always at-the-money. If the company outperforms the industry, the options become in the money. If the company underperforms the industry, the options become out of the money. Note that a relative performance stock option can provide a payoff when both the market and the company\u2019s stock price decline. Relative performance stock options clearly provide a better way of rewarding senior management for superior performance. Some companies have argued that, if they introduce relative performance options when their competitors do not, they will lose some of their top management talent. [!warning] 9.11 | Describe the terminal value of the following portfolio: a newly entered-into long forward contract on an asset and a long position in a European put option on the asset with the same maturity as the forward contract and a strike price that is equal to the forward price of the asset at the time the portfolio is set up. Show that the European put option has the same value as a European call option with the same strike price and maturity. The terminal value of the long forward contract is: ST - F0 * T = price of asset at maturity * F0 = forward price of asset at time portfolio is set up * F0 = delivery price in the forward contract Terminal value of put option: max(F0 - ST 0) Terminal value of portfolio: ST - F0 + max(F0 - ST, 0) = max(0, ST - F0] ![[Pasted image 20240425001345.png]] We have shown that the forward contract plus the put is worth the same as a call with the same strike price and time to maturity as the put. The forward contract is worth zero at the time the portfolio is set up. It follows that the put is worth the same as the call at the time the portfolio is set up. [!danger] Option contracts ![[Pasted image 20240425002017.png]] [!example] 9.18 - \u201cIf most of the call options on a stock are in the money, it is likely that the stock price has risen rapidly in the last few months.\u201d Discuss this statement. The exchange has certain rules governing when trading in a new option is initiated. These mean that the option is close-to-the-money when it is first traded. If all call options are in the money it is therefore likely that the stock price has risen since trading in the option began. [!example] What is the effect of an unexpected cash dividend on (a) a call option price and (b) a put option price? An unexpected cash dividend would reduce the stock price on the ex-dividend date. This stock price reduction would not be anticipated by option holders. As a result there would be a reduction in the value of a call option and an increase the value of a put option. (Note that the terms of an option are adjusted for cash dividends only in exceptional circumstances.) Chapter 10. Valuation of options [!NOTE]- [X] T = 4 months, call, 0 dividend, stock price S = 28, strike K = 25, rfr = 8% pa. 28 - 25 . e^(-8% . 4/12) = 3.66 [!NOTE]- [x] What is a lower bound for the price of a one-month European put option on a non dividend-paying stock when the stock price is $12, the strike price is $15, and the risk free interest rate is 6% per annum? 2.93 [!example]- Explain why an American call option on a dividend-paying stock is always worth at least as much as its intrinsic value. Is the same true of a European call option? The intrinsic value of an American call option on a dividend-paying stock is always equal to or greater than its European counterpart due to the option's exercise flexibility. An American call option can be exercised at any time, allowing the holder to capture dividends immediately. Therefore, its value is at least the intrinsic value. In contrast, a European call option, exercisable only at expiration, may miss out on capturing dividends before maturity. For instance, if a stock is anticipated to pay a substantial dividend during the option's life, the European option's value might be less than its intrinsic value before the dividend is distributed. Thus, the flexibility to exercise early grants the American call option an inherent advantage in capturing dividend-related gains, ensuring its minimum value aligns with its intrinsic value [!NOTE]- [x] The price of a non-dividend paying stock is $19 and the price of a three-month European call option on the stock with a strike price of $20 is $1. The risk-free rate is 4% per annum. What is the price of a three-month European put option with a strike price of $20? From put-call parity: put price p = call price c + strike K . e^(-rT) - stock price S0 = 1 + 20e^(-0.04 x 0.25) - 19 = 1.80 [!NOTE]- [x] Call price c = 3, K = 30, put price p = 1, rfr = 10%, T = 3/12, share price S = 31. Arbitrage ??? From put-call parity: * LHS (portfolio of call & bond) = c + Ke-rt = 3 + 30.e^(-0.1*3/12) = 32.26 * RHS (portfolio of put & share) = p + S0 = 1 + 31 = 32 => LHS is overpriced relative to RHS Arbitrage strategy: buy RHS (put & share), sell LHS (call & bond) 1. Sell call 2. Buy both put & share/stock [!example] Explain why the arguments leading to put\u2013call parity for European options cannot be used to give a similar result for American options. Short answer: the LHS doesnt necessarily = RHS ![[Pasted image 20240216183322.png]] In the absence of early exercise, the put-call parity for European options rests on the premise that portfolios of equivalent values at expiration should also share this equality at earlier times. However, when early exercise is a possibility, the argument loses its validity. Consider the case where P > S - CKe^(-rT). Despite this condition, no arbitrage opportunity emerges. If one buys the call, shorts the put, and shorts the stock, the uncertainty of when the put will be exercised introduces ambiguity in the outcome. The flexibility of early exercise in American options diverges from the straightforward application of European put-call parity. [!NOTE]- [x] What is a lower bound for the price of a six-month call option on a non-dividend-paying stock when the stock price is $80, the strike price is $75, and the risk-free interest rate is 10% per annum? 8.66 [!NOTE]- [x] What is a lower bound for the price of a two-month European put option on a non dividend-paying stock when the stock price is $58, the strike price is $65, and the risk free interest rate is 5% per annum? 6.46 [!warning] In exercises just describe the arbitrage opportunity & mention borrowed / invested & thats it. no need to update what happens to those amount at T1. They are not counted in profit calc. Convert all to PV for profits. [!NOTE]- [x] A one-month European put option on a non-dividend-paying stock is currently selling for 2.5 . The stock price is $47, the strike price is $50, and the risk-free interest rate is 6% per annum. What opportunities are there for an arbitrageur? (hint: no call mentioned -> no trading calls at all) PV of strike price * 50 . e(-0.06 x 1/12) = 49.75 ![[Pasted image 20240216164152.png]] ![[Pasted image 20240216164119.png]] If the above are violated -> arbitrage: Since P </= Ke-rt - S0 ( 2.5 </= 49.75 - 47 ), the condition in the second equation above is violated -> aritrage opportunity. LHS (call & bond) = C + Ke(-rt) = C + 49.75 RHS (put & share) = P + S = 2.5 + 47 = 49.5 Strategy: buy LHS Time T0: * Buy a put (-2.5) * Buy a share (-47) * Borrow 47 + 2.5 = 49.5 at 6% for 1 month (+49.5) Time T1: * If spot > strike of 50: * put expires worthlessly * sell share for at least spot price of 50 (+ \u2265 50) * => PV of 50 -> 49.75 -> profit: at least 0.25 in PV terms (minus the amount borrowed at PV: 49.5) * If spot < strike of 50: * exercise put, sell share for strike of 50 (+ 50) * => PV of 50 -> 49.75 -> profit: 0.25 in PV terms (minus the amount borrowed at PV: 49.5) [!NOTE]- [x] Call option price C = 5 | Stock price S0 = 64 | Strike K = 60 | Dividend = 0.8 expected in 1 month| T = 1/3 | rfr = 0.12 1. Proving that arbitrage opportunity exists ![[Pasted image 20240216164152.png]] ![[Pasted image 20240216181106.png]] 5 >/= 64 - 0.8 e ^(-0.12*1/3) - 60.e^(-0.12*1/3) 5 >/= 5.58 => FALSE -> arbitrage 2. Decide what to short/buy (don't have to show this) put call parity LHS = call + bond = 5 put call parity RHS = put + share = 0 + 64 -> RHS is overpriced -> sell RHS, buy LHS Arbitrageur should sell the share (no put) & buy the call option 3. Profit (convert all to PV) Short sell share: +64 Buy call option to buy at 60: -5 Invest above for 4 months: -59 * If spot < strike of 60: * call expires worthlessly * dividend that must pay: -0.79 (PV) * deliver the share/close out short position: -57.65 or less (PV of 60 or less cos you lose the spot amount at T0) * => gain: +64 (short share) - 0.79 (dividend pay out) - 57.65 (close short position) = 5.56 (in PV terms) * => profit: 5.56 - 5 (cost of call) = 0.56 (at least) * If spot > strike of 60: * exercise call, buy share at strike: -60 * dividend: -0.79 * close out short position: +57.65 (PV of 60) * => gain: 64 - 0.79 - 57.65 = 5.56 * => profit: 5.56 - 5 = 0.56 (exact) [!NOTE]- [x] Euro call, T = 6/12, strike K = 30, call premium C = 2, stock price S = 29. dividend = 0.5 in 2 months & 5 months, rfr = 0.1 Part 1. What is P? (T, strike = same) ![[Pasted image 20240216183651.png]] p = ![[Pasted image 20240216183715.png]] Part 2. Arbitrage if put price P = 3 LHS = call + bond = 2 + 0.5 (convert to PV) + 30 (convert to PV) = 28.54 RHS = put + share = 3 + 29 = 32 => sell RHS (put & share), buy call Arbitrage: Time 1: * short share, gain 29 * short put, sell option to sell, gain 3 * buy call, buy option to buy, lose 2 * invest 30 above at rfr for 6/12 year Time 0: * if spot S > K: * exercise call, buy share at strike: lose 30 -> -28.54 PV * close out the short position on the share * must pay out dividend: -0.97 PV * put holder will let put expires worthlessly * profit: 30 - 28.54 - 0.97 = 0.49 * if spot S < K: * holder will exercise put, i must buy share at strike: lose 30 -> -28.54 PV * call expires worthlessly * deliver share, close out short position * dividend: -0.97 PV * profit: 30 - 28.54 - 0.97 = 0.49 [!NOTE]- US call | no dividend | call premium C = 4 | stock S = 31 | strike = 30 | T = 3/12 | rfr = 0.08. Part 1. Derive upper & lower bounds for US put, same strike K, same T. Part 2. Explain carefully the arbitrage opportunities in Problem 10.16 if the American put price is greater than the calculated upper bound. Part 1 ![[Pasted image 20240216185509.png]] 31 - 30 <= 4 - P <= 31 - 30e^(-0.08x3/12) 1 <= 4 - P <= 1.59 2.41 <= P <= 3 => Upper bound: 2.14 => Lower bound: 3 Part 2 Put is over priced -> RHS overpriced -> sell put & (short) share, buy call 1. Amount realised / CF: * Sell put: +3 * Sell share: +29 * Buy call: - 2 * => CF: 30 at least, which can be reinvested at the rfr 2. At some stage, either the put / call will be exercised 3. At future time CF will be -30 4. Since +30 at T0, -30 at T1, CF PV will be positive -> profit [!example]- Consider a five-year call option on a non-dividend-paying stock granted to employees. The option can be exercised at any time after the end of the first year. Unlike a regular exchange-traded call option, the employee stock option cannot be sold. What is the likely impact of this restriction on the early exercise? An employee stock option may be exercised early because the employee needs cash or because he or she is uncertain about the company\u2019s future prospects. * Regular call options can be sold in the market in either of these two situations, but employee stock options cannot be sold . * In theory an employee can short the company\u2019s stock as an alternative to exercising. * In practice this is not usually encouraged and may even be illegal for senior managers. Chapter 12. Binomial tree pricing [!example]- 12.8 | Consider the situation in which stock price movements during the life of a European option are governed by a two-step binomial tree. Explain why it is not possible to set up a position in the stock and the option that remains riskless for the whole of the life of the option. The riskless portfolio consists of a short position in the option and a long position in \u0394 shares. Because \u0394 changes during the life of the option, this riskless portfolio must also change. [!NOTE]- 12.9 | A stock price is currently $50. It is known that at the end of two months it will be either $53 or $48. The risk-free interest rate is 10% per annum with continuous compounding. What is the value of a two-month European call option with a strike price of $49? Use no-arbitrage arguments. ![[Pasted image 20240329000932.png]] LONG WAY 50 -> 53 or 48 => option will be 4 (53 - strike 49) or 0 (48 - strike 49). Consider portfolio of: long/buy \u0394 shares & short/sell 1 call option * If price goes to 53, value of portfolio is 53\u0394 - 4 * If price goes to 48, value is 48\u0394 - 0 Equating the two scenarios, solve for \u0394: \u0394 = 0.8 Thus value of portfolio is certain to be 48 . 0.8 = 38.4. For this value of \u0394 the portfolios is therefore riskless . Current value of portfolio: \u0394 (number of shares) . 50 (current stock price) - f (value of option) Since it earns interest (continuous compounding) over time period to get to 38.4: (\u0394 . 50 - f).e^(0.10 * 2/12) = 38.4 Solving for f: f = 2.23 SHORT WAY ![[Pasted image 20240304012806.png]] ![[Pasted image 20240304012856.png]] S (50) moves down to Sd (48), aka d = 0.96 S (50) moves up to Su (53), aka u = 1.06 p nume = e^(0.10 * 2/12) - 0.96 p deno = 1.06 - 0.96 p = 0.5681 f = e^(-0.10 * 2/12) x p x value of option = 2.23 [!NOTE]- 12.10 | A stock price is currently $80. It is known that at the end of four months it will be either $75 or $85. The risk-free interest rate is 5% per annum with continuous compounding. What is the value of a four-month European put option with a strike price of $80? Use no-arbitrage arguments. S = 80 -> 75 or 85 ![[Pasted image 20240329001626.png]] [!NOTE]- 12.12 | A stock price is currently $50. Over each of the next two three-month periods it is expected to go up by 6% or down by 5%. The risk-free interest rate is 5% per annum with continuous compounding. What is the value of a six-month European call option with a strike price of $51? ![[Pasted image 20240304175358.png]] ![[Pasted image 20240304175406.png]] For the situation considered in Problem 12.12, what is the value of a six-month European put option with a strike price of $51? Verify that the European call and European put prices satisfy put\u2013call parity. If the put option were American, would it ever be optimal to exercise it early at any of the nodes on the tree? a) Value of the option ![[Pasted image 20240304175703.png]] b) Verifying the put call parity * Value of call + PV of cash (strike price) (RHS) 1.635 + 51.e^(-5% . 6/12) = 51.376 * Value put + share (LHS) 1.376 (final f) + 50 (current share price) = 51.376 c) Test whether it is worth exercising the option early: Payoff of option from immediate exercise at step 1: Down: strike 51 - share price 47.5 = 3.5 -> should exercise early Up: 51 - 53 = -2 -> should'nt exercise early [!NOTE]- 12.13 | For the situation considered in Problem 12.12, what is the value of a six-month European put option with a strike price of $51? Verify that the European call and European put prices satisfy put\u2013call parity. If the put option were American, would it ever be optimal to exercise it early at any of the nodes on the tree? [!warning]- 12.14 | A stock price is currently $25. It is known that at the end of two months it will be either $23 or $27. The risk-free interest rate is 10% per annum with continuous compounding. Suppose ST is the stock price at the end of two months. What is the value of a derivative that pays off ST^2 at this time? Current share price = 25 Time = 2/12 Future price: up = 27, down = 23 rfr = 10% LONG WAY 1. No call or put -> assume +\u0394 shares, -1 derivative/option 2. Pays of ST2 means option's worth is 23^2 = 529 or 27^2 = 729 3. Value of portfolio Either 27\u0394 - 729 Or 23\u0394 - 529 Solving for \u0394 = 50 4. PV value of portfolio: 50 * 25 - f 5. Portfolio must earn rfr interest (50 * 25 - f)e^(10% * 2/12) = 27*50 - 729 Solving for f = 639.26 SHORT WAY p = (e^rt - d) / (u - d) f = e^(-rt) . [p . value of deri if up + (1-p) . value of deri if down] = e^(-0.1 * 2/12)(0.6050 x 729 + 0.3950 x 529) = 639.3 [!note]- [x] 12.20 | Consider a European call option on a non-dividend-paying stock where the stock price is $40, the strike price is $40, the risk-free rate is 4% per annum, the volatility is 30% per annum, and the time to maturity is six months. a. Calculate u, d, and p for a two step tree b. Value the option using a two step tree. c. Verify that DerivaGem gives the same answer d. Use DerivaGem to value the option with 5, 50, 100, and 500 time steps. ![[Pasted image 20240330143859.png]] ![[Pasted image 20240330143913.png]] ![[Pasted image 20240330143827.png]] Chapter 13. Black-Scholes-Merton pricing model [!NOTE]- 13.8. A stock price is currently $40. Assume that the expected return from the stock is 15% and its volatility is 25%. What is the probability distribution for the rate of return (with continuous compounding) earned over a one-year period? mu = 0.15, sigma = 0.25 prob distribution * expected value of return = 0.15 - 0.25^2 / 2 = 0.11875 p.a * SD = 0.25 p.a [!NOTE]- 13.9. A stock price has an expected return of 16% and a volatility of 35%. The current price is $38. | (a) What is the probability that a European call option on the stock with an exercise price of $40 and a maturity date in six months will be exercised? | (b) What is the probability that a European put option on the stock with the same exercise price and maturity will be exercised? a) Find N(d2) = 04969 / 0.4968 b) [!example]- What does the Black\u2013Scholes\u2013Merton stock option pricing model assume about the probability distribution of the stock price in one year? What does it assume about the probability distribution of the continuously compounded rate of return on the stock during the year? * The Black\u2013Scholes\u2013Merton option pricing model assumes that the probability distribution of the stock price in one year (or at any other future time) is lognormal . * Equivalently, it assumes that the continuously compounded rate of return on the stock is normally distributed. [!NOTE]- The volatility of a stock price is 30% per annum. What is the standard deviation of the percentage price change in one trading day? * \u03c3 = 30% = volatility * Assuming 252 trading days per year, \u0394t = 1/252 * Prob dist of RATE OF RETURN = \u03c3\u221a\u0394t = 30% . \u221a1/252 = 1.9% [!example]- Explain how risk-neutral valuation could be used to derive the Black\u2013Scholes\u2013Merton formulas. Assuming that the expected return from the stock is the risk-free rate, we calculate the expected payoff from a call option. We then discount this payoff from the end of the life of the option to the beginning at the risk-free interest rate. [!NOTE]- Calculate the price of a three-month European put option on a non-dividend-paying stock with a strike price of $50 when the current stock price is $50, the risk-free interest rate is 10% per annum, and the volatility is 30% per annum. p = 2.38 [!example] What is Black\u2019s approximation for valuing an American call option on a dividend paying stock? In Black\u2019s approximation, we calculate the price of a European call option expiring at the same time as the American call option and the price of a European call option expiring just before the final ex-dividend date. We set the American call option price equal to the greater of the two. [!example]- 13.10. Prove that, with the notation in the chapter, a 95% confidence interval for ST is between ... ![[Pasted image 20240306213029.png]] [!example]- A portfolio manager announces that the average of the returns realized in each of the last 10 years is 20% per annum. In what respect is this statement misleading? This problem relates to the material in Section 13.2. The statement is misleading in that a certain sum of money, say $1000, when invested for 10 years in the fund would have realized a return (with annual compounding) of less than 20% per annum. The average of the returns realized in each year is always greater than the return per annum (with annual compounding) realized over 10 years . The first is an arithmetic average of the returns in each year; the second is a geometric average of these returns. [!danger]- Assume that a non-dividend-paying stock has an expected return of mu and a volatility of sigma. An innovative financial institution has just announced that it will trade a derivative that pays off a dollar amount equal to ![[Pasted image 20240306213611.png]] at time T. The variables 0 S and T S denote the values of the stock price at time zero and time T. a) Describe the payoff from this derivative. b) Use risk-neutral valuation to calculate the price of the derivative at time zero. a) The derivative will pay off a dollar amount equal to the continuously compounded return on the security between times 0 and T. b) The expected value of ln (ST / S0) is, from equation (13.4), (mu - SD^2 / 2)T. The expected payoff from the derivative is therefore mu - SD^2/2. In a risk-neutral world this becomes r - SD^2 / 2. The value of the derivative at time zero is therefore: ![[Pasted image 20240306214430.png]] [!NOTE]- What is the price of a European call option on a non-dividend-paying stock when the stock price is $52, the strike price is $50, the risk-free interest rate is 12% per annum, the volatility is 30% per annum, and the time to maturity is three months? S = 52, K = 50, r = 12%, sigma = 30%, T = 3/12 ANS: 5.06 [!NOTE]- 13.14 | What is the price of a European put option on a non-dividend-paying stock when the stock price is $69, the strike price is $70, the risk-free interest rate is 5% per annum, the volatility is 35% per annum, and the time to maturity is six months? ![[Pasted image 20240328231309.png]] [!NOTE]- 13.15 | Call = 2.5, stock price = 15, price = 2.50, strike = 13, T = 3/12, rfr = 5%. Implied volatility? ![[Pasted image 20240328231939.png]] Goal seek -> 40% [!NOTE]- 13.16 | Show that the Black\u2013Scholes\u2013Merton formula for a call option gives a price that tends to max\u00f0S0 K; 0\u00de as T !0. ![[Pasted image 20240328232055.png]] [!NOTE]- 13.17 | Explain carefully why Black\u2019s approach to evaluating an American call option on a dividend-paying stock may give an approximate answer even when only one dividend is anticipated. Does the answer given by Black\u2019s approach understate or overstate the true option value? Explain your answer. Black\u2019s approach in effect assumes that the holder of option must decide at time zero whether it is a European option maturing at time n t (the final ex-dividend date) or a European option maturing at time T. In fact the holder of the option has more flexibility than this. The holder can choose to exercise at time n t if the stock price at that time is above some level but not otherwise. Furthermore, if the option is not exercised at time n t , it can still be exercised at time T. It appears that Black\u2019s approach should understate the true option value. This is because the holder of the option has more alternative strategies for deciding when to exercise the option than the two strategies implicitly assumed by the approach. These alternative strategies add value to the option. However, this is not the whole story. The standard approach to valuing either an American or a European option on a stock paying a single dividend applies the volatility to the stock price less the present value of the dividend. (The procedure for valuing an American option is explained in Chapter 18.) Black\u2019s approach when considering exercise just prior to the dividend date applies the volatility to the stock price itself. Black\u2019s approach therefore assumes more stock price variability than the standard approach in some of its calculations. In some circumstances it can give a higher price than the standard approach. [!NOTE]- [x] 13.18 | Consider an American call option on a stock. The stock price is $70, the time to maturity is eight months, the risk-free rate of interest is 10% per annum, the exercise price is $65, and the volatility is 32%. A dividend of $1 is expected after three months and again after six months. Use the results in the appendix to show that it can never be optimal to exercise the option on either of the two dividend dates. Use DerivaGem to calculate the price of the option. ![[Pasted image 20240328232754.png]] ![[Pasted image 20240328232818.png]] [!example]- 13.20 | Show that the Black\u2013Scholes\u2013Merton formulas for call and put options satisfy put\u2013call parity. ![[Pasted image 20240328233515.png]] [!example]- 13.21 | Show that the probability that a European call option will be exercised in a risk-neutral world is, with the notation introduced in this chapter, N\u00f0d2\u00de. What is an expression for the value of a derivative that pays off $100 if the price of a stock at time T is greater than K? ![[Pasted image 20240328233625.png]] ![[Pasted image 20240328233601.png]] ![[Pasted image 20240328233608.png]] Chapter 4. Interest rates, bond yields [!example]- 4.1 | What is meant by LIBOR and LIBID. Which is higher? LIBOR is the London Interbank Offered Rate. It is the rate a bank quotes for deposits it is prepared to place with other banks. LIBID is the London Interbank Bid Rate. It is the rate a bank quotes for deposits from other banks. LIBOR is greater than LIBID. [!NOTE]- 4.3 | The six-month and one-year zero rates are both 10% per annum. For a bond that has a life of 18 months and pays a coupon of 8% per annum semiannually (with a coupon payment having just been made), the yield is 10.4% per annum. What is the bond\u2019s price? What is the 18-month zero rate? Face = 100. All rates are quoted with semiannual compounding. 0. Convert pa rate to semi: 5.2% 1. Current price (right after a coupon pmt): discount all pmt by semi yield 10.4% * 4 / 1.052 + 4 / 1.052^2 + 104 / 1.052^3 = 96.74 * Three payments cos 18 months, 1 pmt = 6 month / semiannual To find 18-month zero rate, let it be R. For the 6 month & 12 month rate -> replace yield with the zero rates (both 10% p.a. -> 5% semi). 4 / 6 month 0 rate + 4 / 12 month 0 rate + 104 / 18 month 0 rate or R NOTE THAT R IS CURRENTLY A PER ANNUM RATE! 4 / 1.05 + 4 / 1.05^2 + 4 / (1 + R/2)^3 = 96.74 Goal seek -> R = 10.42% [!NOTE]- 4.5 | Assuming that zero rates are as in Problem 4.5, what is the value of an FRA that enables the holder to earn 9.5% for a three-month period starting in one year on a principal of $1,000,000? The interest rate is expressed with quarterly compounding. [!example]- 4.7 | The term structure of interest rates is upward sloping. Put the following in order of magnitude: a. The five-year zero rate b. The yield on a five-year coupon-bearing bond c. The forward rate corresponding to the period between 4.75 and 5 years in the future Upward sloping term structure = normal yield curve -> long term interest rates > short term interest rates = usually healthy bc * expectations of econ expansion * expectations of rising inflation When the term structure is upward sloping, smallest = b -> a -> c b = yield, coupon bond = smallest A coupon-bearing bond pays periodic interest payments (coupons) to its holders. These coupon payments reduce the effective yield of the bond compared to its yield if it were a zero-coupon bond ( no coupon = higher yield than coupon ) In contrast, the forward rate (c) and the five-year zero rate (a) represent yields on zero-coupon bonds, which do not pay coupons. a = yield, no coupon bond = middle theoretical zero-coupon bond that matures in five years, meaning it pays no coupons and is redeemed at face value at maturity. < c - five-year zero rate cos current rate = typically lower than the forward rate because it represents the market expectation (upward slope) b cos b has coupon so lower yield c = forward rate = greatest The forward rate represents the market's expectation of the interest rate for a specific future period. In an upward-sloping yield curve, investors anticipate that interest rates will rise over time. Therefore, the forward rate, which represents a future rate, is expected to be higher than the current rates (both the five-year zero rate and the yield on a five-year coupon-bearing bond). What is the answer to this question when the term structure of interest rates is downward sloping? When it is downward sloping, c -> a -> b (smallest to largest) [!NOTE]- 4.8 | The cash prices of six-month and one-year Treasury bills are 94.0 and 89.0. A 1.5-year bond that will pay coupons of $4 every six months currently sells for $94.84. A two-year bond that will pay coupons of $5 every six months currently sells for $97.12. Calculate the six-month, one-year, 1.5-year, and two-year zero rates. ![[Pasted image 20240329063748.png]] ![[Pasted image 20240329062859.png]] [!NOTE]- 4.10 | A deposit account pays 12% per annum with continuous compounding, but interest is actually paid quarterly. How much interest will be paid each quarter on a $10,000 deposit? 1. Convert cont rate to equivalent quarterly rate 2. Cos rate is pa, find interest per annum (amount * rate) then divide by 4 ![[Pasted image 20240329064313.png]] [!NOTE]- 4.11 | Suppose that 6-month, 12-month, 18-month, 24-month, and 30-month zero rates con tinuously compounded are 4%, 4.2%, 4.4%, 4.6%, and 4.8% per annum, respectively. Estimate the cash price of a bond with a face value of 100 that will mature in 30 months pays a coupon of 4% per annum semiannually. ![[Pasted image 20240329065120.png]] ![[Pasted image 20240329065145.png]] [!NOTE]- 4.12 | A three-year bond provides a coupon of 8% semiannually and has a cash price of 104. What is the bond\u2019s yield? ![[Pasted image 20240329070140.png]] ![[Pasted image 20240329070202.png]] [!NOTE]- 4.13 | Suppose that the 6-month, 12-month, 18-month, and 24-month zero rates are 5%, 6%, 6.5%, and 7%, respectively. What is the two-year par yield? Par yield = the coupon rate p.a. of a bond with price / value = 100 ![[Pasted image 20240329070933.png]] 4.15 WHY? 4.10 VS 4.9 EQUATION?? ![[Pasted image 20240329071956.png]] [!warning] 4.16 | A 10-year 8% coupon bond currently sells for $90. A 10-year 4% coupon bond currently sells for $80. What is the 10-year zero rate? (Hint: Consider taking a long position in two of the 4% coupon bonds and a short position in one of the 8% coupon bonds.) Taking a long position in two of the 4% coupon bonds and a short position in one of the 8% coupon bonds leads to the following cash flows: * Year 0: 90 - 2*80 = -70 * Year 10: 200 - 100 = 100 because the coupons cancel out. $100 in 10 years time is equivalent to $70 today. The 10 year rate, R, (continuously compounded) is therefore given by ![[Pasted image 20240329072752.png]] [!example]- Explain carefully why liquidity preference theory is consistent with the observation that the term structure of interest rates tends to be upward sloping more often than it is downward sloping. If long-term rates were simply a reflection of expected future short-term rates, we would expect the term structure to be downward sloping as often as it is upward sloping. (This is based on the assumption that half of the time investors expect rates to increase and half of the time investors expect rates to decrease). Liquidity preference theory argues that long term rates are high relative to expected future short-term rates. This means that the term structure should be upward sloping more often than it is downward sloping. [!example]- \u2018\u2018When the zero curve is upward sloping, the zero rate for a particular maturity is greater than the par yield for that maturity. When the zero curve is downward sloping, the reverse is true.\u2019\u2019 Explain why this is so. The par yield is the yield on a coupon-bearing bond. The zero rate is the yield on a zero coupon bond. When the yield curve is upward sloping, the yield on an N-year coupon bearing bond is less than the yield on an N-year zero-coupon bond. This is because the coupons are discounted at a lower rate than the N-year rate and drag the yield down below this rate. Similarly, when the yield curve is downward sloping, the yield on an N-year coupon bearing bond is higher than the yield on an N-year zero-coupon bond. [!example]- Why are U.S. Treasury rates significantly lower than other rates that are close to risk free? There are 3 reasons 1. Treasury bills and Treasury bonds must be purchased by financial institutions to fulfill a variety of regulatory requirements. This increases demand for these Treasury instruments driving the price up and the yield down. 2. The amount of capital a bank is required to hold to support an investment in Treasury bills and bonds is substantially smaller than the capital required to support a similar investment in other very-low-risk instruments. 3. In the United States, Treasury instruments are given a favorable tax treatment compared with most other fixed-income investments because they are not taxed at the state level. [!example]- Why does a loan in the repo market involve very little credit risk? / Explain how a repo agreement works and why it involves very little risk for the lender. A repo is a contract where an investment dealer who owns securities agrees to sell them to another company now and buy them back later at a slightly higher price. The other company is providing a loan to the investment dealer. This loan involves very little credit risk. If the borrower does not honor the agreement, the lending company simply keeps the securities. If the lending company does not keep to its side of the agreement, the original owner of the securities keeps the cash. [!example]- Explain why an FRA is equivalent to the exchange of a floating rate of interest for a fixed rate of interest? A FRA is an agreement that a certain specified interest rate, RK , will apply to a certain principal, L , for a certain specified future time period. Suppose that the rate observed in the market for the future time period at the beginning of the time period proves to be M R . If the FRA is an agreement that K R will apply when the principal is invested, the holder of the FRA can borrow the principal at M R and then invest it at K R . The net cash flow at the end of the period is then an inflow of K RL and an outflow of M K R L. If the FRA is an agreement that R will apply when the principal is borrowed, the holder of the FRA can invest the borrowed principal at M R . The net cash flow at the end of the period is then an inflow of M outflow of K R L and an RL. In either case we see that the FRA involves the exchange of a fixed rate of interest on the principal of L for a floating rate of interest on the principal. ![[Pasted image 20240329072440.png]] [!NOTE]- \u201cAn interest rate swap where six-month LIBOR is exchanged for a fixed rate 5% on a principal of $100 million is a portfolio of FRAs.\u201d Explain. Each exchange of payments is an FRA where interest at 5% is exchanged for interest at LIBOR on a principal of $100 million. Interest rate swaps are discussed further in Chapter 7. Chapter 3. Hedging & basis risk [!example]- Give three reasons why the treasurer of a company might not hedge the company\u2019s exposure to a particular risk. 1. If the company\u2019s competitors are not hedging, the treasurer might feel that the company will experience less risk if it does not hedge 2. The shareholders might not want the company to hedge. 3. If there is a loss on the hedge and a gain from the company\u2019s exposure to the underlying asset, the treasurer might feel that he or she will have difficulty justifying the hedging to other executives within the organization. [!NOTE]- [x] Suppose that the standard deviation of quarterly changes in the prices of a commodity is $0.65, the standard deviation of quarterly changes in a futures price on the commodity is $0.81, and the coefficient of correlation between the two changes is 0.8. What is the optimal hedge ratio for a three-month contract? What does it mean? ![[Pasted image 20240329121347.png]] [!NOTE]- [x] A company has a $20 million portfolio with a beta of 1.2. It would like to use futures contracts on the S&P 500 to hedge its risk. The index futures price is currently 1080, and each contract is for delivery of $250 times the index. What is the hedge that minimizes risk? What should the company do if it wants to reduce the beta of the portfolio to 0.6? ![[Pasted image 20240329122405.png]] ![[Pasted image 20240329121716.png]] [!NOTE]- In the Chicago Board of Trade\u2019s corn futures contract, the following delivery months are available: March, May, July, September, and December. State the contract that should be used for hedging when the expiration of the hedge is in (a) June, (b) July, and (c) January. a) july b) sep [!example]- Does a perfect hedge always succeed in locking in the current spot price of an asset for a future transaction? Explain your answer. No. Consider, for example, the use of a forward contract to hedge a known cash inflow in a foreign currency. The forward contract locks in the forward exchange rate \u2014 which is in general different from the spot exchange rate. [!example]- Explain why a short hedger\u2019s position improves when the basis strengthens unexpectedly and worsens when the basis weakens unexpectedly. The basis is the amount by which the spot price exceeds the futures price. A short hedger is long the asset and short futures contracts. The value of his or her position therefore improves as the basis increases. Similarly it worsens as the basis decreases. [!example]- Imagine you are the treasurer of a Japanese company exporting electronic equipment to the United States. Discuss how you would design a foreign exchange hedging strategy and the arguments you would use to sell the strategy to your fellow executives. The simple answer to this question is that the treasurer should Estimate the company\u2019s future cash flows in Japanese yen and U.S. dollars Enter into forward and futures contracts to lock in the exchange rate for the U.S. dollar cash flows. However, this is not the whole story. As the gold jewelry example in Table 3.1 shows, the company should examine whether the magnitudes of the foreign cash flows depend on the exchange rate. For example, will the company be able to raise the price of its product in U.S. dollars if the yen appreciates? If the company can do so, its foreign exchange exposure may be quite low. The key estimates required are those showing the overall effect on the company\u2019s profitability of changes in the exchange rate at various times in the future. Once these estimates have been produced the company can choose between using futures and options to hedge its risk. The results of the analysis should be presented carefully to other executives. It should be explained that a hedge does not ensure that profits will be higher. It means that profit will be more certain. * When futures/forwards are used both the downside and upside are eliminated. * With options a premium is paid to eliminate only the downside. [!example]- \"If the minimum-variance hedge ratio is calculated as 1.0, the hedge must be perfect.\" Is this statement true? Explain your answer. Minimum variance hedge ratio is the ratio of the average change in S for a particular change in F, while a perfect hedge is defined as when the correlation coefficient (\u03c1) between the spot and futures prices is 1. Their relationship can be expressed by this equation: A h* value of 1.0 (minimum-variance hedge ratio) alone doesn\u2019t guarantee a \u03c1 value of 1, since it is also dependent on \u03c3S and \u03c3F. For example, a \u03c1 value of 0.1 and a \u03c3S/\u03c3F value of 10 also constitutes a minimum-variance hedge ratio, yet it does not mean the spot is perfectly correlated with the future prices. Hence the statement is not true. [!example]- \u2018\u2018If there is no basis risk, the minimum variance hedge ratio is always 1.0.\u2019\u2019 Is this statement true? Explain your answer. The statement is true. Using the notation in the text, if the hedge ratio is 1.0, the hedger locks in a price of F1 + b2. Since both 1 F and 2 b are known this has a variance of zero and must be the best hedge. [!example]- \u201cFor an asset where futures prices are usually less than spot prices, long hedges are likely to be particularly attractive.\" Explain this statement. A company that knows it will purchase a commodity in the future is able to lock in a price close to the futures price. This is likely to be particularly attractive when the futures price is less than the spot price. [!NOTE]- [x] 3.16 | The standard deviation of monthly changes in the spot price of live cattle is (in cents per pound) 1.2. The standard deviation of monthly changes in the futures price of live cattle for the closest contract is 1.4. The correlation between the futures price changes and the spot price changes is 0.7. It is now October 15. A beef producer is committed to purchasing 200,000 pounds of live cattle on November 15. The producer wants to use the December live cattle futures contracts to hedge its risk. Each contract is for the delivery of 40,000 pounds of cattle. What strategy should the beef producer follow? ![[Pasted image 20240425171453.png]] The beef producer requires a long position in 200000x0.6=120 000 lbs of cattle. The beef producer should therefore take a long position in 3 December contracts closing out the position on November 15. [!NOTE]- [x] On July 1, an investor holds 50,000 shares of a certain stock. The market price is $30 per share. The investor is interested in hedging against movements in the market over the next month and decides to use the September Mini S&P 500 futures contract. The index is currently 1,500 and one contract is for delivery of $50 times the index. The beta of the stock is 1.3. What strategy should the investor follow? Under what circumstances will it be profitable? ![[Pasted image 20240329124120.png]] Equity hedging = bouta sell -> short position . 26 contracts is required. It will be profitable if the stock outperforms the market in the sense that its return is greater than that predicted by the capital asset pricing model. [!example]- A futures contract is used for hedging. Explain why the daily settlement of the contract can give rise to cash flow problems. Suppose that you enter into a short futures contract to hedge the sale of a asset in six months. If the price of the asset rises sharply during the six months, the futures price will also rise and you may get margin calls. The margin calls will lead to cash outflows. Eventually the cash outflows will be offset by the extra amount you get when you sell the asset, but there is a mismatch in the timing of the cash outflows and inflows. Your cash outflows occur earlier than your cash inflows. A similar situation could arise if you used a long position in a futures contract to hedge the purchase of an asset and the asset\u2019s price fell sharply. An extreme example of what we are talking about here is provided by Metallgesellschaft [!example] A corn farmer argues \u201cI do not use futures contracts for hedging. My real risk is not the price of corn. It is that my whole crop gets wiped out by the weather.\u201dDiscuss this viewpoint. Should the farmer estimate his or her expected production of corn and hedge to try to lock in a price for expected production? If weather creates a significant uncertainty about the volume of corn that will be harvested, the farmer should not enter into short forward contracts to hedge the price risk on his or her expected production. The reason is as follows. Suppose that the weather is bad and the farmer\u2019s production is lower than expected. Other farmers are likely to have been affected similarly. Corn production overall will be low and as a consequence the price of corn will be relatively high. The farmer\u2019s problems arising from the bad harvest will be made worse by losses on the short futures position. This problem emphasizes the importance of looking at the big picture when hedging. The farmer is correct to question whether hedging price risk while ignoring other risks is a good strategy. [!warning] 3.22 | A company wishes to hedge its exposure to a new fuel whose price changes have a 0.6 correlation with gasoline futures price changes. The company will lose $1 million for each 1 cent increase in the price per gallon of the new fuel over the next three months. The new fuel's price change has a standard deviation that is 50% greater than price changes in gasoline futures prices. If gasoline futures are used to hedge the exposure what should the hedge ratio be? What is the company's exposure measured in gallons of the new fuel? What position measured in gallons should the company take in gasoline futures? How many gasoline futures contracts should be traded? The new fuel's price change has a standard deviation that is 50% greater than price changes in gasoline futures prices => fraction in RHS is 1.5, thus h is 0.6 * 1.5 = 0.9 If should therefore take a position of 90 million gallons in gasoline futures. Each futures contract is on 42,000 gallons. The number of contracts required is therefore 90 mil / 42mil (size per contract) = 2142.9 (2143) [!warning] ![[Pasted image 20240425175413.png]] ![[Pasted image 20240425175432.png]]","title":"Derivatives exercises"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-1-basics","text":"[!NOTE]- What is the difference between (a) entering into a long futures contract when the futures price is \\$50 and (b) taking a long position in a call option with a strike price of \\$50? a) BUY future - buy the foreign not at the current market price now but at 50$; obligated to buy the asset for $50 and does not have a choice b) BUY call - buy the ability to buy at predetermined price; has the option to buy the asset for $50 but does not have to exercise the option [!NOTE]- An investor enters into a short forward contract to sell 100,000 British pounds for U.S. dollars at an exchange rate of 1.4000 U.S. dollars per pound. How much does the investor gain or lose if the exchange rate at the end of the contract is (a) 1.3900 and (b) 1.4200? Short forward = sell pounds for US not at current price but at 1 pound = 1.4 US * Gain 1.4 US * Lose 1 pound a) Later 1 pound = only worth 1.39 US -> 1.39 - 1.40 = -0.1 US . 100,000 The investor is obligated to sell pounds for 1.4000 when they are worth 1.3900. b) Pound appreciates -> Gain 0.2 US . 100,000 [!NOTE]- Suppose that you write a put contract with a strike price of $40 and an expiration date in three months. The current stock price is $41 and one put option contract is on 100 shares. What have you committed yourself to? How much could you gain or lose? a) Write = sell Put = ability to sell => You're saying if you buy my put -> if you exercise and sell your stock -> I must definitely buy it at exactly 40 bucks => If stock goes up higher -> you'll profit so the buyer won't exercise -> you only gain the premium => If stock goes down < 40 -> they will profit if they sell for you at 40 -> you lose whatever the spot is - 40, times 100 [!NOTE]- You would like to speculate on a rise in the price of a certain stock. The current stock price is $29 and a three-month call (buy) with a strike price of $30 costs $2.90. You have $5,800 to invest. Identify two alternative strategies. Briefly outline the advantages and disadvantages of each. You think it's gonna go up -> better BUY it now a) buy 5800/29 = 200 shares now b) buy 2000 options = option to BUY at 30 dollars * Profit if value share goes up > 30 dollars * Not exercise -> lose premium 2.9 . 2000 = 5800 If the share price does well, the second strategy will give rise to greater gains. However, if the share price does badly, the second strategy yields greater losses. [!NOTE]- Suppose you own 5,000 shares that are worth $25 each. How can put options be used to provide you with insurance against a decline in the value of your holding over the next four months? Buy the ability to sell your stocks at set prices if it were to decrease -> BUY a CALL option with a strike price of $25 and an expiration date in four months. If at the end of four months the stock price proves to be less than $25, you can exercise the options and sell the shares for $25 each. [!warning]- An exchange-traded stock option provides no funds for the company. It is a security sold by one investor to another. The company is not involved. By contrast, a stock when it is first issued is sold by the company to investors and does provide funds for the company. [!example]- Explain why a futures contract can be used for either speculation or hedging. If an investor has an EXPOSURE to the price of an asset, he or she can hedge with futures contracts. * If the investor will gain when the price decreases and lose when the price increases, a long futures position will hedge the risk. * If the investor will lose when the price decreases and gain when the price increases, a short futures position will hedge the risk. * Thus either a long or a short futures position can be entered into for hedging purposes. If the investor has NO EXPOSURE to the price of the underlying asset, entering into a futures contract is speculation. If the investor takes a long position, he or she gains when the asset\u2019s price increases and loses when it decreases. If the investor takes a short position, he or she loses when the asset\u2019s price increases and gains when it decreases. [!warning]- A cattle farmer expects to have 120,000 pounds of live cattle to sell in three months. The live-cattle futures contract on the Chicago Mercantile Exchange is for the delivery of 40,000 pounds of cattle. How can the farmer use the contract for hedging? From the farmer\u2019s viewpoint, what are the pros and cons of hedging? The farmer can SHORT (sell) 3 contracts that have 3 months to maturity. * If the price of cattle falls -> sell at high predetermined price -> futures contract profit but will offset the loss on the sale of the cattle. * If the price of cattle rises, the gain on the sale of the cattle will be offset by the loss on the futures contract. * Using futures contracts to hedge has the advantage that it can at no cost reduce risk to almost zero. * Its disadvantage is that the farmer no longer gains from favorable movements in cattle prices. [!NOTE]- It is May and a trader writes a September call option with a strike price of $20. The stock price is $18 and the option price is $2. Describe the investor\u2019s cash flows if the option is held until September and the stock price is $25 at this time. Write = sell Call = ability to BUY Write a call = sell ability to buy - at time x if exercise -> writer MUST sell to holder no matter what * writer profits if value goes down, sell at agreed > more than spot * At 25 dollars, writer must sell for 18 despite spot = 25 -> lose 7 dollars, gain 2 premium = lose 5 Essentially, at time 0 the writer earns 2 dollars . The, in the future at 25, has to buy the currency at spot of 25 then sell to holder of option for 20 -> lose 5 => inflow of $2 in May and an outflow of $5 in September [!example]- The CME Group offers a futures contract on long-term Treasury bonds. Characterise the investors likely to use this contract. Most investors will use the contract because they want to do one of the following: a) Hedge an exposure to long-term interest rates. b) Speculate on the future direction of long-term interest rates. c) Arbitrage between the spot and futures markets for Treasury bonds. [!example]- An airline executive has argued: \u201cThere is no point in our using oil futures. There is just as much chance that the price of oil in the future will be less than the futures price as there is that it will be greater than this price.\u201d Discuss the executive\u2019s viewpoint. * It may well be true that there is just as much chance that the price of oil in the future will be above the futures price as that it will be below the futures price. This means that the use of a futures contract for speculation would be like betting on whether a coin comes up heads or tails. * But it might make sense for the airline to use futures for hedging rather than speculation . The futures contract then has the effect of reducing risks . It can be argued that an airline should not expose its shareholders to risks associated with the future price of oil when there are contracts available to hedge the risks. [!notes]- A trader enters into a short forward contract on 100 million yen. The forward exchange rate is $0.0080 per yen. How much does the trader gain or lose if the exchange rate at the end of the contract is (a) $0.0074 per yen; (b) $0.0091 per yen? Short forward = sell 100 million yen at 1 yen = 0.0080 US no matter what Profit if the selling at 1 yen = 0.0080 US is higher than spot rate cos then they can immediately buy back / deliver US at lower amounts a) Gain 0.0006 * 100,000,000 b) Lose 0.0011 * 100,000,000 [!note]- A trader enters into a short cotton futures contract when the futures price is 50 cents per pound. The contract is for the delivery of 50,000 pounds. How much does the trader gain or lose if the cotton price at the end of the contract is (a) 48.20 cents per pound; (b) 51.30 cents per pound? Short contract = The agreed-upon price at which the trader has committed to sell the cotton is 50 cents per pound, and for the delivery of 50,000 pounds of cotton. -> No matter what, I would like to sell at this price (aka they think it's gonna go down so they better sell it at this price that is still high) a) It did go down -> profit 50 - 48.20 * 50,000 b) Lose [!NOTE]- A company knows that it is due to receive a certain amount of a foreign currency in four months. What type of option contract is appropriate for hedging? -> Receive foreign - wanna sell it at set price -> PUT buy -> long position in a 4-month put option -> provide insurance against the exchange rate falling below the strike price. It ensures that the foreign currency can be sold for at least the strike price -> If the foreign currency depreciates, the company can exercise the put option and sell the currency at the higher strike price [!NOTE]- A United States company expects to have to pay 1 million Canadian dollars in six months. Explain how the exchange rate risk can be hedged using (a) a forward contract; (b) an option. Pay foreign -> wanna make sure 1 US is worth as much Cad in 6 months. Bad news if 1 US is worth a lesser amount of Cad -> wanna being able to sell US for Cad at predetermined rate -> long future contract - buy 1 million Canadian dollars in six months. This would have the effect of locking in an exchange rate equal to the current forward exchange rate. -> buy / long position in a call - if worst comes to worst -> has the option to buy Cad at set prices - giving it the right (but not the obligation) to purchase 1 million Canadian dollar at a certain exchange rate in six months. This would provide insurance against a strong Canadian dollar in six months while still allowing the company to benefit from a weak Canadian dollar at that time. [!example]- Buying a stock and a put option on the stock is considered a form of insurance. Explain. * In this strategy, the put option acts as a form of protection against potential downside risk. If the stock price falls, the put option provides the right to sell the stock at a predetermined price (the strike price), limiting the potential losses for the trader. * The cost of the put option premium is the price paid for this insurance. * It is a common strategy known as a protective put or a married put . [!NOTE] Hard questions 1. An call option will always be exercised at maturity if the underlying asset price> strike price while a put option will always be exercised at maturity if the strike price > underlying asset price. 2. An American option can be exercised at any time during its life, up to and including the expiration date. This flexibility is a key feature of American options, distinguishing them from European options, which can only be exercised at the expiration date. 3. If principal size = size of market, then the over-the-counter market is ten times as big as the exchange-traded market. 4. When a trader sells put options , they are taking on the obligation to BUY . 5. A short forward contract on an asset + a long position in a call option on the asset with a strike price = forward price is the same as a long position a put option [!warning]- A trader has a portfolio worth $5 million that mirrors the performance of a stock index. The stock index is currently 1,250. Futures contract trade on the index with one contract being on 250 times the index. To remove market risk from the portfolio the trader should: 1. Number of contracts: 1. Each futures contract is on 250 times the index value 2. Given that the stock index is currently at 1,250 3. Value of one futures contract = 250 * 1,250 = $312,500 2. Number of contracts needed = Portfolio value / Value of one futures contract 1. = 5,000,000 / 312,500 = 16 contracts 3. Direction: To remove market risk from the portfolio, the trader should take an opposite position in the futures market to the existing position in the stock index. Since the trader has a portfolio worth $5 million that mirrors the performance of the stock index, they should take a short / sell position in the futures market => sell 16 contracts 1. Taking a short position in futures contracts provides a form of insurance against a decline in the value of the portfolio. If the stock index falls, the gain from the short futures position can help offset the loss in the portfolio, thus reducing overall market risk. 2. To hedge the existing long position in the portfolio, the trader should take a short position [!warning]- A one-year call option on a stock with a strike price of $30 costs $3; a one-year put option on the stock with a strike price of $30 costs $4. Suppose that a trader buys two call option and one put option. The breakeven stock price below which the trader makes a profit is: 'BELOW' which the trader makes a profit -> lower than this = even better, we need to find the ceiling -> the put option = the one that would make this trader money (cos price falls -> sell higher than spot). * Amount they already lost: 3 + 3 + 4 = 10 * Sell at: 30 * To make a profit, price must be 30 - 10 = 20 [!warning]- A one-year call option on a stock with a strike price of $30 costs $3; a one-year put option on the stock with a strike price of $30 costs $4. Suppose that a trader buys two call options and one put option. The breakeven stock price above which the trader makes a profit is Opposite from above -> profit from call options. * Amount lost = 10 * Buy at 30 PER OPTION * There are 2 options => price for each option must compensate for that 10 dollars amount -> 10 / 2 = 5 * Thus price must be 30 + 5 = 35","title":"Chapter 1. Basics"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-2-futures-markets","text":"[!NOTE]- Hard questions 1. Futures contracts nearly always last longer than forward contracts. This is incorrect. 2. Commodities Futures Trading Commission (CFTC) takes primary responsibility for regulating futures market. 3. In many cases, the open interest for a near-month futures contract (e.g., June 2012) is often higher than that for a more distant-month futures contract bc traders and investors may show greater interest and activity in contracts with nearer expiration dates. 4. Clearing house = in both OTC and markets 5. Which are cash settled A. All futures contracts B. All option contracts C. Futures on commodities D. Futures on stock indices (* this one *) [!example]- What's a haircut? A haircut represents the % reduction in the value of an asset when used as collateral. A 20% haircut means the market value of the bond is reduced by 20%, making it worth $80 when used to satisfy a collateral request. [!example]- Number of agreements in bilateral clearing? In bilateral clearing, each pair of dealers forms an agreement. Since there are four dealers (let's label them A, B, C, and D), the possible pairs are AB, AC, AD, BC, BD, and CD. Therefore, there are six agreements in total. [!NOTE]- [x] Suppose that you enter into a short futures contract to sell July silver for $27.20 per ounce. The size of the contract is 5,000 ounces. The initial margin is $4,000, and the maintenance margin is $3,000. What change in the futures price will lead to a margin call? What happens if you do not meet the margin call? Margin call when (initial margin - maintenance margin) $1,000 has been lost from the margin account. Lose money = when price goes up to: * 1000 = 5000 * amount lost per contract -> amount lost per contract = 0.2 dollars => Occur when: price goes up by 0.2 dollars / to 27.40 per ounce If the margin call is not met aka. when you receive a margin call and do not meet it by depositing additional funds into your margin account, the broker will step in to close out your position. [!warning]- [x] Suppose that in September 2013 a company takes a long position in a contract on May 2014 crude oil futures. It closes out its position in March 2014. The futures price (per barrel) is $88.30 when it enters into the contract, $90.50 when it closes out the position, and $89.10 at the end of December 2013. One contract is for the delivery of 1,000 barrels. What is the company\u2019s profit? When is it realized? How is it taxed if it is (a) a hedger and (b) a speculator? Assume that the company has a December 31 year end. Long = buy at set $ = profit if it goes up (it did to 90.50) -> Total profit = 90.50 - 88.30 times 1000 =2200 dollars Of this 2.2k, amount realised on a day-by-day basis btwn Sep 2013 - Dec 2013 is: -> 89.10 - 88.3 * 1000 = 800 dollars Amount realised btwn Jan 2014 - Mar 2014: -> 90.5 - 89.10 * 1000 = 1400 dollars Hedger : taxed on 2200 dollars (everything) in 2014. Speculator : taxed on 800 dollars in 2013, 1400 in 2014 (in separate years) [!warning]- [x] A trader buys two July futures contracts on orange juice. Each contract is for the delivery of 15,000 pounds. The current futures price is 160 cents per pound, the initial margin is $6,000 per contract, and the maintenance margin is $4,500 per contract . What price change would lead to a margin call? Under what circumstances could $2,000 be withdrawn from the margin account? ( HARD BECAUSE PER CONTRACT - THERE ARE 2 ) 1. Margin call when: loss = 1500 PER CONTRACT 2. Price change required: 1500 = amount lost/pound * 15000 -> amount lost/price change = 0.1 dollars = 10 cents 3. Direction of price change: buy at set price -> lose if price goes down cos then they bought 4 2 high => price drops to 150 cents/pound -> trigger margin call Again must think in terms of 1 contract: Gain of 1000/contract = 15000 * amount gained/pound -> amount = 1/15 or 0.06666 dollars -> price goes up to 166.6666 / pound You CANNOT join the 2 together into 2k profit since a threshold is set for each individual contract [!NOTE]- At the end of one day a clearing house member is long 100 contracts, and the settlement price is $50,000 per contract. The original margin is $2,000 per contract. On the following day the member becomes responsible for clearing an additional 20 long contracts, entered into at a price of $51,000 per contract. The settlement price at the end of this day is $50,200. How much does the member have to add to its margin account with the exchange clearing house? Day 1: * Buy 100 contracts * Price = 50k / contract * Margin = 2k / contract Day 2 20 more contracts 51k / contract For the new contract, additional margin needed to provide: -> 20 * 2000 = 40000 dollars Amount gained (buy -> good if higher price): -> 50200 - 50000 times 100 = 20000 gained on Day 1 contracts Amount lost: -> 50200 - 51000 times 20 = 16000 dollars lost on Day 2 contracts Amount must add to margin account: -> 40k (margin for the new 20) - 4k (gained) = 36000 dollars [!NOTE]- On July 1, 2013, a Japanese company enters into a forward contract to buy $1 million with yen on January 1, 2014. On September 1, 2013, it enters into a forward contract to sell $1 million on January 1, 2014. Describe the profit or loss the company will make in dollars as a function of the forward exchange rates on July 1, 2013, and September 1, 2013. July 2013: will buy 1 mil US for x yen/US (current forward XC rate) Sep 2013: will sell 1 mil US for y yen/US (current forward XC rate) On Jan 2014: For the July 2013 contract: + 1 mil US, - x yen For the Sep 2013 contract: - 1 mil US, + y yen Total payoff : (- x + y) yen [!warning]- The forward price of the Swiss franc for delivery in 45 days is quoted as 1.1000. The futures price for a contract that will be delivered in 45 days is 0.9000. Explain these two quotes. Which is more favorable for an investor wanting to sell Swiss francs? 1.1 = will get francs at 1.1 francs / 1 US -> 1 francs = 0.909090909 US 0.9 = will get fracs at 0.9 US / 1 francs => First rate > Second rate => The Swiss franc is therefore more valuable in the forward market (1st one) than in the futures market. => The forward market is therefore more attractive for an investor wanting to SELL Swiss francs. [!example]- Suppose you call your broker and issue instructions to sell one July hogs contract. Describe what happens. Hog futures are traded on the Chicago Mercantile Exchange. 1. The broker will request some initial margin. 2. The order will be relayed by telephone to your broker\u2019s trading desk on the floor of the exchange (or to the trading desk of another broker). 3. It will be sent by messenger to a commission broker who will execute the trade according to your instructions. 4. Confirmation of the trade eventually reaches you. 5. If there are adverse movements in the futures price your broker may contact you to request additional margin. [!example]- \"Speculation in futures markets is pure gambling. It is not in the public interest to allow speculators to trade on a futures exchange.\" Discuss this viewpoint. Speculators are important market participants because they add liquidity to the market. However, contracts must be useful for hedging as well as speculation . This is because regulators generally only approve contracts when they are likely to be of interest to hedgers as well as speculators . [!example]- What do you think would happen if an exchange started trading a contract in which the quality of the underlying asset was incompletely specified? The contract would not be a success. * Parties with short positions would hold their contracts until delivery and then deliver the cheapest form of the asset -> This might well be viewed by the party with the long position as garbage! * Once news of the quality problem became widely known no one would be prepared to buy the contract. * This shows that futures contracts are feasible only when there are rigorous standards within an industry for defining the quality of the asset. * Many futures contracts have in practice failed because of the problem of defining quality. [!example]- \u201cWhen a futures contract is traded on the floor of the exchange, it may be the case that the open interest increases by one, stays the same, or decreases by one.\u201d Explain this statement. * If both sides of the transaction are entering into a new contract, the open interest increases by one. * If both sides of the transaction are closing out existing positions, the open interest decreases by one. * If one party is entering into a new contract while the other party is closing out an existing position, the open interest stays the same. [!NOTE]- [x] Suppose that on October 24, 2010, you take a short position in an April 2011 live-cattle futures contract. You close out your position on January 21, 2011. The futures price (per pound) is 91.20 cents when you enter into the contract, 88.30 cents when you close out your position, and 88.80 cents at the end of December 2010. One contract is for the delivery of 40,000 pounds of cattle. What is your total profit? How is it taxed if you are (a) a hedger and (b) a speculator? Assume that you have a December 31 year end. Short = sell at set $ = think it's gonna go down Oct 2010: take short position in Apr 2011 contract - 0. 9120 Dec 2010: 0.8880 Jan 2011: close out position - 0.8830 Apr 2011: future contract matures Total profit (enter -> close) -> 0.9120 - 0.8830 times 40000 = 1160 dollars gained Realised on day-by-day basis in 2010: -> 0.9120 - 0.8880 times 40000 = 960 dollars gained As a speculator: taxed on 960 in 2010 then on 200 in 2011 As a hedger: taxed on 1160 in 2011 [!example]- Explain the difference between bilateral and central clearing for OTC derivatives. Aspect Bilateral Clearing Central Clearing Nature Direct negotiation between counterparties Centralised clearinghouse acts as an intermediary Counterparty Risk High, as it relies on the creditworthiness of each party Reduced, as the clearinghouse becomes the counterparty to both sides Documentation ISDA Master Agreement Standardised contracts and terms may be used Margining Negotiated directly between counterparties Clearinghouses impose margin requirements Flexibility Greater flexibility in contract terms and negotiations Standardisation may limit flexibility [!example]- Why flexibility decreases f/f prices? The party with the short position chooses between the alternatives. The alternatives therefore make the futures contract more attractive to the party with the short position. The lower the futures price the less attractive it is to the party with the short position. The benefit of the alternatives available to the party with the short position is therefore compensated for by the futures price being lower than it would otherwise be. SELL FUTURE CONTRACT = TAKING SHORT POSITION = THINK IT'S GONNA GO DOWN [!example]- Explain how CCPs work. What are the advantages to the financial system of requiring all standardised derivatives transactions to be cleared through CCPs? A CCP, or Central Counterparty, acts as a middleman when trading standardised derivatives. * After a trade, the CCP steps in as the central counterparty for both the buyer and seller through a process called novation. * The CCP manages risk by using standardised contracts and collecting margin from participants. * If a participant defaults, the CCP has procedures to handle it, using the defaulting party's margin and resources to cover losses. Advantages * Significantly reduces counterparty risk by becoming the counterparty for all trades. * Promotes transparency through the use of standardised contracts with clear terms. * Streamlining of settlement processes by netting offsetting positions, leading to increased operational efficiency.","title":"Chapter 2. Futures markets"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-5-valuation-of-futures-and-forwards","text":"[!note]- [x] An investor shorts 100 shares when the share price is $50 and closes out the position six months later when the share price is $43. The shares pay a dividend of $3 per share during the six months. Net gain/loss? When an investor \"shorts\" shares, it means they are selling shares they don't own with the expectation that the share price will fall. 1. The investor borrows 100 shares from a broker and sells them in the market at the current share price of $50. * The investor receives $5,000 (100 shares * $50/share) from the sale 2. Position open for 6 months: * The investor keeps the proceeds from the short sale and waits for the share price to decrease. 3. Closing out * After six months, the share price has fallen to $43. * To close out the short position, the investor buys back 100 shares at the current lower price of $43/share. * The cost of buying back the shares is $4300 (100 shares * $43/share). Net so far: 5000 gain from selling - 4300 loss from buying back = 700 gain But they must pay dividends during open -> lose 3 * 100 = 300 Thus, profit = 700 - 300 - 400 [!example]- The spot price of an asset is positively correlated with the market. Which of the following would you expect to be true? => The forward price is less than the expected future spot price * A positive correlation between the spot price of an asset and the market implies that when the market is expected to rise in the future, the spot price of the asset is also expected to rise. * In such a scenario, the forward price is typically < expected future spot price. * This is because the forward price incorporates the expected future spot price plus the cost of carry or the opportunity cost of tying up capital. * The difference between the forward price and the expected future spot price reflects this cost of carry . [!example]- f/f quoting conventions Futures price of a foreign currency -> number of U.S. dollars per unit of the foreign currency. Forward price of a foreign currency -> Some forward prices are always quoted as the number of U.S. dollars per unit of the foreign currency and some are always quoted the other way round. [!example]- Reasons why a short position in a stock is closed out? * Investor decisions * broker is no longer able to borrow shares from other clients * investor does not maintain margins required on his/her margin account * NOT lender of the shares issues instructions to close out the position [!WARNING]- What should a trader do when the one-year forward price of an asset is too low? Assume 0 income generating. -> Sell/short the asset -> Invest the proceeds of the short sale at the risk-free rate -> enter into a long forward contract to buy the asset in one year Forward contracts are LESS liquid than futures contracts [!example] Keynes and Hicks? If hedgers hold long positions and speculators holds short positions, the futures price will tend to be higher than expected future spot prices (or vice versa - see notes) [!example]- Contango The futures price is above the expected future spot price -> In other words, the futures price is trading at a premium to the expected future spot price. This condition is often associated with the normal upward-sloping shape of the futures curve. Potential causes: * Cost of carry : Contango can result from the cost of carry, which includes expenses such as storage costs, insurance, and financing charges. These costs are reflected in the futures price. * Supply and demand dynamics : If there is excess supply or low demand for the commodity in the near term, the futures prices for future delivery may be higher than the expected spot price.* [!NOTE]- [x] The spot price of an investment asset is $30 and the risk-free rate for all maturities is 10% with continuous compounding. The asset provides an income of $2 at the end of the first year and at the end of the second year. What is the three-year forward price? 35.84 [!NOTE]- [x] The spot price of an investment asset that provides no income is $30 and the risk-free rate for all maturities (with continuous compounding) is 10%. What is the three-year forward price? 40.50 [!example]- Explain what happens when an investor shorts a certain share. * The investor\u2019s broker borrows the shares from another client\u2019s account and sells them in the usual way. * To close out the position, the investor must purchase the shares. * The broker then replaces them in the account of the client from whom they were borrowed. * The party with the short position must remit to the broker dividends and other income paid on the shares. * The broker transfers these funds to the account of the client from whom the shares were borrowed. * Occasionally the broker runs out of places from which to borrow the shares. * The investor is then short squeezed and has to close out the position immediately. [!example]- What is the difference between the forward price and the value of a forward contract? The forward price of an asset today is the price at which you would agree to buy or sell the asset at a future time. The value of a forward contract is zero 0 you first enter into it. * As time passes the underlying asset price changes and the value of the contract maybecome positive or negative. [!NOTE]- [x] Suppose that you enter into a six-month forward contract on a non-dividend-paying stock when the stock price is $30 and the risk-free interest rate (with continuous compounding) is 12% per annum. What is the forward price? ![[Pasted image 20240202203106.png]] [!NOTE]- [x] A stock index currently stands at 350. The risk-free interest rate is 8% per annum (with continuous compounding) and the dividend yield on the index is 4% per annum. What should the futures price for a four-month contract be? ![[Pasted image 20240202203141.png]] [!example]- Explain carefully why the futures price of gold can be calculated from its spot price and other observable variables whereas the futures price of copper cannot. Gold is an investment asset . * If the futures price is too high, investors will find it profitable to increase their holdings of gold and short futures contracts. * If the futures price is too low, they will find it profitable to decrease their holdings of gold and go long in the futures market. Copper is a consumption asset . * If the futures price is too high, a strategy of buy copper and short futures works. * However, because investors do not in general hold the asset, the strategy of sell copper and buy futures is not available to them. There is therefore an upper bound, but no lower bound, to the futures price . [!example]- Which of the following is true for a consumption commodity? For consumption commodity, there is an upper limit to the futures price but no lower limit , except that the futures price cannot be negative. [!example]- Explain carefully the meaning of the terms convenience yield and cost of carry. What is the relationship between futures price, spot price, convenience yield, and cost of carry? Convenience yield measures the extent to which there are benefits obtained from ownership of the physical asset that are not obtained by owners of long futures contracts. The cost of carry is the interest cost plus storage cost less the income earned. The futures price, F0,and spot price, S0, are related by ![[Pasted image 20240202203439.png]] [!example]- Explain why a foreign currency can be treated as an asset providing a known yield. A foreign currency provides a known interest rate , but the interest is received in the foreign currency . The value in the domestic currency of the income provided by the foreign currency is therefore known as a % of the value of the foreign currency . => The income has the properties of a known yield. [!example]- Is the futures price of a stock index greater than or less than the expected future value of the index? The futures price of a stock index is always < expected future value of the index . * Index has positive systematic risk. * Argument 2: let u be the expected return required by investors on the index so that ![[Pasted image 20240202203740.png]] Since (u > r) and ![[Pasted image 20240202203813.png]] It follows that ![[Pasted image 20240202203832.png]] [!danger]+ [x] A one-year long forward contract on a non-dividend-paying stock is entered into when the stock price is $40 and the risk-free rate of interest is 10% per annum with continuous compounding. (a) What are the forward price and the initial value of the forward contract? (b) Six months later, the price of the stock is $45 and the risk-free interest rate is still 10%. What are the forward price and the value of the forward contract? S = 40, r = 10%, no income a) F and Initial value - Initial value of forward contract = 0 - Forward price F = 40 . e ^(10% . 1) = $ 44.21 ==Left 1st row== b) S(6) = 45, r = 10% - Delivery price K = forward price above = 44.21 - S is now 45 - Forward price F = 45 . e ^(10% . 0.5) = 47.31 ==Left 1st row== - Value of f contract = 45 - 44.21 . e ^(-10% . 0.5) = 2.95 ==Right 1st row== INITIAL VALUE OF CONTRACT = 0! AFTER SOME TIME, THE FORWARD PRICE CALCULATED AT THE BEGINNING BECOMES K - THE DELIVERY PRICE. [!NOTE]- [x] r = 0.07, dividend = 3.2% pa, current value of index = 150, T = 6 month. Futures price = ? CURRENT VALUE OF INDEX = S F = 150 . e ^ (0.07 - 0.032)0.5 = 152.88 ==left 3rd row== [!warning]- [x] r = 0.09, dividend varies throughout the yr: 2, 5, 8, 11 -> 0.05 pa; other 8 months -> 0.02 pa. Value of index on July 31 = 1300 (S); futures price of contract deliverable on Dec 31? a) Find avg yield August (0.05) -> Sep -> Oct -> Nov (0.05) -> Dec (0.05 x 2 + 0.02 x 3) / 5 = 0.032 b) Futures price F = 1300 . e^(0.09 - 0.032).5/12 = 1331.80 ==left 3rd row== [!NOTE]- r = 0.1, dividend = 0.04, index = 400, futures price 4 months = 405. Arbitrage opportunity? S.e^(0.1 - 0.04).4/12 = 408.08 ==left 3rd row== The above is the THEORETICAL FUTURES PRICE. But actual F price = 405 -> F < Sert (index futures price is too low relative to index) Arbitrage strategy Time 0: 1. short/sell underlying the index (receive the current spot price of the index (+S - higher) 2. take a long position (buy) in futures contracts lock in the futures price (-F - lower) Time 1: Deliver -> since F < Sert, you can use the stocks obtained from the short position to cover the futures contract, making a profit. ![[Pasted image 20240114041907.png]] [!NOTE]- [x] Estimate the difference between short-term interest rates in Japan and the United States on August 4, 2009 from the information (the table is in the US so we don't need US, just Japan) 1. Look at settlement prices: Japan 1.0502 in Sep -> 1.0512 in Dec -> 0.09522 % increased over 3 months => indicates that short-term futures prices are increasing at a rate of about 0.09522% per 3 months => Short term interest in Japan > US by (0.09522% / 3*12) = 0.38% per year Short term interest rate differentials If settlement price of country A INCREASED over time -> short term futures prices are INCREASING over time -> Country A interest rates IS LOWER THAN country B (US - home country) ![[Pasted image 20240127003145.png]] [!warning]- [x] 2 months = T, interest rates Switz = 0.02, interest rates US = 0.05, spot price of Switz franc = $0.8, futures contract price, deliverable in 2 months = $0.81. Arbitrage opportunity? 1. Theoretical futures price Se... = 0.8 . e^(0.05 - 0.02).2/12 = 0.8040 Compare with actual futures price of 0.81 -> actual is too high (F > S) Arbitrage opportunity: Sell at F aka short/sell Swiss francs futures (lock in profit at F - higher) Buy Swiss francs at spot S (lower) At delivery, must deliver Swiss francs - you are getting a profit of F (higher) [!warning]- [x] Current price of silver S = 15 per ounce, storage cost = 0.24 / ounce pa payable quarterly in advance, interest rates = 10% pa, find futures price, T = 9 months 1. Find U (storage cost) 0.24 pa, payable quarterly -> 0.06 per quarter Payable in advance quarterly -> * pay 1 now * 1 in 3 months * 1 in 6 months if delivery in 9 months We have to discount each to the present. * 0.06 (present) * 0.06 discount by 3 months - continuous compounding so / by (e^rt = e^10%.3/12) * 0.06 discount by 6 months - continuous compounding so / by (e^rt = e^10%.6/12) PV of storage costs U = 0.06 + 0.06 . e^-(10% . 3/12) + 0.06 . e^-(10% . 6/12) = 0.176 2. Find F F = (S + U) . e^(rT) = (15 + 0.176) . e^(10% . 9/12) = 16.36 [!example]- When a known future cash outflow in a foreign currency is hedged by a company using a forward contract, there is no foreign exchange risk. When it is hedged using futures contracts, the daily settlement process does leave the company exposed to some risk. Explain the nature of this risk. In particular, consider whether the company is better off using a futures contract or a forward contract when: (a) The value of the foreign currency falls rapidly during the life of the contract. (b) The value of the foreign currency rises rapidly during the life of the contract. (c) The value of the foreign currency first rises and then falls back to its initial value. (d) The value of the foreign currency first falls and then rises back to its initial value. Assume that the forward price equals the futures price. a) In total the gain or loss under a futures contract is equal to the gain or loss under the corresponding forward contract. However the timing of the cash flows is different . * When the time value of money is taken into account a futures contract may prove to be > valuable or < valuable than a forward contract. * Ofc company does not know in advance which will work out better. * The long forward contract provides a perfect hedge . * The long futures contract provides a slightly imperfect hedge . b) all effects = slightly * (a) forward > - company will lose on hedge. If forward -> the loss will be realised at the end. If future -> loss will realise day by day. * (b) futures > - company will gain. If forward -> gain realised at the end. If future -> gain realised day by day. On PV basis, latter = preferable. * (c) futures > - positive CF early, negative CF later * (d) forward > cos if futures, negative CF early, later CF positive [!warning] Futures = formal, realise day by day; forwards = realise at the end [!example]- The forward exchange rate = unbiased predictor of the future exchange rate when ??? The exchange rate has no systematic risk . To have no systematic risk the exchange rate must be uncorrelated with the return on the market. [!example]- What is meant by (a) an investment asset and (b) a consumption asset. Why is the distinction between investment and consumption assets important in the determination of forward and futures prices? An investment asset is an asset held for investment by a significant number of people or companies. * The forward/futures price can be determined from the spot price for an investment asset. A consumption asset is an asset that is nearly always held to be consumed (either directly or in some sort of manufacturing process). * All that can be determined is an upper bound for the forward/futures price. [!example] What is the cost of carry for (a) a non-dividend-paying stock, (b) a stock index, (c) a commodity with storage costs, and (d) a foreign currency? a) the rfr b) the excess of the rfr over the dividend yield c) the rfr plus the storage cost d) the excess of the domestic risk-free rate over the foreign rfr [!example]- (1) Explain carefully what is meant by the expected price of a commodity on a particular future date. (2) Suppose that the futures price of crude oil declines with the maturity of the contract at the rate of 2% per year. Assume that speculators tend to be short crude oil futures and hedgers tended to be long crude oil futures. What does the Keynes and Hicks argument imply about the expected future price of oil? (1) The expected future price refers to the anticipated price of a commodity on a specific future date (2) Keynes and Hicks argue that speculators on average make money from commodity futures trading and hedgers on average lose money from commodity futures trading . * If speculators tend to have short positions in crude oil futures, the Keynes and Hicks argument implies that futures prices overstate expected future spot prices. * If crude oil futures prices decline at 2% per year the Keynes and Hicks argument therefore implies an even faster decline for the expected price of crude oil if speculators are short.","title":"Chapter 5. Valuation of futures and forwards"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-9-option","text":"[!example] A corporate treasurer is designing a hedging program involving foreign currency options. What are the pros and cons of using (a) the NASDAQ OMX and (b) the over-the-counter market for trading? The NASDAQ OMX offers options with standard strike prices and times to maturity. Options in the over-the-counter market have the advantage that they can be tailored to meet the precise needs of the treasurer. Their disadvantage is that they expose the treasurer to some credit risk. Exchanges organize their trading so that there is virtually no credit risk. [!example] Explain why the market maker\u2019s bid-offer spread represents a real cost to options investors. A \u201cfair\u201d price for the option can reasonably be assumed to be half way between the bid and the offer price quoted by a market maker. An investor typically buys at the market maker\u2019s offer and sells at the market maker\u2019s bid. Each time he or she does this there is a hidden cost equal to half the bid-offer spread. [!example] \u201cIf a company does not do better than its competitors but the stock market goes up, executives do very well from their stock options. This makes no sense\u201d Discuss this viewpoint. Can you think of alternatives to the usual executive stock option plan that take the viewpoint into account. Executive stock option plans account for a high percentage of the total remuneration received by executives. When the market is rising fast (as it was for much of the 1990s) many corporate executives do very well out of their stock option plans \u2014 even when their company does worse than its competitors. Large institutional investors have argued that executive stock options should be structured so that the payoff depends how the company has performed relative to an appropriate industry index. In a regular executive stock option the strike price is the stock price at the time the option is issued. In the type of relative performance stock option favored by institutional investors, the strike price at time t is S I I \uf02f where 0 S is the company\u2019s stock price at the time the option is issued, 0 I is the value of an equity index for the industry in which the company operates at the time the option is issued, and t I is the value of the index at time t . If the company\u2019s performance equals the performance of the industry, the options are always at-the-money. If the company outperforms the industry, the options become in the money. If the company underperforms the industry, the options become out of the money. Note that a relative performance stock option can provide a payoff when both the market and the company\u2019s stock price decline. Relative performance stock options clearly provide a better way of rewarding senior management for superior performance. Some companies have argued that, if they introduce relative performance options when their competitors do not, they will lose some of their top management talent. [!warning] 9.11 | Describe the terminal value of the following portfolio: a newly entered-into long forward contract on an asset and a long position in a European put option on the asset with the same maturity as the forward contract and a strike price that is equal to the forward price of the asset at the time the portfolio is set up. Show that the European put option has the same value as a European call option with the same strike price and maturity. The terminal value of the long forward contract is: ST - F0 * T = price of asset at maturity * F0 = forward price of asset at time portfolio is set up * F0 = delivery price in the forward contract Terminal value of put option: max(F0 - ST 0) Terminal value of portfolio: ST - F0 + max(F0 - ST, 0) = max(0, ST - F0] ![[Pasted image 20240425001345.png]] We have shown that the forward contract plus the put is worth the same as a call with the same strike price and time to maturity as the put. The forward contract is worth zero at the time the portfolio is set up. It follows that the put is worth the same as the call at the time the portfolio is set up. [!danger] Option contracts ![[Pasted image 20240425002017.png]] [!example] 9.18 - \u201cIf most of the call options on a stock are in the money, it is likely that the stock price has risen rapidly in the last few months.\u201d Discuss this statement. The exchange has certain rules governing when trading in a new option is initiated. These mean that the option is close-to-the-money when it is first traded. If all call options are in the money it is therefore likely that the stock price has risen since trading in the option began. [!example] What is the effect of an unexpected cash dividend on (a) a call option price and (b) a put option price? An unexpected cash dividend would reduce the stock price on the ex-dividend date. This stock price reduction would not be anticipated by option holders. As a result there would be a reduction in the value of a call option and an increase the value of a put option. (Note that the terms of an option are adjusted for cash dividends only in exceptional circumstances.)","title":"Chapter 9. Option"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-10-valuation-of-options","text":"[!NOTE]- [X] T = 4 months, call, 0 dividend, stock price S = 28, strike K = 25, rfr = 8% pa. 28 - 25 . e^(-8% . 4/12) = 3.66 [!NOTE]- [x] What is a lower bound for the price of a one-month European put option on a non dividend-paying stock when the stock price is $12, the strike price is $15, and the risk free interest rate is 6% per annum? 2.93 [!example]- Explain why an American call option on a dividend-paying stock is always worth at least as much as its intrinsic value. Is the same true of a European call option? The intrinsic value of an American call option on a dividend-paying stock is always equal to or greater than its European counterpart due to the option's exercise flexibility. An American call option can be exercised at any time, allowing the holder to capture dividends immediately. Therefore, its value is at least the intrinsic value. In contrast, a European call option, exercisable only at expiration, may miss out on capturing dividends before maturity. For instance, if a stock is anticipated to pay a substantial dividend during the option's life, the European option's value might be less than its intrinsic value before the dividend is distributed. Thus, the flexibility to exercise early grants the American call option an inherent advantage in capturing dividend-related gains, ensuring its minimum value aligns with its intrinsic value [!NOTE]- [x] The price of a non-dividend paying stock is $19 and the price of a three-month European call option on the stock with a strike price of $20 is $1. The risk-free rate is 4% per annum. What is the price of a three-month European put option with a strike price of $20? From put-call parity: put price p = call price c + strike K . e^(-rT) - stock price S0 = 1 + 20e^(-0.04 x 0.25) - 19 = 1.80 [!NOTE]- [x] Call price c = 3, K = 30, put price p = 1, rfr = 10%, T = 3/12, share price S = 31. Arbitrage ??? From put-call parity: * LHS (portfolio of call & bond) = c + Ke-rt = 3 + 30.e^(-0.1*3/12) = 32.26 * RHS (portfolio of put & share) = p + S0 = 1 + 31 = 32 => LHS is overpriced relative to RHS Arbitrage strategy: buy RHS (put & share), sell LHS (call & bond) 1. Sell call 2. Buy both put & share/stock [!example] Explain why the arguments leading to put\u2013call parity for European options cannot be used to give a similar result for American options. Short answer: the LHS doesnt necessarily = RHS ![[Pasted image 20240216183322.png]] In the absence of early exercise, the put-call parity for European options rests on the premise that portfolios of equivalent values at expiration should also share this equality at earlier times. However, when early exercise is a possibility, the argument loses its validity. Consider the case where P > S - CKe^(-rT). Despite this condition, no arbitrage opportunity emerges. If one buys the call, shorts the put, and shorts the stock, the uncertainty of when the put will be exercised introduces ambiguity in the outcome. The flexibility of early exercise in American options diverges from the straightforward application of European put-call parity. [!NOTE]- [x] What is a lower bound for the price of a six-month call option on a non-dividend-paying stock when the stock price is $80, the strike price is $75, and the risk-free interest rate is 10% per annum? 8.66 [!NOTE]- [x] What is a lower bound for the price of a two-month European put option on a non dividend-paying stock when the stock price is $58, the strike price is $65, and the risk free interest rate is 5% per annum? 6.46 [!warning] In exercises just describe the arbitrage opportunity & mention borrowed / invested & thats it. no need to update what happens to those amount at T1. They are not counted in profit calc. Convert all to PV for profits. [!NOTE]- [x] A one-month European put option on a non-dividend-paying stock is currently selling for 2.5 . The stock price is $47, the strike price is $50, and the risk-free interest rate is 6% per annum. What opportunities are there for an arbitrageur? (hint: no call mentioned -> no trading calls at all) PV of strike price * 50 . e(-0.06 x 1/12) = 49.75 ![[Pasted image 20240216164152.png]] ![[Pasted image 20240216164119.png]] If the above are violated -> arbitrage: Since P </= Ke-rt - S0 ( 2.5 </= 49.75 - 47 ), the condition in the second equation above is violated -> aritrage opportunity. LHS (call & bond) = C + Ke(-rt) = C + 49.75 RHS (put & share) = P + S = 2.5 + 47 = 49.5 Strategy: buy LHS Time T0: * Buy a put (-2.5) * Buy a share (-47) * Borrow 47 + 2.5 = 49.5 at 6% for 1 month (+49.5) Time T1: * If spot > strike of 50: * put expires worthlessly * sell share for at least spot price of 50 (+ \u2265 50) * => PV of 50 -> 49.75 -> profit: at least 0.25 in PV terms (minus the amount borrowed at PV: 49.5) * If spot < strike of 50: * exercise put, sell share for strike of 50 (+ 50) * => PV of 50 -> 49.75 -> profit: 0.25 in PV terms (minus the amount borrowed at PV: 49.5) [!NOTE]- [x] Call option price C = 5 | Stock price S0 = 64 | Strike K = 60 | Dividend = 0.8 expected in 1 month| T = 1/3 | rfr = 0.12 1. Proving that arbitrage opportunity exists ![[Pasted image 20240216164152.png]] ![[Pasted image 20240216181106.png]] 5 >/= 64 - 0.8 e ^(-0.12*1/3) - 60.e^(-0.12*1/3) 5 >/= 5.58 => FALSE -> arbitrage 2. Decide what to short/buy (don't have to show this) put call parity LHS = call + bond = 5 put call parity RHS = put + share = 0 + 64 -> RHS is overpriced -> sell RHS, buy LHS Arbitrageur should sell the share (no put) & buy the call option 3. Profit (convert all to PV) Short sell share: +64 Buy call option to buy at 60: -5 Invest above for 4 months: -59 * If spot < strike of 60: * call expires worthlessly * dividend that must pay: -0.79 (PV) * deliver the share/close out short position: -57.65 or less (PV of 60 or less cos you lose the spot amount at T0) * => gain: +64 (short share) - 0.79 (dividend pay out) - 57.65 (close short position) = 5.56 (in PV terms) * => profit: 5.56 - 5 (cost of call) = 0.56 (at least) * If spot > strike of 60: * exercise call, buy share at strike: -60 * dividend: -0.79 * close out short position: +57.65 (PV of 60) * => gain: 64 - 0.79 - 57.65 = 5.56 * => profit: 5.56 - 5 = 0.56 (exact) [!NOTE]- [x] Euro call, T = 6/12, strike K = 30, call premium C = 2, stock price S = 29. dividend = 0.5 in 2 months & 5 months, rfr = 0.1 Part 1. What is P? (T, strike = same) ![[Pasted image 20240216183651.png]] p = ![[Pasted image 20240216183715.png]] Part 2. Arbitrage if put price P = 3 LHS = call + bond = 2 + 0.5 (convert to PV) + 30 (convert to PV) = 28.54 RHS = put + share = 3 + 29 = 32 => sell RHS (put & share), buy call Arbitrage: Time 1: * short share, gain 29 * short put, sell option to sell, gain 3 * buy call, buy option to buy, lose 2 * invest 30 above at rfr for 6/12 year Time 0: * if spot S > K: * exercise call, buy share at strike: lose 30 -> -28.54 PV * close out the short position on the share * must pay out dividend: -0.97 PV * put holder will let put expires worthlessly * profit: 30 - 28.54 - 0.97 = 0.49 * if spot S < K: * holder will exercise put, i must buy share at strike: lose 30 -> -28.54 PV * call expires worthlessly * deliver share, close out short position * dividend: -0.97 PV * profit: 30 - 28.54 - 0.97 = 0.49 [!NOTE]- US call | no dividend | call premium C = 4 | stock S = 31 | strike = 30 | T = 3/12 | rfr = 0.08. Part 1. Derive upper & lower bounds for US put, same strike K, same T. Part 2. Explain carefully the arbitrage opportunities in Problem 10.16 if the American put price is greater than the calculated upper bound. Part 1 ![[Pasted image 20240216185509.png]] 31 - 30 <= 4 - P <= 31 - 30e^(-0.08x3/12) 1 <= 4 - P <= 1.59 2.41 <= P <= 3 => Upper bound: 2.14 => Lower bound: 3 Part 2 Put is over priced -> RHS overpriced -> sell put & (short) share, buy call 1. Amount realised / CF: * Sell put: +3 * Sell share: +29 * Buy call: - 2 * => CF: 30 at least, which can be reinvested at the rfr 2. At some stage, either the put / call will be exercised 3. At future time CF will be -30 4. Since +30 at T0, -30 at T1, CF PV will be positive -> profit [!example]- Consider a five-year call option on a non-dividend-paying stock granted to employees. The option can be exercised at any time after the end of the first year. Unlike a regular exchange-traded call option, the employee stock option cannot be sold. What is the likely impact of this restriction on the early exercise? An employee stock option may be exercised early because the employee needs cash or because he or she is uncertain about the company\u2019s future prospects. * Regular call options can be sold in the market in either of these two situations, but employee stock options cannot be sold . * In theory an employee can short the company\u2019s stock as an alternative to exercising. * In practice this is not usually encouraged and may even be illegal for senior managers.","title":"Chapter 10. Valuation of options"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-12-binomial-tree-pricing","text":"[!example]- 12.8 | Consider the situation in which stock price movements during the life of a European option are governed by a two-step binomial tree. Explain why it is not possible to set up a position in the stock and the option that remains riskless for the whole of the life of the option. The riskless portfolio consists of a short position in the option and a long position in \u0394 shares. Because \u0394 changes during the life of the option, this riskless portfolio must also change. [!NOTE]- 12.9 | A stock price is currently $50. It is known that at the end of two months it will be either $53 or $48. The risk-free interest rate is 10% per annum with continuous compounding. What is the value of a two-month European call option with a strike price of $49? Use no-arbitrage arguments. ![[Pasted image 20240329000932.png]] LONG WAY 50 -> 53 or 48 => option will be 4 (53 - strike 49) or 0 (48 - strike 49). Consider portfolio of: long/buy \u0394 shares & short/sell 1 call option * If price goes to 53, value of portfolio is 53\u0394 - 4 * If price goes to 48, value is 48\u0394 - 0 Equating the two scenarios, solve for \u0394: \u0394 = 0.8 Thus value of portfolio is certain to be 48 . 0.8 = 38.4. For this value of \u0394 the portfolios is therefore riskless . Current value of portfolio: \u0394 (number of shares) . 50 (current stock price) - f (value of option) Since it earns interest (continuous compounding) over time period to get to 38.4: (\u0394 . 50 - f).e^(0.10 * 2/12) = 38.4 Solving for f: f = 2.23 SHORT WAY ![[Pasted image 20240304012806.png]] ![[Pasted image 20240304012856.png]] S (50) moves down to Sd (48), aka d = 0.96 S (50) moves up to Su (53), aka u = 1.06 p nume = e^(0.10 * 2/12) - 0.96 p deno = 1.06 - 0.96 p = 0.5681 f = e^(-0.10 * 2/12) x p x value of option = 2.23 [!NOTE]- 12.10 | A stock price is currently $80. It is known that at the end of four months it will be either $75 or $85. The risk-free interest rate is 5% per annum with continuous compounding. What is the value of a four-month European put option with a strike price of $80? Use no-arbitrage arguments. S = 80 -> 75 or 85 ![[Pasted image 20240329001626.png]] [!NOTE]- 12.12 | A stock price is currently $50. Over each of the next two three-month periods it is expected to go up by 6% or down by 5%. The risk-free interest rate is 5% per annum with continuous compounding. What is the value of a six-month European call option with a strike price of $51? ![[Pasted image 20240304175358.png]] ![[Pasted image 20240304175406.png]] For the situation considered in Problem 12.12, what is the value of a six-month European put option with a strike price of $51? Verify that the European call and European put prices satisfy put\u2013call parity. If the put option were American, would it ever be optimal to exercise it early at any of the nodes on the tree? a) Value of the option ![[Pasted image 20240304175703.png]] b) Verifying the put call parity * Value of call + PV of cash (strike price) (RHS) 1.635 + 51.e^(-5% . 6/12) = 51.376 * Value put + share (LHS) 1.376 (final f) + 50 (current share price) = 51.376 c) Test whether it is worth exercising the option early: Payoff of option from immediate exercise at step 1: Down: strike 51 - share price 47.5 = 3.5 -> should exercise early Up: 51 - 53 = -2 -> should'nt exercise early [!NOTE]- 12.13 | For the situation considered in Problem 12.12, what is the value of a six-month European put option with a strike price of $51? Verify that the European call and European put prices satisfy put\u2013call parity. If the put option were American, would it ever be optimal to exercise it early at any of the nodes on the tree? [!warning]- 12.14 | A stock price is currently $25. It is known that at the end of two months it will be either $23 or $27. The risk-free interest rate is 10% per annum with continuous compounding. Suppose ST is the stock price at the end of two months. What is the value of a derivative that pays off ST^2 at this time? Current share price = 25 Time = 2/12 Future price: up = 27, down = 23 rfr = 10% LONG WAY 1. No call or put -> assume +\u0394 shares, -1 derivative/option 2. Pays of ST2 means option's worth is 23^2 = 529 or 27^2 = 729 3. Value of portfolio Either 27\u0394 - 729 Or 23\u0394 - 529 Solving for \u0394 = 50 4. PV value of portfolio: 50 * 25 - f 5. Portfolio must earn rfr interest (50 * 25 - f)e^(10% * 2/12) = 27*50 - 729 Solving for f = 639.26 SHORT WAY p = (e^rt - d) / (u - d) f = e^(-rt) . [p . value of deri if up + (1-p) . value of deri if down] = e^(-0.1 * 2/12)(0.6050 x 729 + 0.3950 x 529) = 639.3 [!note]- [x] 12.20 | Consider a European call option on a non-dividend-paying stock where the stock price is $40, the strike price is $40, the risk-free rate is 4% per annum, the volatility is 30% per annum, and the time to maturity is six months. a. Calculate u, d, and p for a two step tree b. Value the option using a two step tree. c. Verify that DerivaGem gives the same answer d. Use DerivaGem to value the option with 5, 50, 100, and 500 time steps. ![[Pasted image 20240330143859.png]] ![[Pasted image 20240330143913.png]] ![[Pasted image 20240330143827.png]]","title":"Chapter 12. Binomial tree pricing"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-13-black-scholes-merton-pricing-model","text":"[!NOTE]- 13.8. A stock price is currently $40. Assume that the expected return from the stock is 15% and its volatility is 25%. What is the probability distribution for the rate of return (with continuous compounding) earned over a one-year period? mu = 0.15, sigma = 0.25 prob distribution * expected value of return = 0.15 - 0.25^2 / 2 = 0.11875 p.a * SD = 0.25 p.a [!NOTE]- 13.9. A stock price has an expected return of 16% and a volatility of 35%. The current price is $38. | (a) What is the probability that a European call option on the stock with an exercise price of $40 and a maturity date in six months will be exercised? | (b) What is the probability that a European put option on the stock with the same exercise price and maturity will be exercised? a) Find N(d2) = 04969 / 0.4968 b) [!example]- What does the Black\u2013Scholes\u2013Merton stock option pricing model assume about the probability distribution of the stock price in one year? What does it assume about the probability distribution of the continuously compounded rate of return on the stock during the year? * The Black\u2013Scholes\u2013Merton option pricing model assumes that the probability distribution of the stock price in one year (or at any other future time) is lognormal . * Equivalently, it assumes that the continuously compounded rate of return on the stock is normally distributed. [!NOTE]- The volatility of a stock price is 30% per annum. What is the standard deviation of the percentage price change in one trading day? * \u03c3 = 30% = volatility * Assuming 252 trading days per year, \u0394t = 1/252 * Prob dist of RATE OF RETURN = \u03c3\u221a\u0394t = 30% . \u221a1/252 = 1.9% [!example]- Explain how risk-neutral valuation could be used to derive the Black\u2013Scholes\u2013Merton formulas. Assuming that the expected return from the stock is the risk-free rate, we calculate the expected payoff from a call option. We then discount this payoff from the end of the life of the option to the beginning at the risk-free interest rate. [!NOTE]- Calculate the price of a three-month European put option on a non-dividend-paying stock with a strike price of $50 when the current stock price is $50, the risk-free interest rate is 10% per annum, and the volatility is 30% per annum. p = 2.38 [!example] What is Black\u2019s approximation for valuing an American call option on a dividend paying stock? In Black\u2019s approximation, we calculate the price of a European call option expiring at the same time as the American call option and the price of a European call option expiring just before the final ex-dividend date. We set the American call option price equal to the greater of the two. [!example]- 13.10. Prove that, with the notation in the chapter, a 95% confidence interval for ST is between ... ![[Pasted image 20240306213029.png]] [!example]- A portfolio manager announces that the average of the returns realized in each of the last 10 years is 20% per annum. In what respect is this statement misleading? This problem relates to the material in Section 13.2. The statement is misleading in that a certain sum of money, say $1000, when invested for 10 years in the fund would have realized a return (with annual compounding) of less than 20% per annum. The average of the returns realized in each year is always greater than the return per annum (with annual compounding) realized over 10 years . The first is an arithmetic average of the returns in each year; the second is a geometric average of these returns. [!danger]- Assume that a non-dividend-paying stock has an expected return of mu and a volatility of sigma. An innovative financial institution has just announced that it will trade a derivative that pays off a dollar amount equal to ![[Pasted image 20240306213611.png]] at time T. The variables 0 S and T S denote the values of the stock price at time zero and time T. a) Describe the payoff from this derivative. b) Use risk-neutral valuation to calculate the price of the derivative at time zero. a) The derivative will pay off a dollar amount equal to the continuously compounded return on the security between times 0 and T. b) The expected value of ln (ST / S0) is, from equation (13.4), (mu - SD^2 / 2)T. The expected payoff from the derivative is therefore mu - SD^2/2. In a risk-neutral world this becomes r - SD^2 / 2. The value of the derivative at time zero is therefore: ![[Pasted image 20240306214430.png]] [!NOTE]- What is the price of a European call option on a non-dividend-paying stock when the stock price is $52, the strike price is $50, the risk-free interest rate is 12% per annum, the volatility is 30% per annum, and the time to maturity is three months? S = 52, K = 50, r = 12%, sigma = 30%, T = 3/12 ANS: 5.06 [!NOTE]- 13.14 | What is the price of a European put option on a non-dividend-paying stock when the stock price is $69, the strike price is $70, the risk-free interest rate is 5% per annum, the volatility is 35% per annum, and the time to maturity is six months? ![[Pasted image 20240328231309.png]] [!NOTE]- 13.15 | Call = 2.5, stock price = 15, price = 2.50, strike = 13, T = 3/12, rfr = 5%. Implied volatility? ![[Pasted image 20240328231939.png]] Goal seek -> 40% [!NOTE]- 13.16 | Show that the Black\u2013Scholes\u2013Merton formula for a call option gives a price that tends to max\u00f0S0 K; 0\u00de as T !0. ![[Pasted image 20240328232055.png]] [!NOTE]- 13.17 | Explain carefully why Black\u2019s approach to evaluating an American call option on a dividend-paying stock may give an approximate answer even when only one dividend is anticipated. Does the answer given by Black\u2019s approach understate or overstate the true option value? Explain your answer. Black\u2019s approach in effect assumes that the holder of option must decide at time zero whether it is a European option maturing at time n t (the final ex-dividend date) or a European option maturing at time T. In fact the holder of the option has more flexibility than this. The holder can choose to exercise at time n t if the stock price at that time is above some level but not otherwise. Furthermore, if the option is not exercised at time n t , it can still be exercised at time T. It appears that Black\u2019s approach should understate the true option value. This is because the holder of the option has more alternative strategies for deciding when to exercise the option than the two strategies implicitly assumed by the approach. These alternative strategies add value to the option. However, this is not the whole story. The standard approach to valuing either an American or a European option on a stock paying a single dividend applies the volatility to the stock price less the present value of the dividend. (The procedure for valuing an American option is explained in Chapter 18.) Black\u2019s approach when considering exercise just prior to the dividend date applies the volatility to the stock price itself. Black\u2019s approach therefore assumes more stock price variability than the standard approach in some of its calculations. In some circumstances it can give a higher price than the standard approach. [!NOTE]- [x] 13.18 | Consider an American call option on a stock. The stock price is $70, the time to maturity is eight months, the risk-free rate of interest is 10% per annum, the exercise price is $65, and the volatility is 32%. A dividend of $1 is expected after three months and again after six months. Use the results in the appendix to show that it can never be optimal to exercise the option on either of the two dividend dates. Use DerivaGem to calculate the price of the option. ![[Pasted image 20240328232754.png]] ![[Pasted image 20240328232818.png]] [!example]- 13.20 | Show that the Black\u2013Scholes\u2013Merton formulas for call and put options satisfy put\u2013call parity. ![[Pasted image 20240328233515.png]] [!example]- 13.21 | Show that the probability that a European call option will be exercised in a risk-neutral world is, with the notation introduced in this chapter, N\u00f0d2\u00de. What is an expression for the value of a derivative that pays off $100 if the price of a stock at time T is greater than K? ![[Pasted image 20240328233625.png]] ![[Pasted image 20240328233601.png]] ![[Pasted image 20240328233608.png]]","title":"Chapter 13. Black-Scholes-Merton pricing model"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-4-interest-rates-bond-yields","text":"[!example]- 4.1 | What is meant by LIBOR and LIBID. Which is higher? LIBOR is the London Interbank Offered Rate. It is the rate a bank quotes for deposits it is prepared to place with other banks. LIBID is the London Interbank Bid Rate. It is the rate a bank quotes for deposits from other banks. LIBOR is greater than LIBID. [!NOTE]- 4.3 | The six-month and one-year zero rates are both 10% per annum. For a bond that has a life of 18 months and pays a coupon of 8% per annum semiannually (with a coupon payment having just been made), the yield is 10.4% per annum. What is the bond\u2019s price? What is the 18-month zero rate? Face = 100. All rates are quoted with semiannual compounding. 0. Convert pa rate to semi: 5.2% 1. Current price (right after a coupon pmt): discount all pmt by semi yield 10.4% * 4 / 1.052 + 4 / 1.052^2 + 104 / 1.052^3 = 96.74 * Three payments cos 18 months, 1 pmt = 6 month / semiannual To find 18-month zero rate, let it be R. For the 6 month & 12 month rate -> replace yield with the zero rates (both 10% p.a. -> 5% semi). 4 / 6 month 0 rate + 4 / 12 month 0 rate + 104 / 18 month 0 rate or R NOTE THAT R IS CURRENTLY A PER ANNUM RATE! 4 / 1.05 + 4 / 1.05^2 + 4 / (1 + R/2)^3 = 96.74 Goal seek -> R = 10.42% [!NOTE]- 4.5 | Assuming that zero rates are as in Problem 4.5, what is the value of an FRA that enables the holder to earn 9.5% for a three-month period starting in one year on a principal of $1,000,000? The interest rate is expressed with quarterly compounding. [!example]- 4.7 | The term structure of interest rates is upward sloping. Put the following in order of magnitude: a. The five-year zero rate b. The yield on a five-year coupon-bearing bond c. The forward rate corresponding to the period between 4.75 and 5 years in the future Upward sloping term structure = normal yield curve -> long term interest rates > short term interest rates = usually healthy bc * expectations of econ expansion * expectations of rising inflation When the term structure is upward sloping, smallest = b -> a -> c b = yield, coupon bond = smallest A coupon-bearing bond pays periodic interest payments (coupons) to its holders. These coupon payments reduce the effective yield of the bond compared to its yield if it were a zero-coupon bond ( no coupon = higher yield than coupon ) In contrast, the forward rate (c) and the five-year zero rate (a) represent yields on zero-coupon bonds, which do not pay coupons. a = yield, no coupon bond = middle theoretical zero-coupon bond that matures in five years, meaning it pays no coupons and is redeemed at face value at maturity. < c - five-year zero rate cos current rate = typically lower than the forward rate because it represents the market expectation (upward slope) b cos b has coupon so lower yield c = forward rate = greatest The forward rate represents the market's expectation of the interest rate for a specific future period. In an upward-sloping yield curve, investors anticipate that interest rates will rise over time. Therefore, the forward rate, which represents a future rate, is expected to be higher than the current rates (both the five-year zero rate and the yield on a five-year coupon-bearing bond). What is the answer to this question when the term structure of interest rates is downward sloping? When it is downward sloping, c -> a -> b (smallest to largest) [!NOTE]- 4.8 | The cash prices of six-month and one-year Treasury bills are 94.0 and 89.0. A 1.5-year bond that will pay coupons of $4 every six months currently sells for $94.84. A two-year bond that will pay coupons of $5 every six months currently sells for $97.12. Calculate the six-month, one-year, 1.5-year, and two-year zero rates. ![[Pasted image 20240329063748.png]] ![[Pasted image 20240329062859.png]] [!NOTE]- 4.10 | A deposit account pays 12% per annum with continuous compounding, but interest is actually paid quarterly. How much interest will be paid each quarter on a $10,000 deposit? 1. Convert cont rate to equivalent quarterly rate 2. Cos rate is pa, find interest per annum (amount * rate) then divide by 4 ![[Pasted image 20240329064313.png]] [!NOTE]- 4.11 | Suppose that 6-month, 12-month, 18-month, 24-month, and 30-month zero rates con tinuously compounded are 4%, 4.2%, 4.4%, 4.6%, and 4.8% per annum, respectively. Estimate the cash price of a bond with a face value of 100 that will mature in 30 months pays a coupon of 4% per annum semiannually. ![[Pasted image 20240329065120.png]] ![[Pasted image 20240329065145.png]] [!NOTE]- 4.12 | A three-year bond provides a coupon of 8% semiannually and has a cash price of 104. What is the bond\u2019s yield? ![[Pasted image 20240329070140.png]] ![[Pasted image 20240329070202.png]] [!NOTE]- 4.13 | Suppose that the 6-month, 12-month, 18-month, and 24-month zero rates are 5%, 6%, 6.5%, and 7%, respectively. What is the two-year par yield? Par yield = the coupon rate p.a. of a bond with price / value = 100 ![[Pasted image 20240329070933.png]] 4.15 WHY? 4.10 VS 4.9 EQUATION?? ![[Pasted image 20240329071956.png]] [!warning] 4.16 | A 10-year 8% coupon bond currently sells for $90. A 10-year 4% coupon bond currently sells for $80. What is the 10-year zero rate? (Hint: Consider taking a long position in two of the 4% coupon bonds and a short position in one of the 8% coupon bonds.) Taking a long position in two of the 4% coupon bonds and a short position in one of the 8% coupon bonds leads to the following cash flows: * Year 0: 90 - 2*80 = -70 * Year 10: 200 - 100 = 100 because the coupons cancel out. $100 in 10 years time is equivalent to $70 today. The 10 year rate, R, (continuously compounded) is therefore given by ![[Pasted image 20240329072752.png]] [!example]- Explain carefully why liquidity preference theory is consistent with the observation that the term structure of interest rates tends to be upward sloping more often than it is downward sloping. If long-term rates were simply a reflection of expected future short-term rates, we would expect the term structure to be downward sloping as often as it is upward sloping. (This is based on the assumption that half of the time investors expect rates to increase and half of the time investors expect rates to decrease). Liquidity preference theory argues that long term rates are high relative to expected future short-term rates. This means that the term structure should be upward sloping more often than it is downward sloping. [!example]- \u2018\u2018When the zero curve is upward sloping, the zero rate for a particular maturity is greater than the par yield for that maturity. When the zero curve is downward sloping, the reverse is true.\u2019\u2019 Explain why this is so. The par yield is the yield on a coupon-bearing bond. The zero rate is the yield on a zero coupon bond. When the yield curve is upward sloping, the yield on an N-year coupon bearing bond is less than the yield on an N-year zero-coupon bond. This is because the coupons are discounted at a lower rate than the N-year rate and drag the yield down below this rate. Similarly, when the yield curve is downward sloping, the yield on an N-year coupon bearing bond is higher than the yield on an N-year zero-coupon bond. [!example]- Why are U.S. Treasury rates significantly lower than other rates that are close to risk free? There are 3 reasons 1. Treasury bills and Treasury bonds must be purchased by financial institutions to fulfill a variety of regulatory requirements. This increases demand for these Treasury instruments driving the price up and the yield down. 2. The amount of capital a bank is required to hold to support an investment in Treasury bills and bonds is substantially smaller than the capital required to support a similar investment in other very-low-risk instruments. 3. In the United States, Treasury instruments are given a favorable tax treatment compared with most other fixed-income investments because they are not taxed at the state level. [!example]- Why does a loan in the repo market involve very little credit risk? / Explain how a repo agreement works and why it involves very little risk for the lender. A repo is a contract where an investment dealer who owns securities agrees to sell them to another company now and buy them back later at a slightly higher price. The other company is providing a loan to the investment dealer. This loan involves very little credit risk. If the borrower does not honor the agreement, the lending company simply keeps the securities. If the lending company does not keep to its side of the agreement, the original owner of the securities keeps the cash. [!example]- Explain why an FRA is equivalent to the exchange of a floating rate of interest for a fixed rate of interest? A FRA is an agreement that a certain specified interest rate, RK , will apply to a certain principal, L , for a certain specified future time period. Suppose that the rate observed in the market for the future time period at the beginning of the time period proves to be M R . If the FRA is an agreement that K R will apply when the principal is invested, the holder of the FRA can borrow the principal at M R and then invest it at K R . The net cash flow at the end of the period is then an inflow of K RL and an outflow of M K R L. If the FRA is an agreement that R will apply when the principal is borrowed, the holder of the FRA can invest the borrowed principal at M R . The net cash flow at the end of the period is then an inflow of M outflow of K R L and an RL. In either case we see that the FRA involves the exchange of a fixed rate of interest on the principal of L for a floating rate of interest on the principal. ![[Pasted image 20240329072440.png]] [!NOTE]- \u201cAn interest rate swap where six-month LIBOR is exchanged for a fixed rate 5% on a principal of $100 million is a portfolio of FRAs.\u201d Explain. Each exchange of payments is an FRA where interest at 5% is exchanged for interest at LIBOR on a principal of $100 million. Interest rate swaps are discussed further in Chapter 7.","title":"Chapter 4. Interest rates, bond yields"},{"location":"Financial%20engineering/Derivatives%20exercises/#chapter-3-hedging-basis-risk","text":"[!example]- Give three reasons why the treasurer of a company might not hedge the company\u2019s exposure to a particular risk. 1. If the company\u2019s competitors are not hedging, the treasurer might feel that the company will experience less risk if it does not hedge 2. The shareholders might not want the company to hedge. 3. If there is a loss on the hedge and a gain from the company\u2019s exposure to the underlying asset, the treasurer might feel that he or she will have difficulty justifying the hedging to other executives within the organization. [!NOTE]- [x] Suppose that the standard deviation of quarterly changes in the prices of a commodity is $0.65, the standard deviation of quarterly changes in a futures price on the commodity is $0.81, and the coefficient of correlation between the two changes is 0.8. What is the optimal hedge ratio for a three-month contract? What does it mean? ![[Pasted image 20240329121347.png]] [!NOTE]- [x] A company has a $20 million portfolio with a beta of 1.2. It would like to use futures contracts on the S&P 500 to hedge its risk. The index futures price is currently 1080, and each contract is for delivery of $250 times the index. What is the hedge that minimizes risk? What should the company do if it wants to reduce the beta of the portfolio to 0.6? ![[Pasted image 20240329122405.png]] ![[Pasted image 20240329121716.png]] [!NOTE]- In the Chicago Board of Trade\u2019s corn futures contract, the following delivery months are available: March, May, July, September, and December. State the contract that should be used for hedging when the expiration of the hedge is in (a) June, (b) July, and (c) January. a) july b) sep [!example]- Does a perfect hedge always succeed in locking in the current spot price of an asset for a future transaction? Explain your answer. No. Consider, for example, the use of a forward contract to hedge a known cash inflow in a foreign currency. The forward contract locks in the forward exchange rate \u2014 which is in general different from the spot exchange rate. [!example]- Explain why a short hedger\u2019s position improves when the basis strengthens unexpectedly and worsens when the basis weakens unexpectedly. The basis is the amount by which the spot price exceeds the futures price. A short hedger is long the asset and short futures contracts. The value of his or her position therefore improves as the basis increases. Similarly it worsens as the basis decreases. [!example]- Imagine you are the treasurer of a Japanese company exporting electronic equipment to the United States. Discuss how you would design a foreign exchange hedging strategy and the arguments you would use to sell the strategy to your fellow executives. The simple answer to this question is that the treasurer should Estimate the company\u2019s future cash flows in Japanese yen and U.S. dollars Enter into forward and futures contracts to lock in the exchange rate for the U.S. dollar cash flows. However, this is not the whole story. As the gold jewelry example in Table 3.1 shows, the company should examine whether the magnitudes of the foreign cash flows depend on the exchange rate. For example, will the company be able to raise the price of its product in U.S. dollars if the yen appreciates? If the company can do so, its foreign exchange exposure may be quite low. The key estimates required are those showing the overall effect on the company\u2019s profitability of changes in the exchange rate at various times in the future. Once these estimates have been produced the company can choose between using futures and options to hedge its risk. The results of the analysis should be presented carefully to other executives. It should be explained that a hedge does not ensure that profits will be higher. It means that profit will be more certain. * When futures/forwards are used both the downside and upside are eliminated. * With options a premium is paid to eliminate only the downside. [!example]- \"If the minimum-variance hedge ratio is calculated as 1.0, the hedge must be perfect.\" Is this statement true? Explain your answer. Minimum variance hedge ratio is the ratio of the average change in S for a particular change in F, while a perfect hedge is defined as when the correlation coefficient (\u03c1) between the spot and futures prices is 1. Their relationship can be expressed by this equation: A h* value of 1.0 (minimum-variance hedge ratio) alone doesn\u2019t guarantee a \u03c1 value of 1, since it is also dependent on \u03c3S and \u03c3F. For example, a \u03c1 value of 0.1 and a \u03c3S/\u03c3F value of 10 also constitutes a minimum-variance hedge ratio, yet it does not mean the spot is perfectly correlated with the future prices. Hence the statement is not true. [!example]- \u2018\u2018If there is no basis risk, the minimum variance hedge ratio is always 1.0.\u2019\u2019 Is this statement true? Explain your answer. The statement is true. Using the notation in the text, if the hedge ratio is 1.0, the hedger locks in a price of F1 + b2. Since both 1 F and 2 b are known this has a variance of zero and must be the best hedge. [!example]- \u201cFor an asset where futures prices are usually less than spot prices, long hedges are likely to be particularly attractive.\" Explain this statement. A company that knows it will purchase a commodity in the future is able to lock in a price close to the futures price. This is likely to be particularly attractive when the futures price is less than the spot price. [!NOTE]- [x] 3.16 | The standard deviation of monthly changes in the spot price of live cattle is (in cents per pound) 1.2. The standard deviation of monthly changes in the futures price of live cattle for the closest contract is 1.4. The correlation between the futures price changes and the spot price changes is 0.7. It is now October 15. A beef producer is committed to purchasing 200,000 pounds of live cattle on November 15. The producer wants to use the December live cattle futures contracts to hedge its risk. Each contract is for the delivery of 40,000 pounds of cattle. What strategy should the beef producer follow? ![[Pasted image 20240425171453.png]] The beef producer requires a long position in 200000x0.6=120 000 lbs of cattle. The beef producer should therefore take a long position in 3 December contracts closing out the position on November 15. [!NOTE]- [x] On July 1, an investor holds 50,000 shares of a certain stock. The market price is $30 per share. The investor is interested in hedging against movements in the market over the next month and decides to use the September Mini S&P 500 futures contract. The index is currently 1,500 and one contract is for delivery of $50 times the index. The beta of the stock is 1.3. What strategy should the investor follow? Under what circumstances will it be profitable? ![[Pasted image 20240329124120.png]] Equity hedging = bouta sell -> short position . 26 contracts is required. It will be profitable if the stock outperforms the market in the sense that its return is greater than that predicted by the capital asset pricing model. [!example]- A futures contract is used for hedging. Explain why the daily settlement of the contract can give rise to cash flow problems. Suppose that you enter into a short futures contract to hedge the sale of a asset in six months. If the price of the asset rises sharply during the six months, the futures price will also rise and you may get margin calls. The margin calls will lead to cash outflows. Eventually the cash outflows will be offset by the extra amount you get when you sell the asset, but there is a mismatch in the timing of the cash outflows and inflows. Your cash outflows occur earlier than your cash inflows. A similar situation could arise if you used a long position in a futures contract to hedge the purchase of an asset and the asset\u2019s price fell sharply. An extreme example of what we are talking about here is provided by Metallgesellschaft [!example] A corn farmer argues \u201cI do not use futures contracts for hedging. My real risk is not the price of corn. It is that my whole crop gets wiped out by the weather.\u201dDiscuss this viewpoint. Should the farmer estimate his or her expected production of corn and hedge to try to lock in a price for expected production? If weather creates a significant uncertainty about the volume of corn that will be harvested, the farmer should not enter into short forward contracts to hedge the price risk on his or her expected production. The reason is as follows. Suppose that the weather is bad and the farmer\u2019s production is lower than expected. Other farmers are likely to have been affected similarly. Corn production overall will be low and as a consequence the price of corn will be relatively high. The farmer\u2019s problems arising from the bad harvest will be made worse by losses on the short futures position. This problem emphasizes the importance of looking at the big picture when hedging. The farmer is correct to question whether hedging price risk while ignoring other risks is a good strategy. [!warning] 3.22 | A company wishes to hedge its exposure to a new fuel whose price changes have a 0.6 correlation with gasoline futures price changes. The company will lose $1 million for each 1 cent increase in the price per gallon of the new fuel over the next three months. The new fuel's price change has a standard deviation that is 50% greater than price changes in gasoline futures prices. If gasoline futures are used to hedge the exposure what should the hedge ratio be? What is the company's exposure measured in gallons of the new fuel? What position measured in gallons should the company take in gasoline futures? How many gasoline futures contracts should be traded? The new fuel's price change has a standard deviation that is 50% greater than price changes in gasoline futures prices => fraction in RHS is 1.5, thus h is 0.6 * 1.5 = 0.9 If should therefore take a position of 90 million gallons in gasoline futures. Each futures contract is on 42,000 gallons. The number of contracts required is therefore 90 mil / 42mil (size per contract) = 2142.9 (2143) [!warning] ![[Pasted image 20240425175413.png]] ![[Pasted image 20240425175432.png]]","title":"Chapter 3. Hedging &amp; basis risk"},{"location":"Financial%20engineering/Derivatives%20notes/","text":"Derivatives notes Chapter 1. Basics Basic derivatives Futures and forward contracts are agreements to buy or sell an asset at a certain time in the future for a certain price. Futures contracts are traded on an exchange Forward contracts are traded in the over-the-counter market. Options trade both on exchanges and in the over-the-counter market. 2 types: 1. A call option gives the holder the right to buy an asset by a certain date for a certain price. 2. A put option gives the holder the right to sell an asset by a certain date for a certain price. [!quote]+ Example - option price chart Suppose that a March call option on a stock with a strike price of $50 costs $2.50 and is held until March. Under what circumstances will the holder of the option make a gain? Under what circumstances will the option be exercised? Draw a diagram showing how the profit on a long position in the option depends on the stock price at the maturity of the option. * Call = ability to BUY * If high price, ill buy at low predet price. So spot increases (->) -> boom at 50 PLUS premium -> perk up profits * Low price -> no exercise -> straight line lose at x = -2.5 ![[Pasted image 20240114031854.png]] Suppose that a June put option on a stock with a strike price of $60 costs $4 and is held until June. Under what circumstances will the holder of the option make a gain? Under what circumstances will the option be exercised? * Put = ability to sell -> good if prices go down * At spot = 60 (-4 premium since holder) = 56 -> exercise -> profits perk up * Spot rate higher than that (<-) = profits = negative at 4, not exercised options * Chart for the holder: ![[Pasted image 20240113012227.png]] * Chart for the seller: ![[Pasted image 20240113012159.png]] Long vs. short positions A trader who enters into a long futures position is agreeing to BUY the underlying asset for a certain price at a certain time in the future. A trader who enters into a short futures position is agreeing to SELL the underlying asset for a certain price at a certain time in the future. OTC vs exchange traded The over-the-counter market is a telephone- and computer-linked network of financial institutions, fund managers, and corporate treasurers where 2 participants can enter into any mutually acceptable contract. * When a market maker quotes a bid and an offer, the bid is the price at which the market maker is prepared to BUY and the offer is the price at which the market maker is prepared to SELL . An exchange-traded market is a market organized by an exchange where traders either meet physically or communicate electronically and the contracts that can be traded have been defined by the exchange. Participants in the markets Three main types of participants in the markets: hedgers, speculators, and arbitrageurs. Hedging = when it has an exposure to the price of an asset and takes a position in futures or options markets to offset the exposure. Speculation = the company has no exposure to offset. It is betting on the future movements in the price of the asset. Arbitrage involves taking a position in two or more different markets to lock in a profit. Hedgers are in the position of facing risk associated with the price of an asset. * They use futures, forward, or option contracts to reduce or eliminate this risk. Speculators wish to bet on future movements in the price of an asset. * Futures, forward, and option contracts can give them extra leverage; that is, the contracts can increase both the potential gains and potential losses in a speculative investment. Arbitrageurs are in business to take advantage of a discrepancy between prices in two different markets. * If, for example, they see the futures price of an asset getting out of line with the spot price, they will take offsetting positions in the two markets to lock in a profit. Chapter 2. Future and forward markets Opening & closing futures positions A very high proportion of the futures contracts that are traded do not lead to the delivery of the underlying asset . This is because traders usually enter into offsetting contracts to close out their positions before the delivery period is reached . However, it is the possibility of final delivery that drives the determination of the futures price. Closing a position = enter into an OPPOSITE trade to the original one that opened the position Contract specifications The most important aspects of the design of a new futures contract are the specification of the underlying asset the size of the contract the delivery arrangements the delivery months The specification of contracts is an important activity for a futures exchange. The two sides to any contract must know what can be delivered where delivery can take place when delivery can take place details on the trading hours how prices will be quoted maximum daily price movements Some contracts, such as those on stock indices, are settled in cash rather than by delivery of the underlying asset. New contracts must be approved by the Commodity Futures Trading Commission before trading starts. Convergence of future & spot prices; arbitrage opportunities As we approach the delivery period -> futures price coverge to spot price. Otherwise -> arbitrage opportunity ![[Pasted image 20240118155416.png]] ==If future P > spot P== Sell (SHORT) futures contract promising to sell the asset at HIGH Buy the asset at LOW Deliver the asset to the futures contract buyer, earning HIGH -> Since future inflow from selling > spot outflow from buying -> profit -> As traders exploit this arbitrage opportunity, the futures price will fall. ==If future < spot P== Buy a future promising to buy the asset at LOW Wait until delivery Buy the asset at LOW, cheaper than buying asset now at HIGH -> Prices would consequently rise If the futures price < spot price during the delivery period, there is no similar perfect arbitrage strategy. An arbitrageur can take a long futures position but cannot force immediate delivery of the asset. The decision on when delivery will be made is made by the party with the short position. Nevertheless companies interested in acquiring the asset will find it attractive to enter into a long futures contract and wait for delivery to be made. Operation of margin accounts Layer 1. Client & broker Daily settlement / marking to market * the broker will require the investor to deposit funds in a margin account - must be deposited at the time the contract is entered into is known as the initial margin . * at the end of each trading day, the margin account is adjusted to reflect the investor\u2019s gain or loss. [!NOTE] Example: calculation Suppose, for example, that by the end of June 5 the futures price has dropped from $1,650 to $1,641. * The investor has a loss of $1,800 (= 200 $9), because the 200 ounces of December gold, which the investor contracted to buy at $1,650, can now be sold for only $1,641. * The balance in the margin account would therefore be reduced by $1,800 to $10,200. * Similarly, if the price of December gold rose to $1,659 by the end of June 5, the balance in the margin account would be increased by $1,800 to $13,800. * A trade is first settled at the close of the day on which it takes place. It is then settled at the close of trading on each subsequent day. Layer 2. broker vs clearing house When there is a decrease in the futures price so that the margin account of an investor with a long position is reduced by $1,800, the investor\u2019s broker has to pay the exchange clearing house $1,800 and this money is passed on to the broker of an investor with a short position. Maintenance margin The investor is entitled to withdraw any balance in the margin account in excess of the initial margin. To ensure that the balance in the margin account never becomes negative, a maintenance margin , which is somewhat lower than the initial margin, is set. Variation margin If the balance in the margin account falls < the maintenance margin, the investor receives a margin call and is expected to top up the margin account to the initial margin level the next day . * The extra funds deposited are known as a variation margin . * If the investor does not provide the variation margin, the broker closes out the position. In the case considered above, closing out the position would involve neutralising the existing contract by selling 200 ounces of gold for delivery in December. Extra info * Most brokers pay investors interest on the balance in a margin account, making the balance not represent a true cost if the interest rate is competitive. * Investors can deposit securities, treasury bills (at 90% face value), or shares (at 50% market value) to satisfy initial margin requirements, with subsequent margin calls requiring cash. * Unlike forward contracts, futures contracts are settled daily. Daily gains or losses are added to or subtracted from the margin account balance. * Minimum margin levels = set by the exchange clearing house, with individual brokers having the discretion to require more margin. * Minimum levels depend on the variability of the underlying asset's price, and maintenance margin is typically about 75% of the initial margin. * Margin requirements variation: Depend on the trader's objectives, with bona fide hedgers often having lower margin requirements than speculators due to perceived lower risk of default. Clearing house & clearin margin Clearing house = intermediary in futures transactions, guaranteeing performance and having members who contribute to a default fund. * Brokers, if not members, must channel their business through a clearing house member. * Clearing house tracks daily transactions to calculate the net position of each member. * Brokers maintain margin with a clearing house member, who, in turn, maintains a clearing margin account with the clearing house. Clearing margin account : Adjusted for gains and losses daily, with an original margin but no maintenance margin . * Balance must be maintained at the original margin multiplied by the number of outstanding contracts. * Clearing margin calculation: the exchange clearing house calculates the clearing margin based on the number of contracts outstanding, using either a gross basis (sum of long and short positions) or a net basis (offsetting long and short positions). Most exchanges currently use net margining. OTC market OTC market = where companies agree to derivatives transactions without involving an exchange. Collateral - Credit risk is inherent in OTC derivatives, and defaults can result in losses for the party with a positive net value. - Collateral agreements between companies, such as A and B, are used to mitigate credit risk. - Collateral arrangements may be one-way or two-way, involving the posting of cash or marketable securities with daily valuation. - Two-way agreements may require posting variation margin based on daily changes in transaction values. Clearing houses * Prior to the 2007 credit crisis, most OTC trades operated through bilateral agreements with collateral but had higher credit risk than exchange-traded markets. * Regulators, post-2007 crisis, sought to reduce systemic risk by making OTC markets more like exchange-traded markets. * Legislation mandates the use of central clearing parties (CCPs) for standard OTC transactions to reduce credit risk. * CCPs act as intermediaries , becoming the counterparty to both sides of an OTC transaction and managing credit risk through initial and daily variation margin requirements. * CCPs are similar to exchange clearing houses. * Once it has been agreed between two parties A and B, a standard OTC derivative transaction is presented to a CCP. * Assuming the CCP accepts the transaction, it becomes the counterparty to both A and B. (This is similar to the way the clearing house for a futures exchange becomes the counterparty to the two sides of a futures trade). * For example, if the transaction is a forward contract where A has agreed to buy an asset from B in one year for a certain price, the clearing house agrees to 1. Buy the asset from B in one year for the agreed price, and 2. Sell the asset to A in one year for the agreed price. => It takes on the credit risk of both A and B. It manages this risk by requiring an initial margin and a daily variation margin from each of them. A move from bilateral agreements -> centralised clearing through a CCP ![[Pasted image 20240120141926.png]] Market quotes Table 2.2. Futures Quotes for CME Group Contracts on Commodities - July 13, 2012 Gold, 100 oz, $ per oz Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 1571.2 1596.5 1565.6 1565.3 1589.7 +24.4 115,296 Sept. 2012 1570.4 1597.5 1567.1 1566.4 1590.2 +23.8 303 Oct. 2012 1574.0 1598.3 1570.0 1567.6 1593.6 +26.0 726 Dec. 2012 1576.5 1601.0 1570.7 1570.0 1596.0 +26.0 11,283 June 2013 1598.0 1604.6 1598.0 1576.1 1604.6 +28.5 250 Crude Oil, 1,000 barrels, $ per barrel Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 85.86 87.61 85.58 86.08 87.28 +1.20 223,698 Sept. 2012 86.33 88.00 85.95 86.46 87.68 +1.22 87,931 Dec. 2012 87.45 89.21 87.39 87.73 88.94 +1.21 31,701 Dec. 2013 88.85 90.15 88.78 88.92 89.95 +1.03 11,128 Dec. 2014 87.20 87.74 87.20 86.98 87.74 +0.76 2,388 Corn, 5,000 bushels, cents per bushel Open High Low Prior Settlement Last Trade Change Volume Sept. 2012 730.00 748.00 726.50 731.25 742.25 +11.00 78,317 Dec. 2012 731.25 749.00 727.25 732.25 742.25 +10.00 179,010 Mar. 2013 733.00 748.25 729.00 734.50 743.50 +9.00 22,588 May 2013 731.00 744.25 726.75 732.75 739.75 +7.00 4,548 July 2013 728.00 739.00 721.00 728.75 733.50 +4.75 7,874 Dec. 2013 618.75 626.50 613.75 618.25 626.00 +7.75 4,260 Soybeans, 5,000 bushels, cents per bushel Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 1572.00 1600.00 1571.50 1572.50 1596.00 +23.50 19,194 Sept. 2012 1544.50 1574.00 1544.50 1545.50 1570.00 +24.50 7,024 Nov. 2012 1528.00 1561.50 1526.50 1529.00 1552.75 +23.75 98,526 Jan. 2013 1527.75 1557.25 1523.75 1526.00 1548.00 +22.00 11,621 Mar. 2013 1486.25 1508.00 1482.25 1481.25 1500.25 +19.00 6,226 May 2013 1432.25 1453.25 1428.00 1430.25 1449.00 +18.75 5,234 Wheat, 5,000 bushels, cents per bushel Open High Low Prior Settlement Last Trade Change Volume Sept. 2012 845.75 865.75 842.00 846.75 846.25 \u00b10.50 41,301 Dec. 2012 859.00 877.75 856.00 859.75 861.50 +1.75 29,450 Mar. 2013 868.00 885.75 865.00 869.00 870.00 +2.00 6,972 May 2013 865.00 881.00 863.00 864.50 867.00 +2.50 2,339 July 2013 824.50 840.00 824.25 826.75 832.50 +5.75 4,118 Live Cattle, 40,000 lbs, cents per lb Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 116.900 117.600 116.300 117.025 117.225 +0.200 23,117 Oct. 2012 121.450 121.650 120.525 121.650 121.600 \u00b10.050 18,427 Dec. 2012 124.900 125.000 124.050 124.975 124.950 \u00b10.025 6,561 Feb. 2013 128.500 128.500 127.525 128.550 128.500 \u00b10.050 2,450 Apr. 2013 131.225 131.400 130.300 131.375 131.250 \u00b10.125 1,615 Prices - Prices are presented as the opening, highest, and lowest prices for the day * The opening price is representative of the prices at which contracts were trading immediately after the start of trading on July 13, 2012. Gold, 100 oz, $ per oz Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 1571.2 1596.5 1565.6 1565.3 1589.7 +24.4 115,296 Sept. 2012 1570.4 1597.5 1567.1 1566.4 1590.2 +23.8 303 For the August 2012 gold contract, the opening price on July 13, 2012 was $1,571.2 per ounce. The highest price during the day was $1,596.5 per ounce and The lowest price during the day was $1,565.6 per ounce. Settlement prices settlement price is the price used for calculating daily gains and losses and margin requirements. = the price at which the contract traded immediately before the end of a day\u2019s trading session = aka close Gold, 100 oz, $ per oz Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 1571.2 1596.5 1565.6 1565.3 1589.7 +24.4 115,296 $1,565.3 = settlement price the previous day (i.e., July 12, 2012). 1,589.7 = most recent trading price (closing today) +24.4 = price change from the previous day\u2019s settlement price. [!NOTE] Calculating the amount gained For a trader with a long position, the positive price change of 1565.3 -> 1589.7 = 24.4 is a gain (bc buy -> price increases -> profit cos bought at cheaper price). Times 100 oz cos that was the price per oz -> earn 2440 today Similarly, the margin account of a trader with a short (sell) position would lose this amount 2,440 on July 13. Trading volume and open interest Open interest = total number of outstanding contracts (long = short positions) Trading volume = number of contracts traded in a day - If there is a large amount of trading by day traders (i.e., traders who enter into a position and close it out on the same day) the volume of trading in a day can be greater than either the beginning-of-day or end-of-day open interest. Usually 1 party opens, 1 party closes at the same time -> open interest remains at 0. But if both the long and short parties are closing out existing positions -> the resultant change in the open interest is -1 Patterns of futures Normal market = futures prices tend to increase as the maturity of the contracts extends into the future. * This means that contracts with later expiration dates have higher prices compared to those with earlier expiration dates. * For example, if you observe a series of futures prices for different months, and as you move from near-term to far-term contracts, the prices generally go up, it indicates a normal market. - Gold and live cattle futures prices follow an increasing function of maturity , known as a normal market ; as you move from August 2012 to June 2013 in the contracts, the prices generally increase. Inverted market = Futures prices tend to decrease as the maturity of the contracts extends into the future. * This means that contracts with later expiration dates have lower prices compared to those with earlier expiration dates. * For example, if you observe a series of futures prices for different months, and as you move from near-term to far-term contracts, the prices generally go down, it indicates an inverted market. - Soybean futures prices exhibit a decreasing function of maturity, termed an inverted market . Some commodities, like crude oil, corn, and wheat, may show mixed patterns, combining elements of both normal and inverted markets on a specific date (e.g., July 13, 2012). Pricing Currency In futures markets prices are quoted as the number of U.S. dollars per unit of foreign currency for the British pound euro Australian dollar New Zealand dollar For other major currencies, spot and forward rates are quoted as the number of units of foreign currency per U.S. dollar . Price limits and position limits Limit down = in a day the price moves down from the last day's close by an amonut = daily price limit Limit up = move up by the limit Usually ceases trading Goal of daily price limits: prevent too much volatility due to speculative excesses Position limit = max # of contracts a speculator may hold -> prevent speculators from exercising undue influence Delivery Most futures contracts don't result in the physical delivery of the underlying asset; they are typically closed out early. The potential for delivery, however, DOES influences futures prices . Delivery period: = Defined by the exchange and varies across contracts. - Investor A, holding the short position, decides when to deliver. - Investor A's broker issues a notice of intention to deliver to the exchange clearing house, specifying the number of contracts, delivery location, and grade (for commodities). Selection of delivery party - The exchange selects a long position holder to accept delivery. - Not necessarily the original counterparty (e.g. investor B); positions may have been closed out through multiple trades. - The notice is usually passed to the party with the oldest outstanding long position . Delivery process: - For commodities, taking delivery often involves accepting a warehouse receipt and immediate payment. - Costs associated with livestock care in livestock futures. - Financial futures are usually settled by wire transfer. - Price paid is typically the most recent settlement price, adjusted for grade and location if specified by the exchange. - The entire delivery process takes around two to three days. Critical Days: - First Notice Day: The first day for submitting a notice of intention to make delivery. - Last Notice Day: The last day for submitting such a notice. - Last Trading Day: Usually a few days before the last notice day. - Investors with long positions aim to close out contracts before the first notice day to avoid the risk of delivery. Cash Settlement: - Some financial futures, like stock index futures, are settled in cash due to the impracticality of delivering the underlying asset (e.g., a portfolio of 500 stocks for S&P 500 futures). - All outstanding contracts are closed on a predetermined day. - Final settlement price is set equal to the spot price of the underlying asset at the open or close of trading on that day. Types of trader & order Traders Commission merchant = trades on behalf of a client & charges a commission vs. Local trades on their own behalf Inidividual traders: hedgers speculators scalpers - very short terms, e.g. a few minutes day traders - less than 1 trading day position traders - longer arbitrageurs Orders Market order = carry out trade immediately at best price available Limit order = specifies a specific price -> only execute at this or higher (if selling) or lower (if buying) to prevent loss/maximise profit Stop order = stop-loss order = slightly less favourable than market conditions - once limit is reached -> market order straight away e.g. market is currently 35, stop order at 30 -> once it decreases if it hits 30 sell straight away goal: close out a position if unfavourable price movements take place -> limit the possible amount of loss Stop-limit order = order becomes a limit order as soon as a bid/offer is made at a price =/< favourable than stop price [!quote] Example: stop-limit order * market is currently 25 * stop-order to buy = stop of 40, limit at 41 * the moment theres a bid/offer at 40 -> limit order (buy immediately as long as it's not above 41) [!quote] Example: a stop-limit order to sell at 20.30 with a limit of 20.10: = as soon as there is a bid at 20.30 the contract should be sold providing this can be done at 20.10 or a higher price. A market-if-touched order is executed at the best available price after a trade occurs at a specified price or at a price more favorable than the specified price. * In effect, an MIT becomes a market order once the specified price has been hit. * An MIT is also known as a board order . ==Comparing market if touched and stop order== Consider an investor who has a long position in a futures contract and is issuing instructions that would lead to closing out the contract. A stop order is designed to place a limit on the loss that can occur in the event of unfavorable price movements. By contrast, a market-if-touched order is designed to ensure that profits are taken if sufficiently favorable price movements occur. ==Examples== Stop order to sell at $2 = used by investors - order to sell at the best available price once a price of $2 or less is reached -> used to limit losses/protect gains from an existing long position if the market price falls to $2 or below, a market order to sell will be triggered Limit order to sell at $2 = order to sell at a price of $2 or more -> used to instruct a broker that a short position should be taken, providing it can be done at a price more favorable than $2 * you are instructing your broker to sell your asset at a price of $2 or more, but not at a lower price * used by traders who want to ensure that they only sell at a certain price or better Forwards vs futures attribute forward futures private arrangement private traded on exchanges standardisation not standardised standardised specified delivery date usually one specified date range of delivery dates settlement at the end of the contract settled daily delivery or final cash settlement usually takes place usually closed out prior to maturity credit risk some credit risk virtually no credit risk price quotes same as spot: - same as future for big currencies: AUD, NZ, euro, pound = x US / FOR - other currencies: x FOR / US number of U.S. dollars per unit of the foreign ( x US / FOR ) ==Example== Investor A takes a long/buy position in a 90-day forward contract on \u00a31 million. The forward price is 1.6000 dollars per pound. Investor B takes a long position in 90-day futures contracts on \u00a31 million. The futures price is also 1.6000 dollars per pound. At the end of the 90 days, the exchange rate proves to be 1.7000. The result of this is that investors A and B each make a total gain equal to (1.7 - 1.6)*1,000,000 = 100,000 Investor A\u2019s gain is made entirely on the 90th day. Investor B\u2019s gain is realised day by day over the 90-day period. On some days investor B may realize a loss, whereas on other days he or she will realise a gain. [!NOTE] FORWARDS = 1 LUMP SUM, FUTURES = MARKED TO MARKET DAILY Chapter 5. Determining forward and future prices 1. INVESTMENT vs CONSUMPTION assets Investment assets = held for investment by a significant number of investors Consumption assets = held primarily for consumption and not usually for investment purposes We CAN use arbitrage arguments to determine the forward and futures prices of an INVESTMENT asset from its spot price and other observable market variables. We CANNOT do this for CONSUMPTION assets. 2. Short selling Shorting is the act of selling an asset that the investor does not currently own. Aka. Selling borrowed assets with the hope of profitting from a decline in their price . 1. The investor instructs a broker to short a specific quantity of shares, for instance, 500 shares of company X. 2. The broker borrows the specified shares from an owner and sells them in the market . This action is executed in the same manner as a regular market sale. 3. At a later stage, the investor closes the short position by buying back the same quantity of shares in the market. These purchased shares replace the borrowed ones, thus closing the short position. The investor profits if the stock price declines and incurs a loss if it rises. If the broker has to return the borrowed shares and none are available, the investor must close the position, even if they aren't ready to do so. Lending fees may also be charged for shorting. An investor with a short position is obligated to pay the broker any income, such as dividends or interest, that would typically be received on the shorted securities. [!warning] Net gain from shorting * investor shorts 500 shares in April at $120 per share * closes the position in July at $100 per share * Net gain = * 500*120 = 60000 inflow in April - CF from selling * 500 inflow in May - dividends * 500*100 = 50000 outflow in July - CF from buying the shares back An investor is required to maintain a margin account with the broker This account, consisting of cash or marketable securities, serves as a guarantee that the investor won't abandon the short position if the share price increases. An initial margin is necessary, and additional margin may be required in the event of adverse price movements. The margin account, which earns interest , should NOT represent a cost to the investor, as it can be covered by the proceeds of the asset sale. 3. Assumptions No Transactions Costs: Market participants are assumed to face no transactions costs when engaging in trades. This simplifies our analysis and allows us to focus on the core principles of forward and futures contracts. Uniform Tax Rate: Participants are subject to the same tax rate on all net trading profits. This assumption streamlines our considerations, assuming a consistent tax environment across market participants. Equal Borrowing and Lending Rates: Participants can borrow and lend money at the same risk-free rate of interest. This simplifying assumption ensures a level playing field for market participants in terms of financing their trading activities. Arbitrage Opportunities: Participants actively take advantage of arbitrage opportunities as they arise in the market. This assumption reflects the proactive nature of key market participants, particularly large derivatives dealers, in exploiting profitable discrepancies. Notation - T: Time until delivery date in a forward or futures contract, measured in years. - S0: Current price of the asset underlying the forward or futures contract. - F0: Current forward or futures price. - r: Zero-coupon risk-free rate of interest per annum, expressed with continuous compounding, applicable to an investment maturing at the delivery date (T years in the future). * the rate at which money is borrowed or lent with certainty of repayment, excluding credit risk. * Traditionally, financial institutions have used LIBOR as a proxy for the risk-free rate. However, events during the credit crisis starting in 2007 prompted a search for alternative indicators. 4. FORWARD PRICE valuation (investment assets only) Case 1. No income generating assets Given: forward contract on INVESTMENT ASSET price = P0 no income time to contract delivery = T risk free rate = r forward price = F0 [!warning] Forward and spot price formula - NO INCOME F = S . e^(rT) Forward price = Spot price . e^(risk free rate . time to delivery of f/f contract) All units = in year ==Example== spot price = 40, rfr = 5% If F > Se(rt) -> arbitrageurs can buy the asset and short forward contracts TIME 0: arbitrageur borrows $40 at 5% interest -> buy 1 share -> shorts/sells a forward contract to sell that 1 share in 3 months TIME M: upon contract maturity -> arb delivers the share -> receives $43 -> use 40.5 to repay loan => PROFIT = 2.5 (in 43 out 40.5) If F < Se(rt) -> arbitrageurs can short the asset and enter into long forward contracts * TIME 0: abg shorts/sells 1 share -> gain proceed -> invest this proceed at 5% for 3 months -> takes a long position / buy a 3 month forward contract * TIME M: the proceed invested grows to 40.5 in 3 months -> contract matures, abg pays 39 for the share -> close position * => PROFIT = 1.5 (in 40.5 out 39) ![[Pasted image 20240125010759.png]] Under what circumstances do arbitrage opportunities such as those in Table 5.2 not exist? The first arbitrage works when the forward price is greater than $40.50 The second arbitrage works when the forward price is less than $40.50 => We deduce that, for there to be no arbitrage, the forward price must be exactly $40.50 The thing is, given the info in the example, F = 40 . e^(0.05 . 0.25) = 40.50 [!quote] 4-month forward contract to buy a zero-coupon bond that will mature 1 year from today. (This means that the bond will have 8 months to go when the forward contract matures!); current price = $930; 4-month risk-free rate of interest (continuously compounded) is 6% PA. Forward price = 930 . e^(6% . 4/12) = 948.79 Even if short sales are not universally possible for all investment assets, it doesn't impede the derivation of equation F = S... The ability to short the asset is not essential What matters is the presence of a significant number of investors holding the asset purely for investment. If the forward price is too low, they will find it attractive to sell the asset and take a long position/buy in a forward contract The adjustment of forward prices ensures the absence of arbitrage opportunities. Case 2. Income generating assets - known cash income [!warning] Forward and spot price formula - KNOWN INTEREST INCOME PAYMENTS F = (S - I) . e^(rT) Forward price = (Spot price - PV of income) . e^(risk free rate . time to delivery of f/f contract) All units = in year spot price current = 900 9 month maturity expected coupon payment of 40 after 4 months contnsly compounded rfr of 3% for 4 months, 4% for 9 months pa If F > (S - I) . e^(rT) -> arbitrageurs can buy the asset and short forward contracts - Action now: - Borrow $900 from 2 sources: $39.60 for 4 months and $860.40 for 9 months - Buy 1 unit of the asset and enter into a forward contract to sell it in 9 months for $910 - Action in 4 months: - Receive $40 of income on the asset - Use $40 to repay the first loan with interest - Action in 9 months: - Sell the asset for $910 - Use $886.60 to repay the second loan with interest - Close the short position - Profit: $23.40 If F < (S - I) . e^(rT) -> arbitrageurs can short the asset and enter into long forward contracts - Action now: - Short 1 unit of the asset to realize $900 - Invest $39.60 for 4 months and invest $860.40 for 9 months - Enter into a forward contract to buy the asset in 9 months for $870 - Action in 4 months: - Receive $40 from the 4-month investment - Pay income of $40 on the asset - Action in 9 months: - Receive $886.60 from the 9-month investment - Buy the asset for $870 - Close the short position - Profit: $16.60 [!quote] Forward price = [ 900 - 40.e^(-3% . 4/12) ] . e^(4% . 9/12) = 948.79 ![[Pasted image 20240125012726.png]] If the forward price is greater than $886.60, the arbitrageur can execute the first strategy (buying the bond, shorting a forward contract) and make a profit. If the forward price is less than $886.60, the arbitrageur can execute the second strategy (shorting the bond, entering into a long forward contract) and make a profit. => If there are no arbitrage opportunities, both strategies should not result in a profit. Therefore, the forward price must be precisely $886.60 to eliminate any possibility of arbitrage profits, ensuring equilibrium in the market. [!quote] Consider a 10-month forward contract on a $50 stock; assume a continuously compounded 8% risk-free interest rate for all maturities, and anticipate $0.75 dividends per share at three, six, and nine months. Find F. PV of income/dividend = I = $0.75 . e^(-8% . 3/12) + $0.75 . e^(-8% . 6/12) + $0.75 . e^(-8% . 9/12) = 2.162 Forward price = (50 - 2.162) . e^(8% . 10/12) = 51.14 => If the forward price were less than this, an arbitrageur would short the stock spot and buy forward contracts. => If the forward price were greater than this, an arbitrageur would short forward contracts and buy the stock in the spot market. Case 3. Income generating assets - known yield Known dividends yield = dividends per year as a percentage of the stock price at the time when dividends are paid are known We now consider the situation where the asset underlying a forward contract provides a known yield rather than a known cash income. This means that the income is known when expressed as a percent of the asset\u2019s price at the time the income is paid . [!warning] Forward and spot price formula - KNOWN YIELD F = S . e^[(r-q)T] Forward price = Spot price . e^[(rfr - avg yield pa) . time to delivery of f/f contract] All units = in year [!quote] S = 25, r = 10%, T = 6 months, yield = 4% pa WITH SEMIANNUAL COMPOUNDING - Calculate the yield, q = 0.0396 (from 4% per annum with semiannual compounding) - F = 25 e^[(10% - 0.0396) . 6/12] = $25.77 => If the forward price is less than this, arbitrageurs would short the stock spot and buy forward contracts. => If the forward price is greater than this, arbitrageurs would short forward contracts and buy the stock in the spot market. [!warning] Converting yield pa: semiannual/annual compounding -> continuous compounding Let n be the frequency of compounding per year CONTINUOUS RATE = n . ln(1 + GIVEN RATE / n) Yield is 4% pa semiannual compounding -> 0.04/2 = 0.02 -> 0.02 + 1 = 1.02 -> ln(1.02) = 0.01980 -> ln(1.02) x 2 = 0.0396 = 3.96% 5. FORWARD CONTRACTS valuation When a forward contract is initiated, its value is zero . Banks are required to value forward contracts in their trading books daily . [!warning] Value of LONG (BUY) forward contract today f f = (F - K) . e^(-r . T) * forward contract value = 0 initially * as time passes, both F and f change * K = delivery price [!warning] Value of SHORT (SELL) forward contract today f f = (K - F) . e^(-r . T) ==example== Long future contract (promise to BUY) on a 0 dividend stock. 6 months to maturity rfr = 10% pe, continuously compounding stock price is 25 (S0) delivery price 24 (K) Find value of forward contract price F = S . e^(rT) = 25 . e^(0.1 * 6/12) = 26.28 Value of forward contract = f = (26.28 - 24) . e^(-0.1 * 6/12) = 2.17 Summary: valuation of f/f prices & contracts ![[Pasted image 20240114041907.png]] 6. Forwards = futures prices ? In theory, when there's no uncertainty about future interest rates , the forward price for a contract with a certain delivery date = the futures price for a contract with that delivery date. However, in the real world where interest rates vary unpredictably, this theoretical equality breaks down. Relationship btwn asset price, interest rates and contract types 1. When the price (S) of the underlying asset is strongly positively correlated with interest rates: - Increase in S -> immediate gain for a long futures position. - Positive correlation likely -> simultaneous increase in interest rates. - The gain is invested at a higher-than-average interest rate. - Decrease in S -> immediate loss, but the financing is at a lower-than-average interest rate. - Investors with long forward contracts are not affected by these interest rate movements. - => Long futures contracts are slightly more attractive than similar long forward contracts. - => Hence, futures prices tend to be slightly > forward prices. When S is strongly negatively correlated with interest rates: Similar argument shows that forward prices will tend to be slightly > futures prices. Theoretical differences between forward and futures prices for short-term contracts are generally negligible . Practical factors, such as taxes, transaction costs, and margin account usage, can cause variations in forward and futures prices not accounted for in theoretical models. The risk of counterparty default may be lower in futures contracts due to the involvement of exchange clearinghouses. Futures contracts may be more liquid and easier to trade than forward contracts in certain cases. => Despite potential differences, it is generally reasonable to assume that forward and futures prices are the same for most practical purposes. 7. Stock indices: f/f contracts A stock index can usually be regarded as the price of an investment asset that pays dividends. The investment asset is the portfolio of stocks underlying the index, and the dividends paid by the investment asset are the dividends that would be received by the holder of this portfolio. It is usually assumed that the dividends provide a known yield rather than a known cash income. ==example== 3 month (0.23), dividend yield = 0.01 pa (so q = 0.01), current value of index = 1300, r = 0.05 -> Future price = 1300 * e^(0.05 - 0.01) * 0.25 = 1313.07 Index arbitrage - If F > Se^(r-q)T, buy spot stocks and short futures contracts. - If F < Se^(r-q)T, short/sell spot stocks and take a long position in futures contracts. 7. Currencies: f/f contracts Property of foreign currency = holder of the currency can earn interest at rfr prevailing in the FOREIGN country -> let the rfr in foreign country be rf (domestic = r) [!warning] Price of f/f contract involving foreign currencies F = S . e ^ (r - rf)T Also known as the interest rate parity relationship from International Finance Say I have 1000 units of foreign currency. I need it to domestic currency by time T. There r 2 strategies to convert that 1000 amount to my currency. ![[Pasted image 20240127001443.png]] Method 1 (invest 1000 foreign -> sell proceed in future to gain domestic) Invest in foreign currency for T years at the foreign risk-free rate (rf) -> enter a forward contract to SELL the proceeds for dollars at time T -> gain 1000.F.e^(rf * T) Method 2 (invest 1000 foreign -> sell proceed in future to gain domestic Exchange foreign currency for domestic in the spot market -> invest the proceeds for T years at the domestic rfr (r) -> gain 1000. S.e^(r * T) dollars => In the absence of arbitrage opportunities, the 2 methods should yield the exact same results ![[Pasted image 20240127003145.png]] Calculation [!warning] Calculate forward rate given xc rate & interest rates Forward rate = exchange rate . e ^ [(rfr local - rfr foreign)*time] [!quote] Example - forward rate An exchange rate is 0.7000 and the six-month domestic and foreign risk-free interest rates are 5% and 7% (both expressed with continuous compounding). What is the six-month forward rate? %%0.6930%% Essentially it's an investment asset with a known yield [!quote] 2 year interest rates: 5% AUS and 7% US, spot xc rate: 1 AUD = 0.62 US. -> 2-year forward exchange rate = 0.62 . e [(0.07 - 0.05) x 2] = 0.6453 Scenario 1: 2 year frwrd rate = 0.63 (aka 1 AUD = 0.62 instead of 0.64 US). Arbitrageur can: 1. T0: Borrow 1000 foreign (AUD) at 5% pa interest (AUS rate) for 2 years 2. T0: Convert that borrowed AUD to US at spot xc rate = have 620 USD 3. T0: Invest US 620 at 7% -> will grow to 620 . e^(7% . 2) = 713.17 USD 4. T0: Enter a forward contract to by 1105.17 AUD to pay back (calc in part 5 - 1105.17 AUD equals exactly 696.26 USD) 5. T1: Now paying back the 1000 AUD borrowed: amount after interest = 1000 * e^(0.05 * 2) = 1105.17. To pay this back we'll use the amount from the f contract 6. T1: Net gain = 713.17 USD - 696.26 USD = 16.9 USD Scenario 2: 2 year frwrd rate = 0.66 (aka 1 AUD = 0.66 instead of 0.64 US). Arbitrageur can: 1. T0: Borrow 1000 US at 7% pa (USD rate) for 2 years 2. T0: Convert to AUD using spot: 1000 / 0.62 = 1612.90 AUD 3. T0: Invest this AUD at AUD interest rate 5% pa for 2 years. Proceed from AUD investment will = 1782.53 AUD. 4. T0: Enter f/f contract to sell the investment proceed in AUD later for US. Know 4 sure we will receive 1782.53 * 0.66 = 1176.47 US 6. T1: Paying back the US borrowed: 1000 US has turned into 1000 . e(0.07 * 2) = 1150.27 US. We would need USD from the forward contract entered earlier. Proceed from f contract: 1176.47 7. Net gain: -1150.27 (debt) + 1176.47 (gain from f contract) = 26.20 Both strategies above -> RISKLESS PROFITS [!warning] Value of investment - continuous compounding Future amount = Principal . e^(pa interest rate * time in years) [!warning] Estimating interest rate differentials from table Look at one country & its 2 'Prior settlement price' at 2 different times. * e.g. Australia September vs December: 1.0075 -> 1.0000 * % change = 1/1.0075 = 0.744% LOWER => Short term futures prices are DECREASING at a rate of 0.744% / 3 months = 0.744 / 3 * 12 = 2.976% per year. => This is also the amount by which short term Aus interest rates > short term US interest rates ![[Pasted image 20240202003335.png]] Futures quotes table ![[Pasted image 20240127003549.png]] 8. Commodities: f/f contracts Gold owners, like central banks, charge an interest rate known as the gold lease rate when they lend out gold. Same goes for silver. So, holding onto gold and silver can actually bring in some income. Income and storage costs - Consumption assets may lack income but have significant storage costs. - Storage costs = similar to negative income [!warning] Forward price of investment commodity Without income & storage costs: F = S . e^(rT) With storage costs U (U = PV of all storage costs): F = (S + U) . e^(rT) If U = proportional to price of commodity -> treated as negative yield: F = S.e^[(r+u)T] * u = storage cost per annum = proportion of spot price net of any yield earnt [!quote] Arbitrage opportunity Scenario 1: F > (S + U).e^(rT) . Arbitrageur can: * borrow S + U at rfr -> use it to buy 1 unit of commodity & pay storage costs * short / sell a futures contract on that 1 unit of commodity => profit = F - (S+U).e^(rT) However, as arbitrageurs do so, there will be a tendency for S0 to increase and F0 to decrease until equation above is no longer true. We conclude that equation cannot hold for any significant length of time. [!quote] Arbitrage opportunity Scenario 2: F < (S + U).e^(rT) . Arbitrageur can: * sell commodity -> save storage costs -> invest proceeds at rfr * long/buy a futures contract => riskless profit = (S+U).e^(rT) - F Similarly, equation cannot hold for any significant length of time. This argument cannot be used for commodities that are not, to any significant extent, held for investment. Individuals and companies who keep such a commodity in inventory do so because of its consumption value, not because of its value as an investment. They are reluctant to sell the commodity in the spot market and buy futures or forward contracts, because futures and forward contracts cannot be used in a manufacturing process or consumed in some other way. Thus: ![[Pasted image 20240202012224.png]] [!warning] Calculating U - pv of storage costs U = storage costs per annum . e ^ (-rfr . T) [!quote] Gold futures price - f/f price of a commodity 1 year futures contract, no income, coss 2$ per ounce pa to store gold, pmt made at the end of the year. Spot S = 1600, rfr r = 5% pa. Thus T = 1 (1 year) 1. U = pv of all storage costs = discount cost at rfr U = $2 . e^(-5% x 1) = 1.9 2. Futures price - theoretical F = (1600 + 1.9) . e ^ (5% x 1) = 1684.03 Suppose the actual gold futures price (F) differs from the theoretical one above. Scenario 1. F actual > F theoretical, F = 1700 . Arbitrageur can: * Borrow 160k at rfr of 5% to buy 100 ounces of gold * Short/Sell 1 gold futures contract for delivery in 1 year * ensures that gold can be sold for 170k Convenience yield = the benefits or advantages an investor receives from holding a physical asset, like a commodity or stock, rather than a futures contract. It reflects market expectations on future commodity availability. * is always positive or 0 because it represents the non-monetary benefits of owning the physical asset, such as having access to the asset when it's needed. * For investment assets, convenience yield must be zero to avoid arbitrage opportunities. * Greater likelihood of shortages increases the convenience yield, while high inventories lead to a lower convenience yield. 9. Cost of carry The concept of cost of carry is sometimes useful. Cost of carry = the storage cost of the underlying asset plus the cost of financing it minus the income received from it. Investment assets: the futures price is greater than the spot price by an amount reflecting the cost of carry c. ![[Pasted image 20240202195730.png]] Consumption assets: the futures price is greater than the spot price by an amount reflecting the cost of carry net of the convenience yield c - y. ![[Pasted image 20240202195746.png]] [!NOTE] Relationships * As the convenience yield increases -> one-year futures price as a percentage of the spot price decreases * As inventories of a commodity decline -> one-year futures price as a percentage of the spot price decreases 10. Delivery options In contrast to forward contracts, futures contracts often provide flexibility in the delivery period for the party with the short position. The short position holder can choose to deliver at any time during a specified period, usually with a few days' notice. Determining futures prices becomes complicated due to the flexibility in delivery timing. The maturity of futures contracts raises the question of whether it should be assumed at the beginning, middle, or end of the delivery period. Understanding when delivery would have occurred is crucial for calculating theoretical futures prices. If the futures price increases with time to maturity, it is optimal for the short position holder to deliver early, as interest earned on the cash received outweighs holding the asset. In such cases, futures prices are typically calculated based on the assumption of delivery at the beginning of the delivery period. Conversely, if futures prices decrease as time to maturity increases, it is usually optimal for the short position holder to deliver as late as possible. In these circumstances, futures prices should generally be calculated assuming delivery at the end of the delivery period. 11. Futures price & expected spot prices expected spot price = market's average opinion on an asset's spot price at a future time - Futures prices converge to spot prices at maturity, prompting an analysis of the relationship between expected spot prices and futures prices. Keynes and Hicks' Argument - Keynes and Hicks proposed that if hedgers hold short positions and speculators hold long positions , the futures price will < expected spot price . - This is based on the idea that speculators demand compensation for the risks they bear. Modern approach - risk and return - The modern approach links futures prices to expected spot prices based on the relationship between risk and expected return in the economy. - Systematic and nonsystematic risks are considered, with SYSTEMATIC risk influencing the required expected return on an investment. - The investment is essentially in the asset underlying the futures contract. - If returns from this asset are uncorrelated with the stock market, the correct discount rate is the risk-free rate (r), so k = r. [!NOTE] CF to speculator - Consider: a speculator taking a long (buy) position in a futures contract lasting T years. - Objective: Speculator hopes the spot price of the asset will be above the futures price at the contract's end. - Ignoring daily settlement, treating the futures contract as a forward contract. - Speculator puts the present value of the futures price into a risk-free investment while simultaneously taking a long futures position. - Cash flows to the speculator: - Today: F. e^(rT) - End of Futures Contract: S(T) (where F0 is the current futures price, ST is the asset price at time T, and r is the risk-free return for time T) Relationship between futures price and expected future spot price - When returns are uncorrelated with the stock market, the futures price is considered an unbiased estimate of the expected future spot price. - Systematic risk: * Positive correlation will tend to lead to a futures price lower than the expected future spot price. * Negative correlation will tend to lead to a futures price higher than the expected future spot price. * Only when the correlation is zero will the theoretical futures price be equal to the expected future spot price. ![[Pasted image 20240202200720.png]] Normal backwardation and contango Normal backwardation = when the futures price < expected future spot price. Contango = futures price > expected future spot price. - Note: These terms can also refer to the relationship between futures prices and current spot prices in certain contexts. If we assume the capital asset pricing model is true, the relationship between the futures price and the expected future spot price depends on whether the return on the asset is positively or negatively correlated with the return on the stock market. Chapter 9. Options markets (skipped) Basics of options There are 2 types of options: calls and puts. A call option gives the holder the right to buy the underlying asset for a certain price by a certain date. A put option gives the holder the right to sell the underlying asset by a certain date for a certain price. There are 4 possible positions in options markets: a long position in a call a short position in a call a long position in a put a short position in a put. Taking a short position in an option is known as writing it. [!NOTE] Terminology At the money : the market is trading near the strike price In the money : the option is profitable Deep in the money : the option is very profitable Out of the money : the option is in a loss making situation (for the buyer) Options exchange An exchange must specify the terms of the option contracts it trades. In particular, it must specify the size of the contract, the precise expiration time, and the strike price. In the United States one stock option contract gives the holder the right to buy or sell 100 shares. The expiration of a stock option contract is 10:59 p.m. Central Time on the Saturday immediately following the third Friday of the expiration month. Options with several different expiration months trade at any given time. Strike prices are at $2:5, $5, or $10 intervals, depending on the stock price. The strike price is generally fairly close to the stock price when trading in an option begins. The terms of a stock option are not normally adjusted for cash dividends. However, they are adjusted for stock dividends, stock splits, and rights issues. The aim of the adjustment is to keep the positions of both the writer and the buyer of a contract unchanged. Participants Most options exchanges use market makers. These are individuals who are prepared to quote both a bid price (at which they are prepared to buy) and an offer price (at which they are prepared to sell). Market makers improve the liquidity of the market and ensure that there is never any delay in executing market orders. They themselves make a profit from the difference between their bid and offer prices (known as their bid\u2013offer spread). The exchange has rules specifying upper limits for the bid\u2013offer spread. Writers of options have potential liabilities and are required to maintain margin with their brokers. If it is not a member of the Options Clearing Corporation, the broker will maintain a margin account with a firm that is a member. This firm will in turn maintain a margin account with the Options Clearing Corporation. The Options Clearing Corporation is responsible for keeping a record of all outstanding contracts, handling exercise orders, and so on. Not all options are traded on exchanges. Many options are traded by phone in the over-the-counter market. An advantage of over-the-counter options is that they can be tailored by a financial institution to meet the particular needs of a corporate treasurer or fund manager [!example] ![[Pasted image 20240425001923.png]] Chapter 10. Proporties of stock options Determinants of option value There are 6 factors affecting the value of a stock option the current stock price S0 the strike price K the time to expiration T the stock price volatility \u03c3 the risk-free interest rate r the dividends expected during the life of the option Variable European Call European Put American Call American Put Current stock price + - + - Strike price - + - + Time to expiration ? ? + + Volatility + + + + Risk-free rate + - + - Dividends - + - + Stock price Call more valuable/expensive as: current price \u2191, strike price \u2193 (LHS) * if exercised -> payoff will be current price - strike price Put more valuable/expensive as: current price \u2193, strike price \u2191 (RHS) * if exercised -> payoff will be strike price - current price ![[Pasted image 20240203181805.png]] Time to expiration Good for both puts and calls; more valuable/expensive if time to maturity \u2191 (or at least X decrease in value) * E.g. Longer-life option has all the exercise opportunities open to shorter-life option\u2014and more. The long-life option must therefore always be worth at least as much as the short-life option. ![[Pasted image 20240203185451.png]] However the above is only true if ceteris paribus holds. ==Example== Consider 2 European call (buy) options on a stock: one with an expiration date in 1 month, the other with an expiration date in 2 months. Suppose that a very large dividend is expected in 1.5 months. The dividend will cause the stock price to \u2193, so that the short-life option could be worth more than the long-life option. Dividends Good for puts, bad for calls * Dividends have the effect of reducing the stock price on the ex-dividend date. * You alr get dividend money so price ex-dividend (after dividend) date will be lower Volatility ![[Pasted image 20240203185519.png]] Volatility is good for both put and call holders since they have limited downside risks - they can choose simply to not exercise * As volatility increases, the chance that the stock will do very well or very poorly increases Risk free rate Good for call, bad for put (contrast with dividends) As interest rates in economy (rfr) \u2191 investors expected return required also \u2191 PV of any future CF received by option HOLDERS \u2193 => Combined effects: good for calls, bad for puts ![[Pasted image 20240203185537.png]] Note: only applicable if ceteris paribus holds. In practice: when interest rate (rfr) \u2193, stock prices ALSO tend to \u2193 (and vice versa) interest rate \u2191 -> stock price \u2191; combined can => bad for call, good for put interest rate \u2193 -> stock price \u2193; combined can => good for call, bad for put Assumptions There are no transactions costs All trading profits (net of trading losses) are subject to the same tax rate Borrowing and lending are possible at the risk-free interest rate Market participants are prepared to take advantage of arbitrage opportunities as they arise Notation (American = upper case, European = lower case) Symbol Description S(0) Current stock price K Strike price of option T Time to expiration of option S(T) Stock price on the expiration date r Continuously compounded risk-free rate of interest C Value of American call option to buy one share P Value of American put option to sell one share c Value of European call option to buy one share p Value of European put option to sell one share Interest rate r is NOMINAL, not real. It's > 0 (otherwise a risk free investment would be pretty much the same as cash) Upper and lower bounds for option prices If an option price > upper bound or < lower bound, there are profitable opportunities for arbitrageurs. Upper bound Call options (promise to buy - profit if it later goes up cos u bought it at cheaper price) * option price is never higher than stock price (if higher then can simply not exercise) Put options (profit if later it goes down) * US: holder can sell stock for K * option price is never higher than strike price (aka K is the max profit so why pay more than K for the option) * European: at maturity option cannot worth > K (same as above) * it follows that it cannot be worth more than the PV of K today (PV of K < K) [!warning] Upper bounds of calls and puts for holders Call: C \u2264 S(0) | c \u2264 S(0) * If X true -> arbitrage: buy the stock, sell the call option Put: P \u2264 K | p \u2264 Ke^(-rT) * If X true -> arbitrage: writing/sell the option, invest proceeds of the sale at rfr Lower bounds (non-dividend paying) Call option [!quote] [FULL EXAMPLE WITH EXPLANATION] Euro call (option to buy), non dividend, strike price = 18\\$, expire in 1 year (T), cost 3$. Stock price = 20, rfr = 10% pa. Action now * Buy call option (-3) (only exercise if strike < spot) * Short/sell the stock (+20) * Invest that 17 for 1 year Action at maturity * That 17 invested will turn into 17 x e^(0.1) = (+18.79) * If spot S(T) > strike * exercise option to buy stock for strike of 18 (-18) * now that the stock is in my hands -> deliver it to close out the short position (gaining 20 as alr written above) * net profit = +18.79 - 18 = 0.79 * If spot S(T) < strike of 18: * do NOT exercise option (cos would buy it for higher than market price), accept the 3$ loss from the option expiring worthlessly * buy the stock at spot market price (-S(T)) * deliver the stock to close out the short position (+20 above, alr written) * net profit = +18.79 - S(T) (since ST is < strike of 18 -> we know that profit > 0.79) [!warning] The 0.79 above is called the lower bound for the price of a European call option. ![[Pasted image 20240204164909.png]] [!quote] [SHORT EXAMPLE - APPLYING THE FORMULA] European call, non dividend, stock price S0 = 51, strike K = 50, T = 0.5 years, rfr = 12% pa. Lowerbound = S0 - K.e(-rT) = 51 - 50.e^(-0.12*0.5) = 3.91 Put option [!quote] European put, non-dividend, strike K = 40, T = 0.5, cost = 1, stock price S0 = 37, rfr = 5% pa. Action now * Borrow (31 + 1) = 38 at market rfr for 6 months (+38) * Buy put option for 1 - option to sell stock (-1) (exercise if spot S0 < strike K) * Buy the stock at market spot for 37 (-37) Action at maturity * Paying back the amount borrowed -> 38.96 including interest (-38.96) . Where to get the funds: * If spot ST < strike K: * exercise put option, take the stock that I bought and sell it at strike (+40) * net profit = -38.96 + 40 = +1.04 * If spot ST > strike K: * don't exercise put * instead of selling the stock through the put option, sell it at market spot rate (+ST) * net profit = -38.96 + ST (since ST > 40, we know profit > 1.04) [!warning] The 1.04 above is called the lower bound for the price of a European put option. ![[Pasted image 20240204212630.png]] [!quote] European call, S0 = 38, T = 0.25, rfr = 0.10, K = 40 Lower bound = 40 . e^(-0.10*0.25) - 38 = 1.01 Call No dividend ![[Pasted image 20240216164152.png]] Yes dividend (D = PV of dividend) ![[Pasted image 20240216181106.png]] Put No dividend ![[Pasted image 20240216164119.png]] Yes dividend ![[Pasted image 20240216181150.png]] If the above are violated -> arbitrage Put-call parity ^1e885b Put\u2013call parity is a relationship between the price, c, of a European call option on a stock and the price, p, of a European put option on a stock. * ensures that identical portfolios have the same value today * if put-call parity does not hold -> arbitrage opportunity. Ok setting the scene. We've got: A call option - betting on the stock's price going up . If the stock performs well, you benefit from both the call option's potential profits ==(good if go up)== A put option - provides a safeguard against the stock's price dropping. If the stock performs poorly, the put option allows you to sell the stock at the agreed-upon price, minimising losses ==(not bad if go down)== Bond - guarantee a specific amount K at option's expiration date, even if stock performs poorly or call is not exercised ==(not bad if go down)== Stock - same as call, bets on the stock price going up ==(good if go up)== We're gonna create 2 portfolios, pick 2 securities for each that help achieve a 'balance': PORTFOLIO 1: Call (maximise profit) & bond ( minimise loss) PORTFOLIO 2: Stock (maximise profit) & put ( minimise loss) At time of maturity T: ![[Pasted image 20240206035058.png]] If spot S > strike K (good for call, bad for put): PORTFOLIO 1 call : exercised, brings in S less the strike K (S - K) bond : pays K no matter what when matured (+ K) Net: S - K + K = S PORTFOLIO 2 put : expires worthless (0) (ignore the premium) share : pays S no matter what when matured (+ S) Net: 0 + S = S If spot S < strike K (good for put, bad for call): PORTFOLIO 1 call : expires worthless (0) bond : pays K no matter what when matured (+ K) Net: K PORTFOLIO 2 put : exercised, brings in strike less the spot at which you bought the share (K - S) ==technically, you don't buy the share, usu you enter the put without having an actual share, then whne it matures, you buy it at the market spot rate, hence the - S== share : pays S no matter what when matured (+ S) Net: K - S + S = K Portfolio 1 and portfolio 2 must be equal in both scenarios (K>S and S>K) Current values/prices (all converted to PV): call: c bond: Ke^(e-rT) == basically K but PV == + D (if dividend) put: p share: S [!warning] Put call parity for stock WITHOUT DIVIDENDs ![[Pasted image 20240205185528.png]] WITH DIVIDENDs ![[Pasted image 20240205185412.png]] ![[Pasted image 20240425001946.png]] [!warning] Arbitrage opportunities when put\u2013call parity does not hold. Stock price = $31; interest rate = 10%; call price = $3. Both put and call have strike price of $30 and three months to maturity (0.25) Case 1. Put price p = 2.25 Put call parity LHS (portfolio 1): c + Ke-rT = 3 + 30.e^(-0.1*3/12) = 32.26 Put call parity RHS (portfolio 2): p + S = 2.25 + 31 = 33.25 => Portfolio 2 (RHS) is overpriced => Arbitrage strategy: BUY PORTFOLIO 1 (underpriced), SELL PORTFOLIO 2 (overpriced) At T0 Buy call (-3) Short/Sell put (+2.25) Short/Sell share (+31) Invest the profits from above (-3 + 2.25 + 31) for 3 months (-30.25) At T1: if spot ST > strike price of 30: exercise call, able to buy the share at 30 (-30) put holder (the other person) will let it expire worthlessly deliver the share that we short sold (we alr received the $ above) investment from above is now worth: (+31.02) => Net profit: 1.02 if spot ST < strike price of 30: prices go down, put holder will exercise -> we must buy share at 30 (-30) our call expires worthlessly investment from above is now worth: (+31.02) => Net profit: 1.02 Case 2. Put price p = 1 Put call parity LHS: 32.26 RHS: 1 + 31 = 32 => portfolio 2 is underpriced Arbitrage strategy: BUY PORTFOLIO 2, SELL PORTFOLIO 1 (buy put & share, sell call) * At T0: * Buy put (-1) * Buy share (-31) * Short/sell call (+3) * Funds for all the above: borrow 29 (+29) * At T1 * If spot St > strike price of 30: * prices go up, let put expires worthlessly * call holder will exercise -> we must deliver the share (+30) * pay back the fund borrowed, which has turned into 29.e^(0.1 x 3/12) = (-29.73) * => Net profit: 30 - 29.73 = 0.27 if spot ST < strike price of 30: prices go down, exercise put to sell share for 30 (+30) call holder will let their option expires worthlessly pay back the fund borrowed, which has turned into 29.e^(0.1 x 3/12) = (-29.73) => Net profit: 30 - 29.73 = 0.27 American calls and puts Above = European. Now American options. Put call parity for US options - find upper & lower bounds Put\u2013call parity does not hold for American options. However, it is possible to use arbitrage arguments to obtain upper and lower bounds for the difference between the price of an American call and the price of an American put. [!warning] American call & put ![[Pasted image 20240215152508.png]] [!quote] American calls & puts Non dividend, call strike = 20, maturity T = 5 months, call premium 1.5, stock price = 19, rfr = 0.1 Inequality above: stock price S0 - strike K \u2264 call C - put P \u2264 stock price S0 - PV of K Ke^(-rt) 19 - 20 \u2264 C - P \u2264 19 - 20e^(-0.1 x 5/12) -1 \u2264 C - P \u2264 19 - 20e^(-0.1 x 5/12) 1 \u2265 P - C \u2265 0.18 * P - C lies btwn 0.18 and 1 * Given call premium C = 1.5 -> P must be 1.68 - 2.50 * Aka for US put with same strike K & maturity as US call: * upper bound = 2.5 * lower bound = 1.68 Why it's not optimal to exercise US CALL OPTION early [!example] 2 reasons that the early exercise of an American call option on a non-dividend paying stock is not optimal. 1. Insurance A call option, when held instead of the stock itself, in effect insures the holder against the stock price falling below the strike price. Once the option has been exercised and the strike price has been exchanged for the stock price, this insurance vanishes. 2. Time value of money From the perspective of the option holder, the later the strike price is paid out the better. This is because the more delayed the exercise of the option is, the more interest the option holder can earn (since it is across a longer period of time). Paraphrasing: The early exercise of an American put is a trade-off between the time value of money and the insurance value of a put. Why it CAN be optimal to exercise US PUT OPTION early Short answer: as long as it is sufficiently deep in the money Bounds for European and American call options when there are no dividends ![[Pasted image 20240215155723.png]] Variation of price of an American or European call option on a non-dividend paying stock with the stock price S0. Curve moves in the direction of the arrows when there is an increase in the interest rate, the time to maturity, or the stock price volatility ![[Pasted image 20240215155747.png]] Example: consider an extreme situation. Call option; Strike price K = 10, share price S0 is virtually 0. if exercise immediately -> immediate gain of 10 if wait -> gain is < 10, never exceed 10 since share price cannot be negative Also 10 now is > 10 in the future Put option: different from a call option in that it may be optimal for an investor to forgo this insurance and exercise early in order to realize the strike price immediately. In general, the early exercise of a put option becomes more attractive as: * S0 decreases * r increases * volatility decreases [!NOTE] Why the above? The early exercise of an American put is attractive when the interest earned on the strike price is greater than the insurance element lost. * When interest rates increase, the value of the interest earned on the strike price increases making early exercise more attractive. * When volatility decreases, the insurance element is less valuable. Again this makes early exercise more attractive. Effect of dividends ![[Pasted image 20240215201145.png]] [!warning] Finding upper & lower bounds of US options ![[Pasted image 20240215201155.png]] Chapter 11. Options trading strategies Chapter 12. Binomial tree pricing No arbitrage arguments vs risk-neutral arguments No arbitrage In the no-arbitrage approach, we set up a riskless portfolio consisting of a position in the option and a position in the stock. By setting the return on the portfolio equal to the risk free interest rate, we are able to value the option. Risk-neutral valuation When we use risk-neutral valuation, we first choose probabilities for the branches of the tree so that the expected return on the stock equals the risk-free interest rate. We then value the option by calculating its expected payoff and discounting this expected payoff at the risk-free interest rate. A risk-neutral world has two features that simplify the pricing of derivatives: The expected return on a stock (or any other investment) is the risk-free rate. The discount rate used for the expected payoff on an option (or any other instrument) is the risk-free rate. Comparison - example [!warning] No arbitrage valuation of options SHORT WAY (risk neutral) * f = value of option * d = transformation of current stock price if it goes down * u = transformation of current stock price if it goes up ![[Pasted image 20240304012806.png]] ![[Pasted image 20240304012856.png]] LONG WAY (no arbitrage) 1. Up value \u0394 - option = Down value \u0394 Solve for \u0394 Solve for value of portfolio (any of the two sides) 2. (\u0394 . current share price - f).e^(rt) = 38.4 Solve for f = 2.23 * ** If call, option is -, shares is +\u0394 * ** If put, opposite, shares is -\u0394 [!quote] A stock price is currently $40. It is known that at the end of three months it will be either $45 or $35. The risk-free rate of interest with quarterly compounding is 8% per annum. Calculate the value of a three-month European put option on the stock with an exercise price of $40. Verify that no-arbitrage arguments and risk-neutral valuation arguments give the same answers. No arbitrage * -35\u0394 + 5 = -45\u0394 \u0394 = -0.5 * Current value of portfolio: -40\u0394 + f * Portfolio must earn rfr of interest: (-40\u0394 + f) x e... f = 2.06 Risk neutral * p = probability of upward stock price movement in risk neutral world * This must hold true: 45 p + 35 (1 - p) = 40 x e... 10 p = 5.8 p = 0.58 * Expected value of option in risk neutral world: f = 0 x 0.58 + 5 x 0.42 = 2.10 * PV of f = 2.10 / e... = 2.06 Two-step binomial trees ![[Pasted image 20240304165118.png]] [!warning] Valuation of options - 2 step ![[Pasted image 20240304172334.png]] ![[Pasted image 20240304165312.png]] Volatility: ![[Pasted image 20240305011411.png]] Porbabilities: pp 2p(1-p) (1-p)(1-p) The option price is always equal to its expected payoff in a risk neutral world, discounted at the risk-free interest rate Delta Delta of a stock option = ratio of the change in the price of option : change in the price of underlying stock * measures the sensitivity of the option price to the price of the stock when small changes are considered * # of units of the stock we should hold for each option shorted in order to create a riskless portfolio * delta of call = positive * delta of put = negative Delta hedging = construction of a riskless portfolio Chapter 13. Options pricing - Black, Scholes, Merton model Basics Black\u2013Scholes\u2013Merton model assumptions 1. Assumes a non-dividend-paying stock. 2. The return on the stock in a short period is normally distributed / log normally dist in long period 3. Returns in different non-overlapping periods are independent. S: Change in stock price. t: Time. m : Mean of the normal distribution. v : Variance of the normal distribution. Expected Return ( \u03bc ): Mean of the return. Volatility ( \u03c3 ): Standard deviation of the return. Lognormal vs normal - Short term: In the short term, the Black\u2013Scholes\u2013Merton model assumes that the distribution of stock price changes is normal . This means that over brief intervals, the percentage changes in stock prices are expected to follow a symmetric bell-shaped curve. - Long term: As we consider longer time periods, the model assumes that the distribution of future stock prices is lognormal . aka IT'S NOT ST THAT'S NORMAL BUT NATURAL LOG ST IS NORMAL . This introduces a skewness in the distribution, and it better captures the asymmetry and potential for large price movements over extended periods. A normal distribution is symmetrical A lognormal distribution is skewed with the mean, median, and mode all different A variable with a lognormal distribution has the property that its natural logarithm is normally distributed. ![[Pasted image 20240305174810.png]] ![[Pasted image 20240305174822.png]] [!warning] Black\u2013Scholes\u2013Merton assumption implies that ST (future share price) is normal Distribution of ln ST ![[Pasted image 20240305021349.png]] Distribution of ST * With 95% confidence, mean - Z-score . SD < ln ST < mean + Z-score . SD * e^LHS < ST < e^RHS Given the range * mean = current price . e^(expected return rate x time) * var = current price^2 . e^(2 x expected return x time) . [e^(volatility/SD . volatility/SD . time) - 1] [!quote] Consider a stock with an initial price of $40, an expected return of 16% per annum, and a volatility of 20% per annum. From equation (13.2), the probability distribution of the stock price, ST, in six months is given by ![[Pasted image 20240305014249.png]] * There's 95% prob that norm dist var has a value within 1.96 SD of its mean (empirical rule). * SD = sqrt(variance) = sqrt(0.2^2 * 6/12) = 0.1414 Hence, with 95% confidence: Expected - 1.96.SD < ln ST < Expected + 1.96.SD ![[Pasted image 20240305020658.png]] ![[Pasted image 20240305020717.png]] 32.55 < ST < 56.56 OK now that we've had a range for ST, we need to find mean and variance / SD 1. Mean of ST = Pe^(rT) = 40e^(16% . 6/12) = 43.33 2. Variance of ST = P.P . e^(2 * r * t) . (e^(SD.SD.t) - 1) ![[Pasted image 20240305021034.png]] Conclusion * There's a 95% chance stock price will be [32.55 - 56.56] * Mean = 43.33 * Var = 37.93 [!quote] Consider a stock with an expected return of 17% per annum and a volatility of 20% per annum. The probability distribution for the rate of return (continuously compounded) realized over one year is NORMAL * mean = expected return - SD^2 / 2 = 0.17 - 0.2^2 / 2 = 0.15 * SD = 20% 95% confident that return realised over 1 year: * 15 - 1.96 x 20 = -24.2% * 15 + 1.96 x 20 = +54.2% Expected return The higher the risk, the higher the expected return. The higher the level of interest rates, the higher the expected return required on any given stock. Volatility Our uncertainty about future stock prices increases as we look further ahead. As a rough approximation, we can say that the standard deviation of the stock price is proportional to the square root of how far ahead we are looking : SD = sqrt(n) [!quote] What is meant by implied volatility? How would you calculate the volatility implied by a European put option price? The implied volatility is the volatility that makes the Black\u2013Scholes\u2013Merton price of an option equal to its market price. It is calculated by trial and error. We test in a systematic way different volatilities until we find the one that gives the European put option price when it is substituted into the Black\u2013Scholes\u2013Merton formula. Assumptions Stock price behavior corresponds to the lognormal model (developed earlier in this chapter) with and constant. There are no transactions costs or taxes. All securities are perfectly divisible. There are no dividends on the stock during the life of the option. There are no riskless arbitrage opportunities. Security trading is continuous. Investors can borrow or lend at the same risk-free rate of interest. The short-term risk-free rate of interest, r, is constant. Trading days v. calendar days Research shows that volatility is much higher when the exchange is open for trading than when it is closed. As a result, practitioners tend to ignore days when the exchange is closed when estimating volatility from historical data and when calculating the life of an option. ![[Pasted image 20240306141316.png]] Calc volatility from historical data See excel Black\u2013Scholes\u2013Merton modelling [!warning] The Black\u2013Scholes\u2013Merton formulas for the prices of European calls and puts on non dividend-paying stocks are ![[Pasted image 20240306141705.png]] The function N(x) is the cumulative probability function for a standardized normal variable. In other words, it is the probability that a variable with a standard normal distribution will be less than x. ![[Pasted image 20240306141759.png]] [!quote] The stock price six months from the expiration of an option is $42, the exercise price of the option is $40, the risk-free interest rate is 10% per annum, and the volatility is 20% per annum. This means that S0 = 42, K = 40, r = 0.1, sigma = 0:2, T = 0.5 ![[Pasted image 20240306142007.png]] ![[Pasted image 20240306144817.png]] Risk-neutral valuation: revisited Risk neutral valuation Any security dependent on other traded securities can be valued on the assumption that investors are risk neutral. 1. The expected return from all investment assets is the risk-free interest rate. 2. The risk-free interest rate is the appropriate discount rate to apply to any expected future cash flow Procedures - valuing derivatives 1. Assume that the expected return from the underlying asset is the risk-free interest rate r (i.e., assume u = r ). 2. Calculate the expected payoff. 3. Discount the expected payoff at the risk-free interest rate. Chapter 4. Interest rates 4.1 | Types of rates Two important interest rates for derivatives traders are Treasury rates and LIBOR rates. Treasury rates are the rates paid by a government on borrowings in its own currency. LIBOR rates are short-term lending rates offered by banks in the interbank market. Treasury rates LIBOR Repo rates Risk free rate The compounding frequency for an interest rate defines a unit of measurement for the interest rate. The compounding frequency used for an interest rate defines the units in which it is measured. The difference between an annually compounded rate and a quarterly compounded rate is analogous to the difference between a distance measured in miles and a distance measured in kilometers. Traders frequently use continuous compound ing when analyzing the value of options and more complex derivatives. 4.2 | Bond pricing A bond\u2019s yield is the single discount rate that, when applied to all cash flows, gives the bond\u2019s value equal to its market price. The par yield for a certain bond maturity is the coupon rate that causes the bond price to equal its par value. (The par value is the same as the principal value). 4.3 | Determining Treasury zero rates The n-year zero rate or n-year spot rate is the rate applicable to an investment lasting for n years when all of the return is realized at the end. The method most commonly used to calculate zero rates is known as the bootstrap method . involves starting with short-term instruments and moving progressively to longer-term instruments, making sure that the zero rates calculated at each stage are consistent with the prices of the instruments used daily by trading desks to calculate a Treasury zero-rate curve. 4.4 | Forward rates Forward rates are the rates applicable to future periods of time implied by today\u2019s zero rates. A forward rate agreement (FRA) is an over-the-counter agreement that an interest rate (usually LIBOR) will be exchanged for a specified interest rate during a specified future period of time. * An FRA can be valued by assuming that forward rates are realized and discounting the resulting payoff. [!warning] Forward rate RF ![[Pasted image 20240329010249.png]] 4.5 | Term structure of interest rates It is natural to ask what determines the shape of the zero curve. Why is it sometimes downward sloping, sometimes upward sloping, and sometimes partly upward sloping and partly downward sloping? expectations theory * simplest * long-term interest rates should reflect expected future short-term interest rates. * More precisely, it argues that a forward interest rate corresponding to a certain future period is equal to the expected future zero interest rate for that period . market segmentation theory * conjectures that there need be no relationship between short-, medium-, and long-term interest rates * a major investor such as a large pension fund invests in bonds of a certain maturity and does not readily switch from one maturity to another. * The short term interest rate is determined by supply and demand in the short-term bond market; the medium-term interest rate is determined by supply and demand in the medium-term bond market; and so on. liquidity preference theory * most appealing * Investors = prefer to preserve their liquidity and invest funds for short periods of time . * Borrowers = prefer to borrow at fixed rates for long periods of time . * This leads to a situation in which forward rates are greater than expected future zero rates . * consistent with the empirical result that yield curves tend to be upward sloping more often than they are downward sloping * Liquidity preference theory can be used to explain the interest rate term structures that are observed in practice. The theory argues that most individuals and most companies like to borrow long and lend short. To match the maturities of borrowers and lenders, it is necessary for financial intermediaries to raise long-term rates so that forward interest rates are higher than expected future spot interest rates. Chapter 3. Hedging strategies using futures 3.1 | Basics Short hedge = short position future contracts = short sell A short hedge is appropriate when a company owns an asset and expects to sell that asset in the future. It can also be used when the company does not currently own the asset but expects to do so at some time in the future. A long hedge is appropriate when a company knows it will have to purchase an asset in the future. It can also be used to offset the risk from an existing short position. [!example] It is May 15. An oil producer has negotiated a contract to sell 1 million barrels of crude oil. The price in the sales contract is the spot price on August 15. Quotes: * Spot price of crude oil: $80 per barrel * August oil futures price: $79 per barrel ( think what we're selling r gonna go down -> wanna SELL HIGH -> SHORT HEDGE ) The oil producer can hedge with the following transactions: * May 15: Short 1,000 August futures contracts on crude oil * August 15: Close out futures position After gains or losses on the futures are taken into account, the price received by the company is close to $79 per barrel. Daily settlement : futures = everyday, forward = alll at the end 3.2 | Basis risk Basis risk arises from the hedger\u2019s uncertainty regarding the difference between the spot price and futures price at the expiration of the hedge. Basis = spot of asset - futures price of contract As time passes, the spot price and a particular month\u2019s futures price do not necessarily change by the same amount and, as aresult, the basis changes. An increase in the basis is referred to as a strengthening of the basis and a decrease in the basis is referred to as a weakening of the basis. ![[Pasted image 20240329114341.png]] ![[Pasted image 20240329114401.png]] Consider a company that uses a short hedge because it plans to sell the asset. If the basis strengthens (i.e., increases) unexpectedly, the company\u2019s position improves because it will get a higher price for the asset after futures gains or losses are considered; if the basis weakens (i.e., decreases) unexpectedly, the company\u2019s position worsens. -> short hedge = good if basis gap goes up For a company using a long hedge because it plans to buy the asset: If the basis strengthens unexpectedly, the company\u2019s position worsens because it will pay a higher price for the asset after futures gains and losses are considered; if the basis weakens unexpectedly, the company\u2019s position improves. -> long hedge = good if basis gap goes down Choosing contracts In general, basis risk increases as the 'time difference between the hedge expiration and the delivery month' increases . A good rule of thumb is therefore to choose a delivery month that is as close as possible to, but later than, the expiration of the hedge . Suppose delivery months are March, June, September, and December for futures on a particular asset. For hedge expirations in December, January, and February, the March contract will be chosen; for hedge expirations in March, April, and May, the June contract will be chosen; and so on. Perfect hedge - A perfect hedge completely eliminates the hedger\u2019s risk. - A perfect hedge does not always lead to a better outcome than an imperfect hedge; it just leads to a more certain outcome. Consider a company that hedges its exposure to the price of an asset. Suppose the asset\u2019s price movements prove to be favorable to the company. A perfect hedge totally neutralizes the company\u2019s gain from these favorable price movements. An imperfect hedge, which only partially neutralizes the gains, might well give a better outcome. 3.3 | Cross hedging Cross hedging occurs when the two assets are different. The hedge ratio is the ratio of \"the size of the position taken in futures contracts : the size of the exposure\" * When the asset underlying the futures contract is the same as the asset being hedged it is natural to use a hedge ratio of 1.0. This is the hedge ratio we have used in the examples considered so far. In Example 3.4, for instance, the hedger\u2019s exposure was on 20,000 barrels of oil, and futures contracts were entered into for the delivery of exactly this amount of oil. * When cross hedging is used, setting the hedge ratio equal to 1.0 is not always optimal. The hedger should choose a value for the hedge ratio that minimizes the variance of the value of the hedged position. Minimum variance hedge ratio h is the slope of the best-fit line from a linear regression of S against F. ![[Pasted image 20240329115022.png]] The hedge effectiveness can be defined as the proportion of the variance that is eliminated by hedging. This is the R2 from the regression of S against F and equals 2. [!NOTE] Under what circumstances does a minimum variance hedge portfolio lead to no hedging at all? When the coefficient of correlation between changes in the futures price and changes in the price of the asset being hedged is zero. Optimum number of contracts ![[Pasted image 20240329115128.png]] ![[Pasted image 20240329115615.png]] Tailing the hedge Small adjustment made to allow for the impact of daily settlement if we're using futures instead of forwards ![[Pasted image 20240329115249.png]] Va = dollar value of position being hedged = principal x spot Vf = dollar value of 1 futures contract = futures x size of 1 f contract 3.4 | Hedging equity portfolio If the portfolio mirrors the index, a hedge ratio very close to 1.0 is clearly appropriate -> number of futures contracts that should be shorted is ![[Pasted image 20240329115822.png]] ![[Pasted image 20240329115812.png]] [!quote] Suppose, for example, that a portfolio worth $5.05 million mirrors the S&P 500. The index futures price is 1,010 and each futures contract is on $250 times the index. In this case, * VA = 5,050,000 * VF = 1,010 x 250 = 252,500 * so that 5,050,000 / 252,500 = 20 contracts should be shorted to hedge the portfolio. When the portfolio does not exactly mirror the index, we can use the parameter beta from the capital asset pricing model to determine the appropriate number of contracts to short. ![[Pasted image 20240329120022.png]] ==example== 3 months ![[Pasted image 20240329120041.png]] ![[Pasted image 20240329120130.png]] ![[Pasted image 20240329120141.png]] Why hedge an equity portfolio * One answer to this question is that hedging can be justified if the hedger feels that the stocks in the portfolio have been chosen well. In these circumstances, the hedger might be very uncertain about the performance of the market as a whole, but confident that the stocks in the portfolio will outperform the market (after appropriate adjustments have been made for the beta of the portfolio). A hedge using index futures removes the risk arising from market moves and leaves the hedger exposed only to the performance of the portfolio relative to the market. * Another reason for hedging may be that the hedger is planning to hold a portfolio for a long period of time and requires short-term protection in an uncertain market situation. The alternative strategy of selling the portfolio and buying it back later might involve unacceptably high transaction costs. If we wanna lower the beta ![[Pasted image 20240329120248.png]] Chapter 7. Swaps","title":"Derivatives notes"},{"location":"Financial%20engineering/Derivatives%20notes/#derivatives-notes","text":"","title":"Derivatives notes"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-1-basics","text":"","title":"Chapter 1. Basics"},{"location":"Financial%20engineering/Derivatives%20notes/#basic-derivatives","text":"Futures and forward contracts are agreements to buy or sell an asset at a certain time in the future for a certain price. Futures contracts are traded on an exchange Forward contracts are traded in the over-the-counter market. Options trade both on exchanges and in the over-the-counter market. 2 types: 1. A call option gives the holder the right to buy an asset by a certain date for a certain price. 2. A put option gives the holder the right to sell an asset by a certain date for a certain price. [!quote]+ Example - option price chart Suppose that a March call option on a stock with a strike price of $50 costs $2.50 and is held until March. Under what circumstances will the holder of the option make a gain? Under what circumstances will the option be exercised? Draw a diagram showing how the profit on a long position in the option depends on the stock price at the maturity of the option. * Call = ability to BUY * If high price, ill buy at low predet price. So spot increases (->) -> boom at 50 PLUS premium -> perk up profits * Low price -> no exercise -> straight line lose at x = -2.5 ![[Pasted image 20240114031854.png]] Suppose that a June put option on a stock with a strike price of $60 costs $4 and is held until June. Under what circumstances will the holder of the option make a gain? Under what circumstances will the option be exercised? * Put = ability to sell -> good if prices go down * At spot = 60 (-4 premium since holder) = 56 -> exercise -> profits perk up * Spot rate higher than that (<-) = profits = negative at 4, not exercised options * Chart for the holder: ![[Pasted image 20240113012227.png]] * Chart for the seller: ![[Pasted image 20240113012159.png]]","title":"Basic derivatives"},{"location":"Financial%20engineering/Derivatives%20notes/#long-vs-short-positions","text":"A trader who enters into a long futures position is agreeing to BUY the underlying asset for a certain price at a certain time in the future. A trader who enters into a short futures position is agreeing to SELL the underlying asset for a certain price at a certain time in the future.","title":"Long vs. short positions"},{"location":"Financial%20engineering/Derivatives%20notes/#otc-vs-exchange-traded","text":"The over-the-counter market is a telephone- and computer-linked network of financial institutions, fund managers, and corporate treasurers where 2 participants can enter into any mutually acceptable contract. * When a market maker quotes a bid and an offer, the bid is the price at which the market maker is prepared to BUY and the offer is the price at which the market maker is prepared to SELL . An exchange-traded market is a market organized by an exchange where traders either meet physically or communicate electronically and the contracts that can be traded have been defined by the exchange.","title":"OTC vs exchange traded"},{"location":"Financial%20engineering/Derivatives%20notes/#participants-in-the-markets","text":"Three main types of participants in the markets: hedgers, speculators, and arbitrageurs. Hedging = when it has an exposure to the price of an asset and takes a position in futures or options markets to offset the exposure. Speculation = the company has no exposure to offset. It is betting on the future movements in the price of the asset. Arbitrage involves taking a position in two or more different markets to lock in a profit. Hedgers are in the position of facing risk associated with the price of an asset. * They use futures, forward, or option contracts to reduce or eliminate this risk. Speculators wish to bet on future movements in the price of an asset. * Futures, forward, and option contracts can give them extra leverage; that is, the contracts can increase both the potential gains and potential losses in a speculative investment. Arbitrageurs are in business to take advantage of a discrepancy between prices in two different markets. * If, for example, they see the futures price of an asset getting out of line with the spot price, they will take offsetting positions in the two markets to lock in a profit.","title":"Participants in the markets"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-2-future-and-forward-markets","text":"","title":"Chapter 2. Future and forward markets"},{"location":"Financial%20engineering/Derivatives%20notes/#opening-closing-futures-positions","text":"A very high proportion of the futures contracts that are traded do not lead to the delivery of the underlying asset . This is because traders usually enter into offsetting contracts to close out their positions before the delivery period is reached . However, it is the possibility of final delivery that drives the determination of the futures price. Closing a position = enter into an OPPOSITE trade to the original one that opened the position","title":"Opening &amp; closing futures positions"},{"location":"Financial%20engineering/Derivatives%20notes/#contract-specifications","text":"The most important aspects of the design of a new futures contract are the specification of the underlying asset the size of the contract the delivery arrangements the delivery months The specification of contracts is an important activity for a futures exchange. The two sides to any contract must know what can be delivered where delivery can take place when delivery can take place details on the trading hours how prices will be quoted maximum daily price movements Some contracts, such as those on stock indices, are settled in cash rather than by delivery of the underlying asset. New contracts must be approved by the Commodity Futures Trading Commission before trading starts.","title":"Contract specifications"},{"location":"Financial%20engineering/Derivatives%20notes/#convergence-of-future-spot-prices-arbitrage-opportunities","text":"As we approach the delivery period -> futures price coverge to spot price. Otherwise -> arbitrage opportunity ![[Pasted image 20240118155416.png]] ==If future P > spot P== Sell (SHORT) futures contract promising to sell the asset at HIGH Buy the asset at LOW Deliver the asset to the futures contract buyer, earning HIGH -> Since future inflow from selling > spot outflow from buying -> profit -> As traders exploit this arbitrage opportunity, the futures price will fall. ==If future < spot P== Buy a future promising to buy the asset at LOW Wait until delivery Buy the asset at LOW, cheaper than buying asset now at HIGH -> Prices would consequently rise If the futures price < spot price during the delivery period, there is no similar perfect arbitrage strategy. An arbitrageur can take a long futures position but cannot force immediate delivery of the asset. The decision on when delivery will be made is made by the party with the short position. Nevertheless companies interested in acquiring the asset will find it attractive to enter into a long futures contract and wait for delivery to be made.","title":"Convergence of future &amp; spot prices; arbitrage opportunities"},{"location":"Financial%20engineering/Derivatives%20notes/#operation-of-margin-accounts","text":"Layer 1. Client & broker Daily settlement / marking to market * the broker will require the investor to deposit funds in a margin account - must be deposited at the time the contract is entered into is known as the initial margin . * at the end of each trading day, the margin account is adjusted to reflect the investor\u2019s gain or loss. [!NOTE] Example: calculation Suppose, for example, that by the end of June 5 the futures price has dropped from $1,650 to $1,641. * The investor has a loss of $1,800 (= 200 $9), because the 200 ounces of December gold, which the investor contracted to buy at $1,650, can now be sold for only $1,641. * The balance in the margin account would therefore be reduced by $1,800 to $10,200. * Similarly, if the price of December gold rose to $1,659 by the end of June 5, the balance in the margin account would be increased by $1,800 to $13,800. * A trade is first settled at the close of the day on which it takes place. It is then settled at the close of trading on each subsequent day. Layer 2. broker vs clearing house When there is a decrease in the futures price so that the margin account of an investor with a long position is reduced by $1,800, the investor\u2019s broker has to pay the exchange clearing house $1,800 and this money is passed on to the broker of an investor with a short position. Maintenance margin The investor is entitled to withdraw any balance in the margin account in excess of the initial margin. To ensure that the balance in the margin account never becomes negative, a maintenance margin , which is somewhat lower than the initial margin, is set. Variation margin If the balance in the margin account falls < the maintenance margin, the investor receives a margin call and is expected to top up the margin account to the initial margin level the next day . * The extra funds deposited are known as a variation margin . * If the investor does not provide the variation margin, the broker closes out the position. In the case considered above, closing out the position would involve neutralising the existing contract by selling 200 ounces of gold for delivery in December. Extra info * Most brokers pay investors interest on the balance in a margin account, making the balance not represent a true cost if the interest rate is competitive. * Investors can deposit securities, treasury bills (at 90% face value), or shares (at 50% market value) to satisfy initial margin requirements, with subsequent margin calls requiring cash. * Unlike forward contracts, futures contracts are settled daily. Daily gains or losses are added to or subtracted from the margin account balance. * Minimum margin levels = set by the exchange clearing house, with individual brokers having the discretion to require more margin. * Minimum levels depend on the variability of the underlying asset's price, and maintenance margin is typically about 75% of the initial margin. * Margin requirements variation: Depend on the trader's objectives, with bona fide hedgers often having lower margin requirements than speculators due to perceived lower risk of default. Clearing house & clearin margin Clearing house = intermediary in futures transactions, guaranteeing performance and having members who contribute to a default fund. * Brokers, if not members, must channel their business through a clearing house member. * Clearing house tracks daily transactions to calculate the net position of each member. * Brokers maintain margin with a clearing house member, who, in turn, maintains a clearing margin account with the clearing house. Clearing margin account : Adjusted for gains and losses daily, with an original margin but no maintenance margin . * Balance must be maintained at the original margin multiplied by the number of outstanding contracts. * Clearing margin calculation: the exchange clearing house calculates the clearing margin based on the number of contracts outstanding, using either a gross basis (sum of long and short positions) or a net basis (offsetting long and short positions). Most exchanges currently use net margining.","title":"Operation of margin accounts"},{"location":"Financial%20engineering/Derivatives%20notes/#otc-market","text":"OTC market = where companies agree to derivatives transactions without involving an exchange. Collateral - Credit risk is inherent in OTC derivatives, and defaults can result in losses for the party with a positive net value. - Collateral agreements between companies, such as A and B, are used to mitigate credit risk. - Collateral arrangements may be one-way or two-way, involving the posting of cash or marketable securities with daily valuation. - Two-way agreements may require posting variation margin based on daily changes in transaction values. Clearing houses * Prior to the 2007 credit crisis, most OTC trades operated through bilateral agreements with collateral but had higher credit risk than exchange-traded markets. * Regulators, post-2007 crisis, sought to reduce systemic risk by making OTC markets more like exchange-traded markets. * Legislation mandates the use of central clearing parties (CCPs) for standard OTC transactions to reduce credit risk. * CCPs act as intermediaries , becoming the counterparty to both sides of an OTC transaction and managing credit risk through initial and daily variation margin requirements. * CCPs are similar to exchange clearing houses. * Once it has been agreed between two parties A and B, a standard OTC derivative transaction is presented to a CCP. * Assuming the CCP accepts the transaction, it becomes the counterparty to both A and B. (This is similar to the way the clearing house for a futures exchange becomes the counterparty to the two sides of a futures trade). * For example, if the transaction is a forward contract where A has agreed to buy an asset from B in one year for a certain price, the clearing house agrees to 1. Buy the asset from B in one year for the agreed price, and 2. Sell the asset to A in one year for the agreed price. => It takes on the credit risk of both A and B. It manages this risk by requiring an initial margin and a daily variation margin from each of them. A move from bilateral agreements -> centralised clearing through a CCP ![[Pasted image 20240120141926.png]]","title":"OTC market"},{"location":"Financial%20engineering/Derivatives%20notes/#market-quotes","text":"Table 2.2. Futures Quotes for CME Group Contracts on Commodities - July 13, 2012 Gold, 100 oz, $ per oz Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 1571.2 1596.5 1565.6 1565.3 1589.7 +24.4 115,296 Sept. 2012 1570.4 1597.5 1567.1 1566.4 1590.2 +23.8 303 Oct. 2012 1574.0 1598.3 1570.0 1567.6 1593.6 +26.0 726 Dec. 2012 1576.5 1601.0 1570.7 1570.0 1596.0 +26.0 11,283 June 2013 1598.0 1604.6 1598.0 1576.1 1604.6 +28.5 250 Crude Oil, 1,000 barrels, $ per barrel Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 85.86 87.61 85.58 86.08 87.28 +1.20 223,698 Sept. 2012 86.33 88.00 85.95 86.46 87.68 +1.22 87,931 Dec. 2012 87.45 89.21 87.39 87.73 88.94 +1.21 31,701 Dec. 2013 88.85 90.15 88.78 88.92 89.95 +1.03 11,128 Dec. 2014 87.20 87.74 87.20 86.98 87.74 +0.76 2,388 Corn, 5,000 bushels, cents per bushel Open High Low Prior Settlement Last Trade Change Volume Sept. 2012 730.00 748.00 726.50 731.25 742.25 +11.00 78,317 Dec. 2012 731.25 749.00 727.25 732.25 742.25 +10.00 179,010 Mar. 2013 733.00 748.25 729.00 734.50 743.50 +9.00 22,588 May 2013 731.00 744.25 726.75 732.75 739.75 +7.00 4,548 July 2013 728.00 739.00 721.00 728.75 733.50 +4.75 7,874 Dec. 2013 618.75 626.50 613.75 618.25 626.00 +7.75 4,260 Soybeans, 5,000 bushels, cents per bushel Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 1572.00 1600.00 1571.50 1572.50 1596.00 +23.50 19,194 Sept. 2012 1544.50 1574.00 1544.50 1545.50 1570.00 +24.50 7,024 Nov. 2012 1528.00 1561.50 1526.50 1529.00 1552.75 +23.75 98,526 Jan. 2013 1527.75 1557.25 1523.75 1526.00 1548.00 +22.00 11,621 Mar. 2013 1486.25 1508.00 1482.25 1481.25 1500.25 +19.00 6,226 May 2013 1432.25 1453.25 1428.00 1430.25 1449.00 +18.75 5,234 Wheat, 5,000 bushels, cents per bushel Open High Low Prior Settlement Last Trade Change Volume Sept. 2012 845.75 865.75 842.00 846.75 846.25 \u00b10.50 41,301 Dec. 2012 859.00 877.75 856.00 859.75 861.50 +1.75 29,450 Mar. 2013 868.00 885.75 865.00 869.00 870.00 +2.00 6,972 May 2013 865.00 881.00 863.00 864.50 867.00 +2.50 2,339 July 2013 824.50 840.00 824.25 826.75 832.50 +5.75 4,118 Live Cattle, 40,000 lbs, cents per lb Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 116.900 117.600 116.300 117.025 117.225 +0.200 23,117 Oct. 2012 121.450 121.650 120.525 121.650 121.600 \u00b10.050 18,427 Dec. 2012 124.900 125.000 124.050 124.975 124.950 \u00b10.025 6,561 Feb. 2013 128.500 128.500 127.525 128.550 128.500 \u00b10.050 2,450 Apr. 2013 131.225 131.400 130.300 131.375 131.250 \u00b10.125 1,615 Prices - Prices are presented as the opening, highest, and lowest prices for the day * The opening price is representative of the prices at which contracts were trading immediately after the start of trading on July 13, 2012. Gold, 100 oz, $ per oz Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 1571.2 1596.5 1565.6 1565.3 1589.7 +24.4 115,296 Sept. 2012 1570.4 1597.5 1567.1 1566.4 1590.2 +23.8 303 For the August 2012 gold contract, the opening price on July 13, 2012 was $1,571.2 per ounce. The highest price during the day was $1,596.5 per ounce and The lowest price during the day was $1,565.6 per ounce. Settlement prices settlement price is the price used for calculating daily gains and losses and margin requirements. = the price at which the contract traded immediately before the end of a day\u2019s trading session = aka close Gold, 100 oz, $ per oz Open High Low Prior Settlement Last Trade Change Volume Aug. 2012 1571.2 1596.5 1565.6 1565.3 1589.7 +24.4 115,296 $1,565.3 = settlement price the previous day (i.e., July 12, 2012). 1,589.7 = most recent trading price (closing today) +24.4 = price change from the previous day\u2019s settlement price. [!NOTE] Calculating the amount gained For a trader with a long position, the positive price change of 1565.3 -> 1589.7 = 24.4 is a gain (bc buy -> price increases -> profit cos bought at cheaper price). Times 100 oz cos that was the price per oz -> earn 2440 today Similarly, the margin account of a trader with a short (sell) position would lose this amount 2,440 on July 13. Trading volume and open interest Open interest = total number of outstanding contracts (long = short positions) Trading volume = number of contracts traded in a day - If there is a large amount of trading by day traders (i.e., traders who enter into a position and close it out on the same day) the volume of trading in a day can be greater than either the beginning-of-day or end-of-day open interest. Usually 1 party opens, 1 party closes at the same time -> open interest remains at 0. But if both the long and short parties are closing out existing positions -> the resultant change in the open interest is -1 Patterns of futures Normal market = futures prices tend to increase as the maturity of the contracts extends into the future. * This means that contracts with later expiration dates have higher prices compared to those with earlier expiration dates. * For example, if you observe a series of futures prices for different months, and as you move from near-term to far-term contracts, the prices generally go up, it indicates a normal market. - Gold and live cattle futures prices follow an increasing function of maturity , known as a normal market ; as you move from August 2012 to June 2013 in the contracts, the prices generally increase. Inverted market = Futures prices tend to decrease as the maturity of the contracts extends into the future. * This means that contracts with later expiration dates have lower prices compared to those with earlier expiration dates. * For example, if you observe a series of futures prices for different months, and as you move from near-term to far-term contracts, the prices generally go down, it indicates an inverted market. - Soybean futures prices exhibit a decreasing function of maturity, termed an inverted market . Some commodities, like crude oil, corn, and wheat, may show mixed patterns, combining elements of both normal and inverted markets on a specific date (e.g., July 13, 2012).","title":"Market quotes"},{"location":"Financial%20engineering/Derivatives%20notes/#pricing","text":"","title":"Pricing"},{"location":"Financial%20engineering/Derivatives%20notes/#currency","text":"In futures markets prices are quoted as the number of U.S. dollars per unit of foreign currency for the British pound euro Australian dollar New Zealand dollar For other major currencies, spot and forward rates are quoted as the number of units of foreign currency per U.S. dollar .","title":"Currency"},{"location":"Financial%20engineering/Derivatives%20notes/#price-limits-and-position-limits","text":"Limit down = in a day the price moves down from the last day's close by an amonut = daily price limit Limit up = move up by the limit Usually ceases trading Goal of daily price limits: prevent too much volatility due to speculative excesses Position limit = max # of contracts a speculator may hold -> prevent speculators from exercising undue influence","title":"Price limits and position limits"},{"location":"Financial%20engineering/Derivatives%20notes/#delivery","text":"Most futures contracts don't result in the physical delivery of the underlying asset; they are typically closed out early. The potential for delivery, however, DOES influences futures prices . Delivery period: = Defined by the exchange and varies across contracts. - Investor A, holding the short position, decides when to deliver. - Investor A's broker issues a notice of intention to deliver to the exchange clearing house, specifying the number of contracts, delivery location, and grade (for commodities). Selection of delivery party - The exchange selects a long position holder to accept delivery. - Not necessarily the original counterparty (e.g. investor B); positions may have been closed out through multiple trades. - The notice is usually passed to the party with the oldest outstanding long position . Delivery process: - For commodities, taking delivery often involves accepting a warehouse receipt and immediate payment. - Costs associated with livestock care in livestock futures. - Financial futures are usually settled by wire transfer. - Price paid is typically the most recent settlement price, adjusted for grade and location if specified by the exchange. - The entire delivery process takes around two to three days. Critical Days: - First Notice Day: The first day for submitting a notice of intention to make delivery. - Last Notice Day: The last day for submitting such a notice. - Last Trading Day: Usually a few days before the last notice day. - Investors with long positions aim to close out contracts before the first notice day to avoid the risk of delivery. Cash Settlement: - Some financial futures, like stock index futures, are settled in cash due to the impracticality of delivering the underlying asset (e.g., a portfolio of 500 stocks for S&P 500 futures). - All outstanding contracts are closed on a predetermined day. - Final settlement price is set equal to the spot price of the underlying asset at the open or close of trading on that day.","title":"Delivery"},{"location":"Financial%20engineering/Derivatives%20notes/#types-of-trader-order","text":"","title":"Types of trader &amp; order"},{"location":"Financial%20engineering/Derivatives%20notes/#traders","text":"Commission merchant = trades on behalf of a client & charges a commission vs. Local trades on their own behalf Inidividual traders: hedgers speculators scalpers - very short terms, e.g. a few minutes day traders - less than 1 trading day position traders - longer arbitrageurs","title":"Traders"},{"location":"Financial%20engineering/Derivatives%20notes/#orders","text":"Market order = carry out trade immediately at best price available Limit order = specifies a specific price -> only execute at this or higher (if selling) or lower (if buying) to prevent loss/maximise profit Stop order = stop-loss order = slightly less favourable than market conditions - once limit is reached -> market order straight away e.g. market is currently 35, stop order at 30 -> once it decreases if it hits 30 sell straight away goal: close out a position if unfavourable price movements take place -> limit the possible amount of loss Stop-limit order = order becomes a limit order as soon as a bid/offer is made at a price =/< favourable than stop price [!quote] Example: stop-limit order * market is currently 25 * stop-order to buy = stop of 40, limit at 41 * the moment theres a bid/offer at 40 -> limit order (buy immediately as long as it's not above 41) [!quote] Example: a stop-limit order to sell at 20.30 with a limit of 20.10: = as soon as there is a bid at 20.30 the contract should be sold providing this can be done at 20.10 or a higher price. A market-if-touched order is executed at the best available price after a trade occurs at a specified price or at a price more favorable than the specified price. * In effect, an MIT becomes a market order once the specified price has been hit. * An MIT is also known as a board order . ==Comparing market if touched and stop order== Consider an investor who has a long position in a futures contract and is issuing instructions that would lead to closing out the contract. A stop order is designed to place a limit on the loss that can occur in the event of unfavorable price movements. By contrast, a market-if-touched order is designed to ensure that profits are taken if sufficiently favorable price movements occur. ==Examples== Stop order to sell at $2 = used by investors - order to sell at the best available price once a price of $2 or less is reached -> used to limit losses/protect gains from an existing long position if the market price falls to $2 or below, a market order to sell will be triggered Limit order to sell at $2 = order to sell at a price of $2 or more -> used to instruct a broker that a short position should be taken, providing it can be done at a price more favorable than $2 * you are instructing your broker to sell your asset at a price of $2 or more, but not at a lower price * used by traders who want to ensure that they only sell at a certain price or better","title":"Orders"},{"location":"Financial%20engineering/Derivatives%20notes/#forwards-vs-futures","text":"attribute forward futures private arrangement private traded on exchanges standardisation not standardised standardised specified delivery date usually one specified date range of delivery dates settlement at the end of the contract settled daily delivery or final cash settlement usually takes place usually closed out prior to maturity credit risk some credit risk virtually no credit risk price quotes same as spot: - same as future for big currencies: AUD, NZ, euro, pound = x US / FOR - other currencies: x FOR / US number of U.S. dollars per unit of the foreign ( x US / FOR ) ==Example== Investor A takes a long/buy position in a 90-day forward contract on \u00a31 million. The forward price is 1.6000 dollars per pound. Investor B takes a long position in 90-day futures contracts on \u00a31 million. The futures price is also 1.6000 dollars per pound. At the end of the 90 days, the exchange rate proves to be 1.7000. The result of this is that investors A and B each make a total gain equal to (1.7 - 1.6)*1,000,000 = 100,000 Investor A\u2019s gain is made entirely on the 90th day. Investor B\u2019s gain is realised day by day over the 90-day period. On some days investor B may realize a loss, whereas on other days he or she will realise a gain. [!NOTE] FORWARDS = 1 LUMP SUM, FUTURES = MARKED TO MARKET DAILY","title":"Forwards vs futures"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-5-determining-forward-and-future-prices","text":"","title":"Chapter 5. Determining forward and future prices"},{"location":"Financial%20engineering/Derivatives%20notes/#1-investment-vs-consumption-assets","text":"Investment assets = held for investment by a significant number of investors Consumption assets = held primarily for consumption and not usually for investment purposes We CAN use arbitrage arguments to determine the forward and futures prices of an INVESTMENT asset from its spot price and other observable market variables. We CANNOT do this for CONSUMPTION assets.","title":"1. INVESTMENT vs CONSUMPTION assets"},{"location":"Financial%20engineering/Derivatives%20notes/#2-short-selling","text":"Shorting is the act of selling an asset that the investor does not currently own. Aka. Selling borrowed assets with the hope of profitting from a decline in their price . 1. The investor instructs a broker to short a specific quantity of shares, for instance, 500 shares of company X. 2. The broker borrows the specified shares from an owner and sells them in the market . This action is executed in the same manner as a regular market sale. 3. At a later stage, the investor closes the short position by buying back the same quantity of shares in the market. These purchased shares replace the borrowed ones, thus closing the short position. The investor profits if the stock price declines and incurs a loss if it rises. If the broker has to return the borrowed shares and none are available, the investor must close the position, even if they aren't ready to do so. Lending fees may also be charged for shorting. An investor with a short position is obligated to pay the broker any income, such as dividends or interest, that would typically be received on the shorted securities. [!warning] Net gain from shorting * investor shorts 500 shares in April at $120 per share * closes the position in July at $100 per share * Net gain = * 500*120 = 60000 inflow in April - CF from selling * 500 inflow in May - dividends * 500*100 = 50000 outflow in July - CF from buying the shares back An investor is required to maintain a margin account with the broker This account, consisting of cash or marketable securities, serves as a guarantee that the investor won't abandon the short position if the share price increases. An initial margin is necessary, and additional margin may be required in the event of adverse price movements. The margin account, which earns interest , should NOT represent a cost to the investor, as it can be covered by the proceeds of the asset sale.","title":"2. Short selling"},{"location":"Financial%20engineering/Derivatives%20notes/#3-assumptions","text":"No Transactions Costs: Market participants are assumed to face no transactions costs when engaging in trades. This simplifies our analysis and allows us to focus on the core principles of forward and futures contracts. Uniform Tax Rate: Participants are subject to the same tax rate on all net trading profits. This assumption streamlines our considerations, assuming a consistent tax environment across market participants. Equal Borrowing and Lending Rates: Participants can borrow and lend money at the same risk-free rate of interest. This simplifying assumption ensures a level playing field for market participants in terms of financing their trading activities. Arbitrage Opportunities: Participants actively take advantage of arbitrage opportunities as they arise in the market. This assumption reflects the proactive nature of key market participants, particularly large derivatives dealers, in exploiting profitable discrepancies. Notation - T: Time until delivery date in a forward or futures contract, measured in years. - S0: Current price of the asset underlying the forward or futures contract. - F0: Current forward or futures price. - r: Zero-coupon risk-free rate of interest per annum, expressed with continuous compounding, applicable to an investment maturing at the delivery date (T years in the future). * the rate at which money is borrowed or lent with certainty of repayment, excluding credit risk. * Traditionally, financial institutions have used LIBOR as a proxy for the risk-free rate. However, events during the credit crisis starting in 2007 prompted a search for alternative indicators.","title":"3. Assumptions"},{"location":"Financial%20engineering/Derivatives%20notes/#4-forward-price-valuation-investment-assets-only","text":"","title":"4. FORWARD PRICE valuation (investment assets only)"},{"location":"Financial%20engineering/Derivatives%20notes/#case-1-no-income-generating-assets","text":"Given: forward contract on INVESTMENT ASSET price = P0 no income time to contract delivery = T risk free rate = r forward price = F0 [!warning] Forward and spot price formula - NO INCOME F = S . e^(rT) Forward price = Spot price . e^(risk free rate . time to delivery of f/f contract) All units = in year ==Example== spot price = 40, rfr = 5% If F > Se(rt) -> arbitrageurs can buy the asset and short forward contracts TIME 0: arbitrageur borrows $40 at 5% interest -> buy 1 share -> shorts/sells a forward contract to sell that 1 share in 3 months TIME M: upon contract maturity -> arb delivers the share -> receives $43 -> use 40.5 to repay loan => PROFIT = 2.5 (in 43 out 40.5) If F < Se(rt) -> arbitrageurs can short the asset and enter into long forward contracts * TIME 0: abg shorts/sells 1 share -> gain proceed -> invest this proceed at 5% for 3 months -> takes a long position / buy a 3 month forward contract * TIME M: the proceed invested grows to 40.5 in 3 months -> contract matures, abg pays 39 for the share -> close position * => PROFIT = 1.5 (in 40.5 out 39) ![[Pasted image 20240125010759.png]] Under what circumstances do arbitrage opportunities such as those in Table 5.2 not exist? The first arbitrage works when the forward price is greater than $40.50 The second arbitrage works when the forward price is less than $40.50 => We deduce that, for there to be no arbitrage, the forward price must be exactly $40.50 The thing is, given the info in the example, F = 40 . e^(0.05 . 0.25) = 40.50 [!quote] 4-month forward contract to buy a zero-coupon bond that will mature 1 year from today. (This means that the bond will have 8 months to go when the forward contract matures!); current price = $930; 4-month risk-free rate of interest (continuously compounded) is 6% PA. Forward price = 930 . e^(6% . 4/12) = 948.79 Even if short sales are not universally possible for all investment assets, it doesn't impede the derivation of equation F = S... The ability to short the asset is not essential What matters is the presence of a significant number of investors holding the asset purely for investment. If the forward price is too low, they will find it attractive to sell the asset and take a long position/buy in a forward contract The adjustment of forward prices ensures the absence of arbitrage opportunities.","title":"Case 1. No income generating assets"},{"location":"Financial%20engineering/Derivatives%20notes/#case-2-income-generating-assets-known-cash-income","text":"[!warning] Forward and spot price formula - KNOWN INTEREST INCOME PAYMENTS F = (S - I) . e^(rT) Forward price = (Spot price - PV of income) . e^(risk free rate . time to delivery of f/f contract) All units = in year spot price current = 900 9 month maturity expected coupon payment of 40 after 4 months contnsly compounded rfr of 3% for 4 months, 4% for 9 months pa If F > (S - I) . e^(rT) -> arbitrageurs can buy the asset and short forward contracts - Action now: - Borrow $900 from 2 sources: $39.60 for 4 months and $860.40 for 9 months - Buy 1 unit of the asset and enter into a forward contract to sell it in 9 months for $910 - Action in 4 months: - Receive $40 of income on the asset - Use $40 to repay the first loan with interest - Action in 9 months: - Sell the asset for $910 - Use $886.60 to repay the second loan with interest - Close the short position - Profit: $23.40 If F < (S - I) . e^(rT) -> arbitrageurs can short the asset and enter into long forward contracts - Action now: - Short 1 unit of the asset to realize $900 - Invest $39.60 for 4 months and invest $860.40 for 9 months - Enter into a forward contract to buy the asset in 9 months for $870 - Action in 4 months: - Receive $40 from the 4-month investment - Pay income of $40 on the asset - Action in 9 months: - Receive $886.60 from the 9-month investment - Buy the asset for $870 - Close the short position - Profit: $16.60 [!quote] Forward price = [ 900 - 40.e^(-3% . 4/12) ] . e^(4% . 9/12) = 948.79 ![[Pasted image 20240125012726.png]] If the forward price is greater than $886.60, the arbitrageur can execute the first strategy (buying the bond, shorting a forward contract) and make a profit. If the forward price is less than $886.60, the arbitrageur can execute the second strategy (shorting the bond, entering into a long forward contract) and make a profit. => If there are no arbitrage opportunities, both strategies should not result in a profit. Therefore, the forward price must be precisely $886.60 to eliminate any possibility of arbitrage profits, ensuring equilibrium in the market. [!quote] Consider a 10-month forward contract on a $50 stock; assume a continuously compounded 8% risk-free interest rate for all maturities, and anticipate $0.75 dividends per share at three, six, and nine months. Find F. PV of income/dividend = I = $0.75 . e^(-8% . 3/12) + $0.75 . e^(-8% . 6/12) + $0.75 . e^(-8% . 9/12) = 2.162 Forward price = (50 - 2.162) . e^(8% . 10/12) = 51.14 => If the forward price were less than this, an arbitrageur would short the stock spot and buy forward contracts. => If the forward price were greater than this, an arbitrageur would short forward contracts and buy the stock in the spot market.","title":"Case 2. Income generating assets - known cash income"},{"location":"Financial%20engineering/Derivatives%20notes/#case-3-income-generating-assets-known-yield","text":"Known dividends yield = dividends per year as a percentage of the stock price at the time when dividends are paid are known We now consider the situation where the asset underlying a forward contract provides a known yield rather than a known cash income. This means that the income is known when expressed as a percent of the asset\u2019s price at the time the income is paid . [!warning] Forward and spot price formula - KNOWN YIELD F = S . e^[(r-q)T] Forward price = Spot price . e^[(rfr - avg yield pa) . time to delivery of f/f contract] All units = in year [!quote] S = 25, r = 10%, T = 6 months, yield = 4% pa WITH SEMIANNUAL COMPOUNDING - Calculate the yield, q = 0.0396 (from 4% per annum with semiannual compounding) - F = 25 e^[(10% - 0.0396) . 6/12] = $25.77 => If the forward price is less than this, arbitrageurs would short the stock spot and buy forward contracts. => If the forward price is greater than this, arbitrageurs would short forward contracts and buy the stock in the spot market. [!warning] Converting yield pa: semiannual/annual compounding -> continuous compounding Let n be the frequency of compounding per year CONTINUOUS RATE = n . ln(1 + GIVEN RATE / n) Yield is 4% pa semiannual compounding -> 0.04/2 = 0.02 -> 0.02 + 1 = 1.02 -> ln(1.02) = 0.01980 -> ln(1.02) x 2 = 0.0396 = 3.96%","title":"Case 3. Income generating assets - known yield"},{"location":"Financial%20engineering/Derivatives%20notes/#5-forward-contracts-valuation","text":"When a forward contract is initiated, its value is zero . Banks are required to value forward contracts in their trading books daily . [!warning] Value of LONG (BUY) forward contract today f f = (F - K) . e^(-r . T) * forward contract value = 0 initially * as time passes, both F and f change * K = delivery price [!warning] Value of SHORT (SELL) forward contract today f f = (K - F) . e^(-r . T) ==example== Long future contract (promise to BUY) on a 0 dividend stock. 6 months to maturity rfr = 10% pe, continuously compounding stock price is 25 (S0) delivery price 24 (K) Find value of forward contract price F = S . e^(rT) = 25 . e^(0.1 * 6/12) = 26.28 Value of forward contract = f = (26.28 - 24) . e^(-0.1 * 6/12) = 2.17 Summary: valuation of f/f prices & contracts ![[Pasted image 20240114041907.png]]","title":"5. FORWARD CONTRACTS valuation"},{"location":"Financial%20engineering/Derivatives%20notes/#6-forwards-futures-prices","text":"In theory, when there's no uncertainty about future interest rates , the forward price for a contract with a certain delivery date = the futures price for a contract with that delivery date. However, in the real world where interest rates vary unpredictably, this theoretical equality breaks down. Relationship btwn asset price, interest rates and contract types 1. When the price (S) of the underlying asset is strongly positively correlated with interest rates: - Increase in S -> immediate gain for a long futures position. - Positive correlation likely -> simultaneous increase in interest rates. - The gain is invested at a higher-than-average interest rate. - Decrease in S -> immediate loss, but the financing is at a lower-than-average interest rate. - Investors with long forward contracts are not affected by these interest rate movements. - => Long futures contracts are slightly more attractive than similar long forward contracts. - => Hence, futures prices tend to be slightly > forward prices. When S is strongly negatively correlated with interest rates: Similar argument shows that forward prices will tend to be slightly > futures prices. Theoretical differences between forward and futures prices for short-term contracts are generally negligible . Practical factors, such as taxes, transaction costs, and margin account usage, can cause variations in forward and futures prices not accounted for in theoretical models. The risk of counterparty default may be lower in futures contracts due to the involvement of exchange clearinghouses. Futures contracts may be more liquid and easier to trade than forward contracts in certain cases. => Despite potential differences, it is generally reasonable to assume that forward and futures prices are the same for most practical purposes.","title":"6. Forwards = futures prices ?"},{"location":"Financial%20engineering/Derivatives%20notes/#7-stock-indices-ff-contracts","text":"A stock index can usually be regarded as the price of an investment asset that pays dividends. The investment asset is the portfolio of stocks underlying the index, and the dividends paid by the investment asset are the dividends that would be received by the holder of this portfolio. It is usually assumed that the dividends provide a known yield rather than a known cash income. ==example== 3 month (0.23), dividend yield = 0.01 pa (so q = 0.01), current value of index = 1300, r = 0.05 -> Future price = 1300 * e^(0.05 - 0.01) * 0.25 = 1313.07 Index arbitrage - If F > Se^(r-q)T, buy spot stocks and short futures contracts. - If F < Se^(r-q)T, short/sell spot stocks and take a long position in futures contracts.","title":"7. Stock indices: f/f contracts"},{"location":"Financial%20engineering/Derivatives%20notes/#7-currencies-ff-contracts","text":"Property of foreign currency = holder of the currency can earn interest at rfr prevailing in the FOREIGN country -> let the rfr in foreign country be rf (domestic = r) [!warning] Price of f/f contract involving foreign currencies F = S . e ^ (r - rf)T Also known as the interest rate parity relationship from International Finance Say I have 1000 units of foreign currency. I need it to domestic currency by time T. There r 2 strategies to convert that 1000 amount to my currency. ![[Pasted image 20240127001443.png]] Method 1 (invest 1000 foreign -> sell proceed in future to gain domestic) Invest in foreign currency for T years at the foreign risk-free rate (rf) -> enter a forward contract to SELL the proceeds for dollars at time T -> gain 1000.F.e^(rf * T) Method 2 (invest 1000 foreign -> sell proceed in future to gain domestic Exchange foreign currency for domestic in the spot market -> invest the proceeds for T years at the domestic rfr (r) -> gain 1000. S.e^(r * T) dollars => In the absence of arbitrage opportunities, the 2 methods should yield the exact same results ![[Pasted image 20240127003145.png]] Calculation [!warning] Calculate forward rate given xc rate & interest rates Forward rate = exchange rate . e ^ [(rfr local - rfr foreign)*time] [!quote] Example - forward rate An exchange rate is 0.7000 and the six-month domestic and foreign risk-free interest rates are 5% and 7% (both expressed with continuous compounding). What is the six-month forward rate? %%0.6930%% Essentially it's an investment asset with a known yield [!quote] 2 year interest rates: 5% AUS and 7% US, spot xc rate: 1 AUD = 0.62 US. -> 2-year forward exchange rate = 0.62 . e [(0.07 - 0.05) x 2] = 0.6453 Scenario 1: 2 year frwrd rate = 0.63 (aka 1 AUD = 0.62 instead of 0.64 US). Arbitrageur can: 1. T0: Borrow 1000 foreign (AUD) at 5% pa interest (AUS rate) for 2 years 2. T0: Convert that borrowed AUD to US at spot xc rate = have 620 USD 3. T0: Invest US 620 at 7% -> will grow to 620 . e^(7% . 2) = 713.17 USD 4. T0: Enter a forward contract to by 1105.17 AUD to pay back (calc in part 5 - 1105.17 AUD equals exactly 696.26 USD) 5. T1: Now paying back the 1000 AUD borrowed: amount after interest = 1000 * e^(0.05 * 2) = 1105.17. To pay this back we'll use the amount from the f contract 6. T1: Net gain = 713.17 USD - 696.26 USD = 16.9 USD Scenario 2: 2 year frwrd rate = 0.66 (aka 1 AUD = 0.66 instead of 0.64 US). Arbitrageur can: 1. T0: Borrow 1000 US at 7% pa (USD rate) for 2 years 2. T0: Convert to AUD using spot: 1000 / 0.62 = 1612.90 AUD 3. T0: Invest this AUD at AUD interest rate 5% pa for 2 years. Proceed from AUD investment will = 1782.53 AUD. 4. T0: Enter f/f contract to sell the investment proceed in AUD later for US. Know 4 sure we will receive 1782.53 * 0.66 = 1176.47 US 6. T1: Paying back the US borrowed: 1000 US has turned into 1000 . e(0.07 * 2) = 1150.27 US. We would need USD from the forward contract entered earlier. Proceed from f contract: 1176.47 7. Net gain: -1150.27 (debt) + 1176.47 (gain from f contract) = 26.20 Both strategies above -> RISKLESS PROFITS [!warning] Value of investment - continuous compounding Future amount = Principal . e^(pa interest rate * time in years) [!warning] Estimating interest rate differentials from table Look at one country & its 2 'Prior settlement price' at 2 different times. * e.g. Australia September vs December: 1.0075 -> 1.0000 * % change = 1/1.0075 = 0.744% LOWER => Short term futures prices are DECREASING at a rate of 0.744% / 3 months = 0.744 / 3 * 12 = 2.976% per year. => This is also the amount by which short term Aus interest rates > short term US interest rates ![[Pasted image 20240202003335.png]] Futures quotes table ![[Pasted image 20240127003549.png]]","title":"7. Currencies: f/f contracts"},{"location":"Financial%20engineering/Derivatives%20notes/#8-commodities-ff-contracts","text":"Gold owners, like central banks, charge an interest rate known as the gold lease rate when they lend out gold. Same goes for silver. So, holding onto gold and silver can actually bring in some income. Income and storage costs - Consumption assets may lack income but have significant storage costs. - Storage costs = similar to negative income [!warning] Forward price of investment commodity Without income & storage costs: F = S . e^(rT) With storage costs U (U = PV of all storage costs): F = (S + U) . e^(rT) If U = proportional to price of commodity -> treated as negative yield: F = S.e^[(r+u)T] * u = storage cost per annum = proportion of spot price net of any yield earnt [!quote] Arbitrage opportunity Scenario 1: F > (S + U).e^(rT) . Arbitrageur can: * borrow S + U at rfr -> use it to buy 1 unit of commodity & pay storage costs * short / sell a futures contract on that 1 unit of commodity => profit = F - (S+U).e^(rT) However, as arbitrageurs do so, there will be a tendency for S0 to increase and F0 to decrease until equation above is no longer true. We conclude that equation cannot hold for any significant length of time. [!quote] Arbitrage opportunity Scenario 2: F < (S + U).e^(rT) . Arbitrageur can: * sell commodity -> save storage costs -> invest proceeds at rfr * long/buy a futures contract => riskless profit = (S+U).e^(rT) - F Similarly, equation cannot hold for any significant length of time. This argument cannot be used for commodities that are not, to any significant extent, held for investment. Individuals and companies who keep such a commodity in inventory do so because of its consumption value, not because of its value as an investment. They are reluctant to sell the commodity in the spot market and buy futures or forward contracts, because futures and forward contracts cannot be used in a manufacturing process or consumed in some other way. Thus: ![[Pasted image 20240202012224.png]] [!warning] Calculating U - pv of storage costs U = storage costs per annum . e ^ (-rfr . T) [!quote] Gold futures price - f/f price of a commodity 1 year futures contract, no income, coss 2$ per ounce pa to store gold, pmt made at the end of the year. Spot S = 1600, rfr r = 5% pa. Thus T = 1 (1 year) 1. U = pv of all storage costs = discount cost at rfr U = $2 . e^(-5% x 1) = 1.9 2. Futures price - theoretical F = (1600 + 1.9) . e ^ (5% x 1) = 1684.03 Suppose the actual gold futures price (F) differs from the theoretical one above. Scenario 1. F actual > F theoretical, F = 1700 . Arbitrageur can: * Borrow 160k at rfr of 5% to buy 100 ounces of gold * Short/Sell 1 gold futures contract for delivery in 1 year * ensures that gold can be sold for 170k Convenience yield = the benefits or advantages an investor receives from holding a physical asset, like a commodity or stock, rather than a futures contract. It reflects market expectations on future commodity availability. * is always positive or 0 because it represents the non-monetary benefits of owning the physical asset, such as having access to the asset when it's needed. * For investment assets, convenience yield must be zero to avoid arbitrage opportunities. * Greater likelihood of shortages increases the convenience yield, while high inventories lead to a lower convenience yield.","title":"8. Commodities: f/f contracts"},{"location":"Financial%20engineering/Derivatives%20notes/#9-cost-of-carry","text":"The concept of cost of carry is sometimes useful. Cost of carry = the storage cost of the underlying asset plus the cost of financing it minus the income received from it. Investment assets: the futures price is greater than the spot price by an amount reflecting the cost of carry c. ![[Pasted image 20240202195730.png]] Consumption assets: the futures price is greater than the spot price by an amount reflecting the cost of carry net of the convenience yield c - y. ![[Pasted image 20240202195746.png]] [!NOTE] Relationships * As the convenience yield increases -> one-year futures price as a percentage of the spot price decreases * As inventories of a commodity decline -> one-year futures price as a percentage of the spot price decreases","title":"9. Cost of carry"},{"location":"Financial%20engineering/Derivatives%20notes/#10-delivery-options","text":"In contrast to forward contracts, futures contracts often provide flexibility in the delivery period for the party with the short position. The short position holder can choose to deliver at any time during a specified period, usually with a few days' notice. Determining futures prices becomes complicated due to the flexibility in delivery timing. The maturity of futures contracts raises the question of whether it should be assumed at the beginning, middle, or end of the delivery period. Understanding when delivery would have occurred is crucial for calculating theoretical futures prices. If the futures price increases with time to maturity, it is optimal for the short position holder to deliver early, as interest earned on the cash received outweighs holding the asset. In such cases, futures prices are typically calculated based on the assumption of delivery at the beginning of the delivery period. Conversely, if futures prices decrease as time to maturity increases, it is usually optimal for the short position holder to deliver as late as possible. In these circumstances, futures prices should generally be calculated assuming delivery at the end of the delivery period.","title":"10. Delivery options"},{"location":"Financial%20engineering/Derivatives%20notes/#11-futures-price-expected-spot-prices","text":"expected spot price = market's average opinion on an asset's spot price at a future time - Futures prices converge to spot prices at maturity, prompting an analysis of the relationship between expected spot prices and futures prices. Keynes and Hicks' Argument - Keynes and Hicks proposed that if hedgers hold short positions and speculators hold long positions , the futures price will < expected spot price . - This is based on the idea that speculators demand compensation for the risks they bear. Modern approach - risk and return - The modern approach links futures prices to expected spot prices based on the relationship between risk and expected return in the economy. - Systematic and nonsystematic risks are considered, with SYSTEMATIC risk influencing the required expected return on an investment. - The investment is essentially in the asset underlying the futures contract. - If returns from this asset are uncorrelated with the stock market, the correct discount rate is the risk-free rate (r), so k = r. [!NOTE] CF to speculator - Consider: a speculator taking a long (buy) position in a futures contract lasting T years. - Objective: Speculator hopes the spot price of the asset will be above the futures price at the contract's end. - Ignoring daily settlement, treating the futures contract as a forward contract. - Speculator puts the present value of the futures price into a risk-free investment while simultaneously taking a long futures position. - Cash flows to the speculator: - Today: F. e^(rT) - End of Futures Contract: S(T) (where F0 is the current futures price, ST is the asset price at time T, and r is the risk-free return for time T) Relationship between futures price and expected future spot price - When returns are uncorrelated with the stock market, the futures price is considered an unbiased estimate of the expected future spot price. - Systematic risk: * Positive correlation will tend to lead to a futures price lower than the expected future spot price. * Negative correlation will tend to lead to a futures price higher than the expected future spot price. * Only when the correlation is zero will the theoretical futures price be equal to the expected future spot price. ![[Pasted image 20240202200720.png]] Normal backwardation and contango Normal backwardation = when the futures price < expected future spot price. Contango = futures price > expected future spot price. - Note: These terms can also refer to the relationship between futures prices and current spot prices in certain contexts. If we assume the capital asset pricing model is true, the relationship between the futures price and the expected future spot price depends on whether the return on the asset is positively or negatively correlated with the return on the stock market.","title":"11. Futures price &amp; expected spot prices"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-9-options-markets-skipped","text":"","title":"Chapter 9. Options markets (skipped)"},{"location":"Financial%20engineering/Derivatives%20notes/#basics-of-options","text":"There are 2 types of options: calls and puts. A call option gives the holder the right to buy the underlying asset for a certain price by a certain date. A put option gives the holder the right to sell the underlying asset by a certain date for a certain price. There are 4 possible positions in options markets: a long position in a call a short position in a call a long position in a put a short position in a put. Taking a short position in an option is known as writing it. [!NOTE] Terminology At the money : the market is trading near the strike price In the money : the option is profitable Deep in the money : the option is very profitable Out of the money : the option is in a loss making situation (for the buyer)","title":"Basics of options"},{"location":"Financial%20engineering/Derivatives%20notes/#options-exchange","text":"An exchange must specify the terms of the option contracts it trades. In particular, it must specify the size of the contract, the precise expiration time, and the strike price. In the United States one stock option contract gives the holder the right to buy or sell 100 shares. The expiration of a stock option contract is 10:59 p.m. Central Time on the Saturday immediately following the third Friday of the expiration month. Options with several different expiration months trade at any given time. Strike prices are at $2:5, $5, or $10 intervals, depending on the stock price. The strike price is generally fairly close to the stock price when trading in an option begins. The terms of a stock option are not normally adjusted for cash dividends. However, they are adjusted for stock dividends, stock splits, and rights issues. The aim of the adjustment is to keep the positions of both the writer and the buyer of a contract unchanged.","title":"Options exchange"},{"location":"Financial%20engineering/Derivatives%20notes/#participants","text":"Most options exchanges use market makers. These are individuals who are prepared to quote both a bid price (at which they are prepared to buy) and an offer price (at which they are prepared to sell). Market makers improve the liquidity of the market and ensure that there is never any delay in executing market orders. They themselves make a profit from the difference between their bid and offer prices (known as their bid\u2013offer spread). The exchange has rules specifying upper limits for the bid\u2013offer spread. Writers of options have potential liabilities and are required to maintain margin with their brokers. If it is not a member of the Options Clearing Corporation, the broker will maintain a margin account with a firm that is a member. This firm will in turn maintain a margin account with the Options Clearing Corporation. The Options Clearing Corporation is responsible for keeping a record of all outstanding contracts, handling exercise orders, and so on. Not all options are traded on exchanges. Many options are traded by phone in the over-the-counter market. An advantage of over-the-counter options is that they can be tailored by a financial institution to meet the particular needs of a corporate treasurer or fund manager [!example] ![[Pasted image 20240425001923.png]]","title":"Participants"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-10-proporties-of-stock-options","text":"","title":"Chapter 10. Proporties of stock options"},{"location":"Financial%20engineering/Derivatives%20notes/#determinants-of-option-value","text":"There are 6 factors affecting the value of a stock option the current stock price S0 the strike price K the time to expiration T the stock price volatility \u03c3 the risk-free interest rate r the dividends expected during the life of the option Variable European Call European Put American Call American Put Current stock price + - + - Strike price - + - + Time to expiration ? ? + + Volatility + + + + Risk-free rate + - + - Dividends - + - +","title":"Determinants of option value"},{"location":"Financial%20engineering/Derivatives%20notes/#stock-price","text":"Call more valuable/expensive as: current price \u2191, strike price \u2193 (LHS) * if exercised -> payoff will be current price - strike price Put more valuable/expensive as: current price \u2193, strike price \u2191 (RHS) * if exercised -> payoff will be strike price - current price ![[Pasted image 20240203181805.png]]","title":"Stock price"},{"location":"Financial%20engineering/Derivatives%20notes/#time-to-expiration","text":"Good for both puts and calls; more valuable/expensive if time to maturity \u2191 (or at least X decrease in value) * E.g. Longer-life option has all the exercise opportunities open to shorter-life option\u2014and more. The long-life option must therefore always be worth at least as much as the short-life option. ![[Pasted image 20240203185451.png]] However the above is only true if ceteris paribus holds. ==Example== Consider 2 European call (buy) options on a stock: one with an expiration date in 1 month, the other with an expiration date in 2 months. Suppose that a very large dividend is expected in 1.5 months. The dividend will cause the stock price to \u2193, so that the short-life option could be worth more than the long-life option.","title":"Time to expiration"},{"location":"Financial%20engineering/Derivatives%20notes/#dividends","text":"Good for puts, bad for calls * Dividends have the effect of reducing the stock price on the ex-dividend date. * You alr get dividend money so price ex-dividend (after dividend) date will be lower","title":"Dividends"},{"location":"Financial%20engineering/Derivatives%20notes/#volatility","text":"![[Pasted image 20240203185519.png]] Volatility is good for both put and call holders since they have limited downside risks - they can choose simply to not exercise * As volatility increases, the chance that the stock will do very well or very poorly increases","title":"Volatility"},{"location":"Financial%20engineering/Derivatives%20notes/#risk-free-rate","text":"Good for call, bad for put (contrast with dividends) As interest rates in economy (rfr) \u2191 investors expected return required also \u2191 PV of any future CF received by option HOLDERS \u2193 => Combined effects: good for calls, bad for puts ![[Pasted image 20240203185537.png]] Note: only applicable if ceteris paribus holds. In practice: when interest rate (rfr) \u2193, stock prices ALSO tend to \u2193 (and vice versa) interest rate \u2191 -> stock price \u2191; combined can => bad for call, good for put interest rate \u2193 -> stock price \u2193; combined can => good for call, bad for put","title":"Risk free rate"},{"location":"Financial%20engineering/Derivatives%20notes/#assumptions","text":"There are no transactions costs All trading profits (net of trading losses) are subject to the same tax rate Borrowing and lending are possible at the risk-free interest rate Market participants are prepared to take advantage of arbitrage opportunities as they arise Notation (American = upper case, European = lower case) Symbol Description S(0) Current stock price K Strike price of option T Time to expiration of option S(T) Stock price on the expiration date r Continuously compounded risk-free rate of interest C Value of American call option to buy one share P Value of American put option to sell one share c Value of European call option to buy one share p Value of European put option to sell one share Interest rate r is NOMINAL, not real. It's > 0 (otherwise a risk free investment would be pretty much the same as cash)","title":"Assumptions"},{"location":"Financial%20engineering/Derivatives%20notes/#upper-and-lower-bounds-for-option-prices","text":"If an option price > upper bound or < lower bound, there are profitable opportunities for arbitrageurs.","title":"Upper and lower bounds for option prices"},{"location":"Financial%20engineering/Derivatives%20notes/#upper-bound","text":"Call options (promise to buy - profit if it later goes up cos u bought it at cheaper price) * option price is never higher than stock price (if higher then can simply not exercise) Put options (profit if later it goes down) * US: holder can sell stock for K * option price is never higher than strike price (aka K is the max profit so why pay more than K for the option) * European: at maturity option cannot worth > K (same as above) * it follows that it cannot be worth more than the PV of K today (PV of K < K) [!warning] Upper bounds of calls and puts for holders Call: C \u2264 S(0) | c \u2264 S(0) * If X true -> arbitrage: buy the stock, sell the call option Put: P \u2264 K | p \u2264 Ke^(-rT) * If X true -> arbitrage: writing/sell the option, invest proceeds of the sale at rfr","title":"Upper bound"},{"location":"Financial%20engineering/Derivatives%20notes/#lower-bounds-non-dividend-paying","text":"Call option [!quote] [FULL EXAMPLE WITH EXPLANATION] Euro call (option to buy), non dividend, strike price = 18\\$, expire in 1 year (T), cost 3$. Stock price = 20, rfr = 10% pa. Action now * Buy call option (-3) (only exercise if strike < spot) * Short/sell the stock (+20) * Invest that 17 for 1 year Action at maturity * That 17 invested will turn into 17 x e^(0.1) = (+18.79) * If spot S(T) > strike * exercise option to buy stock for strike of 18 (-18) * now that the stock is in my hands -> deliver it to close out the short position (gaining 20 as alr written above) * net profit = +18.79 - 18 = 0.79 * If spot S(T) < strike of 18: * do NOT exercise option (cos would buy it for higher than market price), accept the 3$ loss from the option expiring worthlessly * buy the stock at spot market price (-S(T)) * deliver the stock to close out the short position (+20 above, alr written) * net profit = +18.79 - S(T) (since ST is < strike of 18 -> we know that profit > 0.79) [!warning] The 0.79 above is called the lower bound for the price of a European call option. ![[Pasted image 20240204164909.png]] [!quote] [SHORT EXAMPLE - APPLYING THE FORMULA] European call, non dividend, stock price S0 = 51, strike K = 50, T = 0.5 years, rfr = 12% pa. Lowerbound = S0 - K.e(-rT) = 51 - 50.e^(-0.12*0.5) = 3.91 Put option [!quote] European put, non-dividend, strike K = 40, T = 0.5, cost = 1, stock price S0 = 37, rfr = 5% pa. Action now * Borrow (31 + 1) = 38 at market rfr for 6 months (+38) * Buy put option for 1 - option to sell stock (-1) (exercise if spot S0 < strike K) * Buy the stock at market spot for 37 (-37) Action at maturity * Paying back the amount borrowed -> 38.96 including interest (-38.96) . Where to get the funds: * If spot ST < strike K: * exercise put option, take the stock that I bought and sell it at strike (+40) * net profit = -38.96 + 40 = +1.04 * If spot ST > strike K: * don't exercise put * instead of selling the stock through the put option, sell it at market spot rate (+ST) * net profit = -38.96 + ST (since ST > 40, we know profit > 1.04) [!warning] The 1.04 above is called the lower bound for the price of a European put option. ![[Pasted image 20240204212630.png]] [!quote] European call, S0 = 38, T = 0.25, rfr = 0.10, K = 40 Lower bound = 40 . e^(-0.10*0.25) - 38 = 1.01 Call No dividend ![[Pasted image 20240216164152.png]] Yes dividend (D = PV of dividend) ![[Pasted image 20240216181106.png]] Put No dividend ![[Pasted image 20240216164119.png]] Yes dividend ![[Pasted image 20240216181150.png]] If the above are violated -> arbitrage","title":"Lower bounds (non-dividend paying)"},{"location":"Financial%20engineering/Derivatives%20notes/#put-call-parity","text":"^1e885b Put\u2013call parity is a relationship between the price, c, of a European call option on a stock and the price, p, of a European put option on a stock. * ensures that identical portfolios have the same value today * if put-call parity does not hold -> arbitrage opportunity. Ok setting the scene. We've got: A call option - betting on the stock's price going up . If the stock performs well, you benefit from both the call option's potential profits ==(good if go up)== A put option - provides a safeguard against the stock's price dropping. If the stock performs poorly, the put option allows you to sell the stock at the agreed-upon price, minimising losses ==(not bad if go down)== Bond - guarantee a specific amount K at option's expiration date, even if stock performs poorly or call is not exercised ==(not bad if go down)== Stock - same as call, bets on the stock price going up ==(good if go up)== We're gonna create 2 portfolios, pick 2 securities for each that help achieve a 'balance': PORTFOLIO 1: Call (maximise profit) & bond ( minimise loss) PORTFOLIO 2: Stock (maximise profit) & put ( minimise loss) At time of maturity T: ![[Pasted image 20240206035058.png]] If spot S > strike K (good for call, bad for put): PORTFOLIO 1 call : exercised, brings in S less the strike K (S - K) bond : pays K no matter what when matured (+ K) Net: S - K + K = S PORTFOLIO 2 put : expires worthless (0) (ignore the premium) share : pays S no matter what when matured (+ S) Net: 0 + S = S If spot S < strike K (good for put, bad for call): PORTFOLIO 1 call : expires worthless (0) bond : pays K no matter what when matured (+ K) Net: K PORTFOLIO 2 put : exercised, brings in strike less the spot at which you bought the share (K - S) ==technically, you don't buy the share, usu you enter the put without having an actual share, then whne it matures, you buy it at the market spot rate, hence the - S== share : pays S no matter what when matured (+ S) Net: K - S + S = K Portfolio 1 and portfolio 2 must be equal in both scenarios (K>S and S>K) Current values/prices (all converted to PV): call: c bond: Ke^(e-rT) == basically K but PV == + D (if dividend) put: p share: S [!warning] Put call parity for stock WITHOUT DIVIDENDs ![[Pasted image 20240205185528.png]] WITH DIVIDENDs ![[Pasted image 20240205185412.png]] ![[Pasted image 20240425001946.png]] [!warning] Arbitrage opportunities when put\u2013call parity does not hold. Stock price = $31; interest rate = 10%; call price = $3. Both put and call have strike price of $30 and three months to maturity (0.25) Case 1. Put price p = 2.25 Put call parity LHS (portfolio 1): c + Ke-rT = 3 + 30.e^(-0.1*3/12) = 32.26 Put call parity RHS (portfolio 2): p + S = 2.25 + 31 = 33.25 => Portfolio 2 (RHS) is overpriced => Arbitrage strategy: BUY PORTFOLIO 1 (underpriced), SELL PORTFOLIO 2 (overpriced) At T0 Buy call (-3) Short/Sell put (+2.25) Short/Sell share (+31) Invest the profits from above (-3 + 2.25 + 31) for 3 months (-30.25) At T1: if spot ST > strike price of 30: exercise call, able to buy the share at 30 (-30) put holder (the other person) will let it expire worthlessly deliver the share that we short sold (we alr received the $ above) investment from above is now worth: (+31.02) => Net profit: 1.02 if spot ST < strike price of 30: prices go down, put holder will exercise -> we must buy share at 30 (-30) our call expires worthlessly investment from above is now worth: (+31.02) => Net profit: 1.02 Case 2. Put price p = 1 Put call parity LHS: 32.26 RHS: 1 + 31 = 32 => portfolio 2 is underpriced Arbitrage strategy: BUY PORTFOLIO 2, SELL PORTFOLIO 1 (buy put & share, sell call) * At T0: * Buy put (-1) * Buy share (-31) * Short/sell call (+3) * Funds for all the above: borrow 29 (+29) * At T1 * If spot St > strike price of 30: * prices go up, let put expires worthlessly * call holder will exercise -> we must deliver the share (+30) * pay back the fund borrowed, which has turned into 29.e^(0.1 x 3/12) = (-29.73) * => Net profit: 30 - 29.73 = 0.27 if spot ST < strike price of 30: prices go down, exercise put to sell share for 30 (+30) call holder will let their option expires worthlessly pay back the fund borrowed, which has turned into 29.e^(0.1 x 3/12) = (-29.73) => Net profit: 30 - 29.73 = 0.27","title":"Put-call parity"},{"location":"Financial%20engineering/Derivatives%20notes/#american-calls-and-puts","text":"Above = European. Now American options.","title":"American calls and puts"},{"location":"Financial%20engineering/Derivatives%20notes/#put-call-parity-for-us-options-find-upper-lower-bounds","text":"Put\u2013call parity does not hold for American options. However, it is possible to use arbitrage arguments to obtain upper and lower bounds for the difference between the price of an American call and the price of an American put. [!warning] American call & put ![[Pasted image 20240215152508.png]] [!quote] American calls & puts Non dividend, call strike = 20, maturity T = 5 months, call premium 1.5, stock price = 19, rfr = 0.1 Inequality above: stock price S0 - strike K \u2264 call C - put P \u2264 stock price S0 - PV of K Ke^(-rt) 19 - 20 \u2264 C - P \u2264 19 - 20e^(-0.1 x 5/12) -1 \u2264 C - P \u2264 19 - 20e^(-0.1 x 5/12) 1 \u2265 P - C \u2265 0.18 * P - C lies btwn 0.18 and 1 * Given call premium C = 1.5 -> P must be 1.68 - 2.50 * Aka for US put with same strike K & maturity as US call: * upper bound = 2.5 * lower bound = 1.68","title":"Put call parity for US options - find upper &amp; lower bounds"},{"location":"Financial%20engineering/Derivatives%20notes/#why-its-not-optimal-to-exercise-us-call-option-early","text":"[!example] 2 reasons that the early exercise of an American call option on a non-dividend paying stock is not optimal. 1. Insurance A call option, when held instead of the stock itself, in effect insures the holder against the stock price falling below the strike price. Once the option has been exercised and the strike price has been exchanged for the stock price, this insurance vanishes. 2. Time value of money From the perspective of the option holder, the later the strike price is paid out the better. This is because the more delayed the exercise of the option is, the more interest the option holder can earn (since it is across a longer period of time). Paraphrasing: The early exercise of an American put is a trade-off between the time value of money and the insurance value of a put.","title":"Why it's not optimal to exercise US CALL OPTION early"},{"location":"Financial%20engineering/Derivatives%20notes/#why-it-can-be-optimal-to-exercise-us-put-option-early","text":"Short answer: as long as it is sufficiently deep in the money Bounds for European and American call options when there are no dividends ![[Pasted image 20240215155723.png]] Variation of price of an American or European call option on a non-dividend paying stock with the stock price S0. Curve moves in the direction of the arrows when there is an increase in the interest rate, the time to maturity, or the stock price volatility ![[Pasted image 20240215155747.png]] Example: consider an extreme situation. Call option; Strike price K = 10, share price S0 is virtually 0. if exercise immediately -> immediate gain of 10 if wait -> gain is < 10, never exceed 10 since share price cannot be negative Also 10 now is > 10 in the future Put option: different from a call option in that it may be optimal for an investor to forgo this insurance and exercise early in order to realize the strike price immediately. In general, the early exercise of a put option becomes more attractive as: * S0 decreases * r increases * volatility decreases [!NOTE] Why the above? The early exercise of an American put is attractive when the interest earned on the strike price is greater than the insurance element lost. * When interest rates increase, the value of the interest earned on the strike price increases making early exercise more attractive. * When volatility decreases, the insurance element is less valuable. Again this makes early exercise more attractive.","title":"Why it CAN be optimal to exercise US PUT OPTION early"},{"location":"Financial%20engineering/Derivatives%20notes/#effect-of-dividends","text":"![[Pasted image 20240215201145.png]] [!warning] Finding upper & lower bounds of US options ![[Pasted image 20240215201155.png]]","title":"Effect of dividends"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-11-options-trading-strategies","text":"","title":"Chapter 11. Options trading strategies"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-12-binomial-tree-pricing","text":"","title":"Chapter 12. Binomial tree pricing"},{"location":"Financial%20engineering/Derivatives%20notes/#no-arbitrage-arguments-vs-risk-neutral-arguments","text":"","title":"No arbitrage arguments vs risk-neutral arguments"},{"location":"Financial%20engineering/Derivatives%20notes/#no-arbitrage","text":"In the no-arbitrage approach, we set up a riskless portfolio consisting of a position in the option and a position in the stock. By setting the return on the portfolio equal to the risk free interest rate, we are able to value the option.","title":"No arbitrage"},{"location":"Financial%20engineering/Derivatives%20notes/#risk-neutral-valuation","text":"When we use risk-neutral valuation, we first choose probabilities for the branches of the tree so that the expected return on the stock equals the risk-free interest rate. We then value the option by calculating its expected payoff and discounting this expected payoff at the risk-free interest rate. A risk-neutral world has two features that simplify the pricing of derivatives: The expected return on a stock (or any other investment) is the risk-free rate. The discount rate used for the expected payoff on an option (or any other instrument) is the risk-free rate.","title":"Risk-neutral valuation"},{"location":"Financial%20engineering/Derivatives%20notes/#comparison-example","text":"[!warning] No arbitrage valuation of options SHORT WAY (risk neutral) * f = value of option * d = transformation of current stock price if it goes down * u = transformation of current stock price if it goes up ![[Pasted image 20240304012806.png]] ![[Pasted image 20240304012856.png]] LONG WAY (no arbitrage) 1. Up value \u0394 - option = Down value \u0394 Solve for \u0394 Solve for value of portfolio (any of the two sides) 2. (\u0394 . current share price - f).e^(rt) = 38.4 Solve for f = 2.23 * ** If call, option is -, shares is +\u0394 * ** If put, opposite, shares is -\u0394 [!quote] A stock price is currently $40. It is known that at the end of three months it will be either $45 or $35. The risk-free rate of interest with quarterly compounding is 8% per annum. Calculate the value of a three-month European put option on the stock with an exercise price of $40. Verify that no-arbitrage arguments and risk-neutral valuation arguments give the same answers. No arbitrage * -35\u0394 + 5 = -45\u0394 \u0394 = -0.5 * Current value of portfolio: -40\u0394 + f * Portfolio must earn rfr of interest: (-40\u0394 + f) x e... f = 2.06 Risk neutral * p = probability of upward stock price movement in risk neutral world * This must hold true: 45 p + 35 (1 - p) = 40 x e... 10 p = 5.8 p = 0.58 * Expected value of option in risk neutral world: f = 0 x 0.58 + 5 x 0.42 = 2.10 * PV of f = 2.10 / e... = 2.06","title":"Comparison - example"},{"location":"Financial%20engineering/Derivatives%20notes/#two-step-binomial-trees","text":"![[Pasted image 20240304165118.png]] [!warning] Valuation of options - 2 step ![[Pasted image 20240304172334.png]] ![[Pasted image 20240304165312.png]] Volatility: ![[Pasted image 20240305011411.png]] Porbabilities: pp 2p(1-p) (1-p)(1-p) The option price is always equal to its expected payoff in a risk neutral world, discounted at the risk-free interest rate","title":"Two-step binomial trees"},{"location":"Financial%20engineering/Derivatives%20notes/#delta","text":"Delta of a stock option = ratio of the change in the price of option : change in the price of underlying stock * measures the sensitivity of the option price to the price of the stock when small changes are considered * # of units of the stock we should hold for each option shorted in order to create a riskless portfolio * delta of call = positive * delta of put = negative Delta hedging = construction of a riskless portfolio","title":"Delta"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-13-options-pricing-black-scholes-merton-model","text":"","title":"Chapter 13. Options pricing - Black, Scholes, Merton model"},{"location":"Financial%20engineering/Derivatives%20notes/#basics","text":"Black\u2013Scholes\u2013Merton model assumptions 1. Assumes a non-dividend-paying stock. 2. The return on the stock in a short period is normally distributed / log normally dist in long period 3. Returns in different non-overlapping periods are independent. S: Change in stock price. t: Time. m : Mean of the normal distribution. v : Variance of the normal distribution. Expected Return ( \u03bc ): Mean of the return. Volatility ( \u03c3 ): Standard deviation of the return. Lognormal vs normal - Short term: In the short term, the Black\u2013Scholes\u2013Merton model assumes that the distribution of stock price changes is normal . This means that over brief intervals, the percentage changes in stock prices are expected to follow a symmetric bell-shaped curve. - Long term: As we consider longer time periods, the model assumes that the distribution of future stock prices is lognormal . aka IT'S NOT ST THAT'S NORMAL BUT NATURAL LOG ST IS NORMAL . This introduces a skewness in the distribution, and it better captures the asymmetry and potential for large price movements over extended periods. A normal distribution is symmetrical A lognormal distribution is skewed with the mean, median, and mode all different A variable with a lognormal distribution has the property that its natural logarithm is normally distributed. ![[Pasted image 20240305174810.png]] ![[Pasted image 20240305174822.png]] [!warning] Black\u2013Scholes\u2013Merton assumption implies that ST (future share price) is normal Distribution of ln ST ![[Pasted image 20240305021349.png]] Distribution of ST * With 95% confidence, mean - Z-score . SD < ln ST < mean + Z-score . SD * e^LHS < ST < e^RHS Given the range * mean = current price . e^(expected return rate x time) * var = current price^2 . e^(2 x expected return x time) . [e^(volatility/SD . volatility/SD . time) - 1] [!quote] Consider a stock with an initial price of $40, an expected return of 16% per annum, and a volatility of 20% per annum. From equation (13.2), the probability distribution of the stock price, ST, in six months is given by ![[Pasted image 20240305014249.png]] * There's 95% prob that norm dist var has a value within 1.96 SD of its mean (empirical rule). * SD = sqrt(variance) = sqrt(0.2^2 * 6/12) = 0.1414 Hence, with 95% confidence: Expected - 1.96.SD < ln ST < Expected + 1.96.SD ![[Pasted image 20240305020658.png]] ![[Pasted image 20240305020717.png]] 32.55 < ST < 56.56 OK now that we've had a range for ST, we need to find mean and variance / SD 1. Mean of ST = Pe^(rT) = 40e^(16% . 6/12) = 43.33 2. Variance of ST = P.P . e^(2 * r * t) . (e^(SD.SD.t) - 1) ![[Pasted image 20240305021034.png]] Conclusion * There's a 95% chance stock price will be [32.55 - 56.56] * Mean = 43.33 * Var = 37.93 [!quote] Consider a stock with an expected return of 17% per annum and a volatility of 20% per annum. The probability distribution for the rate of return (continuously compounded) realized over one year is NORMAL * mean = expected return - SD^2 / 2 = 0.17 - 0.2^2 / 2 = 0.15 * SD = 20% 95% confident that return realised over 1 year: * 15 - 1.96 x 20 = -24.2% * 15 + 1.96 x 20 = +54.2%","title":"Basics"},{"location":"Financial%20engineering/Derivatives%20notes/#expected-return","text":"The higher the risk, the higher the expected return. The higher the level of interest rates, the higher the expected return required on any given stock.","title":"Expected return"},{"location":"Financial%20engineering/Derivatives%20notes/#volatility_1","text":"Our uncertainty about future stock prices increases as we look further ahead. As a rough approximation, we can say that the standard deviation of the stock price is proportional to the square root of how far ahead we are looking : SD = sqrt(n) [!quote] What is meant by implied volatility? How would you calculate the volatility implied by a European put option price? The implied volatility is the volatility that makes the Black\u2013Scholes\u2013Merton price of an option equal to its market price. It is calculated by trial and error. We test in a systematic way different volatilities until we find the one that gives the European put option price when it is substituted into the Black\u2013Scholes\u2013Merton formula.","title":"Volatility"},{"location":"Financial%20engineering/Derivatives%20notes/#assumptions_1","text":"Stock price behavior corresponds to the lognormal model (developed earlier in this chapter) with and constant. There are no transactions costs or taxes. All securities are perfectly divisible. There are no dividends on the stock during the life of the option. There are no riskless arbitrage opportunities. Security trading is continuous. Investors can borrow or lend at the same risk-free rate of interest. The short-term risk-free rate of interest, r, is constant.","title":"Assumptions"},{"location":"Financial%20engineering/Derivatives%20notes/#trading-days-v-calendar-days","text":"Research shows that volatility is much higher when the exchange is open for trading than when it is closed. As a result, practitioners tend to ignore days when the exchange is closed when estimating volatility from historical data and when calculating the life of an option. ![[Pasted image 20240306141316.png]]","title":"Trading days v. calendar days"},{"location":"Financial%20engineering/Derivatives%20notes/#calc-volatility-from-historical-data","text":"See excel","title":"Calc volatility from historical data"},{"location":"Financial%20engineering/Derivatives%20notes/#blackscholesmerton-modelling","text":"[!warning] The Black\u2013Scholes\u2013Merton formulas for the prices of European calls and puts on non dividend-paying stocks are ![[Pasted image 20240306141705.png]] The function N(x) is the cumulative probability function for a standardized normal variable. In other words, it is the probability that a variable with a standard normal distribution will be less than x. ![[Pasted image 20240306141759.png]] [!quote] The stock price six months from the expiration of an option is $42, the exercise price of the option is $40, the risk-free interest rate is 10% per annum, and the volatility is 20% per annum. This means that S0 = 42, K = 40, r = 0.1, sigma = 0:2, T = 0.5 ![[Pasted image 20240306142007.png]] ![[Pasted image 20240306144817.png]]","title":"Black\u2013Scholes\u2013Merton modelling"},{"location":"Financial%20engineering/Derivatives%20notes/#risk-neutral-valuation-revisited","text":"Risk neutral valuation Any security dependent on other traded securities can be valued on the assumption that investors are risk neutral. 1. The expected return from all investment assets is the risk-free interest rate. 2. The risk-free interest rate is the appropriate discount rate to apply to any expected future cash flow Procedures - valuing derivatives 1. Assume that the expected return from the underlying asset is the risk-free interest rate r (i.e., assume u = r ). 2. Calculate the expected payoff. 3. Discount the expected payoff at the risk-free interest rate.","title":"Risk-neutral valuation: revisited"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-4-interest-rates","text":"","title":"Chapter 4. Interest rates"},{"location":"Financial%20engineering/Derivatives%20notes/#41-types-of-rates","text":"Two important interest rates for derivatives traders are Treasury rates and LIBOR rates. Treasury rates are the rates paid by a government on borrowings in its own currency. LIBOR rates are short-term lending rates offered by banks in the interbank market. Treasury rates LIBOR Repo rates Risk free rate The compounding frequency for an interest rate defines a unit of measurement for the interest rate. The compounding frequency used for an interest rate defines the units in which it is measured. The difference between an annually compounded rate and a quarterly compounded rate is analogous to the difference between a distance measured in miles and a distance measured in kilometers. Traders frequently use continuous compound ing when analyzing the value of options and more complex derivatives.","title":"4.1 | Types of rates"},{"location":"Financial%20engineering/Derivatives%20notes/#42-bond-pricing","text":"A bond\u2019s yield is the single discount rate that, when applied to all cash flows, gives the bond\u2019s value equal to its market price. The par yield for a certain bond maturity is the coupon rate that causes the bond price to equal its par value. (The par value is the same as the principal value).","title":"4.2 | Bond pricing"},{"location":"Financial%20engineering/Derivatives%20notes/#43-determining-treasury-zero-rates","text":"The n-year zero rate or n-year spot rate is the rate applicable to an investment lasting for n years when all of the return is realized at the end. The method most commonly used to calculate zero rates is known as the bootstrap method . involves starting with short-term instruments and moving progressively to longer-term instruments, making sure that the zero rates calculated at each stage are consistent with the prices of the instruments used daily by trading desks to calculate a Treasury zero-rate curve.","title":"4.3 | Determining Treasury zero rates"},{"location":"Financial%20engineering/Derivatives%20notes/#44-forward-rates","text":"Forward rates are the rates applicable to future periods of time implied by today\u2019s zero rates. A forward rate agreement (FRA) is an over-the-counter agreement that an interest rate (usually LIBOR) will be exchanged for a specified interest rate during a specified future period of time. * An FRA can be valued by assuming that forward rates are realized and discounting the resulting payoff. [!warning] Forward rate RF ![[Pasted image 20240329010249.png]]","title":"4.4 | Forward rates"},{"location":"Financial%20engineering/Derivatives%20notes/#45-term-structure-of-interest-rates","text":"It is natural to ask what determines the shape of the zero curve. Why is it sometimes downward sloping, sometimes upward sloping, and sometimes partly upward sloping and partly downward sloping? expectations theory * simplest * long-term interest rates should reflect expected future short-term interest rates. * More precisely, it argues that a forward interest rate corresponding to a certain future period is equal to the expected future zero interest rate for that period . market segmentation theory * conjectures that there need be no relationship between short-, medium-, and long-term interest rates * a major investor such as a large pension fund invests in bonds of a certain maturity and does not readily switch from one maturity to another. * The short term interest rate is determined by supply and demand in the short-term bond market; the medium-term interest rate is determined by supply and demand in the medium-term bond market; and so on. liquidity preference theory * most appealing * Investors = prefer to preserve their liquidity and invest funds for short periods of time . * Borrowers = prefer to borrow at fixed rates for long periods of time . * This leads to a situation in which forward rates are greater than expected future zero rates . * consistent with the empirical result that yield curves tend to be upward sloping more often than they are downward sloping * Liquidity preference theory can be used to explain the interest rate term structures that are observed in practice. The theory argues that most individuals and most companies like to borrow long and lend short. To match the maturities of borrowers and lenders, it is necessary for financial intermediaries to raise long-term rates so that forward interest rates are higher than expected future spot interest rates.","title":"4.5 | Term structure of interest rates"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-3-hedging-strategies-using-futures","text":"","title":"Chapter 3. Hedging strategies using futures"},{"location":"Financial%20engineering/Derivatives%20notes/#31-basics","text":"Short hedge = short position future contracts = short sell A short hedge is appropriate when a company owns an asset and expects to sell that asset in the future. It can also be used when the company does not currently own the asset but expects to do so at some time in the future. A long hedge is appropriate when a company knows it will have to purchase an asset in the future. It can also be used to offset the risk from an existing short position. [!example] It is May 15. An oil producer has negotiated a contract to sell 1 million barrels of crude oil. The price in the sales contract is the spot price on August 15. Quotes: * Spot price of crude oil: $80 per barrel * August oil futures price: $79 per barrel ( think what we're selling r gonna go down -> wanna SELL HIGH -> SHORT HEDGE ) The oil producer can hedge with the following transactions: * May 15: Short 1,000 August futures contracts on crude oil * August 15: Close out futures position After gains or losses on the futures are taken into account, the price received by the company is close to $79 per barrel. Daily settlement : futures = everyday, forward = alll at the end","title":"3.1 | Basics"},{"location":"Financial%20engineering/Derivatives%20notes/#32-basis-risk","text":"Basis risk arises from the hedger\u2019s uncertainty regarding the difference between the spot price and futures price at the expiration of the hedge. Basis = spot of asset - futures price of contract As time passes, the spot price and a particular month\u2019s futures price do not necessarily change by the same amount and, as aresult, the basis changes. An increase in the basis is referred to as a strengthening of the basis and a decrease in the basis is referred to as a weakening of the basis. ![[Pasted image 20240329114341.png]] ![[Pasted image 20240329114401.png]] Consider a company that uses a short hedge because it plans to sell the asset. If the basis strengthens (i.e., increases) unexpectedly, the company\u2019s position improves because it will get a higher price for the asset after futures gains or losses are considered; if the basis weakens (i.e., decreases) unexpectedly, the company\u2019s position worsens. -> short hedge = good if basis gap goes up For a company using a long hedge because it plans to buy the asset: If the basis strengthens unexpectedly, the company\u2019s position worsens because it will pay a higher price for the asset after futures gains and losses are considered; if the basis weakens unexpectedly, the company\u2019s position improves. -> long hedge = good if basis gap goes down Choosing contracts In general, basis risk increases as the 'time difference between the hedge expiration and the delivery month' increases . A good rule of thumb is therefore to choose a delivery month that is as close as possible to, but later than, the expiration of the hedge . Suppose delivery months are March, June, September, and December for futures on a particular asset. For hedge expirations in December, January, and February, the March contract will be chosen; for hedge expirations in March, April, and May, the June contract will be chosen; and so on. Perfect hedge - A perfect hedge completely eliminates the hedger\u2019s risk. - A perfect hedge does not always lead to a better outcome than an imperfect hedge; it just leads to a more certain outcome. Consider a company that hedges its exposure to the price of an asset. Suppose the asset\u2019s price movements prove to be favorable to the company. A perfect hedge totally neutralizes the company\u2019s gain from these favorable price movements. An imperfect hedge, which only partially neutralizes the gains, might well give a better outcome.","title":"3.2 | Basis risk"},{"location":"Financial%20engineering/Derivatives%20notes/#33-cross-hedging","text":"Cross hedging occurs when the two assets are different. The hedge ratio is the ratio of \"the size of the position taken in futures contracts : the size of the exposure\" * When the asset underlying the futures contract is the same as the asset being hedged it is natural to use a hedge ratio of 1.0. This is the hedge ratio we have used in the examples considered so far. In Example 3.4, for instance, the hedger\u2019s exposure was on 20,000 barrels of oil, and futures contracts were entered into for the delivery of exactly this amount of oil. * When cross hedging is used, setting the hedge ratio equal to 1.0 is not always optimal. The hedger should choose a value for the hedge ratio that minimizes the variance of the value of the hedged position.","title":"3.3 | Cross hedging"},{"location":"Financial%20engineering/Derivatives%20notes/#minimum-variance-hedge-ratio","text":"h is the slope of the best-fit line from a linear regression of S against F. ![[Pasted image 20240329115022.png]] The hedge effectiveness can be defined as the proportion of the variance that is eliminated by hedging. This is the R2 from the regression of S against F and equals 2. [!NOTE] Under what circumstances does a minimum variance hedge portfolio lead to no hedging at all? When the coefficient of correlation between changes in the futures price and changes in the price of the asset being hedged is zero. Optimum number of contracts ![[Pasted image 20240329115128.png]] ![[Pasted image 20240329115615.png]] Tailing the hedge Small adjustment made to allow for the impact of daily settlement if we're using futures instead of forwards ![[Pasted image 20240329115249.png]] Va = dollar value of position being hedged = principal x spot Vf = dollar value of 1 futures contract = futures x size of 1 f contract","title":"Minimum variance hedge ratio"},{"location":"Financial%20engineering/Derivatives%20notes/#34-hedging-equity-portfolio","text":"If the portfolio mirrors the index, a hedge ratio very close to 1.0 is clearly appropriate -> number of futures contracts that should be shorted is ![[Pasted image 20240329115822.png]] ![[Pasted image 20240329115812.png]] [!quote] Suppose, for example, that a portfolio worth $5.05 million mirrors the S&P 500. The index futures price is 1,010 and each futures contract is on $250 times the index. In this case, * VA = 5,050,000 * VF = 1,010 x 250 = 252,500 * so that 5,050,000 / 252,500 = 20 contracts should be shorted to hedge the portfolio. When the portfolio does not exactly mirror the index, we can use the parameter beta from the capital asset pricing model to determine the appropriate number of contracts to short. ![[Pasted image 20240329120022.png]] ==example== 3 months ![[Pasted image 20240329120041.png]] ![[Pasted image 20240329120130.png]] ![[Pasted image 20240329120141.png]] Why hedge an equity portfolio * One answer to this question is that hedging can be justified if the hedger feels that the stocks in the portfolio have been chosen well. In these circumstances, the hedger might be very uncertain about the performance of the market as a whole, but confident that the stocks in the portfolio will outperform the market (after appropriate adjustments have been made for the beta of the portfolio). A hedge using index futures removes the risk arising from market moves and leaves the hedger exposed only to the performance of the portfolio relative to the market. * Another reason for hedging may be that the hedger is planning to hold a portfolio for a long period of time and requires short-term protection in an uncertain market situation. The alternative strategy of selling the portfolio and buying it back later might involve unacceptably high transaction costs. If we wanna lower the beta ![[Pasted image 20240329120248.png]]","title":"3.4 | Hedging equity portfolio"},{"location":"Financial%20engineering/Derivatives%20notes/#chapter-7-swaps","text":"","title":"Chapter 7. Swaps"},{"location":"Full%20stack/Doccen%20policy%20update/","text":"Update policies for Doccen.vn Source material: confluence | Update policies page on Doccen - Doccen Consumer - Confluence google drive | https://drive.google.com/drive/folders/1bKwqzRfSHciine5lme0dO_1yXzXD5ZUz Policy th\u1ebb '\u0111i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng' > m\u1ee5c '12. Gi\u1ea3i quy\u1ebft tranh ch\u1ea5p' > '12.2. Quy tr\u00ecnh gi\u1ea3i quy\u1ebft tranh ch\u1ea5p kh\u00f4ng ch\u00ednh th\u1ee9c b\u1eaft bu\u1ed9c' & '12.4. Thay \u0111\u1ed5i' Check if email support@doccen.vn is correct Policy th\u1ebb '\u0111i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng' > m\u1ee5c '11. C\u00e1c \u0111i\u1ec1u kho\u1ea3n ph\u00e1p l\u00fd kh\u00e1c' > '11.5. Th\u00f4ng b\u00e1o v\u00e0 H\u00e0nh \u0111\u1ed9ng ph\u00e1p l\u00fd' Check if email notices@Doccen.com is correct. Context: M\u1ecdi th\u00f4ng b\u00e1o ho\u1eb7c li\u00ean l\u1ea1c kh\u00e1c \u0111\u01b0\u1ee3c \u0111\u01b0a ra theo Th\u1ecfa thu\u1eadn n\u00e0y \u0111\u1ec1u ph\u1ea3i \u0111\u01b0\u1ee3c l\u1eadp th\u00e0nh v\u0103n b\u1ea3n v\u00e0 g\u1eedi qua th\u01b0 b\u1ea3o \u0111\u1ea3m ho\u1eb7c th\u01b0 y\u00eau c\u1ea7u x\u00e1c nh\u1eadn \u0111\u00e3 g\u1eedi, ho\u1eb7c qua email (do ch\u00fang t\u00f4i g\u1eedi t\u1edbi email \u0111\u00e3 li\u00ean k\u1ebft v\u1edbi t\u00e0i kho\u1ea3n c\u1ee7a b\u1ea1n ho\u1eb7c do b\u1ea1n g\u1eedi t\u1edbi notices@Doccen.com). Policy th\u1ebb '\u0111i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng' > m\u1ee5c '11. C\u00e1c \u0111i\u1ec1u kho\u1ea3n ph\u00e1p l\u00fd kh\u00e1c' > '11.1. Th\u1ecfa thu\u1eadn r\u00e0ng bu\u1ed9c' ==og content== C\u00e1c m\u1ee5c sau \u0111\u00e2y s\u1ebd v\u1eabn gi\u1eef nguy\u00ean hi\u1ec7u l\u1ef1c khi c\u00e1c \u0110i\u1ec1u kho\u1ea3n n\u00e0y h\u1ebft h\u1ea1n ho\u1eb7c ch\u1ea5m d\u1ee9t: c\u00e1c M\u1ee5c 2 (Ghi danh n\u1ed9i dung v\u00e0 Quy\u1ec1n truy c\u1eadp su\u1ed1t \u0111\u1eddi), 5 (Quy\u1ec1n c\u1ee7a Doccen v\u1edbi n\u1ed9i dung m\u00e0 b\u1ea1n \u0111\u0103ng), 6 (T\u1ef1 ch\u1ecbu r\u1ee7i ro khi s\u1eed d\u1ee5ng Doccen), 7 (Quy\u1ec1n c\u1ee7a Doccen), 8.5 (Tuy\u00ean b\u1ed1 t\u1eeb ch\u1ed1i tr\u00e1ch nhi\u1ec7m v\u1edbi G\u00f3i thu\u00ea bao), 9.4 (Tuy\u00ean b\u1ed1 t\u1eeb ch\u1ed1i tr\u00e1ch nhi\u1ec7m v\u1ec1 t\u00ednh n\u0103ng DoccenAI), 10 (C\u00e1c \u0111i\u1ec1u kho\u1ea3n ph\u00e1p l\u00fd kh\u00e1c) v\u00e0 11 (Gi\u1ea3i quy\u1ebft tranh ch\u1ea5p). ==suggested changes== C\u00e1c m\u1ee5c sau \u0111\u00e2y s\u1ebd v\u1eabn gi\u1eef nguy\u00ean hi\u1ec7u l\u1ef1c khi c\u00e1c \u0110i\u1ec1u kho\u1ea3n n\u00e0y h\u1ebft h\u1ea1n ho\u1eb7c ch\u1ea5m d\u1ee9t: c\u00e1c M\u1ee5c 3 (Ghi danh n\u1ed9i dung v\u00e0 Quy\u1ec1n truy c\u1eadp su\u1ed1t \u0111\u1eddi), ???? , ???? , ???? , 7.6 (Tuy\u00ean b\u1ed1 t\u1eeb ch\u1ed1i tr\u00e1ch nhi\u1ec7m v\u1edbi G\u00f3i thu\u00ea bao), 8.4 (Tuy\u00ean b\u1ed1 t\u1eeb ch\u1ed1i tr\u00e1ch nhi\u1ec7m v\u1ec1 t\u00ednh n\u0103ng DoccenAI), 11 (C\u00e1c \u0111i\u1ec1u kho\u1ea3n ph\u00e1p l\u00fd kh\u00e1c) v\u00e0 12 (Gi\u1ea3i quy\u1ebft tranh ch\u1ea5p).","title":"Doccen policy update"},{"location":"Full%20stack/Doccen%20policy%20update/#update-policies-for-doccenvn","text":"Source material: confluence | Update policies page on Doccen - Doccen Consumer - Confluence google drive | https://drive.google.com/drive/folders/1bKwqzRfSHciine5lme0dO_1yXzXD5ZUz Policy th\u1ebb '\u0111i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng' > m\u1ee5c '12. Gi\u1ea3i quy\u1ebft tranh ch\u1ea5p' > '12.2. Quy tr\u00ecnh gi\u1ea3i quy\u1ebft tranh ch\u1ea5p kh\u00f4ng ch\u00ednh th\u1ee9c b\u1eaft bu\u1ed9c' & '12.4. Thay \u0111\u1ed5i' Check if email support@doccen.vn is correct Policy th\u1ebb '\u0111i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng' > m\u1ee5c '11. C\u00e1c \u0111i\u1ec1u kho\u1ea3n ph\u00e1p l\u00fd kh\u00e1c' > '11.5. Th\u00f4ng b\u00e1o v\u00e0 H\u00e0nh \u0111\u1ed9ng ph\u00e1p l\u00fd' Check if email notices@Doccen.com is correct. Context: M\u1ecdi th\u00f4ng b\u00e1o ho\u1eb7c li\u00ean l\u1ea1c kh\u00e1c \u0111\u01b0\u1ee3c \u0111\u01b0a ra theo Th\u1ecfa thu\u1eadn n\u00e0y \u0111\u1ec1u ph\u1ea3i \u0111\u01b0\u1ee3c l\u1eadp th\u00e0nh v\u0103n b\u1ea3n v\u00e0 g\u1eedi qua th\u01b0 b\u1ea3o \u0111\u1ea3m ho\u1eb7c th\u01b0 y\u00eau c\u1ea7u x\u00e1c nh\u1eadn \u0111\u00e3 g\u1eedi, ho\u1eb7c qua email (do ch\u00fang t\u00f4i g\u1eedi t\u1edbi email \u0111\u00e3 li\u00ean k\u1ebft v\u1edbi t\u00e0i kho\u1ea3n c\u1ee7a b\u1ea1n ho\u1eb7c do b\u1ea1n g\u1eedi t\u1edbi notices@Doccen.com). Policy th\u1ebb '\u0111i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng' > m\u1ee5c '11. C\u00e1c \u0111i\u1ec1u kho\u1ea3n ph\u00e1p l\u00fd kh\u00e1c' > '11.1. Th\u1ecfa thu\u1eadn r\u00e0ng bu\u1ed9c' ==og content== C\u00e1c m\u1ee5c sau \u0111\u00e2y s\u1ebd v\u1eabn gi\u1eef nguy\u00ean hi\u1ec7u l\u1ef1c khi c\u00e1c \u0110i\u1ec1u kho\u1ea3n n\u00e0y h\u1ebft h\u1ea1n ho\u1eb7c ch\u1ea5m d\u1ee9t: c\u00e1c M\u1ee5c 2 (Ghi danh n\u1ed9i dung v\u00e0 Quy\u1ec1n truy c\u1eadp su\u1ed1t \u0111\u1eddi), 5 (Quy\u1ec1n c\u1ee7a Doccen v\u1edbi n\u1ed9i dung m\u00e0 b\u1ea1n \u0111\u0103ng), 6 (T\u1ef1 ch\u1ecbu r\u1ee7i ro khi s\u1eed d\u1ee5ng Doccen), 7 (Quy\u1ec1n c\u1ee7a Doccen), 8.5 (Tuy\u00ean b\u1ed1 t\u1eeb ch\u1ed1i tr\u00e1ch nhi\u1ec7m v\u1edbi G\u00f3i thu\u00ea bao), 9.4 (Tuy\u00ean b\u1ed1 t\u1eeb ch\u1ed1i tr\u00e1ch nhi\u1ec7m v\u1ec1 t\u00ednh n\u0103ng DoccenAI), 10 (C\u00e1c \u0111i\u1ec1u kho\u1ea3n ph\u00e1p l\u00fd kh\u00e1c) v\u00e0 11 (Gi\u1ea3i quy\u1ebft tranh ch\u1ea5p). ==suggested changes== C\u00e1c m\u1ee5c sau \u0111\u00e2y s\u1ebd v\u1eabn gi\u1eef nguy\u00ean hi\u1ec7u l\u1ef1c khi c\u00e1c \u0110i\u1ec1u kho\u1ea3n n\u00e0y h\u1ebft h\u1ea1n ho\u1eb7c ch\u1ea5m d\u1ee9t: c\u00e1c M\u1ee5c 3 (Ghi danh n\u1ed9i dung v\u00e0 Quy\u1ec1n truy c\u1eadp su\u1ed1t \u0111\u1eddi), ???? , ???? , ???? , 7.6 (Tuy\u00ean b\u1ed1 t\u1eeb ch\u1ed1i tr\u00e1ch nhi\u1ec7m v\u1edbi G\u00f3i thu\u00ea bao), 8.4 (Tuy\u00ean b\u1ed1 t\u1eeb ch\u1ed1i tr\u00e1ch nhi\u1ec7m v\u1ec1 t\u00ednh n\u0103ng DoccenAI), 11 (C\u00e1c \u0111i\u1ec1u kho\u1ea3n ph\u00e1p l\u00fd kh\u00e1c) v\u00e0 12 (Gi\u1ea3i quy\u1ebft tranh ch\u1ea5p).","title":"Update policies for Doccen.vn"},{"location":"Full%20stack/python/","text":"Python Important dictionary fruits = { 'apple': 1, 'banana': 3 } if wanna append a new key-value pair: use [] fruits['pineapple'] = 26 for looping, make sure to use for key, value in enumerate([key1, key2]) or dict. items() .keys() = print all keys .values() = print all values .items() = print all keys and values as tuples merging dictionaries dictA .update (dictB) dictA | dict B nested dictionaries -> use more than 1 []: nested_dict[name][last_name] list: [] Set hue = x, legend = False for ombre graphs Installation First must go to the Python directory: cd C:\\Users\\kalul\\AppData\\Local\\Programs\\Python\\Python311\\Scripts pip install pandas numpy seaborn matplotlib ta statsmodels tsfracdiff hmmlearn scikit-learn # Import necessary libraries import numpy as np import pandas as pd import seaborn as sns from IPython.display import display import matplotlib.pyplot as plt import warnings warnings.filterwarnings(\"ignore\") plt.rcParams['figure.figsize'] = (10, 3) sns.set_theme(style = 'darkgrid', font_scale=0.8, palette='viridis') import statsmodels.formula.api as smf rich = pretty terminal print outs Common issue When import __ as __ -> DLL error, cannot import (happened to matplotlib and seaborn) -> Fix : Window R -> %APPDATA% -> clean all cache Virtual environments In general, it's suggested to use virtual environments (I highly suggest looking at the official Python documentation ). With this approach, you easily can set up project-specific Python versions (as well as libraries). Easily manageable and the best part: There are lots of tutorials on the internet on how to approach this: https://www.freecodecamp.org/news/installing-multiple-python-versions-on-windows-using-virtualenv/ File probing File size import os import pandas as pd # Check the file size file_path = 'data.csv' file_size = os.path.getsize('data.csv') print(f'File size: {file_size / (1024 * 1024):.2f} MB') # Count the number of lines line_count = sum(1 for line in open('data.csv')) print(f'Number of lines: {line_count}') # Load the CSV file into a DataFrame (optional) df = pd.read_csv(file_path) Reading files Using pd CSV file_path = 'D:/Github/Python/datasets/baby.csv' baby = pd.read_csv(file_path) Arguments for read_csv: index_col = \"Year\" = set the year column as the index header = 1 = set the 1st row as the header header = None = remove all headers, columns are numbered 0 names = ['cola, colb'] = set column names thousands = ',' = character acting as the thousands separator in numerical values. delimiter/sep = ',' sep = r'\\s+' = if delimiter is white space json pd.read_json() Using with open This approach is more general and can be used for any type of file. You have more control over how you process the content, and it doesn't necessarily assume a tabular structure. If your data is structured and tabular, and you want to perform data analysis, the pandas methods like pd.read_json , pd.read_csv , etc., are often more convenient. If you need more flexibility, or if your data is not in a standard tabular format, using with open allows you to read and process the content in a more customized way. with open('example.txt', 'r') as file: content = file.read() Zip Importing zip files 1. import zipfile package 2. file_path 3. folder to extract the files to (extract) 4. with zipfile.ZipFile(file_path, 'r') as my_zip: my_zip.extractall(extract) import zipfile zip_file_path = 'D:/Github/Python/data100/4homework/hw02A/data.zip' extracted_dir = 'D:/Github/Python/data100/4homework/hw02A' with zipfile.ZipFile(zip_file_path, 'r') as my_zip: my_zip.extractall(extracted_dir) # 'r' = read mode Reading all csv files using glob files = glob.glob('../data/forex_light/*.csv') forex = pd.DataFrame() content = [] for i in files: df = pd.read_csv(i, index_col='Date', header=0) content.append(df) forex = pd.concat(content, axis = 1) forex.dropna(inplace=True) forex.index = pd.to_datetime(forex.index) forex ==Advanced: os and zipfile: hw2_foodsafety== Other useful add ons data.convert_dtypes() ( documentation ) conveniently converts data to the most appropriate type data.drop_na() ( documentation ) data.rename(columns={'old': 'new', 'old2': 'new2'}) Basics Counting, indexing, subsetting etc. Counting unique values and put into a data frame value_counts().reset_index() Sort by any column data.sort_values(by = 'col') * Select column A from 'data' and sort by counts, descending data['A'].value_counts().sort_values(ascending=False).reset_index() Creating an empty column for now data['column'] = None Creating a subset of data subset = data[data[column] < 345] data.loc['row', 'col'] * Similar to R but in R no need for .loc * Can use iloc[] too -> for key difference [[data100 - UC Berkeley#^38e665]] Creating a 3rd column as the mean/sum/diff of other columns data['col 3'] = data[['col 1', 'col 2']].mean(axis=1, skipna=True) * We MUST specify axis = 1/0 since without it -> axis = 0 * axis = 0 = apply column to column (default) * axis = 1 = apply row to row * see ==12_deflategate.ipynb== Copy() Everytime you create a subset, include .copy() if you want to avoid changing the og data set. Dropping a column .drop('col', axis = 1) = default is axis = 0 which drops a row (rmb 0 = row, 1 = column) Or we can just type out axis = \"columns\" or axis = \"rows\" Create a new column filled with NA data['new column'] = None Naming 1 single column Use columns = ['name] df_ssn = pd.DataFrame( ['data'], columns = ['SSN']) Loops if continue = move onto the next iteration for strategy_parameters_value in itertools.product( *strategy_parameters_values): strategy_params = dict( zip(strategy_parameters_keys, strategy_parameters_value)) if (strategy_params['fast_window'] == strategy_parameters['fast_window'][0] and strategy_params['slow_window'] == strategy_parameters['slow_window'][0]) or \\ (strategy_params['fast_window'] == strategy_parameters['fast_window'][1] and strategy_params['slow_window'] == strategy_parameters['slow_window'][1]) or \\ (strategy_params['fast_window'] == strategy_parameters['fast_window'][2] and strategy_params['slow_window'] == strategy_parameters['slow_window'][2]) or \\ (strategy_params['fast_window'] == strategy_parameters['fast_window'][3] and strategy_params['slow_window'] == strategy_parameters['slow_window'][3]): strategy_sides = determine_strategy_side(prices, **strategy_params) else: continue Data frame attributes Mode data['col'].mode()[0] = [0] specifies the first mode Displaying simulation results and plot Def the function WITHOUT the input Outside the function Ask for input results = function() display(results.head()) sns.plot ==Example== def simulated_difference_of_means(dataset): \"\"\"Returns: Difference between mean birthweights of babies of smokers and non-smokers after shuffling labels n times\"\"\" data = [] for i in range(1, rep + 1): # Shuffling dataset['Shuffled Maternal Smoker'] = dataset['Maternal Smoker'] \\ .sample(frac=1).reset_index(drop=True) # Find dim dim = difference_of_means(dataset, 'Shuffled Maternal Smoker') # Update to results table data.append({ 'Stimulation': i, 'Difference of mean': dim }) df_data = pd.DataFrame(data) return df_data # input rep = int(input('Enter the number of repetitions: ')) # call function & display data frame result df_data = simulated_difference_of_means(births_subset) display(df_data.head()) sns.histplot(data = df_data, x = 'Difference of mean') NA To quickly remove na gdp = gdp[~gdp.isna()] groupby Basic syntax: dataframe.groupby['gender']('frequency').mean() . We can add more groupby criteria : ==e.g. not just by gender but also by age== df.groupby( ['gender', 'age'] )['frequency'].mean() * key: the use of [] when more than 1 element is passed to the () add more groupby metrics of interest : df.groupby('gender')[['frequency', 'count']].agg( ['mean', 'max'] ) Subsetting To quickly select rows of this df that is also available in another: A[A.index.isin(B.index)] Y_common = Y[Y.index.isin(Y_fracdiff.index)] Merge, join, append Add columns to existing df (usu for features) dfa = dfa.join (dfb, on = 'Date') Numpy and maths creating an array emission_prob = np.array([ [0.3, 0.5, 0.2], [0.1, 0.5, 0.4] ]) The first number controls the row, second number controls the columns (like dataframes) To print the entire first row: emission_prob[0, :] # array([0.3, 0.5, 0.2]) np.linspace (1, 100, 77) Print out 77 evenly spaced numbers from 1 to 100 Classes, methods etc. A class in Python is like a blueprint for creating objects (instances). It defines a set of attributes (variables) and methods (functions) that the objects created from the class will have. Think of a class as a template for creating something. For example, if you have a Car class, it might define that every car has attributes like color , make , and model , and methods like drive() and stop() . class Car: def __init__(self, color, make, model): self.color = color self.make = make self.model = model def drive(self): print(f\"The {self.color} {self.make} {self.model} is driving.\") def stop(self): print(f\"The {self.color} {self.make} {self.model} has stopped.\") Here, Car is a class. It defines: Attributes : color , make , model Methods : drive() , `stop() An object is an instance of a class. When you create an object from a class, it\u2019s like creating a specific item from a blueprint. my_car = Car(\"red\", \"Toyota\", \"Corolla\" Here, my_car is an object of the Car class. It has its own specific values for color , make , and model . A method is a function that is defined inside a class and operates on instances of that class. Methods are used to define the behaviors of the objects created from the class. my_car.drive() This calls the drive() method on the my_car object, making it print \"The red Toyota Corolla is driving.\" . def __init__(self, color, make, model): self.color = color self.make = make self.model = model In the Car class, __init__ sets the initial values for color , make , and model when a new Car object is created. Inheritance allows one class to inherit the attributes and methods of another class. The new class (child) can add new attributes and methods or override existing ones from the parent class. class ElectricCar(Car): def charge(self): print(f\"The {self.color} {self.make} {self.model} is charging.\") ElectricCar is a subclass of Car. It inherits all the attributes and methods of Car and adds a new method, charge() . An abstract class is a class that cannot be instantiated on its own and is meant to be a base class for other classes. It often contains abstract methods, which are methods that are declared but contain no implementation. The subclasses of the abstract class must implement these abstract methods. In other words, an abstract class is the MOTHER OF EVERYTHING In Python, abstract classes are created using the ABC module, and abstract methods are marked with the @abstractmethod decorator. from abc import ABC, abstractmethod class Animal(ABC): @abstractmethod def sound(self): pass class Dog(Animal): def sound(self): return \"Bark\" my_dog = Dog() print(my_dog.sound()) # Outputs: Bark Here, Animal is an abstract class, and sound() is an abstract method that must be implemented by any non-abstract subclass like Dog . Now onto the more complicated stuffs: The factory pattern is a design pattern that deals with the creation of objects. A factory class or method is responsible for creating objects without specifying the exact class of the object that will be created. It\u2019s useful when you want to abstract the creation process of objects, especially when the object creation involves some complexity. class AnimalFactory: @staticmethod def create_animal(animal_type): if animal_type == \"dog\": return Dog() elif animal_type == \"cat\": return Cat() else: return None my_pet = AnimalFactory.create_animal(\"dog\") print(my_pet.sound()) # Outputs: Bark Here, AnimalFactory is a factory class that creates instances of Dog or Cat based on input. A controller is a class that manages the interaction between different parts of a program. It doesn\u2019t handle the core logic itself but instead orchestrates the different pieces, making sure they work together. [!quote] summary different types of classes - Abstract Classes are at the top, defining the structure. - Concrete Classes implement these abstract classes. - Factory and Controller Classes operate at the same level as concrete classes: - Factory Classes are responsible for creating objects (like concrete classes). - Controller Classes manage the workflow, using objects created by the factory. - Methods and Attributes are at the bottom, as the actual code and data that define the behavior of classes. Models https://scikit-learn.org/stable/modules/classes.html#module-sklearn.metrics A. Preprocessing from sklearn.preprocessing import ___ fit_transform(data) 1. Polynomial features & overfitting from sklearn.preprocessing import PolynomialFeatures | for > linear models Initialise model using PolynomialFeatures rolypoly = PolynomialFeatures(degree = 8, include_bias = False) Fit model using fit_transform transformed = rolypoly.fit_transform(data[[\"column1\", \"column2\", \"column3\"]]) Rmb in econometrics, we could add higher than linear terms, Linear (Degree 1) : $ax+b$ Quadratic (Degree 2) : $ax^2+bx+c$ Cubic (Degree 3) : $ax^3+bx^2+cx+d$ Quartic (Degree 4) : $ax^4+bx^3+cx^2+dx+e$ Quintic (Degree 5) : $ax^5+bx^4+cx^3+dx^2+ex+f$ Sextic (Degree 6) : $ax^6+bx^5+cx^4+dx^3+ex^2+fx+g$ Septic (Degree 7) : $ax^7+bx^6+cx^5+dx^4+ex^3+fx^2+gx+h$ Octic (Degree 8) : $ax^8+bx^7+cx^6+dx^5+ex^4+fx^3+gx^2+hx+i$ Nonic (Degree 9) : $ax^9+bx^8+cx^7+dx^6+ex^5+fx^4+gx^3+hx^2+ix+j$ Decic (Degree 10) : $ax^{10}+bx^9+cx^8+dx^7+ex^6+fx^5+gx^4+hx^3+ix^2+jx+k$ For degrees higher than ten, the naming often simply uses the ordinal number followed by \"-ic\" or \"-degree polynomial,\" such as: 11th-degree polynomial or Undecic 12th-degree polynomial or Duodecic X[\"hp^3\"] = df[\"hp\"]**3 # cubic, fit a model with order 3 X[\"hp^4\"] = df[\"hp\"]**4 # short hand for X and y (defining them in fit) # Fit a model with order 3 hp3_model = lm.LinearRegression() hp3_model.fit(X[[\"hp\", \"hp^2\", \"hp^3\"]], vehicles[\"mpg\"]) hp3_model_predictions = hp3_model.predict(X[[\"hp\", \"hp^2\", \"hp^3\"]]) # Fit a model with order 4 hp4_model = lm.LinearRegression() hp4_model.fit(X[[\"hp\", \"hp^2\", \"hp^3\", \"hp^4\"]], vehicles[\"mpg\"]) hp4_model_predictions = hp4_model.predict(X[[\"hp\", \"hp^2\", \"hp^3\", \"hp^4\"]]) The problem is model complexity - the more features we have, the lower values of training error. In fact, it is a mathematical fact that if we create a polynomial model with degree $n-1$, we can perfectly model a set of $n$ points. For example, a set of 5 points can be perfectly modeled by a degree 4 model. ![[Pasted image 20240514160502.png|center|70%]] However, obviously there's gonna be a trade-off: higher test error . The model has overfit to the data used to train it. It has essentially \"memorized\" the six datapoints used during model fitting, and does not generalize well to new data. Complex models tend to be more sensitive to the data used to train them. The variance of a model refers to its tendency to vary depending on the training data used during model fitting. It turns out that our degree-5 model has very high model variance. If we randomly sample new sets of datapoints to use in training, the model varies erratically. ![[under_over_fitting.png |center|40%]] 2. Standard scaling Scaling adjusts the range of features to a predefined scale, which can be either standardization or normalisation. When values = on vastly different scales -> skew models -> must adjust the ranges etc [!note] Standardisation = rescales features to have a mean of 0 and a standard deviation of 1. * Standardisation is useful when the features have different scales, and you want to give them equal weight in the model. It is particularly beneficial for algorithms that assume Gaussian distributions, such as linear regression and logistic regression. Normalisation rescales features to a fixed range * range is usu 0 to 1 * Normalization preserves the shape of the original distribution while bringing the values into a similar numerical range. It is useful when the scale of the features is not known and might vary widely. * e.g. min max scaler [!note] Standardisation = rescales features to have a mean of 0 and a standard deviation of 1. * Standardisation is useful when the features have different scales, and you want to give them equal weight in the model. It is particularly beneficial for algorithms that assume Gaussian distributions, such as linear regression and logistic regression. Normalisation rescales features to a fixed range * range is usu 0 to 1 * Normalization preserves the shape of the original distribution while bringing the values into a similar numerical range. It is useful when the scale of the features is not known and might vary widely. e.g. min max scaler from sklearn.preprocessing import StandardScaler fit.transform Use cases * before regularisation [!warning] We do NOT scale y_train, only B. Model selection from sklearn.model_selection import ___ fit(x_train, y_train) 1. Train test split from sklearn.model_selection import train_test_split y_train contains the target output corresponding to X_train values Age Sex Disease ---- ------ | --------- X_train | y_train ) ) 5 F | A Disease ) 15 M | B Disease ) 23 M | B Disease ) training 39 M | B Disease ) data 61 F | C Disease ) 55 M | F Disease ) 76 F | D Disease ) 88 F | G Disease ) -------------|------------ X_test | y_test 63 M | C Disease ) 46 F | C Disease ) test 28 M | B Disease ) data 33 F | B Disease ) We fit the model on X_train and y_train : lalala.fit(X_train, y_train) We predict on X_test : lalala.predict(X_test) To get the accuracy score : lalala.score (general purpose, which returns r2_score for regression model and accuracy_score for classification model) for training accuracy score: lalala.score(X_train, y_train) test_score = lalala .score(X_test, y_test) Argument: stratify = True With shuffling, random order. You can stratify by defining the number of samples by class, when splitting, to stay proportional from sklearn.model_selection import train_test_split X_train, X_test, Y_train, Y_test = train_test_split(X, Y, test_size=0.2, random_state=100, shuffle=True) 2. One-hot encoder It is essentially creating dummy variables (January = 0/1, February = 0/1, etc creating 11 dummy variables from sklearn.preprocessing import OneHotEncoder ![[ohe.png | center]] ==step 1== initialise a one hot encoder (ohe) object. ohe = OneHotEncoder() ==step 2== fit the encoder onto the column needs encoding (categorical column) ohe.fit(df[['column']]) ==step 3== transform the categorical column using transform and get_feature_names_out encoded_array = ohe.transform(df[['column]]).toarray() encoded_df = pd.DataFrame(encoded_array, columns = ohe.get_feature_names_out()) ==step 4== rejoin with the full X dataframe, drop the categorical column X = X_raw.join(encoded_df).drop(columns = 'day') C. Models import sklearn.linear_model as ___ 1. Linear regression ==step 1== Model initialisation - initialise an instance of the model class, in this case, LinearRegression() import sklearn.linear_model as lalalalalala my_model = lalalalalala.LinearRegression() ==step 2== Train the model using .fit BTS, sklearn will run gradient descent to determine the optimal model params -> save these model params to our model instance for future use All sklearn model classes include a .fit method, which takes 2 inputs: 1. the design matrix / predictor vars / independent vars (X) 2. the target variable / predicted (y) .fit expects to receive 2D data thus it should be dataframe[['column']], not dataframe[\\'column'] my_model.fit(X, Y) ==step 3== necessary methods .intercept_ = intercept [!NOTE] Quick way to extract the coefficients [theta_1, theta_2, ...], $theta_0$ = model_h .coef_, model_h .intercept_ .coef_ = all x coefficients .predict = predicted y [!success] Short form (1 line) modelll = LinearRegression().fit(AQS, PA) 2. Regularisation Essentially they are linear regression but with shrinkage (LinearRegression = regularisation = 0) [!warning]+ Must standardise data before regularisation L1 regularisation (LASSO) lasso_model_scaled = lm.Lasso(alpha=0.1) lasso_model_scaled.fit(X_train_standardized, Y_train) lasso_model_scaled.coef_ L2 regularisation (RIDGE) ridge_model = lm.Ridge(alpha=0.1) ridge_model.fit(X_train_standardized, Y_train) ridge_model.coef_ D. Cross validation cross validation score: from sklearn.model_selection import cross_val_score kfold: from sklearn.model_selection import KFold Initialise cross validation method cross_val_model = KFold( n_splits = 888, random_state = None, shuffle = False) (optional) identify train and test indices # cross_val_model.split(X) for train_idx, valid_idx in kf.split(X_train): split_X_train, split_X_valid = X_train.iloc[train_idx], X_train.iloc[valid_idx] split_y_train, split_y_valid = y_train.iloc[train_idx], y_train.iloc[valid_idx] (optional) to visualise the folds for i, (train_index, test_index) in enumerate(kf.split(X)): print(f\"Fold {i}:\") print(f\" Train: index={train_index}\") print(f\" Test: index={test_index}\") model fit and calculating mean error for each fold ML_model = LinearRegression() scores = cross_val_score(ML_model, X, y, scoring = 'accuracy' cv = cross_val_model, n_jobs = -1) print('Accuracy: %.3f (%.3f)' % (mean(scores), std(scores))) # before looping over each train/test index validation_errors = [] # in each loop moddell.fit(X_train, y_train) error = ... validation_errors.append(error) # outside of loop mean_error_loops = np.mean(validation_errors) Methods kalulu .get_n_splits(X) - generate indices to split data into training and test set visualisation Add ; to remove unnecessary text lines when drawing using sns (on the same line as sns lines not at the end of the code block on a separate line) Use sns.countplot instead of barplots when you don't have the variable name for one of the axes (which is most of the time) graph styling import seaborn as sns import pandas as pd sns.set(font_scale=1.5) import matplotlib.pyplot as plt import numpy as np from sklearn import linear_model from sklearn.metrics import mean_squared_error from sklearn.metrics import mean_absolute_error import plotly.graph_objects as go import plotly.express as px from sklearn.pipeline import Pipeline from sklearn.preprocessing import PolynomialFeatures from sklearn.linear_model import LinearRegression def adjust_fontsize(size=None): SMALL_SIZE = 8 MEDIUM_SIZE = 10 BIGGER_SIZE = 12 if size != None: SMALL_SIZE = MEDIUM_SIZE = BIGGER_SIZE = size plt.rc('font', size=SMALL_SIZE) # controls default text sizes plt.rc('axes', titlesize=SMALL_SIZE) # fontsize of the axes title plt.rc('axes', labelsize=MEDIUM_SIZE) # fontsize of the x and y labels plt.rc('xtick', labelsize=SMALL_SIZE) # fontsize of the tick labels plt.rc('ytick', labelsize=SMALL_SIZE) # fontsize of the tick labels plt.rc('legend', fontsize=SMALL_SIZE) # legend fontsize plt.rc('figure', titlesize=BIGGER_SIZE) # fontsize of the figure title plt.style.use('fivethirtyeight') sns.set_context(\"talk\") sns.set_theme() adjust_fontsize(size=20) %matplotlib inline import warnings warnings.filterwarnings('ignore') helper functions Plot distribution bar charts def plot_dist(dist_df, xname=\"x\", pname=\"P(X = x)\", varname=\"X\", save=False): \"\"\" Plot a distribution from a distribution table. Single-variate. \"\"\" plt.bar(dist_df[xname], dist_df[pname]) plt.ylabel(pname) plt.xlabel(xname) plt.title(f\"Distribution of ${varname}$\") plt.xticks(sorted(dist_df[xname].unique())) if save: fig = plt.gcf() fig.patch.set_alpha(0.0) plt.savefig(f\"dist{varname}.png\", bbox_inches = 'tight'); Simulate random samples def simulate_samples(df, xname=\"x\", pname=\"P(X = x)\", size=1): return np.random.choice( df[xname], # Draw from these choiecs size=size, # This many times p=df[pname]) # According to this distribution subplots fig, ax = plt.subplots(1, 3, figsize=(12, 3)) # looping predictions_dict = {0:hp2_model_predictions, 1:hp3_model_predictions, 2:hp4_model_predictions} for i in predictions_dict: ax[i].scatter(vehicles[\"hp\"], vehicles[\"mpg\"], edgecolor=\"white\", lw=0.5) ax[i].plot(vehicles[\"hp\"], predictions_dict[i], \"tab:red\") ax[i].set_title(f\"Model with order {i+2}\") ax[i].set_xlabel(\"hp\") ax[i].set_ylabel(\"mpg\") ax[i].annotate(f\"MSE: {np.round(mse(vehicles['mpg'], predictions_dict[i]), 3)}\", (120, 40)) plt.subplots_adjust(wspace=0.3); fig, ax = plt.subplots(ncols=2) sns.histplot(tips['tip'], bins=20, stat=\"proportion\", ax=ax[0]) sns.histplot(tips['tip']/tips['total_bill'], bins=20, stat=\"proportion\", ax=ax[1]) Finance [!NOTE] Finding percentage change / return of strategy Long way = t1 / t0 - 1 ``` spy['returns'] = spy['close'].shift(21) / spy['close'] - 1 2. Short way spy['return'] = spy.close.shift(-21).pct_change(21) spy['strategy_return'] = spy['return'].mul(spy.signal_momentum_high) ``` Dataframe df1.equals(df2) to check if 2 dataframes are equal To join/merge/append new columns 1. join 2. merge (more general and versatile) To display all column names in a pretty way Instead of df.columns: display(Markdown('\\n'.join(fr'{i + 1}. {c}'.replace('$', r'\\$') for i, c in enumerate(wb.columns)))) Multiprocessing Joblib parallel : In rough terms, it spawns multiple Python processes and handles each part of the iterable in a separate process. Then it joins everything at the end. ==see backtesting paper - n_jobs== Examples: results = Parallel(n_jobs=n_jobs)( delayed(FUNCTION)(FUNCTION ARGUMENTS) for random_state_value in random_states ) path_data = Parallel(n_jobs=n_jobs)( delayed(train_test_single_estimator)( deepcopy(single_estimator), train_indices, test_indices ) for train_indices, test_indices in self._single_split(single_data) ) results = Parallel(n_jobs=n_jobs)( delayed(performance_evaluation)( np.concatenate([partitions[i] for i in train_indices], axis=0), np.concatenate([partitions[i] for i in partition_indices if i not in train_indices], axis=0), n_strategies, metric, risk_free_return ) for train_indices in partition_combinations_indices ) Pipeline from sklearn.pipeline import Pipeline Example: fitting polynomial model 18 times def fit_model_dataset(degree): pipelined_model = Pipeline([ ('polynomial_transformation', 'PolynomialFeatures(degree)), ('linear_regression', lm.LinearRegression()) ]) pipelined_model.fit(X_train[['hp']], Y_train) return mean_squared_error(Y_value, pipelined_model.predict(X_value[['hp']])) Miscellaneous simple boolean, if xyz, prints 1 ins['Missing score'] = ins['score'] == -1 OR ins['Missing score'] = (ins['score'] == -1) replace If I have a table called wine, class column: -> To know how many unique values there are in class: wine['class'].unique() -> To replace all values not 1 into 0: wine['class'] .apply(lambda x: 1 if x == 1 else 0) Normalise = True[True] value_counts(normalize=True) -> convert counts to proportions value_counts(normalize=True)[True] -> only show the True results :.2f = display to 2 decimal places relevant_attributes = movies[['Title', 'Genre'] + attribute_columns] table then some extra columns = use plus sign For codes spanning multiple lines Use either: \\ every line end OR () on the RHS of equation wrap all with ' ' Line code > 80 -> use single quotes to wrap each line: print(f'The predicted genre for the movie \"{train_set.loc[235, \"Title\"].title()}\"' f' is: {predicted_genre.loc[0, \"Genre\"].upper()}.') k = int(input(\"Enter k: \")) if isinstance(k, int) and k > 0: predicted_genre = knn_classification(train_set.loc[235], train_set).reset_index() print(f'The predicted genre for the movie \"{train_set.loc[235, \"Title\"].title()}\"' f' is: {predicted_genre.loc[0, \"Genre\"].upper()}.') else: print(\"Invalid input. Please enter a valid integer for k.\") in paths work unless it's followed by n pd.read_csv(\"data\\nst-est2019-01.csv\") # would NOT work cos \\n Solution: add r at the front -> indicates that it's a raw string, and backslashes will be treated as literal characters. pd.read_csv(\"data/nst-est2019-01.csv\") Or simply use a forward slash / np.searchsorted numpy.searchsorted(a, v, side='left', sorter=None)","title":"python"},{"location":"Full%20stack/python/#python","text":"","title":"Python"},{"location":"Full%20stack/python/#important","text":"","title":"Important"},{"location":"Full%20stack/python/#dictionary","text":"fruits = { 'apple': 1, 'banana': 3 } if wanna append a new key-value pair: use [] fruits['pineapple'] = 26 for looping, make sure to use for key, value in enumerate([key1, key2]) or dict. items() .keys() = print all keys .values() = print all values .items() = print all keys and values as tuples merging dictionaries dictA .update (dictB) dictA | dict B nested dictionaries -> use more than 1 []: nested_dict[name][last_name]","title":"dictionary"},{"location":"Full%20stack/python/#list","text":"Set hue = x, legend = False for ombre graphs","title":"list: []"},{"location":"Full%20stack/python/#installation","text":"First must go to the Python directory: cd C:\\Users\\kalul\\AppData\\Local\\Programs\\Python\\Python311\\Scripts pip install pandas numpy seaborn matplotlib ta statsmodels tsfracdiff hmmlearn scikit-learn # Import necessary libraries import numpy as np import pandas as pd import seaborn as sns from IPython.display import display import matplotlib.pyplot as plt import warnings warnings.filterwarnings(\"ignore\") plt.rcParams['figure.figsize'] = (10, 3) sns.set_theme(style = 'darkgrid', font_scale=0.8, palette='viridis') import statsmodels.formula.api as smf rich = pretty terminal print outs","title":"Installation"},{"location":"Full%20stack/python/#common-issue","text":"When import __ as __ -> DLL error, cannot import (happened to matplotlib and seaborn) -> Fix : Window R -> %APPDATA% -> clean all cache","title":"Common issue"},{"location":"Full%20stack/python/#virtual-environments","text":"In general, it's suggested to use virtual environments (I highly suggest looking at the official Python documentation ). With this approach, you easily can set up project-specific Python versions (as well as libraries). Easily manageable and the best part: There are lots of tutorials on the internet on how to approach this: https://www.freecodecamp.org/news/installing-multiple-python-versions-on-windows-using-virtualenv/","title":"Virtual environments"},{"location":"Full%20stack/python/#file-probing","text":"","title":"File probing"},{"location":"Full%20stack/python/#file-size","text":"import os import pandas as pd # Check the file size file_path = 'data.csv' file_size = os.path.getsize('data.csv') print(f'File size: {file_size / (1024 * 1024):.2f} MB') # Count the number of lines line_count = sum(1 for line in open('data.csv')) print(f'Number of lines: {line_count}') # Load the CSV file into a DataFrame (optional) df = pd.read_csv(file_path)","title":"File size"},{"location":"Full%20stack/python/#reading-files","text":"","title":"Reading files"},{"location":"Full%20stack/python/#using-pd","text":"CSV file_path = 'D:/Github/Python/datasets/baby.csv' baby = pd.read_csv(file_path) Arguments for read_csv: index_col = \"Year\" = set the year column as the index header = 1 = set the 1st row as the header header = None = remove all headers, columns are numbered 0 names = ['cola, colb'] = set column names thousands = ',' = character acting as the thousands separator in numerical values. delimiter/sep = ',' sep = r'\\s+' = if delimiter is white space json pd.read_json()","title":"Using pd"},{"location":"Full%20stack/python/#using-with-open","text":"This approach is more general and can be used for any type of file. You have more control over how you process the content, and it doesn't necessarily assume a tabular structure. If your data is structured and tabular, and you want to perform data analysis, the pandas methods like pd.read_json , pd.read_csv , etc., are often more convenient. If you need more flexibility, or if your data is not in a standard tabular format, using with open allows you to read and process the content in a more customized way. with open('example.txt', 'r') as file: content = file.read() Zip Importing zip files 1. import zipfile package 2. file_path 3. folder to extract the files to (extract) 4. with zipfile.ZipFile(file_path, 'r') as my_zip: my_zip.extractall(extract) import zipfile zip_file_path = 'D:/Github/Python/data100/4homework/hw02A/data.zip' extracted_dir = 'D:/Github/Python/data100/4homework/hw02A' with zipfile.ZipFile(zip_file_path, 'r') as my_zip: my_zip.extractall(extracted_dir) # 'r' = read mode","title":"Using with open"},{"location":"Full%20stack/python/#reading-all-csv-files-using-glob","text":"files = glob.glob('../data/forex_light/*.csv') forex = pd.DataFrame() content = [] for i in files: df = pd.read_csv(i, index_col='Date', header=0) content.append(df) forex = pd.concat(content, axis = 1) forex.dropna(inplace=True) forex.index = pd.to_datetime(forex.index) forex ==Advanced: os and zipfile: hw2_foodsafety==","title":"Reading all csv files using glob"},{"location":"Full%20stack/python/#other-useful-add-ons","text":"data.convert_dtypes() ( documentation ) conveniently converts data to the most appropriate type data.drop_na() ( documentation ) data.rename(columns={'old': 'new', 'old2': 'new2'})","title":"Other useful add ons"},{"location":"Full%20stack/python/#basics","text":"","title":"Basics"},{"location":"Full%20stack/python/#counting-indexing-subsetting-etc","text":"Counting unique values and put into a data frame value_counts().reset_index() Sort by any column data.sort_values(by = 'col') * Select column A from 'data' and sort by counts, descending data['A'].value_counts().sort_values(ascending=False).reset_index() Creating an empty column for now data['column'] = None Creating a subset of data subset = data[data[column] < 345] data.loc['row', 'col'] * Similar to R but in R no need for .loc * Can use iloc[] too -> for key difference [[data100 - UC Berkeley#^38e665]] Creating a 3rd column as the mean/sum/diff of other columns data['col 3'] = data[['col 1', 'col 2']].mean(axis=1, skipna=True) * We MUST specify axis = 1/0 since without it -> axis = 0 * axis = 0 = apply column to column (default) * axis = 1 = apply row to row * see ==12_deflategate.ipynb== Copy() Everytime you create a subset, include .copy() if you want to avoid changing the og data set. Dropping a column .drop('col', axis = 1) = default is axis = 0 which drops a row (rmb 0 = row, 1 = column) Or we can just type out axis = \"columns\" or axis = \"rows\" Create a new column filled with NA data['new column'] = None Naming 1 single column Use columns = ['name] df_ssn = pd.DataFrame( ['data'], columns = ['SSN'])","title":"Counting, indexing, subsetting etc."},{"location":"Full%20stack/python/#loops","text":"if continue = move onto the next iteration for strategy_parameters_value in itertools.product( *strategy_parameters_values): strategy_params = dict( zip(strategy_parameters_keys, strategy_parameters_value)) if (strategy_params['fast_window'] == strategy_parameters['fast_window'][0] and strategy_params['slow_window'] == strategy_parameters['slow_window'][0]) or \\ (strategy_params['fast_window'] == strategy_parameters['fast_window'][1] and strategy_params['slow_window'] == strategy_parameters['slow_window'][1]) or \\ (strategy_params['fast_window'] == strategy_parameters['fast_window'][2] and strategy_params['slow_window'] == strategy_parameters['slow_window'][2]) or \\ (strategy_params['fast_window'] == strategy_parameters['fast_window'][3] and strategy_params['slow_window'] == strategy_parameters['slow_window'][3]): strategy_sides = determine_strategy_side(prices, **strategy_params) else: continue","title":"Loops"},{"location":"Full%20stack/python/#data-frame-attributes","text":"Mode data['col'].mode()[0] = [0] specifies the first mode","title":"Data frame attributes"},{"location":"Full%20stack/python/#displaying-simulation-results-and-plot","text":"Def the function WITHOUT the input Outside the function Ask for input results = function() display(results.head()) sns.plot ==Example== def simulated_difference_of_means(dataset): \"\"\"Returns: Difference between mean birthweights of babies of smokers and non-smokers after shuffling labels n times\"\"\" data = [] for i in range(1, rep + 1): # Shuffling dataset['Shuffled Maternal Smoker'] = dataset['Maternal Smoker'] \\ .sample(frac=1).reset_index(drop=True) # Find dim dim = difference_of_means(dataset, 'Shuffled Maternal Smoker') # Update to results table data.append({ 'Stimulation': i, 'Difference of mean': dim }) df_data = pd.DataFrame(data) return df_data # input rep = int(input('Enter the number of repetitions: ')) # call function & display data frame result df_data = simulated_difference_of_means(births_subset) display(df_data.head()) sns.histplot(data = df_data, x = 'Difference of mean')","title":"Displaying simulation results and plot"},{"location":"Full%20stack/python/#na","text":"To quickly remove na gdp = gdp[~gdp.isna()]","title":"NA"},{"location":"Full%20stack/python/#groupby","text":"Basic syntax: dataframe.groupby['gender']('frequency').mean() . We can add more groupby criteria : ==e.g. not just by gender but also by age== df.groupby( ['gender', 'age'] )['frequency'].mean() * key: the use of [] when more than 1 element is passed to the () add more groupby metrics of interest : df.groupby('gender')[['frequency', 'count']].agg( ['mean', 'max'] )","title":"groupby"},{"location":"Full%20stack/python/#subsetting","text":"To quickly select rows of this df that is also available in another: A[A.index.isin(B.index)] Y_common = Y[Y.index.isin(Y_fracdiff.index)]","title":"Subsetting"},{"location":"Full%20stack/python/#merge-join-append","text":"Add columns to existing df (usu for features) dfa = dfa.join (dfb, on = 'Date')","title":"Merge, join, append"},{"location":"Full%20stack/python/#numpy-and-maths","text":"creating an array emission_prob = np.array([ [0.3, 0.5, 0.2], [0.1, 0.5, 0.4] ]) The first number controls the row, second number controls the columns (like dataframes) To print the entire first row: emission_prob[0, :] # array([0.3, 0.5, 0.2]) np.linspace (1, 100, 77) Print out 77 evenly spaced numbers from 1 to 100","title":"Numpy and maths"},{"location":"Full%20stack/python/#classes-methods-etc","text":"A class in Python is like a blueprint for creating objects (instances). It defines a set of attributes (variables) and methods (functions) that the objects created from the class will have. Think of a class as a template for creating something. For example, if you have a Car class, it might define that every car has attributes like color , make , and model , and methods like drive() and stop() . class Car: def __init__(self, color, make, model): self.color = color self.make = make self.model = model def drive(self): print(f\"The {self.color} {self.make} {self.model} is driving.\") def stop(self): print(f\"The {self.color} {self.make} {self.model} has stopped.\") Here, Car is a class. It defines: Attributes : color , make , model Methods : drive() , `stop() An object is an instance of a class. When you create an object from a class, it\u2019s like creating a specific item from a blueprint. my_car = Car(\"red\", \"Toyota\", \"Corolla\" Here, my_car is an object of the Car class. It has its own specific values for color , make , and model . A method is a function that is defined inside a class and operates on instances of that class. Methods are used to define the behaviors of the objects created from the class. my_car.drive() This calls the drive() method on the my_car object, making it print \"The red Toyota Corolla is driving.\" . def __init__(self, color, make, model): self.color = color self.make = make self.model = model In the Car class, __init__ sets the initial values for color , make , and model when a new Car object is created. Inheritance allows one class to inherit the attributes and methods of another class. The new class (child) can add new attributes and methods or override existing ones from the parent class. class ElectricCar(Car): def charge(self): print(f\"The {self.color} {self.make} {self.model} is charging.\") ElectricCar is a subclass of Car. It inherits all the attributes and methods of Car and adds a new method, charge() . An abstract class is a class that cannot be instantiated on its own and is meant to be a base class for other classes. It often contains abstract methods, which are methods that are declared but contain no implementation. The subclasses of the abstract class must implement these abstract methods. In other words, an abstract class is the MOTHER OF EVERYTHING In Python, abstract classes are created using the ABC module, and abstract methods are marked with the @abstractmethod decorator. from abc import ABC, abstractmethod class Animal(ABC): @abstractmethod def sound(self): pass class Dog(Animal): def sound(self): return \"Bark\" my_dog = Dog() print(my_dog.sound()) # Outputs: Bark Here, Animal is an abstract class, and sound() is an abstract method that must be implemented by any non-abstract subclass like Dog . Now onto the more complicated stuffs: The factory pattern is a design pattern that deals with the creation of objects. A factory class or method is responsible for creating objects without specifying the exact class of the object that will be created. It\u2019s useful when you want to abstract the creation process of objects, especially when the object creation involves some complexity. class AnimalFactory: @staticmethod def create_animal(animal_type): if animal_type == \"dog\": return Dog() elif animal_type == \"cat\": return Cat() else: return None my_pet = AnimalFactory.create_animal(\"dog\") print(my_pet.sound()) # Outputs: Bark Here, AnimalFactory is a factory class that creates instances of Dog or Cat based on input. A controller is a class that manages the interaction between different parts of a program. It doesn\u2019t handle the core logic itself but instead orchestrates the different pieces, making sure they work together. [!quote] summary different types of classes - Abstract Classes are at the top, defining the structure. - Concrete Classes implement these abstract classes. - Factory and Controller Classes operate at the same level as concrete classes: - Factory Classes are responsible for creating objects (like concrete classes). - Controller Classes manage the workflow, using objects created by the factory. - Methods and Attributes are at the bottom, as the actual code and data that define the behavior of classes.","title":"Classes, methods etc."},{"location":"Full%20stack/python/#models","text":"https://scikit-learn.org/stable/modules/classes.html#module-sklearn.metrics","title":"Models"},{"location":"Full%20stack/python/#a-preprocessing","text":"from sklearn.preprocessing import ___ fit_transform(data)","title":"A. Preprocessing"},{"location":"Full%20stack/python/#1-polynomial-features-overfitting","text":"from sklearn.preprocessing import PolynomialFeatures | for > linear models Initialise model using PolynomialFeatures rolypoly = PolynomialFeatures(degree = 8, include_bias = False) Fit model using fit_transform transformed = rolypoly.fit_transform(data[[\"column1\", \"column2\", \"column3\"]]) Rmb in econometrics, we could add higher than linear terms, Linear (Degree 1) : $ax+b$ Quadratic (Degree 2) : $ax^2+bx+c$ Cubic (Degree 3) : $ax^3+bx^2+cx+d$ Quartic (Degree 4) : $ax^4+bx^3+cx^2+dx+e$ Quintic (Degree 5) : $ax^5+bx^4+cx^3+dx^2+ex+f$ Sextic (Degree 6) : $ax^6+bx^5+cx^4+dx^3+ex^2+fx+g$ Septic (Degree 7) : $ax^7+bx^6+cx^5+dx^4+ex^3+fx^2+gx+h$ Octic (Degree 8) : $ax^8+bx^7+cx^6+dx^5+ex^4+fx^3+gx^2+hx+i$ Nonic (Degree 9) : $ax^9+bx^8+cx^7+dx^6+ex^5+fx^4+gx^3+hx^2+ix+j$ Decic (Degree 10) : $ax^{10}+bx^9+cx^8+dx^7+ex^6+fx^5+gx^4+hx^3+ix^2+jx+k$ For degrees higher than ten, the naming often simply uses the ordinal number followed by \"-ic\" or \"-degree polynomial,\" such as: 11th-degree polynomial or Undecic 12th-degree polynomial or Duodecic X[\"hp^3\"] = df[\"hp\"]**3 # cubic, fit a model with order 3 X[\"hp^4\"] = df[\"hp\"]**4 # short hand for X and y (defining them in fit) # Fit a model with order 3 hp3_model = lm.LinearRegression() hp3_model.fit(X[[\"hp\", \"hp^2\", \"hp^3\"]], vehicles[\"mpg\"]) hp3_model_predictions = hp3_model.predict(X[[\"hp\", \"hp^2\", \"hp^3\"]]) # Fit a model with order 4 hp4_model = lm.LinearRegression() hp4_model.fit(X[[\"hp\", \"hp^2\", \"hp^3\", \"hp^4\"]], vehicles[\"mpg\"]) hp4_model_predictions = hp4_model.predict(X[[\"hp\", \"hp^2\", \"hp^3\", \"hp^4\"]]) The problem is model complexity - the more features we have, the lower values of training error. In fact, it is a mathematical fact that if we create a polynomial model with degree $n-1$, we can perfectly model a set of $n$ points. For example, a set of 5 points can be perfectly modeled by a degree 4 model. ![[Pasted image 20240514160502.png|center|70%]] However, obviously there's gonna be a trade-off: higher test error . The model has overfit to the data used to train it. It has essentially \"memorized\" the six datapoints used during model fitting, and does not generalize well to new data. Complex models tend to be more sensitive to the data used to train them. The variance of a model refers to its tendency to vary depending on the training data used during model fitting. It turns out that our degree-5 model has very high model variance. If we randomly sample new sets of datapoints to use in training, the model varies erratically. ![[under_over_fitting.png |center|40%]]","title":"1. Polynomial features &amp; overfitting"},{"location":"Full%20stack/python/#2-standard-scaling","text":"Scaling adjusts the range of features to a predefined scale, which can be either standardization or normalisation. When values = on vastly different scales -> skew models -> must adjust the ranges etc [!note] Standardisation = rescales features to have a mean of 0 and a standard deviation of 1. * Standardisation is useful when the features have different scales, and you want to give them equal weight in the model. It is particularly beneficial for algorithms that assume Gaussian distributions, such as linear regression and logistic regression. Normalisation rescales features to a fixed range * range is usu 0 to 1 * Normalization preserves the shape of the original distribution while bringing the values into a similar numerical range. It is useful when the scale of the features is not known and might vary widely. * e.g. min max scaler [!note] Standardisation = rescales features to have a mean of 0 and a standard deviation of 1. * Standardisation is useful when the features have different scales, and you want to give them equal weight in the model. It is particularly beneficial for algorithms that assume Gaussian distributions, such as linear regression and logistic regression. Normalisation rescales features to a fixed range * range is usu 0 to 1 * Normalization preserves the shape of the original distribution while bringing the values into a similar numerical range. It is useful when the scale of the features is not known and might vary widely. e.g. min max scaler from sklearn.preprocessing import StandardScaler fit.transform Use cases * before regularisation [!warning] We do NOT scale y_train, only","title":"2. Standard scaling"},{"location":"Full%20stack/python/#b-model-selection","text":"from sklearn.model_selection import ___ fit(x_train, y_train)","title":"B. Model selection"},{"location":"Full%20stack/python/#1-train-test-split","text":"from sklearn.model_selection import train_test_split y_train contains the target output corresponding to X_train values Age Sex Disease ---- ------ | --------- X_train | y_train ) ) 5 F | A Disease ) 15 M | B Disease ) 23 M | B Disease ) training 39 M | B Disease ) data 61 F | C Disease ) 55 M | F Disease ) 76 F | D Disease ) 88 F | G Disease ) -------------|------------ X_test | y_test 63 M | C Disease ) 46 F | C Disease ) test 28 M | B Disease ) data 33 F | B Disease ) We fit the model on X_train and y_train : lalala.fit(X_train, y_train) We predict on X_test : lalala.predict(X_test) To get the accuracy score : lalala.score (general purpose, which returns r2_score for regression model and accuracy_score for classification model) for training accuracy score: lalala.score(X_train, y_train) test_score = lalala .score(X_test, y_test) Argument: stratify = True With shuffling, random order. You can stratify by defining the number of samples by class, when splitting, to stay proportional from sklearn.model_selection import train_test_split X_train, X_test, Y_train, Y_test = train_test_split(X, Y, test_size=0.2, random_state=100, shuffle=True)","title":"1. Train test split"},{"location":"Full%20stack/python/#2-one-hot-encoder","text":"It is essentially creating dummy variables (January = 0/1, February = 0/1, etc creating 11 dummy variables from sklearn.preprocessing import OneHotEncoder ![[ohe.png | center]] ==step 1== initialise a one hot encoder (ohe) object. ohe = OneHotEncoder() ==step 2== fit the encoder onto the column needs encoding (categorical column) ohe.fit(df[['column']]) ==step 3== transform the categorical column using transform and get_feature_names_out encoded_array = ohe.transform(df[['column]]).toarray() encoded_df = pd.DataFrame(encoded_array, columns = ohe.get_feature_names_out()) ==step 4== rejoin with the full X dataframe, drop the categorical column X = X_raw.join(encoded_df).drop(columns = 'day')","title":"2. One-hot encoder"},{"location":"Full%20stack/python/#c-models","text":"import sklearn.linear_model as ___","title":"C. Models"},{"location":"Full%20stack/python/#1-linear-regression","text":"==step 1== Model initialisation - initialise an instance of the model class, in this case, LinearRegression() import sklearn.linear_model as lalalalalala my_model = lalalalalala.LinearRegression() ==step 2== Train the model using .fit BTS, sklearn will run gradient descent to determine the optimal model params -> save these model params to our model instance for future use All sklearn model classes include a .fit method, which takes 2 inputs: 1. the design matrix / predictor vars / independent vars (X) 2. the target variable / predicted (y) .fit expects to receive 2D data thus it should be dataframe[['column']], not dataframe[\\'column'] my_model.fit(X, Y) ==step 3== necessary methods .intercept_ = intercept [!NOTE] Quick way to extract the coefficients [theta_1, theta_2, ...], $theta_0$ = model_h .coef_, model_h .intercept_ .coef_ = all x coefficients .predict = predicted y [!success] Short form (1 line) modelll = LinearRegression().fit(AQS, PA)","title":"1. Linear regression"},{"location":"Full%20stack/python/#2-regularisation","text":"Essentially they are linear regression but with shrinkage (LinearRegression = regularisation = 0) [!warning]+ Must standardise data before regularisation L1 regularisation (LASSO) lasso_model_scaled = lm.Lasso(alpha=0.1) lasso_model_scaled.fit(X_train_standardized, Y_train) lasso_model_scaled.coef_ L2 regularisation (RIDGE) ridge_model = lm.Ridge(alpha=0.1) ridge_model.fit(X_train_standardized, Y_train) ridge_model.coef_","title":"2. Regularisation"},{"location":"Full%20stack/python/#d-cross-validation","text":"cross validation score: from sklearn.model_selection import cross_val_score kfold: from sklearn.model_selection import KFold Initialise cross validation method cross_val_model = KFold( n_splits = 888, random_state = None, shuffle = False) (optional) identify train and test indices # cross_val_model.split(X) for train_idx, valid_idx in kf.split(X_train): split_X_train, split_X_valid = X_train.iloc[train_idx], X_train.iloc[valid_idx] split_y_train, split_y_valid = y_train.iloc[train_idx], y_train.iloc[valid_idx] (optional) to visualise the folds for i, (train_index, test_index) in enumerate(kf.split(X)): print(f\"Fold {i}:\") print(f\" Train: index={train_index}\") print(f\" Test: index={test_index}\") model fit and calculating mean error for each fold ML_model = LinearRegression() scores = cross_val_score(ML_model, X, y, scoring = 'accuracy' cv = cross_val_model, n_jobs = -1) print('Accuracy: %.3f (%.3f)' % (mean(scores), std(scores))) # before looping over each train/test index validation_errors = [] # in each loop moddell.fit(X_train, y_train) error = ... validation_errors.append(error) # outside of loop mean_error_loops = np.mean(validation_errors) Methods kalulu .get_n_splits(X) - generate indices to split data into training and test set","title":"D. Cross validation"},{"location":"Full%20stack/python/#visualisation","text":"Add ; to remove unnecessary text lines when drawing using sns (on the same line as sns lines not at the end of the code block on a separate line) Use sns.countplot instead of barplots when you don't have the variable name for one of the axes (which is most of the time)","title":"visualisation"},{"location":"Full%20stack/python/#graph-styling","text":"import seaborn as sns import pandas as pd sns.set(font_scale=1.5) import matplotlib.pyplot as plt import numpy as np from sklearn import linear_model from sklearn.metrics import mean_squared_error from sklearn.metrics import mean_absolute_error import plotly.graph_objects as go import plotly.express as px from sklearn.pipeline import Pipeline from sklearn.preprocessing import PolynomialFeatures from sklearn.linear_model import LinearRegression def adjust_fontsize(size=None): SMALL_SIZE = 8 MEDIUM_SIZE = 10 BIGGER_SIZE = 12 if size != None: SMALL_SIZE = MEDIUM_SIZE = BIGGER_SIZE = size plt.rc('font', size=SMALL_SIZE) # controls default text sizes plt.rc('axes', titlesize=SMALL_SIZE) # fontsize of the axes title plt.rc('axes', labelsize=MEDIUM_SIZE) # fontsize of the x and y labels plt.rc('xtick', labelsize=SMALL_SIZE) # fontsize of the tick labels plt.rc('ytick', labelsize=SMALL_SIZE) # fontsize of the tick labels plt.rc('legend', fontsize=SMALL_SIZE) # legend fontsize plt.rc('figure', titlesize=BIGGER_SIZE) # fontsize of the figure title plt.style.use('fivethirtyeight') sns.set_context(\"talk\") sns.set_theme() adjust_fontsize(size=20) %matplotlib inline import warnings warnings.filterwarnings('ignore')","title":"graph styling"},{"location":"Full%20stack/python/#helper-functions","text":"Plot distribution bar charts def plot_dist(dist_df, xname=\"x\", pname=\"P(X = x)\", varname=\"X\", save=False): \"\"\" Plot a distribution from a distribution table. Single-variate. \"\"\" plt.bar(dist_df[xname], dist_df[pname]) plt.ylabel(pname) plt.xlabel(xname) plt.title(f\"Distribution of ${varname}$\") plt.xticks(sorted(dist_df[xname].unique())) if save: fig = plt.gcf() fig.patch.set_alpha(0.0) plt.savefig(f\"dist{varname}.png\", bbox_inches = 'tight'); Simulate random samples def simulate_samples(df, xname=\"x\", pname=\"P(X = x)\", size=1): return np.random.choice( df[xname], # Draw from these choiecs size=size, # This many times p=df[pname]) # According to this distribution","title":"helper functions"},{"location":"Full%20stack/python/#subplots","text":"fig, ax = plt.subplots(1, 3, figsize=(12, 3)) # looping predictions_dict = {0:hp2_model_predictions, 1:hp3_model_predictions, 2:hp4_model_predictions} for i in predictions_dict: ax[i].scatter(vehicles[\"hp\"], vehicles[\"mpg\"], edgecolor=\"white\", lw=0.5) ax[i].plot(vehicles[\"hp\"], predictions_dict[i], \"tab:red\") ax[i].set_title(f\"Model with order {i+2}\") ax[i].set_xlabel(\"hp\") ax[i].set_ylabel(\"mpg\") ax[i].annotate(f\"MSE: {np.round(mse(vehicles['mpg'], predictions_dict[i]), 3)}\", (120, 40)) plt.subplots_adjust(wspace=0.3); fig, ax = plt.subplots(ncols=2) sns.histplot(tips['tip'], bins=20, stat=\"proportion\", ax=ax[0]) sns.histplot(tips['tip']/tips['total_bill'], bins=20, stat=\"proportion\", ax=ax[1])","title":"subplots"},{"location":"Full%20stack/python/#finance","text":"[!NOTE] Finding percentage change / return of strategy Long way = t1 / t0 - 1 ``` spy['returns'] = spy['close'].shift(21) / spy['close'] - 1 2. Short way spy['return'] = spy.close.shift(-21).pct_change(21) spy['strategy_return'] = spy['return'].mul(spy.signal_momentum_high) ```","title":"Finance"},{"location":"Full%20stack/python/#dataframe","text":"df1.equals(df2) to check if 2 dataframes are equal To join/merge/append new columns 1. join 2. merge (more general and versatile) To display all column names in a pretty way Instead of df.columns: display(Markdown('\\n'.join(fr'{i + 1}. {c}'.replace('$', r'\\$') for i, c in enumerate(wb.columns))))","title":"Dataframe"},{"location":"Full%20stack/python/#multiprocessing","text":"Joblib parallel : In rough terms, it spawns multiple Python processes and handles each part of the iterable in a separate process. Then it joins everything at the end. ==see backtesting paper - n_jobs== Examples: results = Parallel(n_jobs=n_jobs)( delayed(FUNCTION)(FUNCTION ARGUMENTS) for random_state_value in random_states ) path_data = Parallel(n_jobs=n_jobs)( delayed(train_test_single_estimator)( deepcopy(single_estimator), train_indices, test_indices ) for train_indices, test_indices in self._single_split(single_data) ) results = Parallel(n_jobs=n_jobs)( delayed(performance_evaluation)( np.concatenate([partitions[i] for i in train_indices], axis=0), np.concatenate([partitions[i] for i in partition_indices if i not in train_indices], axis=0), n_strategies, metric, risk_free_return ) for train_indices in partition_combinations_indices )","title":"Multiprocessing"},{"location":"Full%20stack/python/#pipeline","text":"from sklearn.pipeline import Pipeline Example: fitting polynomial model 18 times def fit_model_dataset(degree): pipelined_model = Pipeline([ ('polynomial_transformation', 'PolynomialFeatures(degree)), ('linear_regression', lm.LinearRegression()) ]) pipelined_model.fit(X_train[['hp']], Y_train) return mean_squared_error(Y_value, pipelined_model.predict(X_value[['hp']]))","title":"Pipeline"},{"location":"Full%20stack/python/#miscellaneous","text":"","title":"Miscellaneous"},{"location":"Full%20stack/python/#simple-boolean-if-xyz-prints-1","text":"ins['Missing score'] = ins['score'] == -1 OR ins['Missing score'] = (ins['score'] == -1)","title":"simple boolean, if xyz, prints 1"},{"location":"Full%20stack/python/#replace","text":"If I have a table called wine, class column: -> To know how many unique values there are in class: wine['class'].unique() -> To replace all values not 1 into 0: wine['class'] .apply(lambda x: 1 if x == 1 else 0)","title":"replace"},{"location":"Full%20stack/python/#normalise-truetrue","text":"value_counts(normalize=True) -> convert counts to proportions value_counts(normalize=True)[True] -> only show the True results","title":"Normalise = True[True]"},{"location":"Full%20stack/python/#2f","text":"= display to 2 decimal places relevant_attributes = movies[['Title', 'Genre'] + attribute_columns] table then some extra columns = use plus sign","title":":.2f"},{"location":"Full%20stack/python/#for-codes-spanning-multiple-lines","text":"Use either: \\ every line end OR () on the RHS of equation wrap all with ' ' Line code > 80 -> use single quotes to wrap each line: print(f'The predicted genre for the movie \"{train_set.loc[235, \"Title\"].title()}\"' f' is: {predicted_genre.loc[0, \"Genre\"].upper()}.') k = int(input(\"Enter k: \")) if isinstance(k, int) and k > 0: predicted_genre = knn_classification(train_set.loc[235], train_set).reset_index() print(f'The predicted genre for the movie \"{train_set.loc[235, \"Title\"].title()}\"' f' is: {predicted_genre.loc[0, \"Genre\"].upper()}.') else: print(\"Invalid input. Please enter a valid integer for k.\")","title":"For codes spanning multiple lines"},{"location":"Full%20stack/python/#in-paths-work-unless-its-followed-by-n","text":"pd.read_csv(\"data\\nst-est2019-01.csv\") # would NOT work cos \\n Solution: add r at the front -> indicates that it's a raw string, and backslashes will be treated as literal characters. pd.read_csv(\"data/nst-est2019-01.csv\") Or simply use a forward slash /","title":"in paths work unless it's followed by n"},{"location":"Full%20stack/python/#npsearchsorted","text":"numpy.searchsorted(a, v, side='left', sorter=None)","title":"np.searchsorted"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/","text":"Data101. Data engineering UCBerkeley Course notes : https://data101.org/notes/overview.html Schedule : https://data101.org/sp24/ Week 1. Data engineering and SQL overview Content Link Status Lecture 1 Lec1 Done Lecture 2 Lec2 Done Worksheet worksheet Done Worksheet solution solution Done Jupyter notebook nb Done Course notes PDF pdf Done MD notes link Done 0. Why data engineer [!quote]- Why learn data engineering? ![[Pasted image 20241011150544.png|centre|60%]] ![[Pasted image 20241011150614.png|centre|60%]] ![[Pasted image 20241011150643.png|centre|60%]] ![[Pasted image 20241011150737.png|centre|60%]] Major frameworks: FirstMark | 2024 MAD (ML/AI/Data) Landscape ==Code-centric== ==Query-centric== Main Storage API is files AWS S3, Azure File Storage, Google Cloud Storage, HDFS, \u2026 Main Storage API is tables Snowflake, BigQuery, Redshift, Azure Synapse, Teradata (founded 1979, still relevant!!) Libraries in general-purpose programming languages, lots of separation - Spark (Scala/Java) for batch processing - Ad hoc code (Python/pandas) for exploration - Metadata tracked in a separate store One language/paradigm for (almost) everything - Batch: SQL - Interactive: SQL - Metadata auto-tracked in database - Other bytestream data stored in files We're gonna be taking the query centric approach based on relational algebra (RA) and relational calculus (RC) RA is procedural, RC is declarative (not algos but outputs, in contrast to ) SQL * declarative : in contrast to general purpose languages like C which are often imperative * abstraction : no overfitting of code to whatever task at hand ![[Pasted image 20241017021421.png|centre|50%]] 3. Relational algrebra Query execution has its foundation in Relational Algebra, which shares some of its concepts with Set Theory. \u2022 Let A and B be sets where A = {1, 2, 3, 4, 5} and B = {2, 3, 4, 5, 6}. \u2022 Let R and S be bags where R = {1, 1, 1, 2, 2, 4, 4}, and S = {2, 3, 3, 3, 4, 4}. [!example] ==Union== Write out A \u222a B and R \u222a S. 1. A \u222a B = {1, 2, 3, 4, 5, 6} 2. R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . [!example] ==Union== Write out A \u222a B and R \u222a S. - A \u222a B = {1, 2, 3, 4, 5, 6} - R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . [!example] ==Union== Write out A \u222a B and R \u222a S. A \u222a B = {1, 2, 3, 4, 5, 6} R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . ==Union== Write out A \u222a B and R \u222a S. 1. A \u222a B = {1, 2, 3, 4, 5, 6} 2. R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . ==Union== Write out A \u222a B and R \u222a S. - A \u222a B = {1, 2, 3, 4, 5, 6} - R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . ==Union== Write out A \u222a B and R \u222a S. A \u222a B = {1, 2, 3, 4, 5, 6} R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . Primitive RA Operations Relational algebra (RA) has six primitive operators, upon which all other complex operators are formed: Unary 1. Projection 2. Selection 3. Renaming Binary Product Union Difference Unary operators = each operator f takes as input 1 operand relation R with schema $(B_1,\u2026,B_m)$ and outputs an output relation f(R) . The output relation can be unnamed. Projection ( SELECT ) - selecting the desired columns, discard the rest $$\\pi_{A_1, A_2, \\dots, A_n}(R)$$ - If the relation (table) $R$ has attributes (columns) ${B_1, B_2, ..., B_m}$, projection selects a subset ${A_1, A_2, ..., A_n}$ where $n\u2264m$. - The projection operator outputs a relation that contains the tuples of the input relation $R$, but restricted to set of attributes ${A1,\u2026,An}$. ==e.g== Imagine a table with information about students: student_id, name, age, GPA; if you project onto only the name and GPA columns, your output will be a new table that only shows the names and GPAs of the students: $$\\pi_{name, GPA}(students)$$ Selection ( WHERE ) - selecting the desired rows, discard the rest $$\\sigma_C(R)$$ * The selection operator outputs a relation that contains the tuples of input relation $R$ that satisfy the row condition $C$. * The row condition is defined to contain attributes with boolean expressions: $=$, $>$, $<$, $!=$, AND ($\\wedge$), OR ($\\vee$), NOT ($!$), etc. * Because selection is a row filter, the input and output schema share the same schema , with set of attributes ${B_1, \\dots, B_m}$. ==e.g== You only want to see students whose GPA > 3.0. This is selection: we filter rows based on the given condition. $$\\sigma_{GPA>3.0}(students)$$ Renaming ( AS ) - the renaming operator outputs a relation with the same data as the input relation, but with renamed attributes and/or relation name. $$\\rho_{S(A_1, \\dots, A_m)}(R)$$equivalently $$\\rho_{S(B_{i_1}\\rightarrow A_1, \\dots, B_{i_n} \\rightarrow A_n)}(R)$$ - The number of attributes, m therefore stays consistent across the input and output relation, and the data in tuples does not change. ==e.g== Imagine a table with the columns first_name and last_name. You want to rename them to given_name and family_name for clarity: $$\\rho_{\\text{given_name} \\rightarrow \\text{first_name}, \\text{family_name} \\rightarrow \\text{last_name}}(\\text{students})$$ ==Example of unary operations== Suppose that we have two relations with the following schema: $\\text{titles(title_id, type, primary_title, runtime_minutes)}$ $\\text{people(person_id, name, born, died)}$ $\\pi_{\\text{title_id, primary_title}}(\\text{titles})$ outputs a relation with tuples of $\\text{titles}$ that are restricted to the attributes $\\text{title_id}$ and $\\text{primary_title}$. In other words, we \"drop\" the other attributes $\\text{type}$ and $\\text{runtime_minutes}$. $\\sigma_{\\text{born} > 1980}(\\text{people})$ outputs a relation with tuples of $\\text{people}$ that satisfy the condition where $\\text{born} > 1980$. $\\rho_{\\text{persons(person_id, name, birth, death)}}(\\text{people})$ outputs a relation named $\\text{persons}$ that has the tuples of $\\text{people}$ but renames attributes $\\text{born}$ and $\\text{died}$ to $\\text{birth}$ and $\\text{death}$, respectively, and keeps $\\text{person_id}$ and $\\text{name}$ unchanged. $\\rho_{\\text{persons}(\\text{born} \\rightarrow \\text{birth}, \\text{died} \\rightarrow \\text{death}}(\\text{people})$ does the same as the previous example but is more concise. Binary operators = each operator f takes as input 2 operand relations R1 and R2 with schemas $(B_1, \\dots, B_m)$ and $(C_1, \\dots, C_n)$ and outputs an output relation f(R1, R2) . The output relation can be unnamed. Product (or Cross Product, Cartesian Product) = outputs a relation that is the Cartesian product of the two input relations $R_1$ and $R_2$. (or Cross Product, Cartesian Product), $R_1 \\times R_2$. $$R_1 \\times R_2$$ - The output relation will contain all possible combinations of tuples from $R_1$ and $R_2$, resulting in a relation with a schema that combines the attributes of both input relations. ==e.g== If we have two relations: $R_1$ (with schema ${A, B}$): A: 1, B: X A: 2, B: Y $R_2$ (with schema ${C, D}$): C: 3, D: P C: 4, D: Q The product $R_1 \\times R_2$ results in: A: 1, B: X, C: 3, D: P A: 1, B: X, C: 4, D: Q A: 2, B: Y, C: 3, D: P A: 2, B: Y, C: 4, D: Q Union = outputs a relation that combines the tuples from both input relations $R_1$ and $R_2$. $$R_1 \\cup R_2$$ - The output relation includes all unique tuples from both relations. The input relations must have the same schema (same attributes). ==e.g== Consider the two relations: $R_1$: id: 1, name: Alice id: 2, name: Bob $R_2$: id: 2, name: Bob id: 3, name: Charlie The union $R_1 \\cup R_2$ results in: id: 1, name: Alice id: 2, name: Bob id: 3, name: Charlie Notice that Bob appears only once in the output, as the union operator removes duplicates . Difference = outputs a relation containing tuples that are in the first relation $R_1$ but not in the second relation $R_2$. $$$R_1 - R_2$$ - Like the union operator, the input relations must have the same schema. ==e.g.== If we have: $R_1$: id: 1, name: Alice id: 2, name: Bob $R_2$: id: 2, name: Bob id: 3, name: Charlie The difference $R_1 - R_2$ results in: id: 1, name: Alice Derived RA operations Intersection = set intersection of rows in R1 and R2 (union+difference) $$R_1 \\cap R_2$$ Join = special cases of Cartesian products & unary operators. Theta join = outputs a relation that joins two relations such that each row satisfies the condition $\\theta$ $$R_1 \\bowtie_{\\theta} R_2 = \\sigma_{\\theta}( R_1 \\times R_2)$$ Because it is defined with a cross product, the output schema distinguishes common attributes $A_i$ in $R_1$ and $B_j$ in $R_2$ as $R_1.A_i$ and $R_2.B_j$, respectively. Equi join = special case of the theta join, where $\\theta$ is an \"equality condition,\" i.e., contains only boolean expressions involving equality ($=$) and logical AND ($\\wedge$). Natural join - outputs a relation that joins the two input relations $R_1$ and $R_2$ such that rows are matched on common attributes and removes duplicate attributes in the output relation schema $$R_1 \\bowtie R_2$$ 1. cross product of $R_1$ and $R_2$. 2. selection with equality condition $\\theta$, where $\\theta$ filters out rows for which shared attributes do not have matching values. In other words, for each attribute pair $R_1.A_i, R_2.B_j$ where $A_i$ in $R_1$ and $B_j$ in $R_2$ have the same attribute name (\"common attributes\"), only keep the tuple if its values for $R_1.A_i$ and $R_2.B_j$ match. 3. Rename one set of common attributes back to their original name, e.g., $R_1.A_i$ is renamed to $A_i$ for each $A_i = B_j$. 4. Drop the other set of common attributes, e.g., drop $R_2.B_j$ ==e.g== natural join: suppose we have the two relations $\\text{crew(tid, pid, c, j)}$ $\\text{people(pid, n, b, d)}$ The natural join of crew and people would then satisfy: $$\\text{crew} \\bowtie \\text{people} = \\pi_{\\text{tid, pid, c, j, n, b, d}}\\bigl(\\rho_{\\text{crew.pid} \\rightarrow \\text{pid}} \\bigl( \\sigma_{\\text{crew.pid = people.pid}} (\\text{crew} \\times \\text{people}) \\bigr) \\bigr)$$. In special cases, the natural join reduces to other operators. ==e.g== Suppose we have the 3 relations: $$R(A, B), S(A, B), T(C, D)$$ Then \\ $$R \\bowtie S = R \\cap S$$and $$R \\bowtie T = R \\times T$$ Converting from SQL query to relational algebra SELECT a1, a2, \u2026, an, agg1(d1), agg2(d2), \u2026, aggp(dp) FROM R1, R2, \u2026, Rk WHERE C GROUP BY b1, b2, \u2026, bm HAVING H We could write the SQL order of execution of the above query using extended relational algebra as follows: $$\\pi_{list} \\biggl( \\sigma_H \\biggl( \\gamma_{b1, \\dots, bm, agg1(d1), \\dots, aggp(dp)} \\bigl( \\sigma_C (R1 \\times \\dots Rk ) \\bigr) \\biggr) \\biggr)$$ $list$ - the list of expressions in SELECT , ==e.g== $a1, \\dots, an, agg1(d1), \\dots, aggp(dp)$ $agg1(d1), \\dots aggp(dp)$ - aggregation functions on specific attributes $d1, \\dots, dp$ in the cross product of $R1 \\times \\dots \\times Rk$, $a1, \\dots, an$ - a subset of the grouped attributes $b1, \\dots, bm$. 4. Data engineering ETL Extract : Scrape raw data from all the source systems, e.g., transactions, sensors, log files, experiments, tables, bytestreams, \u2026 Transform : Apply a series of rules or functions, wrangle data into schema(s)/format(s) Load : Load data into a data storage solution ELT Load without doing a lot of transformation, with transformations done in SQL. Faster to get going, and more scalable, but requires more data warehousing knowledge (& may be more expensive). newer (e.g., the Snowflake approach) ET For data lakes - No need to \u201cmanage\u201d data Data is dumped in cheaply and massaged as needed for various use-cases Usually code-centric ( Spark ) Data warehouse vs. data lakes Essentially we have 2 extremes: Data Warehouse , ~1990s ETL * \u201cSingle source of truth\u201d: A central, organized repository of data used for analytics throughout an enterprise. * Design the uber-schema up-front of all of the rectangular tables you\u2019d ever want. * Extract from trusted sources * Transform to warehouse schema using custom tools * Load data warehouse * Old school ETL solution: Informatica Data Lake , ~2010s ELT * Emerged during Hadoop/Spark revolution * \u201cLanding zone\u201d: unconstrained storage for any and all data * Data is then analyzed on demand * Extract into files/storage * Load into storage (easy!) * Transform on demand for any use. * Create new files in the lake, catalog files as they go for reuse * Often code-centric New term: -> Data Lakehouse Week 2. Relational model and algebra Content Link Status Lecture 3 Lec3 Done Lecture 4 Lec4 Done","title":"DATA101 Data engineering PostgreSQL"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#data101-data-engineering-ucberkeley","text":"Course notes : https://data101.org/notes/overview.html Schedule : https://data101.org/sp24/","title":"Data101. Data engineering UCBerkeley"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#week-1-data-engineering-and-sql-overview","text":"Content Link Status Lecture 1 Lec1 Done Lecture 2 Lec2 Done Worksheet worksheet Done Worksheet solution solution Done Jupyter notebook nb Done Course notes PDF pdf Done MD notes link Done","title":"Week 1. Data engineering and SQL overview"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#0-why-data-engineer","text":"[!quote]- Why learn data engineering? ![[Pasted image 20241011150544.png|centre|60%]] ![[Pasted image 20241011150614.png|centre|60%]] ![[Pasted image 20241011150643.png|centre|60%]] ![[Pasted image 20241011150737.png|centre|60%]] Major frameworks: FirstMark | 2024 MAD (ML/AI/Data) Landscape ==Code-centric== ==Query-centric== Main Storage API is files AWS S3, Azure File Storage, Google Cloud Storage, HDFS, \u2026 Main Storage API is tables Snowflake, BigQuery, Redshift, Azure Synapse, Teradata (founded 1979, still relevant!!) Libraries in general-purpose programming languages, lots of separation - Spark (Scala/Java) for batch processing - Ad hoc code (Python/pandas) for exploration - Metadata tracked in a separate store One language/paradigm for (almost) everything - Batch: SQL - Interactive: SQL - Metadata auto-tracked in database - Other bytestream data stored in files We're gonna be taking the query centric approach based on relational algebra (RA) and relational calculus (RC) RA is procedural, RC is declarative (not algos but outputs, in contrast to ) SQL * declarative : in contrast to general purpose languages like C which are often imperative * abstraction : no overfitting of code to whatever task at hand ![[Pasted image 20241017021421.png|centre|50%]]","title":"0. Why data engineer"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#3-relational-algrebra","text":"Query execution has its foundation in Relational Algebra, which shares some of its concepts with Set Theory. \u2022 Let A and B be sets where A = {1, 2, 3, 4, 5} and B = {2, 3, 4, 5, 6}. \u2022 Let R and S be bags where R = {1, 1, 1, 2, 2, 4, 4}, and S = {2, 3, 3, 3, 4, 4}. [!example] ==Union== Write out A \u222a B and R \u222a S. 1. A \u222a B = {1, 2, 3, 4, 5, 6} 2. R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . [!example] ==Union== Write out A \u222a B and R \u222a S. - A \u222a B = {1, 2, 3, 4, 5, 6} - R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . [!example] ==Union== Write out A \u222a B and R \u222a S. A \u222a B = {1, 2, 3, 4, 5, 6} R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . ==Union== Write out A \u222a B and R \u222a S. 1. A \u222a B = {1, 2, 3, 4, 5, 6} 2. R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . ==Union== Write out A \u222a B and R \u222a S. - A \u222a B = {1, 2, 3, 4, 5, 6} - R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates . ==Union== Write out A \u222a B and R \u222a S. A \u222a B = {1, 2, 3, 4, 5, 6} R \u222a S = {1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4} Union contains ALL elements including duplicates .","title":"3. Relational algrebra"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#primitive-ra-operations","text":"Relational algebra (RA) has six primitive operators, upon which all other complex operators are formed: Unary 1. Projection 2. Selection 3. Renaming Binary Product Union Difference Unary operators = each operator f takes as input 1 operand relation R with schema $(B_1,\u2026,B_m)$ and outputs an output relation f(R) . The output relation can be unnamed. Projection ( SELECT ) - selecting the desired columns, discard the rest $$\\pi_{A_1, A_2, \\dots, A_n}(R)$$ - If the relation (table) $R$ has attributes (columns) ${B_1, B_2, ..., B_m}$, projection selects a subset ${A_1, A_2, ..., A_n}$ where $n\u2264m$. - The projection operator outputs a relation that contains the tuples of the input relation $R$, but restricted to set of attributes ${A1,\u2026,An}$. ==e.g== Imagine a table with information about students: student_id, name, age, GPA; if you project onto only the name and GPA columns, your output will be a new table that only shows the names and GPAs of the students: $$\\pi_{name, GPA}(students)$$ Selection ( WHERE ) - selecting the desired rows, discard the rest $$\\sigma_C(R)$$ * The selection operator outputs a relation that contains the tuples of input relation $R$ that satisfy the row condition $C$. * The row condition is defined to contain attributes with boolean expressions: $=$, $>$, $<$, $!=$, AND ($\\wedge$), OR ($\\vee$), NOT ($!$), etc. * Because selection is a row filter, the input and output schema share the same schema , with set of attributes ${B_1, \\dots, B_m}$. ==e.g== You only want to see students whose GPA > 3.0. This is selection: we filter rows based on the given condition. $$\\sigma_{GPA>3.0}(students)$$ Renaming ( AS ) - the renaming operator outputs a relation with the same data as the input relation, but with renamed attributes and/or relation name. $$\\rho_{S(A_1, \\dots, A_m)}(R)$$equivalently $$\\rho_{S(B_{i_1}\\rightarrow A_1, \\dots, B_{i_n} \\rightarrow A_n)}(R)$$ - The number of attributes, m therefore stays consistent across the input and output relation, and the data in tuples does not change. ==e.g== Imagine a table with the columns first_name and last_name. You want to rename them to given_name and family_name for clarity: $$\\rho_{\\text{given_name} \\rightarrow \\text{first_name}, \\text{family_name} \\rightarrow \\text{last_name}}(\\text{students})$$ ==Example of unary operations== Suppose that we have two relations with the following schema: $\\text{titles(title_id, type, primary_title, runtime_minutes)}$ $\\text{people(person_id, name, born, died)}$ $\\pi_{\\text{title_id, primary_title}}(\\text{titles})$ outputs a relation with tuples of $\\text{titles}$ that are restricted to the attributes $\\text{title_id}$ and $\\text{primary_title}$. In other words, we \"drop\" the other attributes $\\text{type}$ and $\\text{runtime_minutes}$. $\\sigma_{\\text{born} > 1980}(\\text{people})$ outputs a relation with tuples of $\\text{people}$ that satisfy the condition where $\\text{born} > 1980$. $\\rho_{\\text{persons(person_id, name, birth, death)}}(\\text{people})$ outputs a relation named $\\text{persons}$ that has the tuples of $\\text{people}$ but renames attributes $\\text{born}$ and $\\text{died}$ to $\\text{birth}$ and $\\text{death}$, respectively, and keeps $\\text{person_id}$ and $\\text{name}$ unchanged. $\\rho_{\\text{persons}(\\text{born} \\rightarrow \\text{birth}, \\text{died} \\rightarrow \\text{death}}(\\text{people})$ does the same as the previous example but is more concise. Binary operators = each operator f takes as input 2 operand relations R1 and R2 with schemas $(B_1, \\dots, B_m)$ and $(C_1, \\dots, C_n)$ and outputs an output relation f(R1, R2) . The output relation can be unnamed. Product (or Cross Product, Cartesian Product) = outputs a relation that is the Cartesian product of the two input relations $R_1$ and $R_2$. (or Cross Product, Cartesian Product), $R_1 \\times R_2$. $$R_1 \\times R_2$$ - The output relation will contain all possible combinations of tuples from $R_1$ and $R_2$, resulting in a relation with a schema that combines the attributes of both input relations. ==e.g== If we have two relations: $R_1$ (with schema ${A, B}$): A: 1, B: X A: 2, B: Y $R_2$ (with schema ${C, D}$): C: 3, D: P C: 4, D: Q The product $R_1 \\times R_2$ results in: A: 1, B: X, C: 3, D: P A: 1, B: X, C: 4, D: Q A: 2, B: Y, C: 3, D: P A: 2, B: Y, C: 4, D: Q Union = outputs a relation that combines the tuples from both input relations $R_1$ and $R_2$. $$R_1 \\cup R_2$$ - The output relation includes all unique tuples from both relations. The input relations must have the same schema (same attributes). ==e.g== Consider the two relations: $R_1$: id: 1, name: Alice id: 2, name: Bob $R_2$: id: 2, name: Bob id: 3, name: Charlie The union $R_1 \\cup R_2$ results in: id: 1, name: Alice id: 2, name: Bob id: 3, name: Charlie Notice that Bob appears only once in the output, as the union operator removes duplicates . Difference = outputs a relation containing tuples that are in the first relation $R_1$ but not in the second relation $R_2$. $$$R_1 - R_2$$ - Like the union operator, the input relations must have the same schema. ==e.g.== If we have: $R_1$: id: 1, name: Alice id: 2, name: Bob $R_2$: id: 2, name: Bob id: 3, name: Charlie The difference $R_1 - R_2$ results in: id: 1, name: Alice","title":"Primitive RA Operations"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#derived-ra-operations","text":"Intersection = set intersection of rows in R1 and R2 (union+difference) $$R_1 \\cap R_2$$ Join = special cases of Cartesian products & unary operators. Theta join = outputs a relation that joins two relations such that each row satisfies the condition $\\theta$ $$R_1 \\bowtie_{\\theta} R_2 = \\sigma_{\\theta}( R_1 \\times R_2)$$ Because it is defined with a cross product, the output schema distinguishes common attributes $A_i$ in $R_1$ and $B_j$ in $R_2$ as $R_1.A_i$ and $R_2.B_j$, respectively. Equi join = special case of the theta join, where $\\theta$ is an \"equality condition,\" i.e., contains only boolean expressions involving equality ($=$) and logical AND ($\\wedge$). Natural join - outputs a relation that joins the two input relations $R_1$ and $R_2$ such that rows are matched on common attributes and removes duplicate attributes in the output relation schema $$R_1 \\bowtie R_2$$ 1. cross product of $R_1$ and $R_2$. 2. selection with equality condition $\\theta$, where $\\theta$ filters out rows for which shared attributes do not have matching values. In other words, for each attribute pair $R_1.A_i, R_2.B_j$ where $A_i$ in $R_1$ and $B_j$ in $R_2$ have the same attribute name (\"common attributes\"), only keep the tuple if its values for $R_1.A_i$ and $R_2.B_j$ match. 3. Rename one set of common attributes back to their original name, e.g., $R_1.A_i$ is renamed to $A_i$ for each $A_i = B_j$. 4. Drop the other set of common attributes, e.g., drop $R_2.B_j$ ==e.g== natural join: suppose we have the two relations $\\text{crew(tid, pid, c, j)}$ $\\text{people(pid, n, b, d)}$ The natural join of crew and people would then satisfy: $$\\text{crew} \\bowtie \\text{people} = \\pi_{\\text{tid, pid, c, j, n, b, d}}\\bigl(\\rho_{\\text{crew.pid} \\rightarrow \\text{pid}} \\bigl( \\sigma_{\\text{crew.pid = people.pid}} (\\text{crew} \\times \\text{people}) \\bigr) \\bigr)$$. In special cases, the natural join reduces to other operators. ==e.g== Suppose we have the 3 relations: $$R(A, B), S(A, B), T(C, D)$$ Then \\ $$R \\bowtie S = R \\cap S$$and $$R \\bowtie T = R \\times T$$","title":"Derived RA operations"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#converting-from-sql-query-to-relational-algebra","text":"SELECT a1, a2, \u2026, an, agg1(d1), agg2(d2), \u2026, aggp(dp) FROM R1, R2, \u2026, Rk WHERE C GROUP BY b1, b2, \u2026, bm HAVING H We could write the SQL order of execution of the above query using extended relational algebra as follows: $$\\pi_{list} \\biggl( \\sigma_H \\biggl( \\gamma_{b1, \\dots, bm, agg1(d1), \\dots, aggp(dp)} \\bigl( \\sigma_C (R1 \\times \\dots Rk ) \\bigr) \\biggr) \\biggr)$$ $list$ - the list of expressions in SELECT , ==e.g== $a1, \\dots, an, agg1(d1), \\dots, aggp(dp)$ $agg1(d1), \\dots aggp(dp)$ - aggregation functions on specific attributes $d1, \\dots, dp$ in the cross product of $R1 \\times \\dots \\times Rk$, $a1, \\dots, an$ - a subset of the grouped attributes $b1, \\dots, bm$.","title":"Converting from SQL query to relational algebra"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#4-data-engineering","text":"","title":"4. Data engineering"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#etl","text":"Extract : Scrape raw data from all the source systems, e.g., transactions, sensors, log files, experiments, tables, bytestreams, \u2026 Transform : Apply a series of rules or functions, wrangle data into schema(s)/format(s) Load : Load data into a data storage solution","title":"ETL"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#elt","text":"Load without doing a lot of transformation, with transformations done in SQL. Faster to get going, and more scalable, but requires more data warehousing knowledge (& may be more expensive). newer (e.g., the Snowflake approach)","title":"ELT"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#et","text":"For data lakes - No need to \u201cmanage\u201d data Data is dumped in cheaply and massaged as needed for various use-cases Usually code-centric ( Spark )","title":"ET"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#data-warehouse-vs-data-lakes","text":"Essentially we have 2 extremes: Data Warehouse , ~1990s ETL * \u201cSingle source of truth\u201d: A central, organized repository of data used for analytics throughout an enterprise. * Design the uber-schema up-front of all of the rectangular tables you\u2019d ever want. * Extract from trusted sources * Transform to warehouse schema using custom tools * Load data warehouse * Old school ETL solution: Informatica Data Lake , ~2010s ELT * Emerged during Hadoop/Spark revolution * \u201cLanding zone\u201d: unconstrained storage for any and all data * Data is then analyzed on demand * Extract into files/storage * Load into storage (easy!) * Transform on demand for any use. * Create new files in the lake, catalog files as they go for reuse * Often code-centric New term: -> Data Lakehouse","title":"Data warehouse vs. data lakes"},{"location":"Maths/DATA101%20Data%20engineering%20PostgreSQL/#week-2-relational-model-and-algebra","text":"Content Link Status Lecture 3 Lec3 Done Lecture 4 Lec4 Done","title":"Week 2. Relational model and algebra"},{"location":"Maths/Doccen%20tasks/","text":"Doccen tada list Doccen consumer [ ] Update 'Viewing history' doc to include the time Doccen internal [ ]","title":"Doccen tasks"},{"location":"Maths/Doccen%20tasks/#doccen-tada-list","text":"","title":"Doccen tada list"},{"location":"Maths/Doccen%20tasks/#doccen-consumer","text":"[ ] Update 'Viewing history' doc to include the time","title":"Doccen consumer"},{"location":"Maths/Doccen%20tasks/#doccen-internal","text":"[ ]","title":"Doccen internal"},{"location":"Maths/International%20Finance/","text":"[[WSU]] [[1. Multinational financial management]] [[2. International monetary system]] [[3. Balance of payments]] - (OPTIONAL) [[5. Foreign exchange market]] [[6. International parity conditions]] [[7. Foreign currency derivatives]] [[9. Foreign exchange rate determination & forecasting]] [[10. Transaction exposure]] [[13. Global cost of capital]] [[14. Sourcing capital globally]] [[16. International trade finance]] [[17. Foreign direct investment]] Recommended problems and tutorials from Chap 5, 6, 7, 10, 13, 14, 16","title":"International Finance"},{"location":"Maths/Neural%20networks/","text":"pStatQuest with Josh Starmer AutoML: [[AutoML.canvas|AutoML]] Definitions A neural network is a series of algorithms that attempt to recognize underlying relationships in a set of data through a process that mimics the way the human brain operates. A neural network consists of layers of nodes, also known as neurons . These layers include: Input Layer : The layer that receives the input data. Hidden Layers : Intermediate layers that perform computations and feature transformations. Output Layer : The layer that produces the final output of the network. Directed Acyclic Graph (DAG) representation A neural architecture can be represented as a Directed Acyclic Graph (DAG). Let's break this down: Directed : The connections (edges) between nodes have a direction, indicating the flow of data. Acyclic : No loops/cycles - The graph does not contain any cycles; data flows in one direction without looping back. [!NOTE]+ Example of a DAG - entire-based structure 2 simplified examples of entire-structured neural architectures. * Each layer is specified with a different operation, such as 'convolution' and 'max pooling' operations. * The edge indicates the information flow. * The skip-connection operation used in the right example can help explore deeper and more complex neural architectures. ![[Pasted image 20240530095539.png]] Components of the DAG: Nodes : Represent feature tensors, which are multi-dimensional arrays of numbers. Each node performs a specific computation or operation. Edges : Represent the operations applied to the data as it flows from one node to another. Formula for computation at any node The given formula (AutoML A survey of the state-of-the-art) explains the computation at any node $Z_k$ in the DAG. $$ Z_k = \\sum_{i=1}^{N_k} o_i(I_i), \\quad o_i \\in O $$ - $Z_k$: The output feature tensor at node $k$. - $N_k$: The number of incoming edges (indegree) to node $Z_k$. - $I_i$: The $i$-th input tensor to node $Z_k$. - $o_i$: The operation applied to $I_i$, selected from a set of candidate operations $O$. Operations The set of candidate operations OOO can include: Convolution : Applies a filter to the input to extract features. Pooling : Reduces the dimensionality of the input, keeping the most important information. Activation Functions : Introduce non-linearity into the model (e.g., ReLU, sigmoid). Skip Connection : Allows the input to skip certain layers, aiding in training deeper networks. Concatenation : Combines inputs from multiple nodes. Addition : Adds inputs from multiple nodes. Advanced modules To enhance model performance, NAS methods often use advanced, human-designed modules as primitive operations: Depth-wise Separable Convolution : A form of convolution that reduces computational cost and model size. Dilated Convolution : Expands the receptive field without losing resolution. Squeeze-and-Excitation (SE) Blocks : Improve the network's sensitivity to important features. Search space in NAS The search space defines all possible neural network architectures that NAS can explore. A well-designed search space should: Exclude Human Bias : Allow the algorithm to explore architectures that a human designer might not consider. Be Flexible : Cover a wide variety of potential architectures to ensure the best possible model can be found. 1. Entire-structured search space stacking a predefined number of nodes PROS : easy to implement CONS : * deeper= better generalisation ability BUT can be onerous & computationally expensive * lacks transferability (aka may need a new model for a larger dataset) ![[Pasted image 20240530095539.png]] Left: simplest Right: more complex as it permits arbitrary skip connections to exist btwn the ordered nodes (these nodes have been proven effective in practice) 2. Cell-based search space Compose of a fixed number of repeating cell structures (cell = motif / block) To enable the transferability of the generated model, the cell-based search space has been proposed, in which the neural architecture is composed of a fixed num ber of repeating cell structures. This design approach is based on the observation that many well-performing human-designed models are also built by stacking a fixed number of modules.","title":"Neural networks"},{"location":"Maths/Neural%20networks/#definitions","text":"A neural network is a series of algorithms that attempt to recognize underlying relationships in a set of data through a process that mimics the way the human brain operates. A neural network consists of layers of nodes, also known as neurons . These layers include: Input Layer : The layer that receives the input data. Hidden Layers : Intermediate layers that perform computations and feature transformations. Output Layer : The layer that produces the final output of the network.","title":"Definitions"},{"location":"Maths/Neural%20networks/#directed-acyclic-graph-dag-representation","text":"A neural architecture can be represented as a Directed Acyclic Graph (DAG). Let's break this down: Directed : The connections (edges) between nodes have a direction, indicating the flow of data. Acyclic : No loops/cycles - The graph does not contain any cycles; data flows in one direction without looping back. [!NOTE]+ Example of a DAG - entire-based structure 2 simplified examples of entire-structured neural architectures. * Each layer is specified with a different operation, such as 'convolution' and 'max pooling' operations. * The edge indicates the information flow. * The skip-connection operation used in the right example can help explore deeper and more complex neural architectures. ![[Pasted image 20240530095539.png]] Components of the DAG: Nodes : Represent feature tensors, which are multi-dimensional arrays of numbers. Each node performs a specific computation or operation. Edges : Represent the operations applied to the data as it flows from one node to another.","title":"Directed Acyclic Graph (DAG) representation"},{"location":"Maths/Neural%20networks/#formula-for-computation-at-any-node","text":"The given formula (AutoML A survey of the state-of-the-art) explains the computation at any node $Z_k$ in the DAG. $$ Z_k = \\sum_{i=1}^{N_k} o_i(I_i), \\quad o_i \\in O $$ - $Z_k$: The output feature tensor at node $k$. - $N_k$: The number of incoming edges (indegree) to node $Z_k$. - $I_i$: The $i$-th input tensor to node $Z_k$. - $o_i$: The operation applied to $I_i$, selected from a set of candidate operations $O$.","title":"Formula for computation at any node"},{"location":"Maths/Neural%20networks/#operations","text":"The set of candidate operations OOO can include: Convolution : Applies a filter to the input to extract features. Pooling : Reduces the dimensionality of the input, keeping the most important information. Activation Functions : Introduce non-linearity into the model (e.g., ReLU, sigmoid). Skip Connection : Allows the input to skip certain layers, aiding in training deeper networks. Concatenation : Combines inputs from multiple nodes. Addition : Adds inputs from multiple nodes.","title":"Operations"},{"location":"Maths/Neural%20networks/#advanced-modules","text":"To enhance model performance, NAS methods often use advanced, human-designed modules as primitive operations: Depth-wise Separable Convolution : A form of convolution that reduces computational cost and model size. Dilated Convolution : Expands the receptive field without losing resolution. Squeeze-and-Excitation (SE) Blocks : Improve the network's sensitivity to important features.","title":"Advanced modules"},{"location":"Maths/Neural%20networks/#search-space-in-nas","text":"The search space defines all possible neural network architectures that NAS can explore. A well-designed search space should: Exclude Human Bias : Allow the algorithm to explore architectures that a human designer might not consider. Be Flexible : Cover a wide variety of potential architectures to ensure the best possible model can be found.","title":"Search space in NAS"},{"location":"Maths/Neural%20networks/#1-entire-structured-search-space","text":"stacking a predefined number of nodes PROS : easy to implement CONS : * deeper= better generalisation ability BUT can be onerous & computationally expensive * lacks transferability (aka may need a new model for a larger dataset) ![[Pasted image 20240530095539.png]] Left: simplest Right: more complex as it permits arbitrary skip connections to exist btwn the ordered nodes (these nodes have been proven effective in practice)","title":"1. Entire-structured search space"},{"location":"Maths/Neural%20networks/#2-cell-based-search-space","text":"Compose of a fixed number of repeating cell structures (cell = motif / block) To enable the transferability of the generated model, the cell-based search space has been proposed, in which the neural architecture is composed of a fixed num ber of repeating cell structures. This design approach is based on the observation that many well-performing human-designed models are also built by stacking a fixed number of modules.","title":"2. Cell-based search space"}]}